var XpuWebWorker=function(){"use strict";function I(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}function g(g,C){if(g){if("string"==typeof g)return I(g,C);var e=Object.prototype.toString.call(g).slice(8,-1);return"Object"===e&&g.constructor&&(e=g.constructor.name),"Map"===e||"Set"===e?Array.from(g):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?I(g,C):void 0}}function C(I,C){return function(I){if(Array.isArray(I))return I}(I)||function(I,g){var C=null==I?null:"undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(null!=C){var e,A,t,r,c=[],i=!0,l=!1;try{if(t=(C=C.call(I)).next,0===g){if(Object(C)!==C)return;i=!1}else for(;!(i=(e=t.call(C)).done)&&(c.push(e.value),c.length!==g);i=!0);}catch(I){l=!0,A=I}finally{try{if(!i&&null!=C.return&&(r=C.return(),Object(r)!==r))return}finally{if(l)throw A}}return c}}(I,C)||g(I,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(I,g,C,e,A,t,r){try{var c=I[t](r),i=c.value}catch(I){return void C(I)}c.done?g(i):Promise.resolve(i).then(e,A)}function A(I){return function(){var g=this,C=arguments;return new Promise((function(A,t){var r=I.apply(g,C);function c(I){e(r,A,t,c,i,"next",I)}function i(I){e(r,A,t,c,i,"throw",I)}c(void 0)}))}}function t(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}var r={exports:{}},c={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(c);var i=c.exports;!function(I){var g=i.default;function C(){I.exports=C=function(){return A},I.exports.__esModule=!0,I.exports.default=I.exports;var e,A={},t=Object.prototype,r=t.hasOwnProperty,c=Object.defineProperty||function(I,g,C){I[g]=C.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{s({},"")}catch(e){s=function(I,g,C){return I[g]=C}}function a(I,g,C,e){var A=g&&g.prototype instanceof y?g:y,t=Object.create(A.prototype),r=new f(e||[]);return c(t,"_invoke",{value:H(I,C,r)}),t}function d(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}A.wrap=a;var b="suspendedStart",Z="suspendedYield",m="executing",u="completed",B={};function y(){}function G(){}function V(){}var h={};s(h,l,(function(){return this}));var W=Object.getPrototypeOf,R=W&&W(W(F([])));R&&R!==t&&r.call(R,l)&&(h=R);var p=V.prototype=y.prototype=Object.create(h);function X(I){["next","throw","return"].forEach((function(g){s(I,g,(function(I){return this._invoke(g,I)}))}))}function S(I,C){function e(A,t,c,i){var l=d(I[A],I,t);if("throw"!==l.type){var n=l.arg,o=n.value;return o&&"object"==g(o)&&r.call(o,"__await")?C.resolve(o.__await).then((function(I){e("next",I,c,i)}),(function(I){e("throw",I,c,i)})):C.resolve(o).then((function(I){n.value=I,c(n)}),(function(I){return e("throw",I,c,i)}))}i(l.arg)}var A;c(this,"_invoke",{value:function(I,g){function t(){return new C((function(C,A){e(I,g,C,A)}))}return A=A?A.then(t,t):t()}})}function H(I,g,C){var A=b;return function(t,r){if(A===m)throw new Error("Generator is already running");if(A===u){if("throw"===t)throw r;return{value:e,done:!0}}for(C.method=t,C.arg=r;;){var c=C.delegate;if(c){var i=k(c,C);if(i){if(i===B)continue;return i}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(A===b)throw A=u,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);A=m;var l=d(I,g,C);if("normal"===l.type){if(A=C.done?u:Z,l.arg===B)continue;return{value:l.arg,done:C.done}}"throw"===l.type&&(A=u,C.method="throw",C.arg=l.arg)}}}function k(I,g){var C=g.method,A=I.iterator[C];if(A===e)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=e,k(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var t=d(A,I.iterator,g.arg);if("throw"===t.type)return g.method="throw",g.arg=t.arg,g.delegate=null,B;var r=t.arg;return r?r.done?(g[I.resultName]=r.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=e),g.delegate=null,B):r:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function J(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function w(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function f(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(J,this),this.reset(!0)}function F(I){if(I||""===I){var C=I[l];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var A=-1,t=function g(){for(;++A<I.length;)if(r.call(I,A))return g.value=I[A],g.done=!1,g;return g.value=e,g.done=!0,g};return t.next=t}}throw new TypeError(g(I)+" is not iterable")}return G.prototype=V,c(p,"constructor",{value:V,configurable:!0}),c(V,"constructor",{value:G,configurable:!0}),G.displayName=s(V,o,"GeneratorFunction"),A.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===G||"GeneratorFunction"===(g.displayName||g.name))},A.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,V):(I.__proto__=V,s(I,o,"GeneratorFunction")),I.prototype=Object.create(p),I},A.awrap=function(I){return{__await:I}},X(S.prototype),s(S.prototype,n,(function(){return this})),A.AsyncIterator=S,A.async=function(I,g,C,e,t){void 0===t&&(t=Promise);var r=new S(a(I,g,C,e),t);return A.isGeneratorFunction(g)?r:r.next().then((function(I){return I.done?I.value:r.next()}))},X(p),s(p,o,"Generator"),s(p,l,(function(){return this})),s(p,"toString",(function(){return"[object Generator]"})),A.keys=function(I){var g=Object(I),C=[];for(var e in g)C.push(e);return C.reverse(),function I(){for(;C.length;){var e=C.pop();if(e in g)return I.value=e,I.done=!1,I}return I.done=!0,I}},A.values=F,f.prototype={constructor:f,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!I)for(var g in this)"t"===g.charAt(0)&&r.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=e)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,A){return c.type="throw",c.arg=I,g.next=C,A&&(g.method="next",g.arg=e),!!A}for(var A=this.tryEntries.length-1;A>=0;--A){var t=this.tryEntries[A],c=t.completion;if("root"===t.tryLoc)return C("end");if(t.tryLoc<=this.prev){var i=r.call(t,"catchLoc"),l=r.call(t,"finallyLoc");if(i&&l){if(this.prev<t.catchLoc)return C(t.catchLoc,!0);if(this.prev<t.finallyLoc)return C(t.finallyLoc)}else if(i){if(this.prev<t.catchLoc)return C(t.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<t.finallyLoc)return C(t.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var e=this.tryEntries[C];if(e.tryLoc<=this.prev&&r.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var A=e;break}}A&&("break"===I||"continue"===I)&&A.tryLoc<=g&&g<=A.finallyLoc&&(A=null);var t=A?A.completion:{};return t.type=I,t.arg=g,A?(this.method="next",this.next=A.finallyLoc,B):this.complete(t)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),w(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var e=C.completion;if("throw"===e.type){var A=e.arg;w(C)}return A}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:F(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=e),B}},A}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(r);var l=(0,r.exports)(),n=l;try{regeneratorRuntime=l}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=l:Function("r","regeneratorRuntime = r")(l)}var o=t(n);const s={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},a={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},d={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},b={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},Z={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class m{static getFirstMatch(I,g){const C=g.match(I);return C&&C.length>0&&C[1]||""}static getSecondMatch(I,g){const C=g.match(I);return C&&C.length>1&&C[2]||""}static matchAndReturnConst(I,g,C){if(I.test(g))return C}static getWindowsVersionName(I){switch(I){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),10===g[0])switch(g[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),!(1===g[0]&&g[1]<5))return 1===g[0]&&g[1]<6?"Cupcake":1===g[0]&&g[1]>=6?"Donut":2===g[0]&&g[1]<2?"Eclair":2===g[0]&&2===g[1]?"Froyo":2===g[0]&&g[1]>2?"Gingerbread":3===g[0]?"Honeycomb":4===g[0]&&g[1]<1?"Ice Cream Sandwich":4===g[0]&&g[1]<4?"Jelly Bean":4===g[0]&&g[1]>=4?"KitKat":5===g[0]?"Lollipop":6===g[0]?"Marshmallow":7===g[0]?"Nougat":8===g[0]?"Oreo":9===g[0]?"Pie":void 0}static getVersionPrecision(I){return I.split(".").length}static compareVersions(I,g,C=!1){const e=m.getVersionPrecision(I),A=m.getVersionPrecision(g);let t=Math.max(e,A),r=0;const c=m.map([I,g],(I=>{const g=t-m.getVersionPrecision(I),C=I+new Array(g+1).join(".0");return m.map(C.split("."),(I=>new Array(20-I.length).join("0")+I)).reverse()}));for(C&&(r=t-Math.min(e,A)),t-=1;t>=r;){if(c[0][t]>c[1][t])return 1;if(c[0][t]===c[1][t]){if(t===r)return 0;t-=1}else if(c[0][t]<c[1][t])return-1}}static map(I,g){const C=[];let e;if(Array.prototype.map)return Array.prototype.map.call(I,g);for(e=0;e<I.length;e+=1)C.push(g(I[e]));return C}static find(I,g){let C,e;if(Array.prototype.find)return Array.prototype.find.call(I,g);for(C=0,e=I.length;C<e;C+=1){const e=I[C];if(g(e,C))return e}}static assign(I,...g){const C=I;let e,A;if(Object.assign)return Object.assign(I,...g);for(e=0,A=g.length;e<A;e+=1){const I=g[e];if("object"==typeof I&&null!==I){Object.keys(I).forEach((g=>{C[g]=I[g]}))}}return I}static getBrowserAlias(I){return s[I]}static getBrowserTypeByAlias(I){return a[I]||""}}const u=/version\/(\d+(\.?_?\d+)+)/i,B=[{test:[/googlebot/i],describe(I){const g={name:"Googlebot"},C=m.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/opera/i],describe(I){const g={name:"Opera"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opr\/|opios/i],describe(I){const g={name:"Opera"},C=m.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/SamsungBrowser/i],describe(I){const g={name:"Samsung Internet for Android"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Whale/i],describe(I){const g={name:"NAVER Whale Browser"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MZBrowser/i],describe(I){const g={name:"MZ Browser"},C=m.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/focus/i],describe(I){const g={name:"Focus"},C=m.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/swing/i],describe(I){const g={name:"Swing"},C=m.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/coast/i],describe(I){const g={name:"Opera Coast"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(I){const g={name:"Opera Touch"},C=m.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/yabrowser/i],describe(I){const g={name:"Yandex Browser"},C=m.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/ucbrowser/i],describe(I){const g={name:"UC Browser"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Maxthon|mxios/i],describe(I){const g={name:"Maxthon"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/epiphany/i],describe(I){const g={name:"Epiphany"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/puffin/i],describe(I){const g={name:"Puffin"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sleipnir/i],describe(I){const g={name:"Sleipnir"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/k-meleon/i],describe(I){const g={name:"K-Meleon"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/micromessenger/i],describe(I){const g={name:"WeChat"},C=m.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/qqbrowser/i],describe(I){const g={name:/qqbrowserlite/i.test(I)?"QQ Browser Lite":"QQ Browser"},C=m.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/msie|trident/i],describe(I){const g={name:"Internet Explorer"},C=m.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/\sedg\//i],describe(I){const g={name:"Microsoft Edge"},C=m.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/edg([ea]|ios)/i],describe(I){const g={name:"Microsoft Edge"},C=m.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/vivaldi/i],describe(I){const g={name:"Vivaldi"},C=m.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/seamonkey/i],describe(I){const g={name:"SeaMonkey"},C=m.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sailfish/i],describe(I){const g={name:"Sailfish"},C=m.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,I);return C&&(g.version=C),g}},{test:[/silk/i],describe(I){const g={name:"Amazon Silk"},C=m.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/phantom/i],describe(I){const g={name:"PhantomJS"},C=m.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/slimerjs/i],describe(I){const g={name:"SlimerJS"},C=m.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g={name:"BlackBerry"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(web|hpw)[o0]s/i],describe(I){const g={name:"WebOS Browser"},C=m.getFirstMatch(u,I)||m.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/bada/i],describe(I){const g={name:"Bada"},C=m.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/tizen/i],describe(I){const g={name:"Tizen"},C=m.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/qupzilla/i],describe(I){const g={name:"QupZilla"},C=m.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/firefox|iceweasel|fxios/i],describe(I){const g={name:"Firefox"},C=m.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/electron/i],describe(I){const g={name:"Electron"},C=m.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MiuiBrowser/i],describe(I){const g={name:"Miui"},C=m.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/chromium/i],describe(I){const g={name:"Chromium"},C=m.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,I)||m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/chrome|crios|crmo/i],describe(I){const g={name:"Chrome"},C=m.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/GSA/i],describe(I){const g={name:"Google Search"},C=m.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g={name:"Android Browser"},C=m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/playstation 4/i],describe(I){const g={name:"PlayStation 4"},C=m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/safari|applewebkit/i],describe(I){const g={name:"Safari"},C=m.getFirstMatch(u,I);return C&&(g.version=C),g}},{test:[/.*/i],describe(I){const g=-1!==I.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:m.getFirstMatch(g,I),version:m.getSecondMatch(g,I)}}}];var y=[{test:[/Roku\/DVP/],describe(I){const g=m.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,I);return{name:b.Roku,version:g}}},{test:[/windows phone/i],describe(I){const g=m.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,I);return{name:b.WindowsPhone,version:g}}},{test:[/windows /i],describe(I){const g=m.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,I),C=m.getWindowsVersionName(g);return{name:b.Windows,version:g,versionName:C}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(I){const g={name:b.iOS},C=m.getSecondMatch(/(Version\/)(\d[\d.]+)/,I);return C&&(g.version=C),g}},{test:[/macintosh/i],describe(I){const g=m.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,I).replace(/[_\s]/g,"."),C=m.getMacOSVersionName(g),e={name:b.MacOS,version:g};return C&&(e.versionName=C),e}},{test:[/(ipod|iphone|ipad)/i],describe(I){const g=m.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,I).replace(/[_\s]/g,".");return{name:b.iOS,version:g}}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g=m.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,I),C=m.getAndroidVersionName(g),e={name:b.Android,version:g};return C&&(e.versionName=C),e}},{test:[/(web|hpw)[o0]s/i],describe(I){const g=m.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,I),C={name:b.WebOS};return g&&g.length&&(C.version=g),C}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g=m.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,I)||m.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,I)||m.getFirstMatch(/\bbb(\d+)/i,I);return{name:b.BlackBerry,version:g}}},{test:[/bada/i],describe(I){const g=m.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,I);return{name:b.Bada,version:g}}},{test:[/tizen/i],describe(I){const g=m.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,I);return{name:b.Tizen,version:g}}},{test:[/linux/i],describe:()=>({name:b.Linux})},{test:[/CrOS/],describe:()=>({name:b.ChromeOS})},{test:[/PlayStation 4/],describe(I){const g=m.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,I);return{name:b.PlayStation4,version:g}}}],G=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(I){const g=m.getFirstMatch(/(can-l01)/i,I)&&"Nova",C={type:d.mobile,vendor:"Huawei"};return g&&(C.model=g),C}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:d.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:d.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:d.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:d.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:d.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:d.tablet})},{test(I){const g=I.test(/ipod|iphone/i),C=I.test(/like (ipod|iphone)/i);return g&&!C},describe(I){const g=m.getFirstMatch(/(ipod|iphone)/i,I);return{type:d.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:d.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:d.mobile})},{test:I=>"blackberry"===I.getBrowserName(!0),describe:()=>({type:d.mobile,vendor:"BlackBerry"})},{test:I=>"bada"===I.getBrowserName(!0),describe:()=>({type:d.mobile})},{test:I=>"windows phone"===I.getBrowserName(),describe:()=>({type:d.mobile,vendor:"Microsoft"})},{test(I){const g=Number(String(I.getOSVersion()).split(".")[0]);return"android"===I.getOSName(!0)&&g>=3},describe:()=>({type:d.tablet})},{test:I=>"android"===I.getOSName(!0),describe:()=>({type:d.mobile})},{test:I=>"macos"===I.getOSName(!0),describe:()=>({type:d.desktop,vendor:"Apple"})},{test:I=>"windows"===I.getOSName(!0),describe:()=>({type:d.desktop})},{test:I=>"linux"===I.getOSName(!0),describe:()=>({type:d.desktop})},{test:I=>"playstation 4"===I.getOSName(!0),describe:()=>({type:d.tv})},{test:I=>"roku"===I.getOSName(!0),describe:()=>({type:d.tv})}],V=[{test:I=>"microsoft edge"===I.getBrowserName(!0),describe(I){if(/\sedg\//i.test(I))return{name:Z.Blink};const g=m.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,I);return{name:Z.EdgeHTML,version:g}}},{test:[/trident/i],describe(I){const g={name:Z.Trident},C=m.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:I=>I.test(/presto/i),describe(I){const g={name:Z.Presto},C=m.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=I.test(/gecko/i),C=I.test(/like gecko/i);return g&&!C},describe(I){const g={name:Z.Gecko},C=m.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:Z.Blink})},{test:[/(apple)?webkit/i],describe(I){const g={name:Z.WebKit},C=m.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}}];class h{constructor(I,g=!1){if(null==I||""===I)throw new Error("UserAgent parameter can't be empty");this._ua=I,this.parsedResult={},!0!==g&&this.parse()}getUA(){return this._ua}test(I){return I.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const I=m.find(B,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.browser=I.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(I){return I?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const I=m.find(y,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.os=I.describe(this.getUA())),this.parsedResult.os}getOSName(I){const{name:g}=this.getOS();return I?String(g).toLowerCase()||"":g||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(I=!1){const{type:g}=this.getPlatform();return I?String(g).toLowerCase()||"":g||""}parsePlatform(){this.parsedResult.platform={};const I=m.find(G,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.platform=I.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(I){return I?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const I=m.find(V,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.engine=I.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return m.assign({},this.parsedResult)}satisfies(I){const g={};let C=0;const e={};let A=0;if(Object.keys(I).forEach((t=>{const r=I[t];"string"==typeof r?(e[t]=r,A+=1):"object"==typeof r&&(g[t]=r,C+=1)})),C>0){const I=Object.keys(g),C=m.find(I,(I=>this.isOS(I)));if(C){const I=this.satisfies(g[C]);if(void 0!==I)return I}const e=m.find(I,(I=>this.isPlatform(I)));if(e){const I=this.satisfies(g[e]);if(void 0!==I)return I}}if(A>0){const I=Object.keys(e),g=m.find(I,(I=>this.isBrowser(I,!0)));if(void 0!==g)return this.compareVersion(e[g])}}isBrowser(I,g=!1){const C=this.getBrowserName().toLowerCase();let e=I.toLowerCase();const A=m.getBrowserTypeByAlias(e);return g&&A&&(e=A.toLowerCase()),e===C}compareVersion(I){let g=[0],C=I,e=!1;const A=this.getBrowserVersion();if("string"==typeof A)return">"===I[0]||"<"===I[0]?(C=I.substr(1),"="===I[1]?(e=!0,C=I.substr(2)):g=[],">"===I[0]?g.push(1):g.push(-1)):"="===I[0]?C=I.substr(1):"~"===I[0]&&(e=!0,C=I.substr(1)),g.indexOf(m.compareVersions(A,C,e))>-1}isOS(I){return this.getOSName(!0)===String(I).toLowerCase()}isPlatform(I){return this.getPlatformType(!0)===String(I).toLowerCase()}isEngine(I){return this.getEngineName(!0)===String(I).toLowerCase()}is(I,g=!1){return this.isBrowser(I,g)||this.isOS(I)||this.isPlatform(I)}some(I=[]){return I.some((I=>this.is(I)))}}
/*!
   * Bowser - a browser detector
   * https://github.com/lancedikson/bowser
   * MIT License | (c) Dustin Diaz 2012-2015
   * MIT License | (c) Denis Demchenko 2015-2019
   */class W{static getParser(I,g=!1){if("string"!=typeof I)throw new Error("UserAgent should be a string");return new h(I,g)}static parse(I){return new h(I).getResult()}static get BROWSER_MAP(){return a}static get ENGINE_MAP(){return Z}static get OS_MAP(){return b}static get PLATFORMS_MAP(){return d}}var R={exports:{}},p={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(p);var X=p.exports;!function(I){var g=X.default;function C(){I.exports=C=function(){return A},I.exports.__esModule=!0,I.exports.default=I.exports;var e,A={},t=Object.prototype,r=t.hasOwnProperty,c=Object.defineProperty||function(I,g,C){I[g]=C.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{s({},"")}catch(e){s=function(I,g,C){return I[g]=C}}function a(I,g,C,e){var A=g&&g.prototype instanceof y?g:y,t=Object.create(A.prototype),r=new f(e||[]);return c(t,"_invoke",{value:H(I,C,r)}),t}function d(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}A.wrap=a;var b="suspendedStart",Z="suspendedYield",m="executing",u="completed",B={};function y(){}function G(){}function V(){}var h={};s(h,l,(function(){return this}));var W=Object.getPrototypeOf,R=W&&W(W(F([])));R&&R!==t&&r.call(R,l)&&(h=R);var p=V.prototype=y.prototype=Object.create(h);function X(I){["next","throw","return"].forEach((function(g){s(I,g,(function(I){return this._invoke(g,I)}))}))}function S(I,C){function e(A,t,c,i){var l=d(I[A],I,t);if("throw"!==l.type){var n=l.arg,o=n.value;return o&&"object"==g(o)&&r.call(o,"__await")?C.resolve(o.__await).then((function(I){e("next",I,c,i)}),(function(I){e("throw",I,c,i)})):C.resolve(o).then((function(I){n.value=I,c(n)}),(function(I){return e("throw",I,c,i)}))}i(l.arg)}var A;c(this,"_invoke",{value:function(I,g){function t(){return new C((function(C,A){e(I,g,C,A)}))}return A=A?A.then(t,t):t()}})}function H(I,g,C){var A=b;return function(t,r){if(A===m)throw new Error("Generator is already running");if(A===u){if("throw"===t)throw r;return{value:e,done:!0}}for(C.method=t,C.arg=r;;){var c=C.delegate;if(c){var i=k(c,C);if(i){if(i===B)continue;return i}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(A===b)throw A=u,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);A=m;var l=d(I,g,C);if("normal"===l.type){if(A=C.done?u:Z,l.arg===B)continue;return{value:l.arg,done:C.done}}"throw"===l.type&&(A=u,C.method="throw",C.arg=l.arg)}}}function k(I,g){var C=g.method,A=I.iterator[C];if(A===e)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=e,k(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var t=d(A,I.iterator,g.arg);if("throw"===t.type)return g.method="throw",g.arg=t.arg,g.delegate=null,B;var r=t.arg;return r?r.done?(g[I.resultName]=r.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=e),g.delegate=null,B):r:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function J(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function w(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function f(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(J,this),this.reset(!0)}function F(I){if(I||""===I){var C=I[l];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var A=-1,t=function g(){for(;++A<I.length;)if(r.call(I,A))return g.value=I[A],g.done=!1,g;return g.value=e,g.done=!0,g};return t.next=t}}throw new TypeError(g(I)+" is not iterable")}return G.prototype=V,c(p,"constructor",{value:V,configurable:!0}),c(V,"constructor",{value:G,configurable:!0}),G.displayName=s(V,o,"GeneratorFunction"),A.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===G||"GeneratorFunction"===(g.displayName||g.name))},A.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,V):(I.__proto__=V,s(I,o,"GeneratorFunction")),I.prototype=Object.create(p),I},A.awrap=function(I){return{__await:I}},X(S.prototype),s(S.prototype,n,(function(){return this})),A.AsyncIterator=S,A.async=function(I,g,C,e,t){void 0===t&&(t=Promise);var r=new S(a(I,g,C,e),t);return A.isGeneratorFunction(g)?r:r.next().then((function(I){return I.done?I.value:r.next()}))},X(p),s(p,o,"Generator"),s(p,l,(function(){return this})),s(p,"toString",(function(){return"[object Generator]"})),A.keys=function(I){var g=Object(I),C=[];for(var e in g)C.push(e);return C.reverse(),function I(){for(;C.length;){var e=C.pop();if(e in g)return I.value=e,I.done=!1,I}return I.done=!0,I}},A.values=F,f.prototype={constructor:f,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!I)for(var g in this)"t"===g.charAt(0)&&r.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=e)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,A){return c.type="throw",c.arg=I,g.next=C,A&&(g.method="next",g.arg=e),!!A}for(var A=this.tryEntries.length-1;A>=0;--A){var t=this.tryEntries[A],c=t.completion;if("root"===t.tryLoc)return C("end");if(t.tryLoc<=this.prev){var i=r.call(t,"catchLoc"),l=r.call(t,"finallyLoc");if(i&&l){if(this.prev<t.catchLoc)return C(t.catchLoc,!0);if(this.prev<t.finallyLoc)return C(t.finallyLoc)}else if(i){if(this.prev<t.catchLoc)return C(t.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<t.finallyLoc)return C(t.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var e=this.tryEntries[C];if(e.tryLoc<=this.prev&&r.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var A=e;break}}A&&("break"===I||"continue"===I)&&A.tryLoc<=g&&g<=A.finallyLoc&&(A=null);var t=A?A.completion:{};return t.type=I,t.arg=g,A?(this.method="next",this.next=A.finallyLoc,B):this.complete(t)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),w(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var e=C.completion;if("throw"===e.type){var A=e.arg;w(C)}return A}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:F(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=e),B}},A}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(R);var S=(0,R.exports)();try{regeneratorRuntime=S}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=S:Function("r","regeneratorRuntime = r")(S)}function H(I){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},H(I)}function k(I){var g=function(I,g){if("object"!==H(I)||null===I)return I;var C=I[Symbol.toPrimitive];if(void 0!==C){var e=C.call(I,g||"default");if("object"!==H(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(I)}(I,"string");return"symbol"===H(g)?g:String(g)}function J(I,g){for(var C=0;C<g.length;C++){var e=g[C];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(I,k(e.key),e)}}function w(I){return I<0?I>>>0:I}function f(I,g){for(var C=g;0!==I[C];)C++;return new TextDecoder("utf-8").decode(I.slice(g,C))}function F(I,g,C){var e=void 0===g?null:g,A=function(I,g){var C=atob(I);if(g){for(var e=new Uint8Array(C.length),A=0,t=C.length;A<t;++A)e[A]=C.charCodeAt(A);return String.fromCharCode.apply(null,new Uint16Array(e.buffer))}return C}(I,void 0!==C&&C),t=A.indexOf("\n",10)+1,r=A.substring(t)+(e?"//# sourceMappingURL="+e:""),c=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(c)}(function(){function I(){!function(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}(this,I),this._path=""}var g,C,e;return g=I,e=[{key:"getPtr",value:function(g){if(I._filePtrs.has(g))return I._filePtrs.get(g);throw new Error("File instance not found.")}},{key:"setPtr",value:function(g,C){I._filePtrs.set(g,C)}},{key:"removePtr",value:function(g){I._filePtrs.delete(g)}}],(C=[{key:"meta",get:function(){if(void 0!==this._meta)return Object.assign({version:0},this._meta)}},{key:"pageSize",get:function(){}}])&&J(g.prototype,C),e&&J(g,e),Object.defineProperty(g,"prototype",{writable:!1}),I}())._filePtrs=new Map;var Y,v,K,N,E,U=(Y="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX3R5cGVvZiQzKG8pIHsKICAgICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7CgogICAgcmV0dXJuIF90eXBlb2YkMyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvOwogICAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgICB9LCBfdHlwZW9mJDMobyk7CiAgfQoKICBmdW5jdGlvbiB0b1ByaW1pdGl2ZSh0LCByKSB7CiAgICBpZiAoIm9iamVjdCIgIT0gX3R5cGVvZiQzKHQpIHx8ICF0KSByZXR1cm4gdDsKICAgIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdOwogICAgaWYgKHZvaWQgMCAhPT0gZSkgewogICAgICB2YXIgaSA9IGUuY2FsbCh0LCByIHx8ICJkZWZhdWx0Iik7CiAgICAgIGlmICgib2JqZWN0IiAhPSBfdHlwZW9mJDMoaSkpIHJldHVybiBpOwogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOwogICAgfQogICAgcmV0dXJuICgic3RyaW5nIiA9PT0gciA/IFN0cmluZyA6IE51bWJlcikodCk7CiAgfQoKICBmdW5jdGlvbiB0b1Byb3BlcnR5S2V5KHQpIHsKICAgIHZhciBpID0gdG9QcmltaXRpdmUodCwgInN0cmluZyIpOwogICAgcmV0dXJuICJzeW1ib2wiID09IF90eXBlb2YkMyhpKSA/IGkgOiBTdHJpbmcoaSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgICBrZXkgPSB0b1Byb3BlcnR5S2V5KGtleSk7CiAgICBpZiAoa2V5IGluIG9iaikgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CgogIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgIHRyeSB7CiAgICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHJlamVjdChlcnJvcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CiAgICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgICB9CiAgICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgICAgfSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMSAoeCkgewogIAlyZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdkZWZhdWx0JykgPyB4WydkZWZhdWx0J10gOiB4OwogIH0KCiAgdmFyIHJlZ2VuZXJhdG9yUnVudGltZSQyID0ge2V4cG9ydHM6IHt9fTsKCiAgdmFyIF90eXBlb2YkMiA9IHtleHBvcnRzOiB7fX07CgogIF90eXBlb2YkMi5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKICAJICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwoKICAJICByZXR1cm4gKG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiB0eXBlb2YgbzsKICAJICB9IDogZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgCSAgfSwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cyksIF90eXBlb2Yobyk7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChfdHlwZW9mJDIpKTsKCiAgdmFyIF90eXBlb2ZFeHBvcnRzJDEgPSBfdHlwZW9mJDIuZXhwb3J0czsKCiAgcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJdmFyIF90eXBlb2YgPSBfdHlwZW9mRXhwb3J0cyQxWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMikpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyQxID0gcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgLy8gVE9ETyhCYWJlbCA4KTogUmVtb3ZlIHRoaXMgZmlsZS4KCiAgdmFyIHJ1bnRpbWUkMSA9IHJlZ2VuZXJhdG9yUnVudGltZUV4cG9ydHMkMSgpOwogIHZhciByZWdlbmVyYXRvciQxID0gcnVudGltZSQxOwoKICAvLyBDb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL3BhY2thZ2VzL3J1bnRpbWUvcnVudGltZS5qcyNMNzM2PQogIHRyeSB7CiAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgICB9IGVsc2UgewogICAgICBGdW5jdGlvbigiciIsICJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikocnVudGltZSQxKTsKICAgIH0KICB9CgogIHZhciBfcmVnZW5lcmF0b3JSdW50aW1lJDEgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMShyZWdlbmVyYXRvciQxKTsKCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMgKHgpIHsKICAJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKICB9CgogIHZhciByZWdlbmVyYXRvclJ1bnRpbWUkMSA9IHtleHBvcnRzOiB7fX07CgogIHZhciBfdHlwZW9mJDEgPSB7ZXhwb3J0czoge319OwoKICBfdHlwZW9mJDEuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJZnVuY3Rpb24gX3R5cGVvZihvKSB7CiAgCSAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKCiAgCSAgcmV0dXJuIChtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gdHlwZW9mIG87CiAgCSAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gbyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMpLCBfdHlwZW9mKG8pOwogIAl9CiAgCW1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0czsgCiAgfSAoX3R5cGVvZiQxKSk7CgogIHZhciBfdHlwZW9mRXhwb3J0cyA9IF90eXBlb2YkMS5leHBvcnRzOwoKICByZWdlbmVyYXRvclJ1bnRpbWUkMS5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAl2YXIgX3R5cGVvZiA9IF90eXBlb2ZFeHBvcnRzWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMSkpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyA9IHJlZ2VuZXJhdG9yUnVudGltZSQxLmV4cG9ydHM7CgogIC8vIFRPRE8oQmFiZWwgOCk6IFJlbW92ZSB0aGlzIGZpbGUuCgogIHZhciBydW50aW1lID0gcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cygpOwogIHZhciByZWdlbmVyYXRvciA9IHJ1bnRpbWU7CgogIC8vIENvcGllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vcGFja2FnZXMvcnVudGltZS9ydW50aW1lLmpzI0w3MzY9CiAgdHJ5IHsKICAgIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWU7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lOwogICAgfSBlbHNlIHsKICAgICAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUpOwogICAgfQogIH0KCiAgdmFyIF9yZWdlbmVyYXRvclJ1bnRpbWUgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMocmVnZW5lcmF0b3IpOwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQ0KICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuDQoNCiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZDQogIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwNCiAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SDQogIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1INCiAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCg0KICBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0NCiAgICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgICB9KTsNCiAgfQoKICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICAgIG8uX19wcm90b19fID0gcDsKICAgICAgcmV0dXJuIG87CiAgICB9OwogICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICAgIH0KICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfQogICAgfSk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7CiAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgfSk7CiAgICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKICB9CgogIGZ1bmN0aW9uIF90eXBlb2YobykgewogICAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKCiAgICByZXR1cm4gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvOwogICAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgICB9LCBfdHlwZW9mKG8pOwogIH0KCiAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgICB9CiAgICByZXR1cm4gc2VsZjsKICB9CgogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICAgIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgcmV0dXJuIGNhbGw7CiAgICB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOwogICAgfQogICAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7CiAgfQoKICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayQxKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHsKICAgIGlmIChfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsKICAgIHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsKICAgIGlmIChwcmltICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpOwogICAgICBpZiAoX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTsKICAgIH0KICAgIHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsKICB9CgogIGZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgewogICAgdmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTsKICAgIHJldHVybiBfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyQxKHRhcmdldCwgcHJvcHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MkMShDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyQxKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzJDEoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CgogIC8qDQogICAgQ29weXJpZ2h0IDIwMjItMjAyMyBQaWNvdm9pY2UgSW5jLg0KCiAgICBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIGxpY2Vuc2UuIEEgY29weSBvZiB0aGUgbGljZW5zZSBpcyBsb2NhdGVkIGluIHRoZSAiTElDRU5TRSINCiAgICBmaWxlIGFjY29tcGFueWluZyB0aGlzIHNvdXJjZS4NCgogICAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbg0KICAgIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQ0KICAgIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogICovCiAgLyoqDQogICAqIEJhc2VQdkZpbGUgQ2xhc3MNCiAgICogVGhpcyBjbGFzcyBtb2NrcyB0aGUgZmlsZSBzeXN0ZW0gdXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UuDQogICAqLwogIHZhciBQdkZpbGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUHZGaWxlKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2skMSh0aGlzLCBQdkZpbGUpOwogICAgICB0aGlzLl9wYXRoID0gJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiBHZXR0ZXIgZm9yIGZpbGUncyBtZXRhIGluZm9ybWF0aW9uLg0KICAgICAqLwogICAgX2NyZWF0ZUNsYXNzJDEoUHZGaWxlLCBbewogICAgICBrZXk6ICJtZXRhIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMuX21ldGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgdmVyc2lvbjogMAogICAgICAgIH0sIHRoaXMuX21ldGEpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInBhZ2VTaXplIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgICAvKioNCiAgICAgICAqIEdldCB0aGUgZmlsZSBwb2ludGVyIGZyb20gdGhlIF9maWxlUHRycyBtYXAuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBwb2ludGVyIHRvIEJhc2VQdkZpbGUgaW5zdGFuY2UgdG8gZ2V0IGZyb20gdGhlIG1hcC4NCiAgICAgICAqIEByZXR1cm5zIEJhc2VQdkZpbGUgcmV0dXJucyB0aGUgY3VycmVudCBmaWxlIGluc3RhbmNlIHJlbGF0ZWQgdG8gcHRyLg0KICAgICAgICovCiAgICB9XSwgW3sKICAgICAga2V5OiAiZ2V0UHRyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFB0cihwdHIpIHsKICAgICAgICBpZiAoUHZGaWxlLl9maWxlUHRycy5oYXMocHRyKSkgewogICAgICAgICAgcmV0dXJuIFB2RmlsZS5fZmlsZVB0cnMuZ2V0KHB0cik7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSBpbnN0YW5jZSBub3QgZm91bmQuJyk7CiAgICAgIH0KICAgICAgLyoqDQogICAgICAgKiBTYXZlcyB0aGUgQmFzZVB2RmlsZSBpbnN0YW5jZSB0byB0aGUgbWFwIHdpdGggYW4gYXNzb2NpYXRlZCBwdHIuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBmaWxlIHBvaW50ZXIgdG8gc2F2ZSBhcyB0aGUga2V5Lg0KICAgICAgICogQHBhcmFtIGluc3RhbmNlIFRoZSBCYXNlUHZGaWxlIGluc3RhbmNlIHRvIHNhdmUgYXMgdGhlIHZhbHVlLg0KICAgICAgICovCiAgICB9LCB7CiAgICAgIGtleTogInNldFB0ciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQdHIocHRyLCBpbnN0YW5jZSkgewogICAgICAgIFB2RmlsZS5fZmlsZVB0cnMuc2V0KHB0ciwgaW5zdGFuY2UpOwogICAgICB9CiAgICAgIC8qKg0KICAgICAgICogUmVtb3ZlcyB0aGUgcHRyIGZyb20gdGhlIF9maWxlUHRycyBtYXAuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBmaWxlIHBvaW50ZXIgdG8gcmVtb3ZlLg0KICAgICAgICovCiAgICB9LCB7CiAgICAgIGtleTogInJlbW92ZVB0ciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVQdHIocHRyKSB7CiAgICAgICAgUHZGaWxlLl9maWxlUHRyc1siZGVsZXRlIl0ocHRyKTsKICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIFB2RmlsZTsKICB9KCk7CiAgUHZGaWxlLl9maWxlUHRycyA9IG5ldyBNYXAoKTsKCiAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KICBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQogIC8qKg0KICAgKiBQdkZpbGVNZW0gQ2xhc3MNCiAgICogVGhpcyBjbGFzcyBtb2NrcyB0aGUgZmlsZSBzeXN0ZW0gdXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UuDQogICAqLwogIHZhciBQdkZpbGVNZW0gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QdkZpbGUpIHsKICAgIF9pbmhlcml0cyhQdkZpbGVNZW0sIF9QdkZpbGUpOwogICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihQdkZpbGVNZW0pOwogICAgZnVuY3Rpb24gUHZGaWxlTWVtKHBhdGgsIG1ldGEsIGRiLCBtb2RlKSB7CiAgICAgIHZhciBfdGhpczsKICAgICAgX2NsYXNzQ2FsbENoZWNrJDEodGhpcywgUHZGaWxlTWVtKTsKICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKICAgICAgX3RoaXMuX3BvcyA9IDA7CiAgICAgIF90aGlzLl9wYXRoID0gcGF0aDsKICAgICAgX3RoaXMuX21ldGEgPSBtZXRhOwogICAgICBfdGhpcy5fbW9kZSA9IG1vZGU7CiAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyQxKFB2RmlsZU1lbSwgW3sKICAgICAga2V5OiAiY2xvc2UiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInJlYWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZChzaXplLCBjb3VudCkgewogICAgICAgIGlmICghdGhpcy5leGlzdHMoKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCInIi5jb25jYXQodGhpcy5fcGF0aCwgIicgZG9lc24ndCBleGlzdC4iKSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pc0VPRikgewogICAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcigiRU9GIik7CiAgICAgICAgICBlcnIubmFtZSA9ICJFbmRPZkZpbGUiOwogICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIH0KICAgICAgICB2YXIgdG9Db3B5ID0gTWF0aC5taW4oc2l6ZSAqIGNvdW50LCB0aGlzLl9maWxlLmxlbmd0aCAtIHRoaXMuX3Bvcyk7CiAgICAgICAgdmFyIHRvdGFsRWxlbXMgPSB0b0NvcHkgLSB0b0NvcHkgJSBzaXplOwogICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSh0b3RhbEVsZW1zKTsKICAgICAgICBidWZmZXIuc2V0KHRoaXMuX2ZpbGUuc2xpY2UodGhpcy5fcG9zLCB0aGlzLl9wb3MgKyB0b3RhbEVsZW1zKSwgMCk7CiAgICAgICAgdGhpcy5fcG9zICs9IHRvdGFsRWxlbXM7CiAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJ3cml0ZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB3cml0ZShjb250ZW50KSB7CiAgICAgICAgdmFyIG5ld0ZpbGUgPSBuZXcgVWludDhBcnJheSh0aGlzLl9wb3MgKyBjb250ZW50Lmxlbmd0aCk7CiAgICAgICAgaWYgKHRoaXMuX2ZpbGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3RmlsZS5zZXQodGhpcy5fZmlsZS5zbGljZSgwLCB0aGlzLl9wb3MpKTsKICAgICAgICAgIG5ld0ZpbGUuc2V0KGNvbnRlbnQsIHRoaXMuX3Bvcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld0ZpbGUuc2V0KGNvbnRlbnQpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9maWxlID0gbmV3RmlsZTsKICAgICAgICB0aGlzLl9wb3MgKz0gY29udGVudC5sZW5ndGg7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic2VlayIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWVrKG9mZnNldCwgd2hlbmNlKSB7CiAgICAgICAgaWYgKCF0aGlzLmV4aXN0cygpICYmIHRoaXMuX21vZGUgPT09ICJyZWFkb25seSIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiJyIuY29uY2F0KHRoaXMuX3BhdGgsICInIGRvZXNuJ3QgZXhpc3QuIikpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuZXhpc3RzKCkpIHsKICAgICAgICAgIC8vIFRoaXMgaXMgdmFsaWQgaW4gSVNPIEMgYnV0IG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBjdXJyZW50IGltcGxlbWVudGF0aW9uCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiciLmNvbmNhdCh0aGlzLl9wYXRoLCAiJyBkb2Vzbid0IGV4aXN0LiIpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9mZnNldCA8IDApIHsKICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoIkVPRiIpOwogICAgICAgICAgZXJyLm5hbWUgPSAiRW5kT2ZGaWxlIjsKICAgICAgICAgIHRocm93IGVycjsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld09mZnNldDsKICAgICAgICBpZiAod2hlbmNlID09PSAwKSB7CiAgICAgICAgICBuZXdPZmZzZXQgPSBNYXRoLm1pbihvZmZzZXQsIHRoaXMuX2ZpbGUubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKHdoZW5jZSA9PT0gMSkgewogICAgICAgICAgbmV3T2Zmc2V0ID0gTWF0aC5taW4odGhpcy5fcG9zICsgb2Zmc2V0LCB0aGlzLl9maWxlLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmICh3aGVuY2UgPT09IDIpIHsKICAgICAgICAgIG5ld09mZnNldCA9IE1hdGgubWluKHRoaXMuX2ZpbGUubGVuZ3RoICsgb2Zmc2V0LCB0aGlzLl9maWxlLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBvcGVyYXRpb246ICIuY29uY2F0KHdoZW5jZSwgIi4iKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3BvcyA9IG5ld09mZnNldDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJ0ZWxsIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRlbGwoKSB7CiAgICAgICAgaWYgKCF0aGlzLmV4aXN0cygpKSB7CiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9wb3M7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFTk9FTlQiKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBQdkZpbGVNZW0uX21lbUZpbGVzWyJkZWxldGUiXSh0aGlzLl9wYXRoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BvcyA9IDA7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZXhpc3RzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGV4aXN0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmlsZSAhPT0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9pc0VPRiIsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wb3MgPj0gdGhpcy5fZmlsZS5sZW5ndGg7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2ZpbGUiLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gUHZGaWxlTWVtLl9tZW1GaWxlcy5nZXQodGhpcy5fcGF0aCk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGNvbnRlbnQpIHsKICAgICAgICBQdkZpbGVNZW0uX21lbUZpbGVzLnNldCh0aGlzLl9wYXRoLCBjb250ZW50KTsKICAgICAgfQogICAgfV0sIFt7CiAgICAgIGtleTogIm9wZW4iLAogICAgICB2YWx1ZTogZnVuY3Rpb24gb3BlbihwYXRoLCBtb2RlKSB7CiAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uX21lbUZpbGVzLmdldChwYXRoKTsKICAgICAgICB2YXIgZGJNb2RlID0gbW9kZS5pbmNsdWRlcygncicpID8gInJlYWRvbmx5IiA6ICJyZWFkd3JpdGUiOwogICAgICAgIGlmIChmaWxlID09PSB1bmRlZmluZWQgJiYgZGJNb2RlID09PSAicmVhZG9ubHkiKSB7CiAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IoIiciLmNvbmNhdChwYXRoLCAiJyBkb2Vzbid0IGV4aXN0LiIpKTsKICAgICAgICAgIGVycm9yLm5hbWUgPSAiRmlsZU5vdEV4aXN0cyI7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICAgICAgdmFyIGZpbGVNZW0gPSBuZXcgUHZGaWxlTWVtKHBhdGgsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYk1vZGUpOwogICAgICAgIGlmIChtb2RlLmluY2x1ZGVzKCdhJykpIHsKICAgICAgICAgIGZpbGVNZW0uc2VlaygwLCAyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbGVNZW07CiAgICAgIH0KICAgIH1dKTsKICAgIHJldHVybiBQdkZpbGVNZW07CiAgfShQdkZpbGUpOwogIFB2RmlsZU1lbS5fbWVtRmlsZXMgPSBuZXcgTWFwKCk7CiAgLyoqDQogICAqIENhc3QgYSBzaWduZWQgYWRkcmVzcyB0byB1bnNpZ25lZCBhZGRyZXNzLg0KICAgKg0KICAgKiBAcGFyYW0gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBjYXN0IHRvIHVuc2lnbmVkIGFkZHJlc3MuDQogICAqLwogIGZ1bmN0aW9uIHVuc2lnbmVkQWRkcmVzcyhhZGRyZXNzKSB7CiAgICBpZiAoYWRkcmVzcyA8IDApIHsKICAgICAgcmV0dXJuIGFkZHJlc3MgPj4+IDA7CiAgICB9CiAgICByZXR1cm4gYWRkcmVzczsKICB9CgogIHZhciBQdlhwdUFjdGlvbjsKICAoZnVuY3Rpb24gKFB2WHB1QWN0aW9uKSB7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiSU5JVCJdID0gMF0gPSAiSU5JVCI7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiQUxMT0MiXSA9IDFdID0gIkFMTE9DIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJGUkVFIl0gPSAyXSA9ICJGUkVFIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJDT1BZX1RPX1hQVSJdID0gM10gPSAiQ09QWV9UT19YUFUiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIkNPUFlfRlJPTV9YUFUiXSA9IDRdID0gIkNPUFlfRlJPTV9YUFUiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIk1FTVNFVCJdID0gNV0gPSAiTUVNU0VUIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJUSU1FUl9TVEFSVCJdID0gNl0gPSAiVElNRVJfU1RBUlQiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIlRJTUVSX1NUT1AiXSA9IDddID0gIlRJTUVSX1NUT1AiOwogICAgLy8gb3RoZXIgeHB1IGFjdGlvbnMKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJNQVRSSVhfVkVDVE9SX01VTFRJUExZIl0gPSA4XSA9ICJNQVRSSVhfVkVDVE9SX01VTFRJUExZIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJTWU5DX1ZFQ1RPUiJdID0gOV0gPSAiU1lOQ19WRUNUT1IiOwogIH0pKFB2WHB1QWN0aW9uIHx8IChQdlhwdUFjdGlvbiA9IHt9KSk7CgogIGNvbnN0IHdhc2lfc25hcHNob3RfcHJldmlldzFfZW11bGF0b3IgPSB7CiAgICBhcmdzX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGFyZ3Nfc2l6ZXNfZ2V0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZW52aXJvbl9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBlbnZpcm9uX3NpemVzX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGNsb2NrX3Jlc19nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBjbG9ja190aW1lX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2FkdmlzZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2FsbG9jYXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfY2xvc2U6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9kYXRhc3luYzogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2Zkc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9mZHN0YXRfc2V0X2ZsYWdzOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfZmRzdGF0X3NldF9yaWdodHM6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9maWxlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9maWxlc3RhdF9zZXRfc2l6ZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2ZpbGVzdGF0X3NldF90aW1lczogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3ByZWFkOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcHJlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9wcmVzdGF0X2Rpcl9uYW1lOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcHdyaXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcmVhZDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3JlYWRkaXI6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9yZW51bWJlcjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3NlZWs6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9zeW5jOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfdGVsbDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3dyaXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9jcmVhdGVfZGlyZWN0b3J5OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9maWxlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX2ZpbGVzdGF0X3NldF90aW1lczogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfbGluazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfb3BlbjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfcmVhZGxpbms6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX3JlbW92ZV9kaXJlY3Rvcnk6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX3JlbmFtZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfc3ltbGluazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfdW5saW5rX2ZpbGU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwb2xsX29uZW9mZjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHByb2NfZXhpdDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHByb2NfcmFpc2U6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzY2hlZF95aWVsZDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHJhbmRvbV9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3JlY3Y6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3NlbmQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3NodXRkb3duOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogIH07CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uOwogIChmdW5jdGlvbiAoUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uKSB7CiAgICBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uWyJBVFRFTlRJT05fUFJFQ09NUFVURV9FTkNPRElORyJdID0gMjAwXSA9ICJBVFRFTlRJT05fUFJFQ09NUFVURV9FTkNPRElORyI7CiAgICBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uWyJBVFRFTlRJT05fQVRURU5EX0NPTUJJTkVEIl0gPSAyMDFdID0gIkFUVEVOVElPTl9BVFRFTkRfQ09NQklORUQiOwogIH0pKFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbiB8fCAoUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uID0ge30pKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CgogIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7IHZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07IGlmICghaXQpIHsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsgaWYgKGl0KSBvID0gaXQ7IHZhciBpID0gMDsgdmFyIEYgPSBmdW5jdGlvbiBGKCkge307IHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsgdGhyb3cgX2U7IH0sIGY6IEYgfTsgfSB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0gdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOyByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgeyBpdCA9IGl0LmNhbGwobyk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7IH0gfSB9OyB9CiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldOyByZXR1cm4gYXJyMjsgfQogIHZhciBQdlhwdSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBQdlhwdSgpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFB2WHB1KTsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyhQdlhwdSwgbnVsbCwgW3sKICAgICAga2V5OiAiYWRkWHB1IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFhwdShvYmpBZGRyZXNzLCBkYXRhKSB7CiAgICAgICAgUHZYcHUueHB1T2JqZWN0cy5zZXQob2JqQWRkcmVzcywgZGF0YSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0WHB1IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFhwdShvYmpBZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIFB2WHB1LnhwdU9iamVjdHMuZ2V0KG9iakFkZHJlc3MpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImhhc1hwdSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNYcHUob2JqQWRkcmVzcykgewogICAgICAgIHJldHVybiBQdlhwdS54cHVPYmplY3RzLmhhcyhvYmpBZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmVYcHUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlWHB1KG9iakFkZHJlc3MpIHsKICAgICAgICBpZiAoUHZYcHUueHB1T2JqZWN0cy5oYXMob2JqQWRkcmVzcykpIHsKICAgICAgICAgIHZhciBfUHZYcHUkeHB1T2JqZWN0cyRnZXQgPSBQdlhwdS54cHVPYmplY3RzLmdldChvYmpBZGRyZXNzKSwKICAgICAgICAgICAgZGV2aWNlTWVtID0gX1B2WHB1JHhwdU9iamVjdHMkZ2V0LmRldmljZU1lbTsKICAgICAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihkZXZpY2VNZW0pLAogICAgICAgICAgICBfc3RlcDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIG1lbUFkZHJlc3MgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICBQdlhwdS5tZW1vcnlPYmplY3RzWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgfQogICAgICAgICAgUHZYcHUueHB1T2JqZWN0c1siZGVsZXRlIl0ob2JqQWRkcmVzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImFkZE1lbW9yeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRNZW1vcnkobWVtQWRkcmVzcywgZGF0YSkgewogICAgICAgIFB2WHB1Lm1lbW9yeU9iamVjdHMuc2V0KG1lbUFkZHJlc3MsIGRhdGEpOwogICAgICAgIFB2WHB1LnhwdU9iamVjdHMuZ2V0KGRhdGEub2JqQWRkcmVzcykuZGV2aWNlTWVtLmFkZChtZW1BZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRNZW1vcnkiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWVtb3J5KG1lbUFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gUHZYcHUubWVtb3J5T2JqZWN0cy5nZXQobWVtQWRkcmVzcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiaGFzTWVtb3J5IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhhc01lbW9yeShtZW1BZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIFB2WHB1Lm1lbW9yeU9iamVjdHMuaGFzKG1lbUFkZHJlc3MpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInJlbW92ZU1lbW9yeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVNZW1vcnkobWVtQWRkcmVzcykgewogICAgICAgIGlmIChQdlhwdS5oYXNNZW1vcnkobWVtQWRkcmVzcykpIHsKICAgICAgICAgIFB2WHB1LnhwdU9iamVjdHMuZ2V0KFB2WHB1LmdldE1lbW9yeShtZW1BZGRyZXNzKS5vYmpBZGRyZXNzKS5kZXZpY2VNZW1bImRlbGV0ZSJdKG1lbUFkZHJlc3MpOwogICAgICAgIH0KICAgICAgICBQdlhwdS5tZW1vcnlPYmplY3RzWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRVbmlxdWVQb2ludGVyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFVuaXF1ZVBvaW50ZXIoKSB7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIHZhciBwdHIgPSBNYXRoLmNlaWwoKHBlcmZvcm1hbmNlLm5vdygpICsgTWF0aC5yYW5kb20oKSkgKiAxMGUyKTsKICAgICAgICAgIGlmICghdGhpcy51bmlxdWVQb2ludGVycy5oYXMocHRyKSkgewogICAgICAgICAgICB0aGlzLnVuaXF1ZVBvaW50ZXJzLmFkZChwdHIpOwogICAgICAgICAgICByZXR1cm4gcHRyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmVVbmlxdWVQb2ludGVyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVVuaXF1ZVBvaW50ZXIocHRyKSB7CiAgICAgICAgaWYgKHRoaXMudW5pcXVlUG9pbnRlcnMuaGFzKHB0cikpIHsKICAgICAgICAgIHRoaXMudW5pcXVlUG9pbnRlcnNbImRlbGV0ZSJdKHB0cik7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CiAgICByZXR1cm4gUHZYcHU7CiAgfSgpOwogIF9kZWZpbmVQcm9wZXJ0eShQdlhwdSwgInhwdU9iamVjdHMiLCBuZXcgTWFwKCkpOwogIF9kZWZpbmVQcm9wZXJ0eShQdlhwdSwgIm1lbW9yeU9iamVjdHMiLCBuZXcgTWFwKCkpOwogIF9kZWZpbmVQcm9wZXJ0eShQdlhwdSwgInVuaXF1ZVBvaW50ZXJzIiwgbmV3IFNldCgpKTsKCiAgdmFyIGF0dGVudGlvblByZWNvbXB1dGVFbmNvZGluZyA9IGZ1bmN0aW9uIGF0dGVudGlvblByZWNvbXB1dGVFbmNvZGluZyhkYXRhKSB7CiAgICB2YXIgX2RhdGEkZ2xvYmFscyA9IGRhdGEuZ2xvYmFscywKICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMuZXhwb3J0cywKICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzLm1lbUFsbG9jOwogICAgdmFyIGVuY29kaW5nQWRkcmVzcyA9IGRhdGEuZW5jb2RpbmdBZGRyZXNzLAogICAgICBkaW1lbnNpb24gPSBkYXRhLmRpbWVuc2lvbiwKICAgICAgc3RlcHMgPSBkYXRhLnN0ZXBzLAogICAgICB0aGV0YSA9IGRhdGEudGhldGEsCiAgICAgIHJvcGVTY2FsZXNBZGRyZXNzID0gZGF0YS5yb3BlU2NhbGVzQWRkcmVzcywKICAgICAgcm9wZVNjYWxlID0gZGF0YS5yb3BlU2NhbGU7CiAgICB2YXIgcHZfcGljb2xsbV9hdHRlbnRpb25fcHJlY29tcHV0ZV9lbmNvZGluZ193YXNtID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl9wcmVjb21wdXRlX2VuY29kaW5nX3dhc207CiAgICB2YXIgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChlbmNvZGluZ0FkZHJlc3MpLAogICAgICB3b3JrZXJFbmNvZGluZ0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Lndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQocm9wZVNjYWxlc0FkZHJlc3MpLAogICAgICB3b3JrZXJSb3BlU2NhbGVzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICBwdl9waWNvbGxtX2F0dGVudGlvbl9wcmVjb21wdXRlX2VuY29kaW5nX3dhc20od29ya2VyRW5jb2RpbmdBZGRyZXNzLCBkaW1lbnNpb24sIHN0ZXBzLCB0aGV0YSwgd29ya2VyUm9wZVNjYWxlc0FkZHJlc3MsIHJvcGVTY2FsZSk7CiAgfTsKICB2YXIgYXR0ZW50aW9uQXR0ZW5kQ29tYmluZWQgPSBmdW5jdGlvbiBhdHRlbnRpb25BdHRlbmRDb21iaW5lZChkYXRhKSB7CiAgICB2YXIgX2RhdGEkZ2xvYmFsczIgPSBkYXRhLmdsb2JhbHMsCiAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzMi5leHBvcnRzLAogICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMyLm1lbUFsbG9jLAogICAgICBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzMi5tZW1vcnk7CiAgICB2YXIgbnVtSGVhZHMgPSBkYXRhLm51bUhlYWRzLAogICAgICBudW1LdkhlYWRzID0gZGF0YS5udW1LdkhlYWRzLAogICAgICB3aW5kb3dMZW5ndGggPSBkYXRhLndpbmRvd0xlbmd0aCwKICAgICAgaGVhZERpbWVuc2lvbiA9IGRhdGEuaGVhZERpbWVuc2lvbiwKICAgICAgcm9wZURpbWVuc2lvbiA9IGRhdGEucm9wZURpbWVuc2lvbiwKICAgICAgcm9wZUludGVybGVhdmVkID0gZGF0YS5yb3BlSW50ZXJsZWF2ZWQsCiAgICAgIG5ld0VuY29kaW5nQWRkcmVzcyA9IGRhdGEubmV3RW5jb2RpbmdBZGRyZXNzLAogICAgICBxQnVmZmVyID0gZGF0YS5xQnVmZmVyLAogICAgICBrQnVmZmVyID0gZGF0YS5rQnVmZmVyLAogICAgICB2QnVmZmVyID0gZGF0YS52QnVmZmVyLAogICAgICBrZXlzQWRkcmVzcyA9IGRhdGEua2V5c0FkZHJlc3MsCiAgICAgIGtleUludGVyY2VwdHNBZGRyZXNzID0gZGF0YS5rZXlJbnRlcmNlcHRzQWRkcmVzcywKICAgICAga2V5U2xvcGVzQWRkcmVzcyA9IGRhdGEua2V5U2xvcGVzQWRkcmVzcywKICAgICAgdmFsdWVzQWRkcmVzcyA9IGRhdGEudmFsdWVzQWRkcmVzcywKICAgICAgdmFsdWVJbnRlcmNlcHRzQWRkcmVzcyA9IGRhdGEudmFsdWVJbnRlcmNlcHRzQWRkcmVzcywKICAgICAgdmFsdWVTbG9wZXNBZGRyZXNzID0gZGF0YS52YWx1ZVNsb3Blc0FkZHJlc3MsCiAgICAgIHBvc2l0aW9uID0gZGF0YS5wb3NpdGlvbiwKICAgICAgcXVlcnlBZGRyZXNzID0gZGF0YS5xdWVyeUFkZHJlc3MsCiAgICAgIG4gPSBkYXRhLm47CiAgICB2YXIgYWxpZ25lZF9hbGxvYyA9IGV4cG9ydHMuYWxpZ25lZF9hbGxvYywKICAgICAgZnJlZSA9IGV4cG9ydHMuZnJlZSwKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fZW5jb2RlX3dhc20gPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZV93YXNtLAogICAgICBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfa2V5c193YXNtID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfa2V5c193YXNtLAogICAgICBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfdmFsdWVzX3dhc20gPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX3VwZGF0ZV92YWx1ZXNfd2FzbSwKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdHJhbnNwb3NlX3F1ZXJ5X3dhc20gPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX3RyYW5zcG9zZV9xdWVyeV93YXNtLAogICAgICBwdl9waWNvbGxtX2F0dGVudGlvbl9hdHRlbmRfd2FzbSA9IGV4cG9ydHMucHZfcGljb2xsbV9hdHRlbnRpb25fYXR0ZW5kX3dhc207CiAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQobmV3RW5jb2RpbmdBZGRyZXNzKSwKICAgICAgd29ya2VyRW5jb2RpbmdBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldChrZXlzQWRkcmVzcyksCiAgICAgIHdvcmtlcktleXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDQud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0NSA9IG1lbUFsbG9jLmdldChrZXlJbnRlcmNlcHRzQWRkcmVzcyksCiAgICAgIHdvcmtlcktleUludGVyY2VwdHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDUud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0NiA9IG1lbUFsbG9jLmdldChrZXlTbG9wZXNBZGRyZXNzKSwKICAgICAgd29ya2VyS2V5U2xvcGVzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ2Lndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDcgPSBtZW1BbGxvYy5nZXQodmFsdWVzQWRkcmVzcyksCiAgICAgIHdvcmtlclZhbHVlc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Ny53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIF9tZW1BbGxvYyRnZXQ4ID0gbWVtQWxsb2MuZ2V0KHZhbHVlSW50ZXJjZXB0c0FkZHJlc3MpLAogICAgICB3b3JrZXJWYWx1ZUludGVyY2VwdHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDgud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0OSA9IG1lbUFsbG9jLmdldCh2YWx1ZVNsb3Blc0FkZHJlc3MpLAogICAgICB3b3JrZXJWYWx1ZVNsb3Blc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0OS53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIF9tZW1BbGxvYyRnZXQxMCA9IG1lbUFsbG9jLmdldChxdWVyeUFkZHJlc3MpLAogICAgICB3b3JrZXJRdWVyeUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTAud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciB3b3JrZXJRQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBxQnVmZmVyLmxlbmd0aCAqIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICB2YXIgd29ya2VyS0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwga0J1ZmZlci5sZW5ndGggKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgdmFyIHdvcmtlclZBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHZCdWZmZXIubGVuZ3RoICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIHZhciBsZW5ndGggPSBudW1IZWFkcyAqIGhlYWREaW1lbnNpb24gKiBuOwogICAgdmFyIHdvcmtlck91dHB1dEFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgbGVuZ3RoICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIHZhciBtZW1vcnlCdWZmZXJGbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KHFCdWZmZXIsIHdvcmtlclFBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KGtCdWZmZXIsIHdvcmtlcktBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KHZCdWZmZXIsIHdvcmtlclZBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuZmlsbCgwLCB3b3JrZXJPdXRwdXRBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCB3b3JrZXJPdXRwdXRBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICsgbGVuZ3RoKTsKICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZV93YXNtKHdvcmtlclFBZGRyZXNzLCB3b3JrZXJFbmNvZGluZ0FkZHJlc3MsIG4sIG51bUhlYWRzLCByb3BlSW50ZXJsZWF2ZWQsIGhlYWREaW1lbnNpb24sIHJvcGVEaW1lbnNpb24sIHBvc2l0aW9uKTsKICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX3RyYW5zcG9zZV9xdWVyeV93YXNtKG4sIHdvcmtlclFBZGRyZXNzLCB3b3JrZXJRdWVyeUFkZHJlc3MsIG51bUhlYWRzLCBoZWFkRGltZW5zaW9uKTsKICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZV93YXNtKHdvcmtlcktBZGRyZXNzLCB3b3JrZXJFbmNvZGluZ0FkZHJlc3MsIG4sIG51bUt2SGVhZHMsIHJvcGVJbnRlcmxlYXZlZCwgaGVhZERpbWVuc2lvbiwgcm9wZURpbWVuc2lvbiwgcG9zaXRpb24pOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX2tleXNfd2FzbShudW1LdkhlYWRzLCB3aW5kb3dMZW5ndGgsIGhlYWREaW1lbnNpb24sIHdvcmtlcktleXNBZGRyZXNzLCB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyS2V5U2xvcGVzQWRkcmVzcywgcG9zaXRpb24sIG4sIHdvcmtlcktBZGRyZXNzKTsKICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX3VwZGF0ZV92YWx1ZXNfd2FzbShudW1LdkhlYWRzLCB3aW5kb3dMZW5ndGgsIGhlYWREaW1lbnNpb24sIHdvcmtlclZhbHVlc0FkZHJlc3MsIHdvcmtlclZhbHVlSW50ZXJjZXB0c0FkZHJlc3MsIHdvcmtlclZhbHVlU2xvcGVzQWRkcmVzcywgcG9zaXRpb24sIG4sIHdvcmtlclZBZGRyZXNzKTsKICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX2F0dGVuZF93YXNtKG51bUhlYWRzLCBudW1LdkhlYWRzLCB3aW5kb3dMZW5ndGgsIGhlYWREaW1lbnNpb24sIHdvcmtlcktleXNBZGRyZXNzLCB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyS2V5U2xvcGVzQWRkcmVzcywgd29ya2VyVmFsdWVzQWRkcmVzcywgd29ya2VyVmFsdWVJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzLCBwb3NpdGlvbiwgd29ya2VyUXVlcnlBZGRyZXNzLCBuLCB3b3JrZXJPdXRwdXRBZGRyZXNzKTsKICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIgPSBuZXcgRmxvYXQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgdmFyIHJlcyA9IG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2xpY2Uod29ya2VyT3V0cHV0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgd29ya2VyT3V0cHV0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCArIGxlbmd0aCk7CiAgICBmcmVlKHdvcmtlclFBZGRyZXNzKTsKICAgIGZyZWUod29ya2VyS0FkZHJlc3MpOwogICAgZnJlZSh3b3JrZXJWQWRkcmVzcyk7CiAgICBmcmVlKHdvcmtlck91dHB1dEFkZHJlc3MpOwogICAgcmV0dXJuIHJlczsKICB9OwogIHZhciBwdlBpY29sbG1BdHRlbnRpb25BY3Rpb25NYXAgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KHt9LCBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb24uQVRURU5USU9OX1BSRUNPTVBVVEVfRU5DT0RJTkcsIGF0dGVudGlvblByZWNvbXB1dGVFbmNvZGluZyksIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbi5BVFRFTlRJT05fQVRURU5EX0NPTUJJTkVELCBhdHRlbnRpb25BdHRlbmRDb21iaW5lZCk7CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uOwogIChmdW5jdGlvbiAoUHZQaWNvbGxtV2VpZ2h0QWN0aW9uKSB7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JMT0NLUyJdID0gMTAwXSA9ICJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JMT0NLUyI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX01FVEFTIl0gPSAxMDFdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfTUVUQVMiOwogICAgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uW1B2UGljb2xsbVdlaWdodEFjdGlvblsiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfUFJFUFJPQ0VTU19CSUFTIl0gPSAxMDJdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQklBUyI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX1NJTkdMRSJdID0gMTAzXSA9ICJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX1NJTkdMRSI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX01VTFRJUExFIl0gPSAxMDRdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfTVVMVElQTEUiOwogIH0pKFB2UGljb2xsbVdlaWdodEFjdGlvbiB8fCAoUHZQaWNvbGxtV2VpZ2h0QWN0aW9uID0ge30pKTsKCiAgdmFyIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc0Jsb2NrcyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSQxLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShkYXRhKSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzLCBleHBvcnRzLCBtZW1BbGxvYywgbWVtb3J5LCBzaGFwZSwgYml0RGVwdGhzLCBiaXREZXB0aFN0YXJ0cywgbnVtQmxvY2tCeXRlcywgYmxvY2tzQWRkcmVzcywgYmxvY2ssIGFsaWduZWRfYWxsb2MsIGZyZWUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfcHJlcHJvY2Vzc19ibG9ja3MsIHdvcmtlckJsb2Nrc0FkZHJlc3MsIHNoYXBlQWRkcmVzcywgYml0RGVwdGhzQWRkcmVzcywgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCBtZW1vcnlCdWZmZXJVaW50OCwgbWVtb3J5QnVmZmVySW50MzI7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9kYXRhJGdsb2JhbHMgPSBkYXRhLmdsb2JhbHMsIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzLmV4cG9ydHMsIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFscy5tZW1BbGxvYywgbWVtb3J5ID0gX2RhdGEkZ2xvYmFscy5tZW1vcnk7CiAgICAgICAgICAgIHNoYXBlID0gZGF0YS5zaGFwZSwgYml0RGVwdGhzID0gZGF0YS5iaXREZXB0aHMsIGJpdERlcHRoU3RhcnRzID0gZGF0YS5iaXREZXB0aFN0YXJ0cywgbnVtQmxvY2tCeXRlcyA9IGRhdGEubnVtQmxvY2tCeXRlcywgYmxvY2tzQWRkcmVzcyA9IGRhdGEuYmxvY2tzQWRkcmVzcywgYmxvY2sgPSBkYXRhLmJsb2NrOwogICAgICAgICAgICBhbGlnbmVkX2FsbG9jID0gZXhwb3J0cy5hbGlnbmVkX2FsbG9jLCBmcmVlID0gZXhwb3J0cy5mcmVlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X3ByZXByb2Nlc3NfYmxvY2tzID0gZXhwb3J0cy5wdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X3ByZXByb2Nlc3NfYmxvY2tzOwogICAgICAgICAgICB3b3JrZXJCbG9ja3NBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBudW1CbG9ja0J5dGVzICogVWludDhBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIGlmICh3b3JrZXJCbG9ja3NBZGRyZXNzKSB7CiAgICAgICAgICAgICAgbWVtQWxsb2Muc2V0KGJsb2Nrc0FkZHJlc3MsIHsKICAgICAgICAgICAgICAgIGFsbG9jU2l6ZTogbnVtQmxvY2tCeXRlcywKICAgICAgICAgICAgICAgIHdvcmtlck1lbUFkZHJlc3M6IHdvcmtlckJsb2Nrc0FkZHJlc3MKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzaGFwZUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBzaGFwZS5sZW5ndGgpOwogICAgICAgICAgICAgIGJpdERlcHRoc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aHMubGVuZ3RoKTsKICAgICAgICAgICAgICBiaXREZXB0aHNTdGFydEFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aFN0YXJ0cy5sZW5ndGgpOwogICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJVaW50OC5zZXQoYmxvY2ssIHdvcmtlckJsb2Nrc0FkZHJlc3MpOwogICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChzaGFwZSwgc2hhcGVBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRocywgYml0RGVwdGhzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzU3RhcnRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9wcmVwcm9jZXNzX2Jsb2NrcyhzaGFwZUFkZHJlc3MsIGJpdERlcHRocy5sZW5ndGgsIGJpdERlcHRoc0FkZHJlc3MsIGJpdERlcHRoc1N0YXJ0QWRkcmVzcywgd29ya2VyQmxvY2tzQWRkcmVzcyk7CiAgICAgICAgICAgICAgZnJlZShzaGFwZUFkZHJlc3MpOwogICAgICAgICAgICAgIGZyZWUoYml0RGVwdGhzQWRkcmVzcyk7CiAgICAgICAgICAgICAgZnJlZShiaXREZXB0aHNTdGFydEFkZHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmxvY2tzKF94KSB7CiAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKICB2YXIgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzTWV0YXMgPSBmdW5jdGlvbiB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NNZXRhcyhkYXRhKSB7CiAgICB2YXIgX2RhdGEkZ2xvYmFsczIgPSBkYXRhLmdsb2JhbHMsCiAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzMi5leHBvcnRzLAogICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMyLm1lbUFsbG9jLAogICAgICBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzMi5tZW1vcnk7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzcywKICAgICAgbWV0YXMgPSBkYXRhLm1ldGFzOwogICAgdmFyIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2M7CiAgICB2YXIgd29ya2VyTWV0YXNBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhVaW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgbWV0YXMubGVuZ3RoICogVWludDE2QXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgaWYgKHdvcmtlck1ldGFzQWRkcmVzcykgewogICAgICBtZW1BbGxvYy5zZXQobWVtQWRkcmVzcywgewogICAgICAgIGFsbG9jU2l6ZTogbWV0YXMubGVuZ3RoICogVWludDE2QXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCiAgICAgICAgd29ya2VyTWVtQWRkcmVzczogd29ya2VyTWV0YXNBZGRyZXNzCiAgICAgIH0pOwogICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDE2ID0gbmV3IFVpbnQxNkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICBtZW1vcnlCdWZmZXJVaW50MTYuc2V0KG1ldGFzLCB3b3JrZXJNZXRhc0FkZHJlc3MgLyBVaW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICB9CiAgfTsKICB2YXIgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmlhcyA9IGZ1bmN0aW9uIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc0JpYXMoZGF0YSkgewogICAgdmFyIF9kYXRhJGdsb2JhbHMzID0gZGF0YS5nbG9iYWxzLAogICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczMuZXhwb3J0cywKICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMy5tZW1BbGxvYywKICAgICAgbWVtb3J5ID0gX2RhdGEkZ2xvYmFsczMubWVtb3J5OwogICAgdmFyIG1lbUFkZHJlc3MgPSBkYXRhLm1lbUFkZHJlc3MsCiAgICAgIGJpYXMgPSBkYXRhLmJpYXM7CiAgICB2YXIgYWxpZ25lZF9hbGxvYyA9IGV4cG9ydHMuYWxpZ25lZF9hbGxvYzsKICAgIHZhciB3b3JrZXJCaWFzQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBiaWFzLmxlbmd0aCAqIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICBpZiAod29ya2VyQmlhc0FkZHJlc3MpIHsKICAgICAgbWVtQWxsb2Muc2V0KG1lbUFkZHJlc3MsIHsKICAgICAgICBhbGxvY1NpemU6IGJpYXMubGVuZ3RoICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAogICAgICAgIHdvcmtlck1lbUFkZHJlc3M6IHdvcmtlckJpYXNBZGRyZXNzCiAgICAgIH0pOwogICAgICB2YXIgbWVtb3J5QnVmZmVyRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KGJpYXMsIHdvcmtlckJpYXNBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIH0KICB9OwogIHZhciB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRTaW5nbGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkYXRhKSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzNCwgZXhwb3J0cywgbWVtQWxsb2MsIG1lbW9yeSwgc2hhcGUsIGluZGljZXNBZGRyZXNzLCBiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzLCBtZXRhc0FkZHJlc3MsIGJsb2Nrc0FkZHJlc3MsIHhPZmZzZXQsIHhCdWZmZXIsIGJpYXNBZGRyZXNzLCBhbGlnbmVkX2FsbG9jLCBmcmVlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2ZvcndhcmRfc2luZ2xlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2FkZF9iaWFzLCBfbWVtQWxsb2MkZ2V0LCB3b3JrZXJJbmRpY2VzQWRkcmVzcywgX21lbUFsbG9jJGdldDIsIHdvcmtlck1ldGFzQWRkcmVzcywgX21lbUFsbG9jJGdldDMsIHdvcmtlckJsb2Nrc0FkZHJlc3MsIHNoYXBlQWRkcmVzcywgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCBiaXREZXB0aHNBZGRyZXNzLCB3b3JrZXJYQWRkcmVzcywgd29ya2VyWUFkZHJlc3MsIG1lbW9yeUJ1ZmZlckZsb2F0MzIsIG1lbW9yeUJ1ZmZlckludDMyLCBfbWVtQWxsb2MkZ2V0NCwgd29ya2VyQmlhc0FkZHJlc3MsIGFsbG9jU2l6ZSwgZGltZW5zaW9uLCByZXM7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfZGF0YSRnbG9iYWxzNCA9IGRhdGEuZ2xvYmFscywgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHM0LmV4cG9ydHMsIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczQubWVtQWxsb2MsIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHM0Lm1lbW9yeTsKICAgICAgICAgICAgc2hhcGUgPSBkYXRhLnNoYXBlLCBpbmRpY2VzQWRkcmVzcyA9IGRhdGEuaW5kaWNlc0FkZHJlc3MsIGJpdERlcHRoU3RhcnRzID0gZGF0YS5iaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzID0gZGF0YS5iaXREZXB0aHMsIG1ldGFzQWRkcmVzcyA9IGRhdGEubWV0YXNBZGRyZXNzLCBibG9ja3NBZGRyZXNzID0gZGF0YS5ibG9ja3NBZGRyZXNzLCB4T2Zmc2V0ID0gZGF0YS54T2Zmc2V0LCB4QnVmZmVyID0gZGF0YS54QnVmZmVyLCBiaWFzQWRkcmVzcyA9IGRhdGEuYmlhc0FkZHJlc3M7CiAgICAgICAgICAgIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2MsIGZyZWUgPSBleHBvcnRzLmZyZWUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGUgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXM7CiAgICAgICAgICAgIF9tZW1BbGxvYyRnZXQgPSBtZW1BbGxvYy5nZXQoaW5kaWNlc0FkZHJlc3MpLCB3b3JrZXJJbmRpY2VzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQobWV0YXNBZGRyZXNzKSwgd29ya2VyTWV0YXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDIud29ya2VyTWVtQWRkcmVzczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQoYmxvY2tzQWRkcmVzcyksIHdvcmtlckJsb2Nrc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0My53b3JrZXJNZW1BZGRyZXNzOwogICAgICAgICAgICBzaGFwZUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBzaGFwZS5sZW5ndGgpOwogICAgICAgICAgICBiaXREZXB0aHNTdGFydEFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aFN0YXJ0cy5sZW5ndGgpOwogICAgICAgICAgICBiaXREZXB0aHNBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogYml0RGVwdGhzLmxlbmd0aCk7CiAgICAgICAgICAgIHdvcmtlclhBZGRyZXNzID0gYWxpZ25lZF9hbGxvYygyNTYsIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIHhCdWZmZXIubGVuZ3RoKTsKICAgICAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKDI1NiwgRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogc2hhcGVbMF0pOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJGbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KHNoYXBlLCBzaGFwZUFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRoU3RhcnRzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRocywgYml0RGVwdGhzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJGbG9hdDMyLnNldCh4QnVmZmVyLCB3b3JrZXJYQWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGUoc2hhcGVBZGRyZXNzLCB3b3JrZXJJbmRpY2VzQWRkcmVzcywgYml0RGVwdGhzLmxlbmd0aCwgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCBiaXREZXB0aHNBZGRyZXNzLCB3b3JrZXJNZXRhc0FkZHJlc3MsIHdvcmtlckJsb2Nrc0FkZHJlc3MsIHdvcmtlclhBZGRyZXNzICsgeE9mZnNldCwgd29ya2VyWUFkZHJlc3MpOwogICAgICAgICAgICBpZiAobWVtQWxsb2MuaGFzKGJpYXNBZGRyZXNzKSkgewogICAgICAgICAgICAgIF9tZW1BbGxvYyRnZXQ0ID0gbWVtQWxsb2MuZ2V0KGJpYXNBZGRyZXNzKSwgd29ya2VyQmlhc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NC53b3JrZXJNZW1BZGRyZXNzLCBhbGxvY1NpemUgPSBfbWVtQWxsb2MkZ2V0NC5hbGxvY1NpemU7CiAgICAgICAgICAgICAgZGltZW5zaW9uID0gYWxsb2NTaXplIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwogICAgICAgICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMoMSwgZGltZW5zaW9uLCB3b3JrZXJZQWRkcmVzcywgd29ya2VyQmlhc0FkZHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcyA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcikuc2xpY2Uod29ya2VyWUFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHdvcmtlcllBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICsgc2hhcGVbMF0pOwogICAgICAgICAgICBmcmVlKHNoYXBlQWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUoYml0RGVwdGhzU3RhcnRBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZShiaXREZXB0aHNBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZSh3b3JrZXJYQWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUod29ya2VyWUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVzKTsKICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRTaW5nbGUoX3gyKSB7CiAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7CiAgdmFyIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZE11bHRpcGxlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSQxLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoZGF0YSkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczUsIGV4cG9ydHMsIG1lbUFsbG9jLCBtZW1vcnksIHNoYXBlLCBpbmRpY2VzQWRkcmVzcywgYml0RGVwdGhTdGFydHMsIGJpdERlcHRocywgbWV0YXNBZGRyZXNzLCBibG9ja3NBZGRyZXNzLCBuLCB4T2Zmc2V0LCB4QnVmZmVyLCBiaWFzQWRkcmVzcywgYWxpZ25lZF9hbGxvYywgZnJlZSwgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX211bHRpcGxlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2FkZF9iaWFzLCBfbWVtQWxsb2MkZ2V0NSwgd29ya2VySW5kaWNlc0FkZHJlc3MsIF9tZW1BbGxvYyRnZXQ2LCB3b3JrZXJNZXRhc0FkZHJlc3MsIF9tZW1BbGxvYyRnZXQ3LCB3b3JrZXJCbG9ja3NBZGRyZXNzLCBzaGFwZUFkZHJlc3MsIGJpdERlcHRoc1N0YXJ0QWRkcmVzcywgYml0RGVwdGhzQWRkcmVzcywgd29ya2VyWEFkZHJlc3MsIHdvcmtlcllBZGRyZXNzLCBtZW1vcnlCdWZmZXJGbG9hdDMyLCBtZW1vcnlCdWZmZXJJbnQzMiwgX21lbUFsbG9jJGdldDgsIHdvcmtlckJpYXNBZGRyZXNzLCBhbGxvY1NpemUsIGRpbWVuc2lvbiwgcmVzOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSQxLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2RhdGEkZ2xvYmFsczUgPSBkYXRhLmdsb2JhbHMsIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzNS5leHBvcnRzLCBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHM1Lm1lbUFsbG9jLCBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzNS5tZW1vcnk7CiAgICAgICAgICAgIHNoYXBlID0gZGF0YS5zaGFwZSwgaW5kaWNlc0FkZHJlc3MgPSBkYXRhLmluZGljZXNBZGRyZXNzLCBiaXREZXB0aFN0YXJ0cyA9IGRhdGEuYml0RGVwdGhTdGFydHMsIGJpdERlcHRocyA9IGRhdGEuYml0RGVwdGhzLCBtZXRhc0FkZHJlc3MgPSBkYXRhLm1ldGFzQWRkcmVzcywgYmxvY2tzQWRkcmVzcyA9IGRhdGEuYmxvY2tzQWRkcmVzcywgbiA9IGRhdGEubiwgeE9mZnNldCA9IGRhdGEueE9mZnNldCwgeEJ1ZmZlciA9IGRhdGEueEJ1ZmZlciwgYmlhc0FkZHJlc3MgPSBkYXRhLmJpYXNBZGRyZXNzOwogICAgICAgICAgICBhbGlnbmVkX2FsbG9jID0gZXhwb3J0cy5hbGlnbmVkX2FsbG9jLCBmcmVlID0gZXhwb3J0cy5mcmVlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2ZvcndhcmRfbXVsdGlwbGUgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9tdWx0aXBsZSwgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhcyA9IGV4cG9ydHMucHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldDUgPSBtZW1BbGxvYy5nZXQoaW5kaWNlc0FkZHJlc3MpLCB3b3JrZXJJbmRpY2VzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ1Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgICAgICAgIF9tZW1BbGxvYyRnZXQ2ID0gbWVtQWxsb2MuZ2V0KG1ldGFzQWRkcmVzcyksIHdvcmtlck1ldGFzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ2Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgICAgICAgIF9tZW1BbGxvYyRnZXQ3ID0gbWVtQWxsb2MuZ2V0KGJsb2Nrc0FkZHJlc3MpLCB3b3JrZXJCbG9ja3NBZGRyZXNzID0gX21lbUFsbG9jJGdldDcud29ya2VyTWVtQWRkcmVzczsKICAgICAgICAgICAgc2hhcGVBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogc2hhcGUubGVuZ3RoKTsKICAgICAgICAgICAgYml0RGVwdGhzU3RhcnRBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogYml0RGVwdGhTdGFydHMubGVuZ3RoKTsKICAgICAgICAgICAgYml0RGVwdGhzQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRocy5sZW5ndGgpOwogICAgICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiB4QnVmZmVyLmxlbmd0aCk7CiAgICAgICAgICAgIHdvcmtlcllBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIChzaGFwZVswXSAqIG4pKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVyRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChzaGFwZSwgc2hhcGVBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzU3RhcnRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aHMsIGJpdERlcHRoc0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQoeEJ1ZmZlciwgd29ya2VyWEFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2ZvcndhcmRfbXVsdGlwbGUoc2hhcGVBZGRyZXNzLCB3b3JrZXJJbmRpY2VzQWRkcmVzcywgYml0RGVwdGhzLmxlbmd0aCwgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCBiaXREZXB0aHNBZGRyZXNzLCB3b3JrZXJNZXRhc0FkZHJlc3MsIHdvcmtlckJsb2Nrc0FkZHJlc3MsIG4sIHdvcmtlclhBZGRyZXNzICsgeE9mZnNldCwgd29ya2VyWUFkZHJlc3MpOwogICAgICAgICAgICBpZiAobWVtQWxsb2MuaGFzKGJpYXNBZGRyZXNzKSkgewogICAgICAgICAgICAgIF9tZW1BbGxvYyRnZXQ4ID0gbWVtQWxsb2MuZ2V0KGJpYXNBZGRyZXNzKSwgd29ya2VyQmlhc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0OC53b3JrZXJNZW1BZGRyZXNzLCBhbGxvY1NpemUgPSBfbWVtQWxsb2MkZ2V0OC5hbGxvY1NpemU7CiAgICAgICAgICAgICAgZGltZW5zaW9uID0gYWxsb2NTaXplIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwogICAgICAgICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMobiwgZGltZW5zaW9uLCB3b3JrZXJZQWRkcmVzcywgd29ya2VyQmlhc0FkZHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcyA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcikuc2xpY2Uod29ya2VyWUFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHdvcmtlcllBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICsgc2hhcGVbMF0gKiBuKTsKICAgICAgICAgICAgZnJlZShzaGFwZUFkZHJlc3MpOwogICAgICAgICAgICBmcmVlKGJpdERlcHRoc1N0YXJ0QWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUoYml0RGVwdGhzQWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUod29ya2VyWEFkZHJlc3MpOwogICAgICAgICAgICBmcmVlKHdvcmtlcllBZGRyZXNzKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHJlcyk7CiAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMyk7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkTXVsdGlwbGUoX3gzKSB7CiAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7CiAgdmFyIHB2UGljb2xsbVdlaWdodEFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2UGljb2xsbVdlaWdodEFjdGlvbi5XRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JMT0NLUywgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmxvY2tzKSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfTUVUQVMsIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc01ldGFzKSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQklBUywgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmlhcyksIFB2UGljb2xsbVdlaWdodEFjdGlvbi5XRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX1NJTkdMRSwgd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkU2luZ2xlKSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfTVVMVElQTEUsIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZE11bHRpcGxlKTsKCiAgZnVuY3Rpb24gb3duS2V5cyhlLCByKSB7IHZhciB0ID0gT2JqZWN0LmtleXMoZSk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBvID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTsgciAmJiAobyA9IG8uZmlsdGVyKGZ1bmN0aW9uIChyKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsIHIpLmVudW1lcmFibGU7IH0pKSwgdC5wdXNoLmFwcGx5KHQsIG8pOyB9IHJldHVybiB0OyB9CiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZChlKSB7IGZvciAodmFyIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7IHZhciB0ID0gbnVsbCAhPSBhcmd1bWVudHNbcl0gPyBhcmd1bWVudHNbcl0gOiB7fTsgciAlIDIgPyBvd25LZXlzKE9iamVjdCh0KSwgITApLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgX2RlZmluZVByb3BlcnR5KGUsIHIsIHRbcl0pOyB9KSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModCkpIDogb3duS2V5cyhPYmplY3QodCkpLmZvckVhY2goZnVuY3Rpb24gKHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHIsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodCwgcikpOyB9KTsgfSByZXR1cm4gZTsgfQogIHZhciBleHBvcnRzJDE7CiAgdmFyIG1lbW9yeTsKICB2YXIgbWVtQWxsb2MgPSBuZXcgTWFwKCk7CiAgZnVuY3Rpb24gYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgoYXJyYXlCdWZmZXIsIGluZGV4U3RhcnQpIHsKICAgIHZhciBpbmRleEVuZCA9IGluZGV4U3RhcnQ7CiAgICB3aGlsZSAoYXJyYXlCdWZmZXJbaW5kZXhFbmRdICE9PSAwKSB7CiAgICAgIGluZGV4RW5kKys7CiAgICB9CiAgICB2YXIgdXRmOGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoJ3V0Zi04Jyk7CiAgICByZXR1cm4gdXRmOGRlY29kZXIuZGVjb2RlKGFycmF5QnVmZmVyLnN1YmFycmF5KGluZGV4U3RhcnQsIGluZGV4RW5kKSk7CiAgfQogIHZhciBnZXRXYXNtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlKHdhc20pIHsKICAgICAgdmFyIHB2Q29uc29sZUxvZ1dhc20sIHB2QXNzZXJ0V2FzbSwgcHZUaW1lV2FzbSwgcHZGaWxlT3Blbldhc20sIHB2RmlsZUNsb3NlV2FzbSwgcHZGaWxlUmVhZFdhc20sIHB2RmlsZVdyaXRlV2FzbSwgcHZGaWxlU2Vla1dhc20sIHB2RmlsZVRlbGxXYXNtLCBwdkZpbGVSZW1vdmVXYXNtLCBpbnN0YW5jZSwgYWxpZ25lZF9hbGxvYywgYWxpZ25lZEFsbG9jOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSQxLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBwdkNvbnNvbGVMb2dXYXNtID0gZnVuY3Rpb24gcHZDb25zb2xlTG9nV2FzbShpbmRleCkgewogICAgICAgICAgICAgIGluZGV4ID0gdW5zaWduZWRBZGRyZXNzKGluZGV4KTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBpbmRleCkpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkFzc2VydFdhc20gPSBmdW5jdGlvbiBwdkFzc2VydFdhc20oZXhwciwgbGluZSwgZmlsZU5hbWVBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZU5hbWVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGZpbGVOYW1lQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgaWYgKGV4cHIgPT09IDApIHsKICAgICAgICAgICAgICAgIHZhciBmaWxlTmFtZSA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBmaWxlTmFtZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJhc3NlcnRpb24gZmFpbGVkIGF0IGxpbmUgIi5jb25jYXQobGluZSwgIiBpbiBcIiIpLmNvbmNhdChmaWxlTmFtZSwgIlwiIikpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZUaW1lV2FzbSA9IGZ1bmN0aW9uIHB2VGltZVdhc20oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlT3Blbldhc20gPSBmdW5jdGlvbiBwdkZpbGVPcGVuV2FzbShmaWxlQWRkcmVzcywgcGF0aEFkZHJlc3MsIG1vZGVBZGRyZXNzLCBzdGF0dXNBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIHBhdGhBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKHBhdGhBZGRyZXNzKTsKICAgICAgICAgICAgICBtb2RlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhtb2RlQWRkcmVzcyk7CiAgICAgICAgICAgICAgc3RhdHVzQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhzdGF0dXNBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgcGF0aCA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBwYXRoQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1vZGUgPSBhcnJheUJ1ZmZlclRvU3RyaW5nQXRJbmRleChtZW1vcnlCdWZmZXJVaW50OCwgbW9kZUFkZHJlc3MpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IFB2RmlsZU1lbS5vcGVuKHBhdGgsIG1vZGUpOwogICAgICAgICAgICAgICAgUHZGaWxlTWVtLnNldFB0cihmaWxlQWRkcmVzcywgZmlsZSk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAwOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlQ2xvc2VXYXNtID0gZnVuY3Rpb24gcHZGaWxlQ2xvc2VXYXNtKGZpbGVBZGRyZXNzLCBzdGF0dXNBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIHN0YXR1c0FkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3Moc3RhdHVzQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICBmaWxlLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAwOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlUmVhZFdhc20gPSBmdW5jdGlvbiBwdkZpbGVSZWFkV2FzbShmaWxlQWRkcmVzcywgY29udGVudEFkZHJlc3MsIHNpemUsIGNvdW50LCBudW1SZWFkQWRkcmVzcykgewogICAgICAgICAgICAgIGZpbGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICBjb250ZW50QWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhjb250ZW50QWRkcmVzcyk7CiAgICAgICAgICAgICAgbnVtUmVhZEFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MobnVtUmVhZEFkZHJlc3MpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IFB2RmlsZU1lbS5nZXRQdHIoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBmaWxlLnJlYWQoc2l6ZSwgY291bnQpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVyVWludDguc2V0KGNvbnRlbnQsIGNvbnRlbnRBZGRyZXNzKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW251bVJlYWRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSBjb250ZW50Lmxlbmd0aCAvIHNpemU7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbbnVtUmVhZEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlV3JpdGVXYXNtID0gZnVuY3Rpb24gcHZGaWxlV3JpdGVXYXNtKGZpbGVBZGRyZXNzLCBjb250ZW50QWRkcmVzcywgc2l6ZSwgY291bnQsIG51bVdyaXRlQWRkcmVzcykgewogICAgICAgICAgICAgIGZpbGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICBjb250ZW50QWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhjb250ZW50QWRkcmVzcyk7CiAgICAgICAgICAgICAgbnVtV3JpdGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKG51bVdyaXRlQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IG5ldyBVaW50OEFycmF5KHNpemUgKiBjb3VudCk7CiAgICAgICAgICAgICAgICBjb250ZW50LnNldChtZW1vcnlCdWZmZXJVaW50OC5zbGljZShjb250ZW50QWRkcmVzcywgY29udGVudEFkZHJlc3MgKyBzaXplICogY291bnQpLCAwKTsKICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoY29udGVudCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltudW1Xcml0ZUFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IGNvbnRlbnQubGVuZ3RoIC8gc2l6ZTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltudW1Xcml0ZUFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVTZWVrV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVNlZWtXYXNtKGZpbGVBZGRyZXNzLCBvZmZzZXQsIHdoZW5jZSwgc3RhdHVzQWRkcmVzcykgewogICAgICAgICAgICAgIGZpbGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICBzdGF0dXNBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKHN0YXR1c0FkZHJlc3MpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IFB2RmlsZU1lbS5nZXRQdHIoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgZmlsZS5zZWVrKG9mZnNldCwgd2hlbmNlKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDA7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVUZWxsV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVRlbGxXYXNtKGZpbGVBZGRyZXNzLCBvZmZzZXRBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIG9mZnNldEFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3Mob2Zmc2V0QWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltvZmZzZXRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSBmaWxlLnRlbGwoKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltvZmZzZXRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2RmlsZVJlbW92ZVdhc20gPSBmdW5jdGlvbiBwdkZpbGVSZW1vdmVXYXNtKHBhdGhBZGRyZXNzLCBzdGF0dXNBZGRyZXNzKSB7CiAgICAgICAgICAgICAgcGF0aEFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MocGF0aEFkZHJlc3MpOwogICAgICAgICAgICAgIHN0YXR1c0FkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3Moc3RhdHVzQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdmFyIHBhdGggPSBhcnJheUJ1ZmZlclRvU3RyaW5nQXRJbmRleChtZW1vcnlCdWZmZXJVaW50OCwgcGF0aEFkZHJlc3MpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IFB2RmlsZU1lbS5vcGVuKHBhdGgsICJ3Iik7CiAgICAgICAgICAgICAgICBmaWxlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gMDsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgcmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHdhc20sIHsKICAgICAgICAgICAgICB3YXNpX3NuYXBzaG90X3ByZXZpZXcxOiB3YXNpX3NuYXBzaG90X3ByZXZpZXcxX2VtdWxhdG9yLAogICAgICAgICAgICAgIGVudjogewogICAgICAgICAgICAgICAgbWVtb3J5OiBtZW1vcnksCiAgICAgICAgICAgICAgICBwdl9jb25zb2xlX2xvZ193YXNtOiBwdkNvbnNvbGVMb2dXYXNtLAogICAgICAgICAgICAgICAgcHZfYXNzZXJ0X3dhc206IHB2QXNzZXJ0V2FzbSwKICAgICAgICAgICAgICAgIHB2X3RpbWVfd2FzbTogcHZUaW1lV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfb3Blbl93YXNtOiBwdkZpbGVPcGVuV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfY2xvc2Vfd2FzbTogcHZGaWxlQ2xvc2VXYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV9yZWFkX3dhc206IHB2RmlsZVJlYWRXYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV93cml0ZV93YXNtOiBwdkZpbGVXcml0ZVdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3NlZWtfd2FzbTogcHZGaWxlU2Vla1dhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3RlbGxfd2FzbTogcHZGaWxlVGVsbFdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3JlbW92ZV93YXNtOiBwdkZpbGVSZW1vdmVXYXNtCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIGluc3RhbmNlID0gX2NvbnRleHQuc2VudC5pbnN0YW5jZTsKICAgICAgICAgICAgYWxpZ25lZF9hbGxvYyA9IGluc3RhbmNlLmV4cG9ydHMuYWxpZ25lZF9hbGxvYzsKICAgICAgICAgICAgYWxpZ25lZEFsbG9jID0gZnVuY3Rpb24gYWxpZ25lZEFsbG9jKGFsaWdubWVudCwgc2l6ZSkgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQogICAgICAgICAgICAgIHZhciBwb2ludGVyID0gYWxpZ25lZF9hbGxvYyhhbGlnbm1lbnQsIHNpemUpOwogICAgICAgICAgICAgIGlmIChwb2ludGVyIDwgMCkgewogICAgICAgICAgICAgICAgcG9pbnRlciA9IHBvaW50ZXIgPj4+IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBwb2ludGVyOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGluc3RhbmNlLmV4cG9ydHMpLCB7fSwgewogICAgICAgICAgICAgIGFsaWduZWRfYWxsb2M6IGFsaWduZWRBbGxvYwogICAgICAgICAgICB9KSk7CiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpOwogICAgcmV0dXJuIGZ1bmN0aW9uIGdldFdhc20oX3gpIHsKICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpOwogIHZhciBpbml0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSQxLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZGF0YSkgewogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSQxLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgbWVtb3J5ID0gbmV3IFdlYkFzc2VtYmx5Lk1lbW9yeSh7CiAgICAgICAgICAgICAgaW5pdGlhbDogMTI4CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBnZXRXYXNtKGRhdGEud2FzbSk7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGV4cG9ydHMkMSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMik7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gaW5pdChfeDIpIHsKICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKICB2YXIgYWxsb2NNZW0gPSBmdW5jdGlvbiBhbGxvY01lbShkYXRhKSB7CiAgICB2YXIgc2l6ZSA9IGRhdGEuc2l6ZSwKICAgICAgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzczsKICAgIHZhciBfZXhwb3J0cyA9IGV4cG9ydHMkMSwKICAgICAgYWxpZ25lZF9hbGxvYyA9IF9leHBvcnRzLmFsaWduZWRfYWxsb2M7CiAgICBpZiAoc2l6ZSA+IDApIHsKICAgICAgdmFyIHdvcmtlck1lbUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHNpemUgKiBVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgbWVtQWxsb2Muc2V0KG1lbUFkZHJlc3MsIHsKICAgICAgICBhbGxvY1NpemU6IHNpemUsCiAgICAgICAgd29ya2VyTWVtQWRkcmVzczogd29ya2VyTWVtQWRkcmVzcwogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBmcmVlTWVtID0gZnVuY3Rpb24gZnJlZU1lbShkYXRhKSB7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzczsKICAgIHZhciBfZXhwb3J0czIgPSBleHBvcnRzJDEsCiAgICAgIGZyZWUgPSBfZXhwb3J0czIuZnJlZTsKICAgIGlmIChtZW1BbGxvYy5oYXMobWVtQWRkcmVzcykpIHsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgICAgd29ya2VyTWVtQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgZnJlZSh3b3JrZXJNZW1BZGRyZXNzKTsKICAgICAgbWVtQWxsb2NbImRlbGV0ZSJdKG1lbUFkZHJlc3MpOwogICAgfQogIH07CiAgdmFyIGNvcHlUb1hwdSA9IGZ1bmN0aW9uIGNvcHlUb1hwdShkYXRhKSB7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzcywKICAgICAgb2Zmc2V0ID0gZGF0YS5vZmZzZXQsCiAgICAgIGJ1ZmZlciA9IGRhdGEuYnVmZmVyOwogICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KG1lbUFkZHJlc3MpLAogICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDIud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgbWVtb3J5QnVmZmVyVWludDguc2V0KGJ1ZmZlciwgd29ya2VyTWVtQWRkcmVzcyArIG9mZnNldCk7CiAgfTsKICB2YXIgY29weUZyb21YcHUgPSBmdW5jdGlvbiBjb3B5RnJvbVhwdShkYXRhKSB7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzcywKICAgICAgb2Zmc2V0ID0gZGF0YS5vZmZzZXQsCiAgICAgIHNpemUgPSBkYXRhLnNpemU7CiAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgIHdvcmtlck1lbUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0My53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICByZXR1cm4gbWVtb3J5QnVmZmVyVWludDguc2xpY2Uod29ya2VyTWVtQWRkcmVzcyArIG9mZnNldCwgd29ya2VyTWVtQWRkcmVzcyArIG9mZnNldCArIHNpemUpOwogIH07CiAgdmFyIG1lbXNldCA9IGZ1bmN0aW9uIG1lbXNldChkYXRhKSB7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzcywKICAgICAgZmlsbEJ5dGUgPSBkYXRhLmZpbGxCeXRlLAogICAgICBzaXplID0gZGF0YS5zaXplOwogICAgaWYgKG1lbUFsbG9jLmhhcyhtZW1BZGRyZXNzKSkgewogICAgICB2YXIgX21lbUFsbG9jJGdldDQgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgICAgd29ya2VyTWVtQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ0Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICBtZW1vcnlCdWZmZXJVaW50OC5maWxsKGZpbGxCeXRlLCB3b3JrZXJNZW1BZGRyZXNzLCB3b3JrZXJNZW1BZGRyZXNzICsgc2l6ZSk7CiAgICB9CiAgfTsKICB2YXIgdGltZXJTdGFydCA9IGZ1bmN0aW9uIHRpbWVyU3RhcnQoZGF0YSkgewogICAgdmFyIHdvcmtlckluZGV4ID0gZGF0YS53b3JrZXJJbmRleDsKICAgIHZhciBfZXhwb3J0czMgPSBleHBvcnRzJDEsCiAgICAgIHB2X3BpY29sbG1fdGltZXJfc3RhcnRfd2FzbSA9IF9leHBvcnRzMy5wdl9waWNvbGxtX3RpbWVyX3N0YXJ0X3dhc207CiAgICBpZiAocHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtKSB7CiAgICAgIHB2X3BpY29sbG1fdGltZXJfc3RhcnRfd2FzbSh3b3JrZXJJbmRleCk7CiAgICB9CiAgfTsKICB2YXIgdGltZXJTdG9wID0gZnVuY3Rpb24gdGltZXJTdG9wKCkgewogICAgdmFyIF9leHBvcnRzNCA9IGV4cG9ydHMkMSwKICAgICAgcHZfcGljb2xsbV90aW1lcl9zdG9wX3dhc20gPSBfZXhwb3J0czQucHZfcGljb2xsbV90aW1lcl9zdG9wX3dhc207CiAgICBpZiAocHZfcGljb2xsbV90aW1lcl9zdG9wX3dhc20pIHsKICAgICAgcHZfcGljb2xsbV90aW1lcl9zdG9wX3dhc20oKTsKICAgIH0KICB9OwogIHZhciB4cHVBY3Rpb25NYXAgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZYcHVBY3Rpb24uSU5JVCwgaW5pdCksIFB2WHB1QWN0aW9uLkFMTE9DLCBhbGxvY01lbSksIFB2WHB1QWN0aW9uLkZSRUUsIGZyZWVNZW0pLCBQdlhwdUFjdGlvbi5DT1BZX1RPX1hQVSwgY29weVRvWHB1KSwgUHZYcHVBY3Rpb24uQ09QWV9GUk9NX1hQVSwgY29weUZyb21YcHUpLCBQdlhwdUFjdGlvbi5NRU1TRVQsIG1lbXNldCksIFB2WHB1QWN0aW9uLlRJTUVSX1NUQVJULCB0aW1lclN0YXJ0KSwgUHZYcHVBY3Rpb24uVElNRVJfU1RPUCwgdGltZXJTdG9wKSwgcHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uTWFwKSwgcHZQaWNvbGxtV2VpZ2h0QWN0aW9uTWFwKTsKICBzZWxmLm9ubWVzc2FnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUkMS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGV2ZW50KSB7CiAgICAgIHZhciByZXM7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBpZiAoIShldmVudC5kYXRhLmFjdGlvbiBpbiB4cHVBY3Rpb25NYXApKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudC5kYXRhLmdsb2JhbHMgPSB7CiAgICAgICAgICAgICAgZXhwb3J0czogZXhwb3J0cyQxLAogICAgICAgICAgICAgIG1lbW9yeTogbWVtb3J5LAogICAgICAgICAgICAgIG1lbUFsbG9jOiBtZW1BbGxvYwogICAgICAgICAgICB9OwogICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDI7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIHhwdUFjdGlvbk1hcFtldmVudC5kYXRhLmFjdGlvbl0oZXZlbnQuZGF0YSk7CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBjb21tYW5kOiAnb2snLAogICAgICAgICAgICAgICAgd29ya0lkOiBldmVudC5kYXRhLndvcmtJZCwKICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzCiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgICAgICAgfSwgW3Jlcy5idWZmZXJdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGNvbW1hbmQ6ICdvaycsCiAgICAgICAgICAgICAgICB3b3JrSWQ6IGV2ZW50LmRhdGEud29ya0lkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gOTsKICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzWyJjYXRjaCJdKDIpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgICAgICAgIHdvcmtJZDogZXZlbnQuZGF0YS53b3JrSWQsCiAgICAgICAgICAgICAgbWVzc2FnZTogX2NvbnRleHQzLnQwLm1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE1OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIGNvbW1hbmQ6ICdmYWlsZWQnLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICJVbnJlY29nbml6ZWQgY29tbWFuZDogIi5jb25jYXQoZXZlbnQuZGF0YS5hY3Rpb24pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTMsIG51bGwsIFtbMiwgOV1dKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiAoX3gzKSB7CiAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7Cgp9KSgpOwoK",v=null,K=!1,function(I){return N=N||F(Y,v,K),new Worker(N,I)});function L(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}function M(I){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},M(I)}function T(I){var g=function(I,g){if("object"!=M(I)||!I)return I;var C=I[Symbol.toPrimitive];if(void 0!==C){var e=C.call(I,g||"default");if("object"!=M(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(I)}(I,"string");return"symbol"==M(g)?g:String(g)}function Q(I,g){for(var C=0;C<g.length;C++){var e=g[C];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(I,T(e.key),e)}}function z(I,g,C){return g&&Q(I.prototype,g),C&&Q(I,C),Object.defineProperty(I,"prototype",{writable:!1}),I}function x(I,g,C){return(g=T(g))in I?Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):I[g]=C,I}function _(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return P(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return P(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function P(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}!function(I){I[I.INIT=0]="INIT",I[I.ALLOC=1]="ALLOC",I[I.FREE=2]="FREE",I[I.COPY_TO_XPU=3]="COPY_TO_XPU",I[I.COPY_FROM_XPU=4]="COPY_FROM_XPU",I[I.MEMSET=5]="MEMSET",I[I.TIMER_START=6]="TIMER_START",I[I.TIMER_STOP=7]="TIMER_STOP",I[I.MATRIX_VECTOR_MULTIPLY=8]="MATRIX_VECTOR_MULTIPLY",I[I.SYNC_VECTOR=9]="SYNC_VECTOR"}(E||(E={}));var D=function(){function I(){L(this,I)}return z(I,null,[{key:"addXpu",value:function(g,C){I.xpuObjects.set(g,C)}},{key:"getXpu",value:function(g){return I.xpuObjects.get(g)}},{key:"hasXpu",value:function(g){return I.xpuObjects.has(g)}},{key:"removeXpu",value:function(g){if(I.xpuObjects.has(g)){var C,e=_(I.xpuObjects.get(g).deviceMem);try{for(e.s();!(C=e.n()).done;){var A=C.value;I.memoryObjects.delete(A)}}catch(I){e.e(I)}finally{e.f()}I.xpuObjects.delete(g)}}},{key:"addMemory",value:function(g,C){I.memoryObjects.set(g,C),I.xpuObjects.get(C.objAddress).deviceMem.add(g)}},{key:"getMemory",value:function(g){return I.memoryObjects.get(g)}},{key:"hasMemory",value:function(g){return I.memoryObjects.has(g)}},{key:"removeMemory",value:function(g){I.hasMemory(g)&&I.xpuObjects.get(I.getMemory(g).objAddress).deviceMem.delete(g),I.memoryObjects.delete(g)}},{key:"getUniquePointer",value:function(){for(;;){var I=Math.ceil(1e3*(performance.now()+Math.random()));if(!this.uniquePointers.has(I))return this.uniquePointers.add(I),I}}},{key:"removeUniquePointer",value:function(I){this.uniquePointers.has(I)&&this.uniquePointers.delete(I)}}]),I}();function O(C){return function(g){if(Array.isArray(g))return I(g)}(C)||function(I){if("undefined"!=typeof Symbol&&null!=I[Symbol.iterator]||null!=I["@@iterator"])return Array.from(I)}(C)||g(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return q(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return q(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function q(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}x(D,"xpuObjects",new Map),x(D,"memoryObjects",new Map),x(D,"uniquePointers",new Set);var $=new Map;function II(I){return $.has(I)||$.set(I,function(){for(var I="BCDEF".split(""),g="#",C=0;C<6;C++)g+=I[Math.floor(Math.random()*I.length)];return g}()),$.get(I)}var gI=function(){function I(){L(this,I),x(this,"_names",new Map),x(this,"_paths",void 0),x(this,"_stack",void 0),x(this,"_enabled",void 0),x(this,"_memory",null),this._paths=new Map,this._stack=[],this._enabled=!1}var g;return z(I,[{key:"addName",value:function(I,g){this._names.set(I,g)}},{key:"getName",value:function(I){return this._names.get(I)}},{key:"enabled",get:function(){return this._enabled},set:function(I){this._enabled=I}},{key:"memory",get:function(){return this._memory},set:function(I){this._memory=I}},{key:"graphify",value:function(I,g,C,e){var t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=I.name,c=this;function i(){return i=A(o.mark((function A(){var i,l,n,s,a,d,b,Z=arguments;return o.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:for(i=Z.length,l=new Array(i),n=0;n<i;n++)l[n]=Z[n];if(c.memory&&void 0!==t&&(new Int32Array(c.memory.buffer)[l[l.length-1]/Int32Array.BYTES_PER_ELEMENT]=t),c.enabled){A.next=6;break}return A.next=5,I.apply(I,l);case 5:return A.abrupt("return");case 6:s=g.map((function(I){return l[I]})),a=C>=0?l[C]:C,d=e?l[e]:void 0,(b=new CI(r,I,l)).inputsAddr=s,b.output=a,b.subName=c.getName(d),"pvXpuDeviceMemFree"===r||"pvXpuGraphifiedFree"===r?c.addFreeNode(b,s[0]):c.addNode(b,s);case 14:case"end":return A.stop()}}),A)}))),i.apply(this,arguments)}return function(){return i.apply(this,arguments)}}},{key:"addNode",value:function(I,g){this._stack.push(I),this._paths.has(I)||this._paths.set(I,new Set);var C,e=j(g);try{for(e.s();!(C=e.n()).done;)for(var A=C.value,t=this._stack.length-2;t>=0;t--){var r=this._stack[t];if(r.output===A){this._paths.get(r).add(I),I.inputs.add(r);break}}}catch(I){e.e(I)}finally{e.f()}}},{key:"addFreeNode",value:function(I,g){this._stack.push(I),this._paths.has(I)||this._paths.set(I,new Set);for(var C=this._stack.length-2;C>=0;C--){var e=this._stack[C];if(e.inputsAddr.includes(g)){this._paths.get(e).add(I),I.inputs.add(e);break}}}},{key:"executeHelper",value:function(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(I.numVisited++,I.level=Math.max(g,I.level),!(I.numVisited<I.inputs.size||I.visited)){I.visited=!0,I.runOnce();var C,e=j(this._paths.get(I));try{for(e.s();!(C=e.n()).done;){var A=C.value;this.executeHelper(A,I.level+1)}}catch(I){e.e(I)}finally{e.f()}}}},{key:"execute",value:(g=A(o.mark((function I(){var g,C,e,A,t,r,c,i,l,n,s=this;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:for(CI.tick=performance.now(),g=this._stack.filter((function(I){return 0===I.inputs.size})),C=[];g.length>0;)C.push(g.splice(0,8));e=0,A=C;case 5:if(!(e<A.length)){I.next=15;break}t=A[e],r=[],c=j(t);try{for(c.s();!(i=c.n()).done;)l=i.value,this.executeHelper(l),r.push(l.executionPromise)}catch(I){c.e(I)}finally{c.f()}return I.next=12,Promise.all(r);case 12:e++,I.next=5;break;case 15:return n=new Promise((function(I){Promise.all(s._stack.map((function(I){return I.executionPromise}))).then((function(){I()}))})),I.next=18,n;case 18:this.clear();case 19:case"end":return I.stop()}}),I,this)}))),function(){return g.apply(this,arguments)})},{key:"generateViz",value:function(){var I,g="",e="",A=j(this._paths);try{for(A.s();!(I=A.n()).done;){var t=C(I.value,2),r=t[0],c=t[1];g+="  ".concat(r.id," [label=<[").concat(r.id,"] ").concat(r.name).concat(r.subName?" ("+r.subName+")":"",'<BR /><FONT POINT-SIZE="10">wait: ').concat(r.timeWait.toFixed(4),", execute: ").concat(r.timeExecute.toFixed(4),'</FONT>>, style=filled, fillcolor="').concat(II(r.level),'"]\n');var i,l=j(c);try{for(l.s();!(i=l.n()).done;){var n=i.value;e+="  ".concat(r.id," -> ").concat(n.id,"\n")}}catch(I){l.e(I)}finally{l.f()}}}catch(I){A.e(I)}finally{A.f()}var o="digraph {\n".concat(g,"\n").concat(e,"}");console.log(o)}},{key:"clear",value:function(){this._paths.clear(),this._stack=[],CI.reset()}}]),I}(),CI=function(){function I(g,C,e){L(this,I),x(this,"id",void 0),x(this,"name",void 0),x(this,"subName",void 0),x(this,"visited",void 0),x(this,"numVisited",void 0),x(this,"executionPromise",void 0),x(this,"inputs",void 0),x(this,"inputsAddr",void 0),x(this,"output",void 0),x(this,"timeWait",0),x(this,"timeExecute",0),x(this,"level",0),x(this,"_fn",void 0),x(this,"_args",void 0),this.id=I.nodeId++,this.name=g,this.visited=!1,this.numVisited=0,this.inputs=new Set,this.inputsAddr=[],this.output=-1,this._fn=C,this._args=e}var g;return z(I,[{key:"runOnce",value:function(){var g=this;if(void 0===this.executionPromise){var C=O(this.inputs).map((function(I){return I.executionPromise}));this.executionPromise=Promise.all(C).then(A(o.mark((function C(){var e,A,t;return o.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:return e=performance.now(),g.timeWait=(e-I.tick)/1e3,A=performance.now(),C.next=5,g._fn.apply(null,g._args);case 5:return t=C.sent,e=performance.now(),g.timeExecute=(e-A)/1e3,C.abrupt("return",t);case 9:case"end":return C.stop()}}),C)}))))}}},{key:"runFn",value:(g=A(o.mark((function I(){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this._fn.apply(null,this._args);case 2:case"end":return I.stop()}}),I,this)}))),function(){return g.apply(this,arguments)})}],[{key:"reset",value:function(){I.nodeId=0}}]),I}();function eI(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(I);g&&(e=e.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,e)}return C}function AI(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?eI(Object(C),!0).forEach((function(g){x(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):eI(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}x(CI,"nodeId",0),x(CI,"executeWasmFn",void 0),x(CI,"tick",0);var tI,rI=function(){function I(g){var C=this;L(this,I),x(this,"worker",void 0),x(this,"listeners",{}),this.worker=g,this.worker.onmessage=function(I){switch(I.data.command){case"ok":I.data.workId in C.listeners&&(C.listeners[I.data.workId](I.data.result),C.removeListener(I.data.workId));break;case"failed":case"error":throw C.removeListener(I.data.workId),new Error(I.data.message);default:throw C.removeListener(I.data.workId),new Error("Unrecognized command: ".concat(I.data.command))}}}return z(I,[{key:"postMessage",value:function(I,g){this.worker.postMessage(I,g)}},{key:"terminate",value:function(){this.worker.terminate()}},{key:"addListener",value:function(I,g){this.listeners[I]=g}},{key:"removeListener",value:function(I){delete this.listeners[I]}}]),I}(),cI=function(I,g,C){var e=Math.ceil(1e10*(performance.now()+Math.random())),A=function(I,g){return new Promise((function(C){g.addListener(I,(function(I){C(I)}))}))}(e,I);return I.postMessage(AI(AI({},g),{},{workId:e}),C),A};!function(I){I[I.ATTENTION_PRECOMPUTE_ENCODING=200]="ATTENTION_PRECOMPUTE_ENCODING",I[I.ATTENTION_ATTEND_COMBINED=201]="ATTENTION_ATTEND_COMBINED"}(tI||(tI={}));var iI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,C,A,t,r,c,i,l){var n;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),C=w(C),c=w(c),l=w(l),n=D.getXpu(g)){I.next=8;break}return e(l,-1),I.abrupt("return");case 8:return I.next=10,cI(n.workers[0],{action:tI.ATTENTION_PRECOMPUTE_ENCODING,encodingAddress:C,dimension:A,steps:t,theta:r,ropeScalesAddress:c,ropeScale:i});case 10:e(l,0);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i){return I.apply(this,arguments)}}(),r=function(){var g=A(o.mark((function g(C,A,t,r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G,V,h,W,R){var p,X,S,H,k,J,f;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),n=w(n),s=w(s),a=w(a),d=w(d),b=w(b),Z=w(Z),m=w(m),u=w(u),B=w(B),y=w(y),V=w(V),W=w(W),R=w(R),p=D.getXpu(C)){g.next=18;break}return e(R,-1),g.abrupt("return");case 18:return X=new Float32Array(I.buffer),S=h*A*c,H=X.slice(s/Float32Array.BYTES_PER_ELEMENT,s/Float32Array.BYTES_PER_ELEMENT+S),k=X.slice(a/Float32Array.BYTES_PER_ELEMENT,a/Float32Array.BYTES_PER_ELEMENT+S),J=X.slice(d/Float32Array.BYTES_PER_ELEMENT,d/Float32Array.BYTES_PER_ELEMENT+S),g.next=25,cI(p.workers[0],{action:tI.ATTENTION_ATTEND_COMBINED,numHeads:A,numKvHeads:t,windowLength:r,headDimension:c,ropeDimension:i,ropeInterleaved:l,newEncodingAddress:n,qBuffer:H,kBuffer:k,vBuffer:J,keysAddress:b,keyInterceptsAddress:Z,keySlopesAddress:m,valuesAddress:u,valueInterceptsAddress:B,valueSlopesAddress:y,position:G,queryAddress:V,n:h},[H.buffer,k.buffer,J.buffer]);case 25:f=g.sent,(X=new Float32Array(I.buffer)).set(f,W/Float32Array.BYTES_PER_ELEMENT);case 28:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,l,n,o,s,a,d,b,Z,m,u,B,y,G,V){return g.apply(this,arguments)}}();return{pv_picollm_attention_precompute_encoding_web_worker_wasm:t,pv_picollm_attention_attend_combined_web_worker_wasm:g.graphify(r,[7,8,9,10,11,14,18,20],20)}};x(x({},tI.ATTENTION_PRECOMPUTE_ENCODING,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=I.encodingAddress,t=I.dimension,r=I.steps,c=I.theta,i=I.ropeScalesAddress,l=I.ropeScale;(0,C.pv_picollm_attention_precompute_encoding_wasm)(e.get(A).workerMemAddress,t,r,c,e.get(i).workerMemAddress,l)})),tI.ATTENTION_ATTEND_COMBINED,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.numHeads,r=I.numKvHeads,c=I.windowLength,i=I.headDimension,l=I.ropeDimension,n=I.ropeInterleaved,o=I.newEncodingAddress,s=I.qBuffer,a=I.kBuffer,d=I.vBuffer,b=I.keysAddress,Z=I.keyInterceptsAddress,m=I.keySlopesAddress,u=I.valuesAddress,B=I.valueInterceptsAddress,y=I.valueSlopesAddress,G=I.position,V=I.queryAddress,h=I.n,W=C.aligned_alloc,R=C.free,p=C.pv_picollm_attention_encode_wasm,X=C.pv_picollm_attention_update_keys_wasm,S=C.pv_picollm_attention_update_values_wasm,H=C.pv_picollm_attention_transpose_query_wasm,k=C.pv_picollm_attention_attend_wasm,J=e.get(o).workerMemAddress,w=e.get(b).workerMemAddress,f=e.get(Z).workerMemAddress,F=e.get(m).workerMemAddress,Y=e.get(u).workerMemAddress,v=e.get(B).workerMemAddress,K=e.get(y).workerMemAddress,N=e.get(V).workerMemAddress,E=W(Float32Array.BYTES_PER_ELEMENT,s.length*Float32Array.BYTES_PER_ELEMENT),U=W(Float32Array.BYTES_PER_ELEMENT,a.length*Float32Array.BYTES_PER_ELEMENT),L=W(Float32Array.BYTES_PER_ELEMENT,d.length*Float32Array.BYTES_PER_ELEMENT),M=t*i*h,T=W(Float32Array.BYTES_PER_ELEMENT,M*Float32Array.BYTES_PER_ELEMENT),Q=new Float32Array(A.buffer);Q.set(s,E/Float32Array.BYTES_PER_ELEMENT),Q.set(a,U/Float32Array.BYTES_PER_ELEMENT),Q.set(d,L/Float32Array.BYTES_PER_ELEMENT),Q.fill(0,T/Float32Array.BYTES_PER_ELEMENT,T/Float32Array.BYTES_PER_ELEMENT+M),p(E,J,h,t,n,i,l,G),H(h,E,N,t,i),p(U,J,h,r,n,i,l,G),X(r,c,i,w,f,F,G,h,U),S(r,c,i,Y,v,K,G,h,L),k(t,r,c,i,w,f,F,Y,v,K,G,N,h,T);var z=(Q=new Float32Array(A.buffer)).slice(T/Float32Array.BYTES_PER_ELEMENT,T/Float32Array.BYTES_PER_ELEMENT+M);return R(E),R(U),R(L),R(T),z}));var lI,nI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),D.getXpu(g)){I.next=7;break}return e(r,-1),I.abrupt("return");case 7:return I.next=9,C.pv_picollm_feed_forward_silu_wasm(A,t);case 9:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),r=function(){var I=A(o.mark((function I(g,A,t,r){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),D.getXpu(g)){I.next=7;break}return e(r,-1),I.abrupt("return");case 7:return I.next=9,C.pv_picollm_feed_forward_gelu_wasm(A,t);case 9:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),c=function(){var I=A(o.mark((function I(g,e,A,t){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),A=w(A),D.getXpu(g)){I.next=6;break}return I.abrupt("return");case 6:return I.next=8,C.pv_picollm_feed_forward_almost_gelu_wasm(e,A);case 8:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),i=function(){var I=A(o.mark((function I(g,A,t,r,c){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),c=w(c),D.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_feed_forward_multiply_buffers_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}();return{pv_picollm_feed_forward_silu_web_worker_wasm:g.graphify(t,[2],2),pv_picollm_feed_forward_gelu_web_worker_wasm:g.graphify(r,[2],2),pv_picollm_feed_forward_almost_gelu_web_worker_wasm:g.graphify(c,[2],2),pv_picollm_feed_forward_multiply_buffers_web_worker_wasm:g.graphify(i,[2,3],3)}},oI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r,c,i,l,n){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),c=w(c),i=w(i),l=w(l),n=w(n),D.getXpu(g)){I.next=9;break}return e(n,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_gate_forward_wasm(A,t,r,c,i,l);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i){return I.apply(this,arguments)}}();return{pv_picollm_gate_forward_web_worker_wasm:g.graphify(t,[],6)}},sI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r,c){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),c=w(c),D.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_moe_transformer_add_to_buffer_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}(),r=function(){var I=A(o.mark((function I(g,A,t,r,c,i,l,n){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),c=w(c),i=w(i),l=w(l),n=w(n),D.getXpu(g)){I.next=9;break}return e(n,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer_wasm(A,t,r,c,i,l);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i){return I.apply(this,arguments)}}(),c=function(){var I=A(o.mark((function I(g,A,t,r,c,i){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),c=w(c),i=w(i),D.getXpu(g)){I.next=9;break}return e(i,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_moe_transformer_add_buffers_wasm(A,t,r,c);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}();return{pv_picollm_moe_transformer_add_to_buffer_web_worker_wasm:g.graphify(t,[2],3),pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer_web_worker_wasm:g.graphify(r,[5],6),pv_picollm_moe_transformer_add_buffers_web_worker_wasm:g.graphify(c,[2,3],4)}},aI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r,c,i,l,n,s,a){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),r=w(r),l=w(l),s=w(s),a=w(a),D.getXpu(g)){I.next=9;break}return e(a,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_norm_forward_wasm(A,t,r,c,l+i,s+n);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,l,n){return I.apply(this,arguments)}}();return{pv_picollm_norm_forward_web_worker_wasm:g.graphify(t,[6],8)}},dI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r,c,i,l,n,s,a,d){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),r=w(r),c=w(c),n=w(n),a=w(a),d=w(d),D.getXpu(g)){I.next=10;break}return e(d,-1),I.abrupt("return");case 10:return I.next=12,C.pv_picollm_norm_layer_forward_wasm(A,t,r,c,i,n+l,a+s);case 12:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,l,n,o){return I.apply(this,arguments)}}();return{pv_picollm_norm_layer_forward_web_worker_wasm:g.graphify(t,[7,9],9)}},bI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var I=A(o.mark((function I(g,A,t,r,c){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),c=w(c),D.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_transformer_add_to_buffer_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}(),r=function(){var I=A(o.mark((function I(g,A,t,r,c,i){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),t=w(t),r=w(r),c=w(c),i=w(i),D.getXpu(g)){I.next=9;break}return e(i,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_transformer_add_buffers_wasm(A,t,r,c);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}();return{pv_picollm_transformer_add_to_buffer_web_worker_wasm:g.graphify(t,[2,3],3),pv_picollm_transformer_add_buffers_web_worker_wasm:g.graphify(r,[2,3],4)}};function ZI(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return mI(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return mI(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function mI(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}function uI(I){return I|=I>>1,I|=I>>2,I|=I>>4,I|=I>>8,I|=I>>16,(I|=I>>32)-(I>>1)}function BI(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0===g&&(g=I,I=0);for(var e=[],A=I;C>0?A<g:A>g;A+=C)e.push(A);return e}!function(I){I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS=100]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS",I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS=101]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS",I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS=102]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE=103]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE=104]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE"}(lI||(lI={}));var yI=function(I,g,e){var t=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},r=function(){var e=A(o.mark((function e(A,r,c,i,l,n,s,a,d){var b,Z,m,u,B,y,G,V,h,W,R,p,X,S,H,k,J,F,Y,v,K,N,E,U,L,M,T,Q,z,x,_,P;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A=w(A),r=w(r),c=w(c),l=w(l),n=w(n),s=w(s),a=w(a),d=w(d),b=D.getXpu(A)){e.next=12;break}return t(d,-1),e.abrupt("return");case 12:for(Z=new Uint8Array(I.buffer),m=f(Z,r),g.addName(s,m),u=new Int32Array(I.buffer),B=u.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+2),y=u.slice(l/Int32Array.BYTES_PER_ELEMENT,l/Int32Array.BYTES_PER_ELEMENT+i),G=u.slice(n/Int32Array.BYTES_PER_ELEMENT,n/Int32Array.BYTES_PER_ELEMENT+i),V=[],h=0,W=0;W<i;W++)R=W===i-1?B[1]/8:G[W+1],p=(R-G[W])*y[W]*B[0],V.push([h,p]),h+=p;X=h,S=new Uint8Array(I.buffer).slice(s,s+X),H=[],b.numWorkers<4?(k=uI(b.numWorkers),H=BI(b.numWorkers-k,b.numWorkers)):(J=uI((b.numWorkers-1)*(2/3)),F=uI((b.numWorkers-1)*(1/3)),Y=b.numWorkers-1-J-F,H=m.includes("ff")||X>1024e4?BI(1,1+J):BI(1+J,1+J+F),Y>0&&m.includes("att.v")&&(Y>=F?H=BI(1+J+F,1+J+2*F):F===Y+1&&(H=[0].concat(O(BI(1+J+F,J+2*F)))))),v=Math.ceil(X/H.length),K=X/v,B[0]/=K,N=[],E=X,U=0;case 32:if(!(U<H.length)){e.next=44;break}L=new Uint8Array(v),M=0,T=ZI(V);try{for(T.s();!(Q=T.n()).done;)z=C(Q.value,2),x=z[0],_=z[1],P=U*(_/K),L.set(S.slice(x+P,x+P+_/K),M),M+=_/K}catch(I){T.e(I)}finally{T.f()}if(E-=M,N.push(cI(b.workers[H[U]],{action:lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,shape:B,bitDepths:y,bitDepthStarts:G,numBlockBytes:v,blocksAddress:a,block:L},[L.buffer])),!(E<=0)){e.next=41;break}return e.abrupt("break",44);case 41:U++,e.next=32;break;case 44:return e.next=46,Promise.all(N);case 46:t(d,0),D.addMemory(a,{objAddress:A,memFlag:0,allocSize:X,chunkSize:v,workerSet:H});case 48:case"end":return e.stop()}}),e)})));return function(I,g,C,A,t,r,c,i,l){return e.apply(this,arguments)}}(),c=function(){var g=A(o.mark((function g(e,A,r,c,i,l,n,s){var a,d,b,Z,m,u,B,y,G,V,h,W,R,p,X,S,H,k,J,f,F,Y,v,K,N;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(e=w(e),A=w(A),c=w(c),i=w(i),l=w(l),n=w(n),s=w(s),a=D.getXpu(e)){g.next=11;break}return t(s,-1),g.abrupt("return");case 11:if(d=D.getMemory(i)){g.next=15;break}return t(s,-1),g.abrupt("return");case 15:for(b=new Int32Array(I.buffer),Z=b.slice(A/Int32Array.BYTES_PER_ELEMENT,A/Int32Array.BYTES_PER_ELEMENT+2),m=b.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),u=[],B=0,y=0;y<r;y++)G=y===r-1?Z[1]/8:m[y+1],V=2*(G-m[y])*(Z[0]/16),u.push([B,V]),B+=V;h=B,W=Math.ceil(h/d.workerSet.length),R=h/W,p=new Uint16Array(I.buffer).slice(l/Uint16Array.BYTES_PER_ELEMENT,l/Uint16Array.BYTES_PER_ELEMENT+h),X=[],S=h,H=0;case 28:if(!(H<d.workerSet.length)){g.next=40;break}k=new Uint16Array(W),J=0,f=ZI(u);try{for(f.s();!(F=f.n()).done;)Y=C(F.value,2),v=Y[0],K=Y[1],N=H*(K/R),k.set(p.slice(v+N,v+N+K/R),J),J+=K/R}catch(I){f.e(I)}finally{f.f()}if(S-=J,X.push(cI(a.workers[d.workerSet[H]],{action:lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS,memAddress:n,metas:k},[k.buffer])),!(S<=0)){g.next=37;break}return g.abrupt("break",40);case 37:H++,g.next=28;break;case 40:return g.next=42,Promise.all(X);case 42:t(s,0),D.addMemory(n,{objAddress:e,memFlag:0,allocSize:h*Uint16Array.BYTES_PER_ELEMENT,chunkSize:W,workerSet:d.workerSet});case 44:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i){return g.apply(this,arguments)}}(),i=function(){var g=A(o.mark((function g(C,e,A,r,c,i){var l,n,s,a,d,b,Z,m,u,B,y;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),e=w(e),A=w(A),r=w(r),c=w(c),i=w(i),l=D.getXpu(C)){g.next=10;break}return t(i,-1),g.abrupt("return");case 10:if(n=D.getMemory(A)){g.next=14;break}return t(i,-1),g.abrupt("return");case 14:s=new Int32Array(I.buffer),a=s.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),d=a[0],b=new Float32Array(I.buffer).slice(r/Float32Array.BYTES_PER_ELEMENT,r/Float32Array.BYTES_PER_ELEMENT+d),Z=Math.ceil(d/n.workerSet.length),m=[],u=d,B=0;case 22:if(!(B<n.workerSet.length)){g.next=31;break}if(y=b.slice(B*Z,(B+1)*Z),m.push(cI(l.workers[n.workerSet[B]],{action:lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS,memAddress:c,bias:y},[y.buffer])),!((u-=Z)<=0)){g.next=28;break}return g.abrupt("break",31);case 28:B++,g.next=22;break;case 31:return g.next=33,Promise.all(m);case 33:t(i,0),D.addMemory(c,{objAddress:C,memFlag:0,allocSize:d*Float32Array.BYTES_PER_ELEMENT,chunkSize:Z,workerSet:n.workerSet});case 35:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r){return g.apply(this,arguments)}}(),l=function(){var g=A(o.mark((function g(C,e,A,r,c,i,l,n,s,a,d,b,Z){var m,u,B,y,G,V,h,W,R,p,X,S,H,k,J,f,F,Y,v;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),e=w(e),A=w(A),c=w(c),i=w(i),l=w(l),n=w(n),a=w(a),d=w(d),b=w(b),Z=w(Z),m=D.getXpu(C)){g.next=15;break}return t(Z,-1),g.abrupt("return");case 15:if(u=D.getMemory(n)){g.next=19;break}return t(Z,-1),g.abrupt("return");case 19:if(B=D.getMemory(l)){g.next=23;break}return t(Z,-1),g.abrupt("return");case 23:if(y=D.getMemory(a)){g.next=27;break}return t(Z,-1),g.abrupt("return");case 27:if(D.getMemory(d)){g.next=31;break}return t(Z,-1),g.abrupt("return");case 31:for(G=new Float32Array(I.buffer),V=new Int32Array(I.buffer),h=V.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),W=V.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),R=V.slice(i/Int32Array.BYTES_PER_ELEMENT,i/Int32Array.BYTES_PER_ELEMENT+r),p=G.slice(a/Float32Array.BYTES_PER_ELEMENT,(a+y.allocSize)/Float32Array.BYTES_PER_ELEMENT),B.allocSize,Uint16Array.BYTES_PER_ELEMENT,X=u.chunkSize,S=u.allocSize,H=S/X,h[0]/=H,k=[],J=0;J<u.workerSet.length;J++)k.push(cI(m.workers[u.workerSet[J]],{action:lI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,shape:h,indicesAddress:A,bitDepthStarts:W,bitDepths:R,metasAddress:l,blocksAddress:n,xOffset:s,xAddress:a,xBuffer:p,biasAddress:b}));return g.next=45,Promise.all(k);case 45:for(f=g.sent,F=new Float32Array(h[0]*H),Y=0;Y<f.length;Y++)v=new Float32Array(f[Y].buffer),F.set(v,Y*v.length);G.set(F,d/Float32Array.BYTES_PER_ELEMENT);case 49:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,l,n,o,s,a){return g.apply(this,arguments)}}(),n=function(){var g=A(o.mark((function g(C,e,A,r,c,i,l,n,s,a,d,b,Z,m){var u,B,y,G,V,h,W,R,p,X,S,H,k,J,f,F,Y,v,K,N,E,U;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),e=w(e),A=w(A),c=w(c),i=w(i),l=w(l),n=w(n),d=w(d),b=w(b),Z=w(Z),m=w(m),u=D.getXpu(C)){g.next=15;break}return t(m,-1),g.abrupt("return");case 15:if(B=D.getMemory(n)){g.next=19;break}return t(m,-1),g.abrupt("return");case 19:if(y=D.getMemory(l)){g.next=23;break}return t(m,-1),g.abrupt("return");case 23:if(D.getMemory(b)){g.next=27;break}return t(m,-1),g.abrupt("return");case 27:if(G=D.getMemory(d)){g.next=31;break}return t(m,-1),g.abrupt("return");case 31:for(V=new Float32Array(I.buffer),h=new Int32Array(I.buffer),W=h.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),R=h.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),p=h.slice(i/Int32Array.BYTES_PER_ELEMENT,i/Int32Array.BYTES_PER_ELEMENT+r),X=V.slice(d/Float32Array.BYTES_PER_ELEMENT,(d+G.allocSize)/Float32Array.BYTES_PER_ELEMENT),y.allocSize,Uint16Array.BYTES_PER_ELEMENT,S=B.chunkSize,H=B.allocSize,k=H/S,W[0]/=k,J=[],f=0;f<B.workerSet.length;f++)J.push(cI(u.workers[B.workerSet[f]],{action:lI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,shape:W,indicesAddress:A,bitDepthStarts:R,bitDepths:p,metasAddress:l,blocksAddress:n,n:s,xOffset:a,xAddress:d,xBuffer:X,biasAddress:Z}));return g.next=45,Promise.all(J);case 45:for(F=g.sent,Y=new Float32Array(W[0]*k*s),v=0,K=0;K<F.length;K++){for(N=new Float32Array(F[K].buffer),E=0,U=0;U<s;U++)Y.set(N.slice(E,E+W[0]),E*k+v),E+=W[0];v+=W[0]}V.set(Y,b/Float32Array.BYTES_PER_ELEMENT);case 50:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,l,n,o,s,a,d){return g.apply(this,arguments)}}(),s=function(){var I=A(o.mark((function I(g,C,A,r,c,i,l,n,s){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),c=w(c),l=w(l),n=w(n),s=w(s),D.getXpu(g)){I.next=9;break}return t(s,-1),I.abrupt("return");case 9:return I.next=11,e.pv_picollm_weight_float_forward_wasm(C,A,r,c,l+i,n);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,l){return I.apply(this,arguments)}}();return{pv_picollm_weight_block_mixed_16x8_preprocess_blocks_web_worker_wasm:r,pv_picollm_weight_block_mixed_16x8_preprocess_metas_web_worker_wasm:c,pv_picollm_weight_block_mixed_16x8_preprocess_bias_web_worker_wasm:i,pv_picollm_weight_block_mixed_16x8_forward_single_web_worker_wasm:g.graphify(l,[9,10],10,7),pv_picollm_weight_block_mixed_16x8_forward_multiple_web_worker_wasm:g.graphify(n,[10,11],11,7),pv_picollm_weight_float_forward_web_worker_wasm:g.graphify(s,[6,7],7)}},GI=function(){var I=A(o.mark((function I(g){var C,e,A,t,r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.bitDepths,i=g.bitDepthStarts,l=g.numBlockBytes,n=g.blocksAddress,s=g.block,a=e.aligned_alloc,d=e.free,b=e.pv_picollm_weight_block_mixed_16x8_preprocess_blocks,(Z=a(Uint8Array.BYTES_PER_ELEMENT,l*Uint8Array.BYTES_PER_ELEMENT))&&(A.set(n,{allocSize:l,workerMemAddress:Z}),m=a(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),u=a(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*c.length),B=a(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),y=new Uint8Array(t.buffer),G=new Int32Array(t.buffer),y.set(s,Z),G.set(r,m/Int32Array.BYTES_PER_ELEMENT),G.set(c,u/Int32Array.BYTES_PER_ELEMENT),G.set(i,B/Int32Array.BYTES_PER_ELEMENT),b(m,c.length,u,B,Z),d(m),d(u),d(B));case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),VI=function(){var I=A(o.mark((function I(g){var C,e,A,t,r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G,V,h,W,R,p,X,S,H,k,J,w,f,F,Y,v,K;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.indicesAddress,i=g.bitDepthStarts,l=g.bitDepths,n=g.metasAddress,s=g.blocksAddress,a=g.xOffset,d=g.xBuffer,b=g.biasAddress,Z=e.aligned_alloc,m=e.free,u=e.pv_picollm_weight_block_mixed_16x8_forward_single,B=e.pv_picollm_weight_block_mixed_16x8_add_bias,y=A.get(c),G=y.workerMemAddress,V=A.get(n),h=V.workerMemAddress,W=A.get(s),R=W.workerMemAddress,p=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),X=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),S=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*l.length),H=Z(256,Float32Array.BYTES_PER_ELEMENT*d.length),k=Z(256,Float32Array.BYTES_PER_ELEMENT*r[0]),J=new Float32Array(t.buffer),(w=new Int32Array(t.buffer)).set(r,p/Int32Array.BYTES_PER_ELEMENT),w.set(i,X/Int32Array.BYTES_PER_ELEMENT),w.set(l,S/Int32Array.BYTES_PER_ELEMENT),J.set(d,H/Float32Array.BYTES_PER_ELEMENT),u(p,G,l.length,X,S,h,R,H+a,k),A.has(b)&&(f=A.get(b),F=f.workerMemAddress,Y=f.allocSize,v=Y/Float32Array.BYTES_PER_ELEMENT,B(1,v,k,F)),K=new Float32Array(t.buffer).slice(k/Float32Array.BYTES_PER_ELEMENT,k/Float32Array.BYTES_PER_ELEMENT+r[0]),m(p),m(X),m(S),m(H),m(k),I.abrupt("return",K);case 26:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),hI=function(){var I=A(o.mark((function I(g){var C,e,A,t,r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G,V,h,W,R,p,X,S,H,k,J,w,f,F,Y,v,K,N;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.indicesAddress,i=g.bitDepthStarts,l=g.bitDepths,n=g.metasAddress,s=g.blocksAddress,a=g.n,d=g.xOffset,b=g.xBuffer,Z=g.biasAddress,m=e.aligned_alloc,u=e.free,B=e.pv_picollm_weight_block_mixed_16x8_forward_multiple,y=e.pv_picollm_weight_block_mixed_16x8_add_bias,G=A.get(c),V=G.workerMemAddress,h=A.get(n),W=h.workerMemAddress,R=A.get(s),p=R.workerMemAddress,X=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),S=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),H=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*l.length),k=m(Float32Array.BYTES_PER_ELEMENT,Float32Array.BYTES_PER_ELEMENT*b.length),J=m(Float32Array.BYTES_PER_ELEMENT,Float32Array.BYTES_PER_ELEMENT*(r[0]*a)),w=new Float32Array(t.buffer),(f=new Int32Array(t.buffer)).set(r,X/Int32Array.BYTES_PER_ELEMENT),f.set(i,S/Int32Array.BYTES_PER_ELEMENT),f.set(l,H/Int32Array.BYTES_PER_ELEMENT),w.set(b,k/Float32Array.BYTES_PER_ELEMENT),B(X,V,l.length,S,H,W,p,a,k+d,J),A.has(Z)&&(F=A.get(Z),Y=F.workerMemAddress,v=F.allocSize,K=v/Float32Array.BYTES_PER_ELEMENT,y(a,K,J,Y)),N=new Float32Array(t.buffer).slice(J/Float32Array.BYTES_PER_ELEMENT,J/Float32Array.BYTES_PER_ELEMENT+r[0]*a),u(X),u(S),u(H),u(k),u(J),I.abrupt("return",N);case 26:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}();function WI(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return RI(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return RI(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function RI(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}x(x(x(x(x({},lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,GI),lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.memAddress,r=I.metas,c=(0,C.aligned_alloc)(Uint16Array.BYTES_PER_ELEMENT,r.length*Uint16Array.BYTES_PER_ELEMENT);c&&(e.set(t,{allocSize:r.length*Uint16Array.BYTES_PER_ELEMENT,workerMemAddress:c}),new Uint16Array(A.buffer).set(r,c/Uint16Array.BYTES_PER_ELEMENT))})),lI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.memAddress,r=I.bias,c=(0,C.aligned_alloc)(Float32Array.BYTES_PER_ELEMENT,r.length*Float32Array.BYTES_PER_ELEMENT);c&&(e.set(t,{allocSize:r.length*Float32Array.BYTES_PER_ELEMENT,workerMemAddress:c}),new Float32Array(A.buffer).set(r,c/Float32Array.BYTES_PER_ELEMENT))})),lI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,VI),lI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,hI);return function(I,g){var e=new gI;e.memory=I;for(var t=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},r=function(){var g=A(o.mark((function g(C,e,A,r,c){var i,l,n,s,a,d,b,Z,m,u,B,y,G;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return C=w(C),e=w(e),A=w(A),r=w(r),c=w(c),i=h.aligned_alloc,l=W.getParser(navigator.userAgent),n=new Uint8Array(I.buffer),s=l.getBrowserName(),g.next=11,i(Uint8Array.BYTES_PER_ELEMENT,(s.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 11:if(0!==(a=g.sent)){g.next=15;break}return t(c,-1),g.abrupt("return");case 15:for(t(C,a),d=0;d<s.length;d++)n[a+d]=s.charCodeAt(d);return n[a+s.length]=0,b=l.getBrowserVersion(),g.next=21,i(Uint8Array.BYTES_PER_ELEMENT,(b.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 21:if(0!==(Z=g.sent)){g.next=25;break}return t(c,-1),g.abrupt("return");case 25:for(t(e,Z),m=0;m<b.length;m++)n[Z+m]=b.charCodeAt(m);return n[Z+b.length]=0,u=l.getOSName(),g.next=31,i(Uint8Array.BYTES_PER_ELEMENT,(u.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 31:if(0!==(B=g.sent)){g.next=35;break}return t(c,-1),g.abrupt("return");case 35:for(t(A,B),y=0;y<u.length;y++)n[B+y]=u.charCodeAt(y);n[B+u.length]=0,G=self.navigator.hardwareConcurrency,t(r,G||1),t(c,0);case 41:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t){return g.apply(this,arguments)}}(),c=function(){var I=A(o.mark((function I(C,A,r){var c,i,l,n,s;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=w(C),r=w(r),g){I.next=5;break}return t(r,-1),I.abrupt("return");case 5:0===A&&(A=8),c=self.navigator.hardwareConcurrency,i=c&&c<A?c:A,l=[],n=0;case 10:if(!(n<i)){I.next=18;break}return s=new rI(new U),l.push(s),I.next=15,cI(s,{action:E.INIT,wasm:g});case 15:n++,I.next=10;break;case 18:if(!h.pv_picollm_feed_forward_almost_gelu_init_lookup_table){I.next=21;break}return I.next=21,h.pv_picollm_feed_forward_almost_gelu_init_lookup_table();case 21:D.addXpu(C,{deviceMem:new Set,numWorkers:i,workers:l,graph:e}),t(r,0);case 23:case"end":return I.stop()}}),I)})));return function(g,C,e){return I.apply(this,arguments)}}(),i=function(){var I=A(o.mark((function I(g,C,A,r,c){var i,l,n,s,a,d,b,Z;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),C=w(C),c=w(c),i=D.getXpu(g)){I.next=7;break}return t(c,-1),I.abrupt("return");case 7:if(l=i.workers,n=i.numWorkers,s=A,!Boolean(4&r)){I.next=35;break}if(a=[],!Boolean(8&r)){I.next=17;break}a.push(cI(l[0],{action:E.ALLOC,size:A,memAddress:C})),I.next=33;break;case 17:d=Boolean(2&r),s=Math.ceil(A/n),b=A,Z=0;case 21:if(!(Z<n)){I.next=33;break}if(!d){I.next=26;break}a.push(cI(l[Z],{action:E.ALLOC,size:A,memAddress:C})),I.next=30;break;case 26:if(a.push(cI(l[Z],{action:E.ALLOC,size:Math.min(b,s),memAddress:C})),!((b-=s)<=0)){I.next=30;break}return I.abrupt("break",33);case 30:Z++,I.next=21;break;case 33:return I.next=35,Promise.all(a);case 35:D.addMemory(C,{objAddress:g,memFlag:r,allocSize:A,chunkSize:s}),e.enabled||t(c,0);case 37:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}(),l=function(){var I=A(o.mark((function I(g){var C,e,A,t,r,c;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),!D.hasMemory(g)){I.next=16;break}if(C=D.getMemory(g),e=C.objAddress,A=C.memFlag,t=D.getXpu(e),Boolean(4&A)){I.next=10;break}return I.next=8,h.free(g);case 8:I.next=14;break;case 10:for(r=[],c=0;c<t.numWorkers;c++)r.push(cI(t.workers[c],{action:E.FREE,memAddress:g}));return I.next=14,Promise.all(r);case 14:D.removeMemory(g),D.removeUniquePointer(g);case 16:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),n=function(){var g=A(o.mark((function g(C,e,A,t){var r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),e=w(e),r=D.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:if(c=r.objAddress,i=r.memFlag,l=r.chunkSize,n=D.getXpu(c),Boolean(4&i)){g.next=13;break}(s=new Uint8Array(I.buffer)).set(s.slice(e,e+t),C+A),g.next=38;break;case 13:if(a=[],d=new Uint8Array(I.buffer).slice(e,e+t),!Boolean(8&i)){g.next=20;break}a.push(cI(n.workers[0],{action:E.COPY_TO_XPU,memAddress:C,offset:A,buffer:d})),g.next=36;break;case 20:b=Boolean(2&i),Z=t,m=0;case 23:if(!(m<n.numWorkers)){g.next=36;break}if(!b){g.next=28;break}a.push(cI(n.workers[m],{action:E.COPY_TO_XPU,memAddress:C,offset:A,buffer:d})),g.next=33;break;case 28:if(u=m*l,A<(m+1)*l&&(y=l-(B=A>u?A-u:0),G=t-Z,a.push(cI(n.workers[m],{action:E.COPY_TO_XPU,memAddress:C,offset:B,buffer:d.slice(G,G+y)})),Z-=y),!(Z<=0)){g.next=33;break}return g.abrupt("break",36);case 33:m++,g.next=23;break;case 36:return g.next=38,Promise.all(a);case 38:case"end":return g.stop()}}),g)})));return function(I,C,e,A){return g.apply(this,arguments)}}(),s=function(){var g=A(o.mark((function g(C,e,A,t){var r,c,i,l,n,s,a,d,b,Z,m,u,B,y,G,V,h,W,R,p;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),e=w(e),r=D.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:if(c=r.objAddress,i=r.allocSize,l=r.memFlag,n=r.chunkSize,s=D.getXpu(c),Boolean(4&l)){g.next=13;break}(a=new Uint8Array(I.buffer)).set(a.slice(C+A,C+A+t),e),g.next=49;break;case 13:if(d=[],b=Boolean(2&l),Z=Boolean(8&l),!b&&!Z){g.next=20;break}d.push(cI(s.workers[0],{action:E.COPY_FROM_XPU,memAddress:C,offset:A,size:i})),g.next=31;break;case 20:m=i,u=0;case 22:if(!(u<s.numWorkers)){g.next=31;break}if(B=u*n,A<(u+1)*n&&(y=A>B?A-B:0,G=Math.min(m,n-y),d.push(cI(s.workers[u],{action:E.COPY_FROM_XPU,memAddress:C,offset:y,size:G})),m-=G),0!==m){g.next=28;break}return g.abrupt("break",31);case 28:u++,g.next=22;break;case 31:return g.next=33,Promise.all(d);case 33:V=g.sent,h=new Uint8Array(I.buffer),W=0,R=0;case 37:if(!(R<V.length)){g.next=49;break}if(p=V[R],!(W+p.length>t)){g.next=44;break}return h.set(p.slice(0,t-W),e+W),g.abrupt("break",49);case 44:h.set(p,e+W),W+=p.length;case 46:R++,g.next=37;break;case 49:case"end":return g.stop()}}),g)})));return function(I,C,e,A){return g.apply(this,arguments)}}(),a=function(){var g=A(o.mark((function g(C,e,A){var t,r,c,i,l,n,s,a,d,b;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=w(C),t=D.getMemory(C)){g.next=4;break}return g.abrupt("return");case 4:if(r=t.objAddress,c=t.allocSize,i=t.memFlag,l=t.chunkSize,n=D.getXpu(r),Boolean(4&i)){g.next=12;break}new Uint8Array(I.buffer).fill(e,C,C+A),g.next=35;break;case 12:if(s=[],!Boolean(8&i)){g.next=18;break}s.push(cI(n.workers[0],{action:E.MEMSET,memAddress:C,fillByte:e,size:c})),g.next=33;break;case 18:a=Boolean(2&i),d=A,b=0;case 21:if(!(b<n.numWorkers)){g.next=33;break}if(!a){g.next=26;break}s.push(cI(n.workers[b],{action:E.MEMSET,memAddress:C,fillByte:e,size:c})),g.next=30;break;case 26:if(s.push(cI(n.workers[b],{action:E.MEMSET,memAddress:C,fillByte:e,size:Math.min(d,l)})),!((d-=l)<=0)){g.next=30;break}return g.abrupt("break",33);case 30:b++,g.next=21;break;case 33:return g.next=35,Promise.all(s);case 35:case"end":return g.stop()}}),g)})));return function(I,C,e){return g.apply(this,arguments)}}(),d=function(){var I=A(o.mark((function I(g){var C;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:g=w(g),C=self.navigator.hardwareConcurrency,t(g,C||1);case 3:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),b=function(){var I=A(o.mark((function I(g){var C,e,A;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),C=D.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(e=[],A=0;A<C.numWorkers;A++)e.push(cI(C.workers[A],{action:E.TIMER_START,workerIndex:A}));return I.next=8,Promise.all(e);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),Z=function(){var I=A(o.mark((function I(g){var C,e,A;return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),C=D.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(e=[],A=0;A<C.numWorkers;A++)e.push(cI(C.workers[A],{action:E.TIMER_STOP}));return I.next=8,Promise.all(e);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),m=function(){var I=A(o.mark((function I(g){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),D.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:e.enabled=!0;case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),u=function(){var I=A(o.mark((function I(g){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),D.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:e.enabled=!1;case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),B=function(){var I=A(o.mark((function I(g,C){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=w(g),D.getXpu(g)){I.next=5;break}return t(C,-1),I.abrupt("return");case 5:return I.prev=5,I.next=8,e.execute();case 8:t(C,0),I.next=14;break;case 11:I.prev=11,I.t0=I.catch(5),t(C,-1);case 14:case"end":return I.stop()}}),I,null,[[5,11]])})));return function(g,C){return I.apply(this,arguments)}}(),y=function(){var g=A(o.mark((function g(C,e,A){var t;return o.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return A=w(A),g.prev=1,g.next=4,h.aligned_alloc(C,e);case 4:t=g.sent,new Int32Array(I.buffer)[A/Int32Array.BYTES_PER_ELEMENT]=t,g.next=13;break;case 9:g.prev=9,g.t0=g.catch(1),new Int32Array(I.buffer)[A/Int32Array.BYTES_PER_ELEMENT]=0;case 13:case"end":return g.stop()}}),g,null,[[1,9]])})));return function(I,C,e){return g.apply(this,arguments)}}(),G=function(){var I=A(o.mark((function I(g){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,h.free(g);case 2:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),V=function(){var I=A(o.mark((function I(g,C,e,A){return o.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,h.pv_picollm_table_forward(g,C,e,A);case 2:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),h={aligned_alloc:function(I,g){throw new Error("aligned_alloc was not passed in from parent module")},free:function(I){throw new Error("free was not passed in from parent module")},pv_picollm_table_forward:function(I,g,C,e){throw new Error("pv_picollm_table_forward was not passed in from parent module")},pv_picollm_feed_forward_almost_gelu_init_lookup_table:void 0,pv_xpu_graphified_alloc_wasm:e.graphify(y,[2],2,void 0,1),pv_xpu_graphified_free_wasm:e.graphify(G,[0],0,void 0,1),pv_xpu_web_worker_device_info_wasm:r,pv_xpu_web_worker_device_init_wasm:c,pv_xpu_web_worker_device_cleanup_wasm:function(I){I=w(I);var g=D.getXpu(I);if(g){var C,e=WI(g.workers);try{for(e.s();!(C=e.n()).done;){C.value.terminate()}}catch(I){e.e(I)}finally{e.f()}D.removeXpu(I)}},pv_xpu_web_worker_device_get_unique_pointer_wasm:function(){return D.getUniquePointer()},pv_xpu_web_worker_device_mem_alloc_wasm:e.graphify(i,[1],1),pv_xpu_web_worker_device_mem_free_wasm:e.graphify(l,[0],0,void 0,void 0),pv_xpu_web_worker_device_mem_copy_to_xpu_wasm:e.graphify(n,[0,1],0,void 0,void 0),pv_xpu_web_worker_device_mem_copy_from_xpu_wasm:e.graphify(s,[0,1],-1,void 0,void 0),pv_xpu_web_worker_device_mem_memset_wasm:e.graphify(a,[0],0,void 0,void 0),pv_xpu_web_worker_get_max_workers_wasm:d,pv_xpu_web_worker_timer_start_wasm:b,pv_xpu_web_worker_timer_stop_wasm:Z,pv_xpu_web_worker_start_graph_wasm:m,pv_xpu_web_worker_stop_graph_wasm:u,pv_xpu_web_worker_execute_graph_wasm:B,pv_xpu_web_worker_picollm_table_forward_wasm:e.graphify(V,[2,3],3,void 0,void 0)},R=0,p=[iI,nI,oI,sI,aI,dI,bI,yI];R<p.length;R++)for(var X=p[R],S=0,H=Object.entries(X(I,e,h));S<H.length;S++){var k=C(H[S],2),J=k[0],f=k[1];h[J]=f}return h}}();
