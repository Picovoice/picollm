function I(g){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I(g)}function g(g){var C=function(g,C){if("object"!=I(g)||!g)return g;var A=g[Symbol.toPrimitive];if(void 0!==A){var e=A.call(g,C||"default");if("object"!=I(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===C?String:Number)(g)}(g,"string");return"symbol"==I(C)?C:String(C)}function C(I,C,A){return(C=g(C))in I?Object.defineProperty(I,C,{value:A,enumerable:!0,configurable:!0,writable:!0}):I[C]=A,I}function A(I,g,C,A,e,c,l){try{var t=I[c](l),s=t.value}catch(I){return void C(I)}t.done?g(s):Promise.resolve(s).then(A,e)}function e(I){return function(){var g=this,C=arguments;return new Promise((function(e,c){var l=I.apply(g,C);function t(I){A(l,e,c,t,s,"next",I)}function s(I){A(l,e,c,t,s,"throw",I)}t(void 0)}))}}function c(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}var l={exports:{}},t={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(t);var s=t.exports;!function(I){var g=s.default;function C(){I.exports=C=function(){return e},I.exports.__esModule=!0,I.exports.default=I.exports;var A,e={},c=Object.prototype,l=c.hasOwnProperty,t=Object.defineProperty||function(I,g,C){I[g]=C.value},s="function"==typeof Symbol?Symbol:{},Z=s.iterator||"@@iterator",d=s.asyncIterator||"@@asyncIterator",b=s.toStringTag||"@@toStringTag";function i(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{i({},"")}catch(A){i=function(I,g,C){return I[g]=C}}function r(I,g,C,A){var e=g&&g.prototype instanceof y?g:y,c=Object.create(e.prototype),l=new Y(A||[]);return t(c,"_invoke",{value:p(I,C,l)}),c}function o(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}e.wrap=r;var n="suspendedStart",m="suspendedYield",G="executing",a="completed",B={};function y(){}function V(){}function W(){}var u={};i(u,Z,(function(){return this}));var R=Object.getPrototypeOf,X=R&&R(R(w([])));X&&X!==c&&l.call(X,Z)&&(u=X);var h=W.prototype=y.prototype=Object.create(u);function H(I){["next","throw","return"].forEach((function(g){i(I,g,(function(I){return this._invoke(g,I)}))}))}function k(I,C){function A(e,c,t,s){var Z=o(I[e],I,c);if("throw"!==Z.type){var d=Z.arg,b=d.value;return b&&"object"==g(b)&&l.call(b,"__await")?C.resolve(b.__await).then((function(I){A("next",I,t,s)}),(function(I){A("throw",I,t,s)})):C.resolve(b).then((function(I){d.value=I,t(d)}),(function(I){return A("throw",I,t,s)}))}s(Z.arg)}var e;t(this,"_invoke",{value:function(I,g){function c(){return new C((function(C,e){A(I,g,C,e)}))}return e=e?e.then(c,c):c()}})}function p(I,g,C){var e=n;return function(c,l){if(e===G)throw new Error("Generator is already running");if(e===a){if("throw"===c)throw l;return{value:A,done:!0}}for(C.method=c,C.arg=l;;){var t=C.delegate;if(t){var s=J(t,C);if(s){if(s===B)continue;return s}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(e===n)throw e=a,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);e=G;var Z=o(I,g,C);if("normal"===Z.type){if(e=C.done?a:m,Z.arg===B)continue;return{value:Z.arg,done:C.done}}"throw"===Z.type&&(e=a,C.method="throw",C.arg=Z.arg)}}}function J(I,g){var C=g.method,e=I.iterator[C];if(e===A)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=A,J(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var c=o(e,I.iterator,g.arg);if("throw"===c.type)return g.method="throw",g.arg=c.arg,g.delegate=null,B;var l=c.arg;return l?l.done?(g[I.resultName]=l.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=A),g.delegate=null,B):l:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function F(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function S(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function Y(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(F,this),this.reset(!0)}function w(I){if(I||""===I){var C=I[Z];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var e=-1,c=function g(){for(;++e<I.length;)if(l.call(I,e))return g.value=I[e],g.done=!1,g;return g.value=A,g.done=!0,g};return c.next=c}}throw new TypeError(g(I)+" is not iterable")}return V.prototype=W,t(h,"constructor",{value:W,configurable:!0}),t(W,"constructor",{value:V,configurable:!0}),V.displayName=i(W,b,"GeneratorFunction"),e.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===V||"GeneratorFunction"===(g.displayName||g.name))},e.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,W):(I.__proto__=W,i(I,b,"GeneratorFunction")),I.prototype=Object.create(h),I},e.awrap=function(I){return{__await:I}},H(k.prototype),i(k.prototype,d,(function(){return this})),e.AsyncIterator=k,e.async=function(I,g,C,A,c){void 0===c&&(c=Promise);var l=new k(r(I,g,C,A),c);return e.isGeneratorFunction(g)?l:l.next().then((function(I){return I.done?I.value:l.next()}))},H(h),i(h,b,"Generator"),i(h,Z,(function(){return this})),i(h,"toString",(function(){return"[object Generator]"})),e.keys=function(I){var g=Object(I),C=[];for(var A in g)C.push(A);return C.reverse(),function I(){for(;C.length;){var A=C.pop();if(A in g)return I.value=A,I.done=!1,I}return I.done=!0,I}},e.values=w,Y.prototype={constructor:Y,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=A,this.done=!1,this.delegate=null,this.method="next",this.arg=A,this.tryEntries.forEach(S),!I)for(var g in this)"t"===g.charAt(0)&&l.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=A)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,e){return t.type="throw",t.arg=I,g.next=C,e&&(g.method="next",g.arg=A),!!e}for(var e=this.tryEntries.length-1;e>=0;--e){var c=this.tryEntries[e],t=c.completion;if("root"===c.tryLoc)return C("end");if(c.tryLoc<=this.prev){var s=l.call(c,"catchLoc"),Z=l.call(c,"finallyLoc");if(s&&Z){if(this.prev<c.catchLoc)return C(c.catchLoc,!0);if(this.prev<c.finallyLoc)return C(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return C(c.catchLoc,!0)}else{if(!Z)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return C(c.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var A=this.tryEntries[C];if(A.tryLoc<=this.prev&&l.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var e=A;break}}e&&("break"===I||"continue"===I)&&e.tryLoc<=g&&g<=e.finallyLoc&&(e=null);var c=e?e.completion:{};return c.type=I,c.arg=g,e?(this.method="next",this.next=e.finallyLoc,B):this.complete(c)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),S(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var A=C.completion;if("throw"===A.type){var e=A.arg;S(C)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:w(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=A),B}},e}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(l);var Z=(0,l.exports)(),d=Z;try{regeneratorRuntime=Z}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=Z:Function("r","regeneratorRuntime = r")(Z)}var b=c(d);const i={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},o={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},n={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},m={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class G{static getFirstMatch(I,g){const C=g.match(I);return C&&C.length>0&&C[1]||""}static getSecondMatch(I,g){const C=g.match(I);return C&&C.length>1&&C[2]||""}static matchAndReturnConst(I,g,C){if(I.test(g))return C}static getWindowsVersionName(I){switch(I){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),10===g[0])switch(g[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),!(1===g[0]&&g[1]<5))return 1===g[0]&&g[1]<6?"Cupcake":1===g[0]&&g[1]>=6?"Donut":2===g[0]&&g[1]<2?"Eclair":2===g[0]&&2===g[1]?"Froyo":2===g[0]&&g[1]>2?"Gingerbread":3===g[0]?"Honeycomb":4===g[0]&&g[1]<1?"Ice Cream Sandwich":4===g[0]&&g[1]<4?"Jelly Bean":4===g[0]&&g[1]>=4?"KitKat":5===g[0]?"Lollipop":6===g[0]?"Marshmallow":7===g[0]?"Nougat":8===g[0]?"Oreo":9===g[0]?"Pie":void 0}static getVersionPrecision(I){return I.split(".").length}static compareVersions(I,g,C=!1){const A=G.getVersionPrecision(I),e=G.getVersionPrecision(g);let c=Math.max(A,e),l=0;const t=G.map([I,g],(I=>{const g=c-G.getVersionPrecision(I),C=I+new Array(g+1).join(".0");return G.map(C.split("."),(I=>new Array(20-I.length).join("0")+I)).reverse()}));for(C&&(l=c-Math.min(A,e)),c-=1;c>=l;){if(t[0][c]>t[1][c])return 1;if(t[0][c]===t[1][c]){if(c===l)return 0;c-=1}else if(t[0][c]<t[1][c])return-1}}static map(I,g){const C=[];let A;if(Array.prototype.map)return Array.prototype.map.call(I,g);for(A=0;A<I.length;A+=1)C.push(g(I[A]));return C}static find(I,g){let C,A;if(Array.prototype.find)return Array.prototype.find.call(I,g);for(C=0,A=I.length;C<A;C+=1){const A=I[C];if(g(A,C))return A}}static assign(I,...g){const C=I;let A,e;if(Object.assign)return Object.assign(I,...g);for(A=0,e=g.length;A<e;A+=1){const I=g[A];if("object"==typeof I&&null!==I){Object.keys(I).forEach((g=>{C[g]=I[g]}))}}return I}static getBrowserAlias(I){return i[I]}static getBrowserTypeByAlias(I){return r[I]||""}}const a=/version\/(\d+(\.?_?\d+)+)/i,B=[{test:[/googlebot/i],describe(I){const g={name:"Googlebot"},C=G.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/opera/i],describe(I){const g={name:"Opera"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opr\/|opios/i],describe(I){const g={name:"Opera"},C=G.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/SamsungBrowser/i],describe(I){const g={name:"Samsung Internet for Android"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Whale/i],describe(I){const g={name:"NAVER Whale Browser"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MZBrowser/i],describe(I){const g={name:"MZ Browser"},C=G.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/focus/i],describe(I){const g={name:"Focus"},C=G.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/swing/i],describe(I){const g={name:"Swing"},C=G.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/coast/i],describe(I){const g={name:"Opera Coast"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(I){const g={name:"Opera Touch"},C=G.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/yabrowser/i],describe(I){const g={name:"Yandex Browser"},C=G.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/ucbrowser/i],describe(I){const g={name:"UC Browser"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Maxthon|mxios/i],describe(I){const g={name:"Maxthon"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/epiphany/i],describe(I){const g={name:"Epiphany"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/puffin/i],describe(I){const g={name:"Puffin"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sleipnir/i],describe(I){const g={name:"Sleipnir"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/k-meleon/i],describe(I){const g={name:"K-Meleon"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/micromessenger/i],describe(I){const g={name:"WeChat"},C=G.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/qqbrowser/i],describe(I){const g={name:/qqbrowserlite/i.test(I)?"QQ Browser Lite":"QQ Browser"},C=G.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/msie|trident/i],describe(I){const g={name:"Internet Explorer"},C=G.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/\sedg\//i],describe(I){const g={name:"Microsoft Edge"},C=G.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/edg([ea]|ios)/i],describe(I){const g={name:"Microsoft Edge"},C=G.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/vivaldi/i],describe(I){const g={name:"Vivaldi"},C=G.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/seamonkey/i],describe(I){const g={name:"SeaMonkey"},C=G.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sailfish/i],describe(I){const g={name:"Sailfish"},C=G.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,I);return C&&(g.version=C),g}},{test:[/silk/i],describe(I){const g={name:"Amazon Silk"},C=G.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/phantom/i],describe(I){const g={name:"PhantomJS"},C=G.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/slimerjs/i],describe(I){const g={name:"SlimerJS"},C=G.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g={name:"BlackBerry"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(web|hpw)[o0]s/i],describe(I){const g={name:"WebOS Browser"},C=G.getFirstMatch(a,I)||G.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/bada/i],describe(I){const g={name:"Bada"},C=G.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/tizen/i],describe(I){const g={name:"Tizen"},C=G.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/qupzilla/i],describe(I){const g={name:"QupZilla"},C=G.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/firefox|iceweasel|fxios/i],describe(I){const g={name:"Firefox"},C=G.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/electron/i],describe(I){const g={name:"Electron"},C=G.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MiuiBrowser/i],describe(I){const g={name:"Miui"},C=G.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/chromium/i],describe(I){const g={name:"Chromium"},C=G.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,I)||G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/chrome|crios|crmo/i],describe(I){const g={name:"Chrome"},C=G.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/GSA/i],describe(I){const g={name:"Google Search"},C=G.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g={name:"Android Browser"},C=G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/playstation 4/i],describe(I){const g={name:"PlayStation 4"},C=G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/safari|applewebkit/i],describe(I){const g={name:"Safari"},C=G.getFirstMatch(a,I);return C&&(g.version=C),g}},{test:[/.*/i],describe(I){const g=-1!==I.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:G.getFirstMatch(g,I),version:G.getSecondMatch(g,I)}}}];var y=[{test:[/Roku\/DVP/],describe(I){const g=G.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,I);return{name:n.Roku,version:g}}},{test:[/windows phone/i],describe(I){const g=G.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,I);return{name:n.WindowsPhone,version:g}}},{test:[/windows /i],describe(I){const g=G.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,I),C=G.getWindowsVersionName(g);return{name:n.Windows,version:g,versionName:C}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(I){const g={name:n.iOS},C=G.getSecondMatch(/(Version\/)(\d[\d.]+)/,I);return C&&(g.version=C),g}},{test:[/macintosh/i],describe(I){const g=G.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,I).replace(/[_\s]/g,"."),C=G.getMacOSVersionName(g),A={name:n.MacOS,version:g};return C&&(A.versionName=C),A}},{test:[/(ipod|iphone|ipad)/i],describe(I){const g=G.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,I).replace(/[_\s]/g,".");return{name:n.iOS,version:g}}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g=G.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,I),C=G.getAndroidVersionName(g),A={name:n.Android,version:g};return C&&(A.versionName=C),A}},{test:[/(web|hpw)[o0]s/i],describe(I){const g=G.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,I),C={name:n.WebOS};return g&&g.length&&(C.version=g),C}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g=G.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,I)||G.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,I)||G.getFirstMatch(/\bbb(\d+)/i,I);return{name:n.BlackBerry,version:g}}},{test:[/bada/i],describe(I){const g=G.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,I);return{name:n.Bada,version:g}}},{test:[/tizen/i],describe(I){const g=G.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,I);return{name:n.Tizen,version:g}}},{test:[/linux/i],describe:()=>({name:n.Linux})},{test:[/CrOS/],describe:()=>({name:n.ChromeOS})},{test:[/PlayStation 4/],describe(I){const g=G.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,I);return{name:n.PlayStation4,version:g}}}],V=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(I){const g=G.getFirstMatch(/(can-l01)/i,I)&&"Nova",C={type:o.mobile,vendor:"Huawei"};return g&&(C.model=g),C}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:o.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:o.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:o.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:o.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:o.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:o.tablet})},{test(I){const g=I.test(/ipod|iphone/i),C=I.test(/like (ipod|iphone)/i);return g&&!C},describe(I){const g=G.getFirstMatch(/(ipod|iphone)/i,I);return{type:o.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:o.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:o.mobile})},{test:I=>"blackberry"===I.getBrowserName(!0),describe:()=>({type:o.mobile,vendor:"BlackBerry"})},{test:I=>"bada"===I.getBrowserName(!0),describe:()=>({type:o.mobile})},{test:I=>"windows phone"===I.getBrowserName(),describe:()=>({type:o.mobile,vendor:"Microsoft"})},{test(I){const g=Number(String(I.getOSVersion()).split(".")[0]);return"android"===I.getOSName(!0)&&g>=3},describe:()=>({type:o.tablet})},{test:I=>"android"===I.getOSName(!0),describe:()=>({type:o.mobile})},{test:I=>"macos"===I.getOSName(!0),describe:()=>({type:o.desktop,vendor:"Apple"})},{test:I=>"windows"===I.getOSName(!0),describe:()=>({type:o.desktop})},{test:I=>"linux"===I.getOSName(!0),describe:()=>({type:o.desktop})},{test:I=>"playstation 4"===I.getOSName(!0),describe:()=>({type:o.tv})},{test:I=>"roku"===I.getOSName(!0),describe:()=>({type:o.tv})}],W=[{test:I=>"microsoft edge"===I.getBrowserName(!0),describe(I){if(/\sedg\//i.test(I))return{name:m.Blink};const g=G.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,I);return{name:m.EdgeHTML,version:g}}},{test:[/trident/i],describe(I){const g={name:m.Trident},C=G.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:I=>I.test(/presto/i),describe(I){const g={name:m.Presto},C=G.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=I.test(/gecko/i),C=I.test(/like gecko/i);return g&&!C},describe(I){const g={name:m.Gecko},C=G.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:m.Blink})},{test:[/(apple)?webkit/i],describe(I){const g={name:m.WebKit},C=G.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}}];class u{constructor(I,g=!1){if(null==I||""===I)throw new Error("UserAgent parameter can't be empty");this._ua=I,this.parsedResult={},!0!==g&&this.parse()}getUA(){return this._ua}test(I){return I.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const I=G.find(B,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.browser=I.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(I){return I?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const I=G.find(y,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.os=I.describe(this.getUA())),this.parsedResult.os}getOSName(I){const{name:g}=this.getOS();return I?String(g).toLowerCase()||"":g||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(I=!1){const{type:g}=this.getPlatform();return I?String(g).toLowerCase()||"":g||""}parsePlatform(){this.parsedResult.platform={};const I=G.find(V,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.platform=I.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(I){return I?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const I=G.find(W,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.engine=I.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return G.assign({},this.parsedResult)}satisfies(I){const g={};let C=0;const A={};let e=0;if(Object.keys(I).forEach((c=>{const l=I[c];"string"==typeof l?(A[c]=l,e+=1):"object"==typeof l&&(g[c]=l,C+=1)})),C>0){const I=Object.keys(g),C=G.find(I,(I=>this.isOS(I)));if(C){const I=this.satisfies(g[C]);if(void 0!==I)return I}const A=G.find(I,(I=>this.isPlatform(I)));if(A){const I=this.satisfies(g[A]);if(void 0!==I)return I}}if(e>0){const I=Object.keys(A),g=G.find(I,(I=>this.isBrowser(I,!0)));if(void 0!==g)return this.compareVersion(A[g])}}isBrowser(I,g=!1){const C=this.getBrowserName().toLowerCase();let A=I.toLowerCase();const e=G.getBrowserTypeByAlias(A);return g&&e&&(A=e.toLowerCase()),A===C}compareVersion(I){let g=[0],C=I,A=!1;const e=this.getBrowserVersion();if("string"==typeof e)return">"===I[0]||"<"===I[0]?(C=I.substr(1),"="===I[1]?(A=!0,C=I.substr(2)):g=[],">"===I[0]?g.push(1):g.push(-1)):"="===I[0]?C=I.substr(1):"~"===I[0]&&(A=!0,C=I.substr(1)),g.indexOf(G.compareVersions(e,C,A))>-1}isOS(I){return this.getOSName(!0)===String(I).toLowerCase()}isPlatform(I){return this.getPlatformType(!0)===String(I).toLowerCase()}isEngine(I){return this.getEngineName(!0)===String(I).toLowerCase()}is(I,g=!1){return this.isBrowser(I,g)||this.isOS(I)||this.isPlatform(I)}some(I=[]){return I.some((I=>this.is(I)))}}
/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class R{static getParser(I,g=!1){if("string"!=typeof I)throw new Error("UserAgent should be a string");return new u(I,g)}static parse(I){return new u(I).getResult()}static get BROWSER_MAP(){return r}static get ENGINE_MAP(){return m}static get OS_MAP(){return n}static get PLATFORMS_MAP(){return o}}var X={exports:{}},h={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(h);var H=h.exports;!function(I){var g=H.default;function C(){I.exports=C=function(){return e},I.exports.__esModule=!0,I.exports.default=I.exports;var A,e={},c=Object.prototype,l=c.hasOwnProperty,t=Object.defineProperty||function(I,g,C){I[g]=C.value},s="function"==typeof Symbol?Symbol:{},Z=s.iterator||"@@iterator",d=s.asyncIterator||"@@asyncIterator",b=s.toStringTag||"@@toStringTag";function i(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{i({},"")}catch(A){i=function(I,g,C){return I[g]=C}}function r(I,g,C,A){var e=g&&g.prototype instanceof y?g:y,c=Object.create(e.prototype),l=new Y(A||[]);return t(c,"_invoke",{value:p(I,C,l)}),c}function o(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}e.wrap=r;var n="suspendedStart",m="suspendedYield",G="executing",a="completed",B={};function y(){}function V(){}function W(){}var u={};i(u,Z,(function(){return this}));var R=Object.getPrototypeOf,X=R&&R(R(w([])));X&&X!==c&&l.call(X,Z)&&(u=X);var h=W.prototype=y.prototype=Object.create(u);function H(I){["next","throw","return"].forEach((function(g){i(I,g,(function(I){return this._invoke(g,I)}))}))}function k(I,C){function A(e,c,t,s){var Z=o(I[e],I,c);if("throw"!==Z.type){var d=Z.arg,b=d.value;return b&&"object"==g(b)&&l.call(b,"__await")?C.resolve(b.__await).then((function(I){A("next",I,t,s)}),(function(I){A("throw",I,t,s)})):C.resolve(b).then((function(I){d.value=I,t(d)}),(function(I){return A("throw",I,t,s)}))}s(Z.arg)}var e;t(this,"_invoke",{value:function(I,g){function c(){return new C((function(C,e){A(I,g,C,e)}))}return e=e?e.then(c,c):c()}})}function p(I,g,C){var e=n;return function(c,l){if(e===G)throw new Error("Generator is already running");if(e===a){if("throw"===c)throw l;return{value:A,done:!0}}for(C.method=c,C.arg=l;;){var t=C.delegate;if(t){var s=J(t,C);if(s){if(s===B)continue;return s}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(e===n)throw e=a,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);e=G;var Z=o(I,g,C);if("normal"===Z.type){if(e=C.done?a:m,Z.arg===B)continue;return{value:Z.arg,done:C.done}}"throw"===Z.type&&(e=a,C.method="throw",C.arg=Z.arg)}}}function J(I,g){var C=g.method,e=I.iterator[C];if(e===A)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=A,J(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var c=o(e,I.iterator,g.arg);if("throw"===c.type)return g.method="throw",g.arg=c.arg,g.delegate=null,B;var l=c.arg;return l?l.done?(g[I.resultName]=l.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=A),g.delegate=null,B):l:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function F(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function S(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function Y(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(F,this),this.reset(!0)}function w(I){if(I||""===I){var C=I[Z];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var e=-1,c=function g(){for(;++e<I.length;)if(l.call(I,e))return g.value=I[e],g.done=!1,g;return g.value=A,g.done=!0,g};return c.next=c}}throw new TypeError(g(I)+" is not iterable")}return V.prototype=W,t(h,"constructor",{value:W,configurable:!0}),t(W,"constructor",{value:V,configurable:!0}),V.displayName=i(W,b,"GeneratorFunction"),e.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===V||"GeneratorFunction"===(g.displayName||g.name))},e.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,W):(I.__proto__=W,i(I,b,"GeneratorFunction")),I.prototype=Object.create(h),I},e.awrap=function(I){return{__await:I}},H(k.prototype),i(k.prototype,d,(function(){return this})),e.AsyncIterator=k,e.async=function(I,g,C,A,c){void 0===c&&(c=Promise);var l=new k(r(I,g,C,A),c);return e.isGeneratorFunction(g)?l:l.next().then((function(I){return I.done?I.value:l.next()}))},H(h),i(h,b,"Generator"),i(h,Z,(function(){return this})),i(h,"toString",(function(){return"[object Generator]"})),e.keys=function(I){var g=Object(I),C=[];for(var A in g)C.push(A);return C.reverse(),function I(){for(;C.length;){var A=C.pop();if(A in g)return I.value=A,I.done=!1,I}return I.done=!0,I}},e.values=w,Y.prototype={constructor:Y,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=A,this.done=!1,this.delegate=null,this.method="next",this.arg=A,this.tryEntries.forEach(S),!I)for(var g in this)"t"===g.charAt(0)&&l.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=A)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,e){return t.type="throw",t.arg=I,g.next=C,e&&(g.method="next",g.arg=A),!!e}for(var e=this.tryEntries.length-1;e>=0;--e){var c=this.tryEntries[e],t=c.completion;if("root"===c.tryLoc)return C("end");if(c.tryLoc<=this.prev){var s=l.call(c,"catchLoc"),Z=l.call(c,"finallyLoc");if(s&&Z){if(this.prev<c.catchLoc)return C(c.catchLoc,!0);if(this.prev<c.finallyLoc)return C(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return C(c.catchLoc,!0)}else{if(!Z)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return C(c.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var A=this.tryEntries[C];if(A.tryLoc<=this.prev&&l.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var e=A;break}}e&&("break"===I||"continue"===I)&&e.tryLoc<=g&&g<=e.finallyLoc&&(e=null);var c=e?e.completion:{};return c.type=I,c.arg=g,e?(this.method="next",this.next=e.finallyLoc,B):this.complete(c)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),S(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var A=C.completion;if("throw"===A.type){var e=A.arg;S(C)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:w(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=A),B}},e}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(X);var k=(0,X.exports)();try{regeneratorRuntime=k}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=k:Function("r","regeneratorRuntime = r")(k)}function p(I){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},p(I)}function J(I){var g=function(I,g){if("object"!==p(I)||null===I)return I;var C=I[Symbol.toPrimitive];if(void 0!==C){var A=C.call(I,g||"default");if("object"!==p(A))return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(I)}(I,"string");return"symbol"===p(g)?g:String(g)}function F(I,g){for(var C=0;C<g.length;C++){var A=g[C];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(I,J(A.key),A)}}function S(I){return I<0?I>>>0:I}function Y(I,g,C){var A=void 0===g?null:g,e=function(I,g){var C=atob(I);if(g){for(var A=new Uint8Array(C.length),e=0,c=C.length;e<c;++e)A[e]=C.charCodeAt(e);return String.fromCharCode.apply(null,new Uint16Array(A.buffer))}return C}(I,void 0!==C&&C),c=e.indexOf("\n",10)+1,l=e.substring(c)+(A?"//# sourceMappingURL="+A:""),t=new Blob([l],{type:"application/javascript"});return URL.createObjectURL(t)}(function(){function I(){!function(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}(this,I),this._path=""}var g,C,A;return g=I,A=[{key:"getPtr",value:function(g){if(I._filePtrs.has(g))return I._filePtrs.get(g);throw new Error("File instance not found.")}},{key:"setPtr",value:function(g,C){I._filePtrs.set(g,C)}},{key:"removePtr",value:function(g){I._filePtrs.delete(g)}}],(C=[{key:"meta",get:function(){if(void 0!==this._meta)return Object.assign({version:0},this._meta)}}])&&F(g.prototype,C),A&&F(g,A),Object.defineProperty(g,"prototype",{writable:!1}),I}())._filePtrs=new Map;var w,K,v,f,N,U=(w="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX3R5cGVvZiQzKG8pIHsKICAgICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7CgogICAgcmV0dXJuIF90eXBlb2YkMyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvOwogICAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgICB9LCBfdHlwZW9mJDMobyk7CiAgfQoKICBmdW5jdGlvbiB0b1ByaW1pdGl2ZSh0LCByKSB7CiAgICBpZiAoIm9iamVjdCIgIT0gX3R5cGVvZiQzKHQpIHx8ICF0KSByZXR1cm4gdDsKICAgIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdOwogICAgaWYgKHZvaWQgMCAhPT0gZSkgewogICAgICB2YXIgaSA9IGUuY2FsbCh0LCByIHx8ICJkZWZhdWx0Iik7CiAgICAgIGlmICgib2JqZWN0IiAhPSBfdHlwZW9mJDMoaSkpIHJldHVybiBpOwogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOwogICAgfQogICAgcmV0dXJuICgic3RyaW5nIiA9PT0gciA/IFN0cmluZyA6IE51bWJlcikodCk7CiAgfQoKICBmdW5jdGlvbiB0b1Byb3BlcnR5S2V5KHQpIHsKICAgIHZhciBpID0gdG9QcmltaXRpdmUodCwgInN0cmluZyIpOwogICAgcmV0dXJuICJzeW1ib2wiID09IF90eXBlb2YkMyhpKSA/IGkgOiBTdHJpbmcoaSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgICBrZXkgPSB0b1Byb3BlcnR5S2V5KGtleSk7CiAgICBpZiAoa2V5IGluIG9iaikgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CgogIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgIHRyeSB7CiAgICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHJlamVjdChlcnJvcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CiAgICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgICB9CiAgICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgICAgfSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMSAoeCkgewogIAlyZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdkZWZhdWx0JykgPyB4WydkZWZhdWx0J10gOiB4OwogIH0KCiAgdmFyIHJlZ2VuZXJhdG9yUnVudGltZSQyID0ge2V4cG9ydHM6IHt9fTsKCiAgdmFyIF90eXBlb2YkMiA9IHtleHBvcnRzOiB7fX07CgogIF90eXBlb2YkMi5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKICAJICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwoKICAJICByZXR1cm4gKG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiB0eXBlb2YgbzsKICAJICB9IDogZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgCSAgfSwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cyksIF90eXBlb2Yobyk7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChfdHlwZW9mJDIpKTsKCiAgdmFyIF90eXBlb2ZFeHBvcnRzJDEgPSBfdHlwZW9mJDIuZXhwb3J0czsKCiAgcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJdmFyIF90eXBlb2YgPSBfdHlwZW9mRXhwb3J0cyQxWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMikpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyQxID0gcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgLy8gVE9ETyhCYWJlbCA4KTogUmVtb3ZlIHRoaXMgZmlsZS4KCiAgdmFyIHJ1bnRpbWUkMSA9IHJlZ2VuZXJhdG9yUnVudGltZUV4cG9ydHMkMSgpOwogIHZhciByZWdlbmVyYXRvciQxID0gcnVudGltZSQxOwoKICAvLyBDb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL3BhY2thZ2VzL3J1bnRpbWUvcnVudGltZS5qcyNMNzM2PQogIHRyeSB7CiAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgICB9IGVsc2UgewogICAgICBGdW5jdGlvbigiciIsICJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikocnVudGltZSQxKTsKICAgIH0KICB9CgogIHZhciBfcmVnZW5lcmF0b3JSdW50aW1lJDEgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMShyZWdlbmVyYXRvciQxKTsKCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMgKHgpIHsKICAJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKICB9CgogIHZhciByZWdlbmVyYXRvclJ1bnRpbWUkMSA9IHtleHBvcnRzOiB7fX07CgogIHZhciBfdHlwZW9mJDEgPSB7ZXhwb3J0czoge319OwoKICBfdHlwZW9mJDEuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJZnVuY3Rpb24gX3R5cGVvZihvKSB7CiAgCSAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKCiAgCSAgcmV0dXJuIChtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gdHlwZW9mIG87CiAgCSAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gbyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMpLCBfdHlwZW9mKG8pOwogIAl9CiAgCW1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0czsgCiAgfSAoX3R5cGVvZiQxKSk7CgogIHZhciBfdHlwZW9mRXhwb3J0cyA9IF90eXBlb2YkMS5leHBvcnRzOwoKICByZWdlbmVyYXRvclJ1bnRpbWUkMS5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAl2YXIgX3R5cGVvZiA9IF90eXBlb2ZFeHBvcnRzWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMSkpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyA9IHJlZ2VuZXJhdG9yUnVudGltZSQxLmV4cG9ydHM7CgogIC8vIFRPRE8oQmFiZWwgOCk6IFJlbW92ZSB0aGlzIGZpbGUuCgogIHZhciBydW50aW1lID0gcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cygpOwogIHZhciByZWdlbmVyYXRvciA9IHJ1bnRpbWU7CgogIC8vIENvcGllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vcGFja2FnZXMvcnVudGltZS9ydW50aW1lLmpzI0w3MzY9CiAgdHJ5IHsKICAgIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWU7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lOwogICAgfSBlbHNlIHsKICAgICAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUpOwogICAgfQogIH0KCiAgdmFyIF9yZWdlbmVyYXRvclJ1bnRpbWUgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMocmVnZW5lcmF0b3IpOwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQ0KICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuDQoNCiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZDQogIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwNCiAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SDQogIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1INCiAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCg0KICBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0NCiAgICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgICB9KTsNCiAgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2skMShpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX3R5cGVvZihvKSB7CiAgICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwoKICAgIHJldHVybiBfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAobykgewogICAgICByZXR1cm4gdHlwZW9mIG87CiAgICB9IDogZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIG8gJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2YgbzsKICAgIH0sIF90eXBlb2Yobyk7CiAgfQoKICBmdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHsKICAgIGlmIChfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsKICAgIHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsKICAgIGlmIChwcmltICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpOwogICAgICBpZiAoX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTsKICAgIH0KICAgIHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsKICB9CgogIGZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgewogICAgdmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTsKICAgIHJldHVybiBfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyQxKHRhcmdldCwgcHJvcHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MkMShDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyQxKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzJDEoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CgogIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgICAgby5fX3Byb3RvX18gPSBwOwogICAgICByZXR1cm4gbzsKICAgIH07CiAgICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwogIH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogICAgfQogICAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwogIH0KCiAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgICB9CiAgICByZXR1cm4gc2VsZjsKICB9CgogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICAgIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgcmV0dXJuIGNhbGw7CiAgICB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOwogICAgfQogICAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7CiAgfQoKICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CgogIC8qDQogICAgQ29weXJpZ2h0IDIwMjItMjAyMyBQaWNvdm9pY2UgSW5jLg0KCiAgICBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIGxpY2Vuc2UuIEEgY29weSBvZiB0aGUgbGljZW5zZSBpcyBsb2NhdGVkIGluIHRoZSAiTElDRU5TRSINCiAgICBmaWxlIGFjY29tcGFueWluZyB0aGlzIHNvdXJjZS4NCgogICAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbg0KICAgIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQ0KICAgIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogICovCiAgLyoqDQogICAqIEJhc2VQdkZpbGUgQ2xhc3MNCiAgICogVGhpcyBjbGFzcyBtb2NrcyB0aGUgZmlsZSBzeXN0ZW0gdXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UuDQogICAqLwogIHZhciBQdkZpbGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUHZGaWxlKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2skMSh0aGlzLCBQdkZpbGUpOwogICAgICB0aGlzLl9wYXRoID0gJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiBHZXR0ZXIgZm9yIGZpbGUncyBtZXRhIGluZm9ybWF0aW9uLg0KICAgICAqLwogICAgX2NyZWF0ZUNsYXNzJDEoUHZGaWxlLCBbewogICAgICBrZXk6ICJtZXRhIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMuX21ldGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgdmVyc2lvbjogMAogICAgICAgIH0sIHRoaXMuX21ldGEpOwogICAgICB9CiAgICAgIC8qKg0KICAgICAgICogR2V0IHRoZSBmaWxlIHBvaW50ZXIgZnJvbSB0aGUgX2ZpbGVQdHJzIG1hcC4NCiAgICAgICAqIEBwYXJhbSBwdHIgVGhlIHBvaW50ZXIgdG8gQmFzZVB2RmlsZSBpbnN0YW5jZSB0byBnZXQgZnJvbSB0aGUgbWFwLg0KICAgICAgICogQHJldHVybnMgQmFzZVB2RmlsZSByZXR1cm5zIHRoZSBjdXJyZW50IGZpbGUgaW5zdGFuY2UgcmVsYXRlZCB0byBwdHIuDQogICAgICAgKi8KICAgIH1dLCBbewogICAgICBrZXk6ICJnZXRQdHIiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UHRyKHB0cikgewogICAgICAgIGlmIChQdkZpbGUuX2ZpbGVQdHJzLmhhcyhwdHIpKSB7CiAgICAgICAgICByZXR1cm4gUHZGaWxlLl9maWxlUHRycy5nZXQocHRyKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIGluc3RhbmNlIG5vdCBmb3VuZC4nKTsKICAgICAgfQogICAgICAvKioNCiAgICAgICAqIFNhdmVzIHRoZSBCYXNlUHZGaWxlIGluc3RhbmNlIHRvIHRoZSBtYXAgd2l0aCBhbiBhc3NvY2lhdGVkIHB0ci4NCiAgICAgICAqIEBwYXJhbSBwdHIgVGhlIGZpbGUgcG9pbnRlciB0byBzYXZlIGFzIHRoZSBrZXkuDQogICAgICAgKiBAcGFyYW0gaW5zdGFuY2UgVGhlIEJhc2VQdkZpbGUgaW5zdGFuY2UgdG8gc2F2ZSBhcyB0aGUgdmFsdWUuDQogICAgICAgKi8KICAgIH0sIHsKICAgICAga2V5OiAic2V0UHRyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFB0cihwdHIsIGluc3RhbmNlKSB7CiAgICAgICAgUHZGaWxlLl9maWxlUHRycy5zZXQocHRyLCBpbnN0YW5jZSk7CiAgICAgIH0KICAgICAgLyoqDQogICAgICAgKiBSZW1vdmVzIHRoZSBwdHIgZnJvbSB0aGUgX2ZpbGVQdHJzIG1hcC4NCiAgICAgICAqIEBwYXJhbSBwdHIgVGhlIGZpbGUgcG9pbnRlciB0byByZW1vdmUuDQogICAgICAgKi8KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlUHRyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVB0cihwdHIpIHsKICAgICAgICBQdkZpbGUuX2ZpbGVQdHJzWyJkZWxldGUiXShwdHIpOwogICAgICB9CiAgICB9XSk7CiAgICByZXR1cm4gUHZGaWxlOwogIH0oKTsKICBQdkZpbGUuX2ZpbGVQdHJzID0gbmV3IE1hcCgpOwoKICBmdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkgeyB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgeyB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsgdmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjsgcmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTsgfSBlbHNlIHsgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgcmVzdWx0KTsgfTsgfQogIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7IHJldHVybiB0cnVlOyB9IGNhdGNoIChlKSB7IHJldHVybiBmYWxzZTsgfSB9CiAgLyoqDQogICAqIFB2RmlsZU1lbSBDbGFzcw0KICAgKiBUaGlzIGNsYXNzIG1vY2tzIHRoZSBmaWxlIHN5c3RlbSB1c2luZyBpbi1tZW1vcnkgc3RvcmFnZS4NCiAgICovCiAgdmFyIFB2RmlsZU1lbSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1B2RmlsZSkgewogICAgX2luaGVyaXRzKFB2RmlsZU1lbSwgX1B2RmlsZSk7CiAgICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKFB2RmlsZU1lbSk7CiAgICBmdW5jdGlvbiBQdkZpbGVNZW0ocGF0aCwgbWV0YSwgZGIsIG1vZGUpIHsKICAgICAgdmFyIF90aGlzOwogICAgICBfY2xhc3NDYWxsQ2hlY2skMSh0aGlzLCBQdkZpbGVNZW0pOwogICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpOwogICAgICBfdGhpcy5fcG9zID0gMDsKICAgICAgX3RoaXMuX3BhdGggPSBwYXRoOwogICAgICBfdGhpcy5fbWV0YSA9IG1ldGE7CiAgICAgIF90aGlzLl9tb2RlID0gbW9kZTsKICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgX2NyZWF0ZUNsYXNzJDEoUHZGaWxlTWVtLCBbewogICAgICBrZXk6ICJjbG9zZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVhZCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZWFkKHNpemUsIGNvdW50KSB7CiAgICAgICAgaWYgKCF0aGlzLmV4aXN0cygpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiciLmNvbmNhdCh0aGlzLl9wYXRoLCAiJyBkb2Vzbid0IGV4aXN0LiIpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX2lzRU9GKSB7CiAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCJFT0YiKTsKICAgICAgICAgIGVyci5uYW1lID0gIkVuZE9mRmlsZSI7CiAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgfQogICAgICAgIHZhciB0b0NvcHkgPSBNYXRoLm1pbihzaXplICogY291bnQsIHRoaXMuX2ZpbGUubGVuZ3RoIC0gdGhpcy5fcG9zKTsKICAgICAgICB2YXIgdG90YWxFbGVtcyA9IHRvQ29weSAtIHRvQ29weSAlIHNpemU7CiAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KHRvdGFsRWxlbXMpOwogICAgICAgIGJ1ZmZlci5zZXQodGhpcy5fZmlsZS5zbGljZSh0aGlzLl9wb3MsIHRoaXMuX3BvcyArIHRvdGFsRWxlbXMpLCAwKTsKICAgICAgICB0aGlzLl9wb3MgKz0gdG90YWxFbGVtczsKICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIndyaXRlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHdyaXRlKGNvbnRlbnQpIHsKICAgICAgICB2YXIgbmV3RmlsZSA9IG5ldyBVaW50OEFycmF5KHRoaXMuX3BvcyArIGNvbnRlbnQubGVuZ3RoKTsKICAgICAgICBpZiAodGhpcy5fZmlsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBuZXdGaWxlLnNldCh0aGlzLl9maWxlLnNsaWNlKDAsIHRoaXMuX3BvcykpOwogICAgICAgICAgbmV3RmlsZS5zZXQoY29udGVudCwgdGhpcy5fcG9zKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3RmlsZS5zZXQoY29udGVudCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2ZpbGUgPSBuZXdGaWxlOwogICAgICAgIHRoaXMuX3BvcyArPSBjb250ZW50Lmxlbmd0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJzZWVrIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlZWsob2Zmc2V0LCB3aGVuY2UpIHsKICAgICAgICBpZiAoIXRoaXMuZXhpc3RzKCkgJiYgdGhpcy5fbW9kZSA9PT0gInJlYWRvbmx5IikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCInIi5jb25jYXQodGhpcy5fcGF0aCwgIicgZG9lc24ndCBleGlzdC4iKSk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5leGlzdHMoKSkgewogICAgICAgICAgLy8gVGhpcyBpcyB2YWxpZCBpbiBJU08gQyBidXQgbm90IHN1cHBvcnRlZCBieSB0aGlzIGN1cnJlbnQgaW1wbGVtZW50YXRpb24KICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiJyIuY29uY2F0KHRoaXMuX3BhdGgsICInIGRvZXNuJ3QgZXhpc3QuIikpOwogICAgICAgIH0KICAgICAgICBpZiAob2Zmc2V0IDwgMCkgewogICAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcigiRU9GIik7CiAgICAgICAgICBlcnIubmFtZSA9ICJFbmRPZkZpbGUiOwogICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIH0KICAgICAgICB2YXIgbmV3T2Zmc2V0OwogICAgICAgIGlmICh3aGVuY2UgPT09IDApIHsKICAgICAgICAgIG5ld09mZnNldCA9IE1hdGgubWluKG9mZnNldCwgdGhpcy5fZmlsZS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAod2hlbmNlID09PSAxKSB7CiAgICAgICAgICBuZXdPZmZzZXQgPSBNYXRoLm1pbih0aGlzLl9wb3MgKyBvZmZzZXQsIHRoaXMuX2ZpbGUubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKHdoZW5jZSA9PT0gMikgewogICAgICAgICAgbmV3T2Zmc2V0ID0gTWF0aC5taW4odGhpcy5fZmlsZS5sZW5ndGggKyBvZmZzZXQsIHRoaXMuX2ZpbGUubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG9wZXJhdGlvbjogIi5jb25jYXQod2hlbmNlLCAiLiIpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcG9zID0gbmV3T2Zmc2V0OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInRlbGwiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdGVsbCgpIHsKICAgICAgICBpZiAoIXRoaXMuZXhpc3RzKCkpIHsKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX3BvczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkVOT0VOVCIpOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIFB2RmlsZU1lbS5fbWVtRmlsZXNbImRlbGV0ZSJdKHRoaXMuX3BhdGgpOwogICAgICAgICAgICAgICAgdGhpcy5fcG9zID0gMDsKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgIH0pKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJleGlzdHMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZXhpc3RzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9maWxlICE9PSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2lzRU9GIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BvcyA+PSB0aGlzLl9maWxlLmxlbmd0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfZmlsZSIsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBQdkZpbGVNZW0uX21lbUZpbGVzLmdldCh0aGlzLl9wYXRoKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoY29udGVudCkgewogICAgICAgIFB2RmlsZU1lbS5fbWVtRmlsZXMuc2V0KHRoaXMuX3BhdGgsIGNvbnRlbnQpOwogICAgICB9CiAgICB9XSwgW3sKICAgICAga2V5OiAib3BlbiIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuKHBhdGgsIG1vZGUpIHsKICAgICAgICB2YXIgZmlsZSA9IFB2RmlsZU1lbS5fbWVtRmlsZXMuZ2V0KHBhdGgpOwogICAgICAgIHZhciBkYk1vZGUgPSBtb2RlLmluY2x1ZGVzKCdyJykgPyAicmVhZG9ubHkiIDogInJlYWR3cml0ZSI7CiAgICAgICAgaWYgKGZpbGUgPT09IHVuZGVmaW5lZCAmJiBkYk1vZGUgPT09ICJyZWFkb25seSIpIHsKICAgICAgICAgIHZhciBlcnJvciA9IG5ldyBFcnJvcigiJyIuY29uY2F0KHBhdGgsICInIGRvZXNuJ3QgZXhpc3QuIikpOwogICAgICAgICAgZXJyb3IubmFtZSA9ICJGaWxlTm90RXhpc3RzIjsKICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0KICAgICAgICB2YXIgZmlsZU1lbSA9IG5ldyBQdkZpbGVNZW0ocGF0aCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRiTW9kZSk7CiAgICAgICAgaWYgKG1vZGUuaW5jbHVkZXMoJ2EnKSkgewogICAgICAgICAgZmlsZU1lbS5zZWVrKDAsIDIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmlsZU1lbTsKICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIFB2RmlsZU1lbTsKICB9KFB2RmlsZSk7CiAgUHZGaWxlTWVtLl9tZW1GaWxlcyA9IG5ldyBNYXAoKTsKICAvKioNCiAgICogQ2FzdCBhIHNpZ25lZCBhZGRyZXNzIHRvIHVuc2lnbmVkIGFkZHJlc3MuDQogICAqDQogICAqIEBwYXJhbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIGNhc3QgdG8gdW5zaWduZWQgYWRkcmVzcy4NCiAgICovCiAgZnVuY3Rpb24gdW5zaWduZWRBZGRyZXNzKGFkZHJlc3MpIHsKICAgIGlmIChhZGRyZXNzIDwgMCkgewogICAgICByZXR1cm4gYWRkcmVzcyA+Pj4gMDsKICAgIH0KICAgIHJldHVybiBhZGRyZXNzOwogIH0KCiAgdmFyIFB2WHB1QWN0aW9uOwogIChmdW5jdGlvbiAoUHZYcHVBY3Rpb24pIHsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJJTklUIl0gPSAwXSA9ICJJTklUIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJBTExPQyJdID0gMV0gPSAiQUxMT0MiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIkZSRUUiXSA9IDJdID0gIkZSRUUiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIkNPUFlfVE9fWFBVIl0gPSAzXSA9ICJDT1BZX1RPX1hQVSI7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiQ09QWV9GUk9NX1hQVSJdID0gNF0gPSAiQ09QWV9GUk9NX1hQVSI7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiTUVNU0VUIl0gPSA1XSA9ICJNRU1TRVQiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIlRJTUVSX1NUQVJUIl0gPSA2XSA9ICJUSU1FUl9TVEFSVCI7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiVElNRVJfU1RPUCJdID0gN10gPSAiVElNRVJfU1RPUCI7CiAgICAvLyBvdGhlciB4cHUgYWN0aW9ucwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIk1BVFJJWF9WRUNUT1JfTVVMVElQTFkiXSA9IDhdID0gIk1BVFJJWF9WRUNUT1JfTVVMVElQTFkiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIlNZTkNfVkVDVE9SIl0gPSA5XSA9ICJTWU5DX1ZFQ1RPUiI7CiAgfSkoUHZYcHVBY3Rpb24gfHwgKFB2WHB1QWN0aW9uID0ge30pKTsKCiAgY29uc3Qgd2FzaV9zbmFwc2hvdF9wcmV2aWV3MV9lbXVsYXRvciA9IHsKICAgIGFyZ3NfZ2V0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgYXJnc19zaXplc19nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBlbnZpcm9uX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGVudmlyb25fc2l6ZXNfZ2V0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgY2xvY2tfcmVzX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGNsb2NrX3RpbWVfZ2V0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfYWR2aXNlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfYWxsb2NhdGU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9jbG9zZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2RhdGFzeW5jOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfZmRzdGF0X2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2Zkc3RhdF9zZXRfZmxhZ3M6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9mZHN0YXRfc2V0X3JpZ2h0czogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2ZpbGVzdGF0X2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2ZpbGVzdGF0X3NldF9zaXplOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfZmlsZXN0YXRfc2V0X3RpbWVzOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcHJlYWQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9wcmVzdGF0X2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3ByZXN0YXRfZGlyX25hbWU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9wd3JpdGU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9yZWFkOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcmVhZGRpcjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3JlbnVtYmVyOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfc2VlazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3N5bmM6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF90ZWxsOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfd3JpdGU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX2NyZWF0ZV9kaXJlY3Rvcnk6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX2ZpbGVzdGF0X2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9saW5rOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9vcGVuOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9yZWFkbGluazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfcmVtb3ZlX2RpcmVjdG9yeTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfcmVuYW1lOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9zeW1saW5rOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF91bmxpbmtfZmlsZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBvbGxfb25lb2ZmOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcHJvY19leGl0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcHJvY19yYWlzZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHNjaGVkX3lpZWxkOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcmFuZG9tX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHNvY2tfcmVjdjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHNvY2tfc2VuZDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHNvY2tfc2h1dGRvd246IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgfTsKCiAgdmFyIG1hdHJpeFZlY3Rvck11bHRpcGx5ID0gZnVuY3Rpb24gbWF0cml4VmVjdG9yTXVsdGlwbHkoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMubWVtQWxsb2MsCiAgICAgICAgbWVtb3J5ID0gX2RhdGEkZ2xvYmFscy5tZW1vcnk7CiAgICAgIHZhciBtYXRyaXhBZGRyZXNzID0gZGF0YS5tYXRyaXhBZGRyZXNzLAogICAgICAgIHZlY3RvckFkZHJlc3MgPSBkYXRhLnZlY3RvckFkZHJlc3MsCiAgICAgICAgbSA9IGRhdGEubSwKICAgICAgICBuID0gZGF0YS5uLAogICAgICAgIHJlc3VsdEFkZHJlc3MgPSBkYXRhLnJlc3VsdEFkZHJlc3M7CiAgICAgIHZhciBwdl9tYXRyaXhfdmVjdG9yX211bHRpcGx5ID0gZXhwb3J0cy5wdl9tYXRyaXhfdmVjdG9yX211bHRpcGx5OwogICAgICBpZiAoIW1lbUFsbG9jLmhhcyhtYXRyaXhBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKHZlY3RvckFkZHJlc3MpIHx8ICFtZW1BbGxvYy5oYXMocmVzdWx0QWRkcmVzcykpIHsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGNvbW1hbmQ6ICdvaycsCiAgICAgICAgICByZXN1bHQ6IG5ldyBGbG9hdDMyQXJyYXkoMCkKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIG1lbW9yeUJ1ZmZlckZsb2F0MzIgPSBuZXcgRmxvYXQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICB2YXIgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChtYXRyaXhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJNYXRyaXhBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQodmVjdG9yQWRkcmVzcyksCiAgICAgICAgd29ya2VyVmVjdG9yQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldChyZXN1bHRBZGRyZXNzKSwKICAgICAgICB3b3JrZXJSZXN1bHRBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfbWF0cml4X3ZlY3Rvcl9tdWx0aXBseSh3b3JrZXJNYXRyaXhBZGRyZXNzLCB3b3JrZXJWZWN0b3JBZGRyZXNzLCBtLCBuLCB3b3JrZXJSZXN1bHRBZGRyZXNzKTsKICAgICAgdmFyIHJlc3VsdCA9IG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2xpY2Uod29ya2VyUmVzdWx0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgd29ya2VyUmVzdWx0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCArIG0pOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snLAogICAgICAgIHJlc3VsdDogcmVzdWx0CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBzeW5jVmVjdG9yID0gZnVuY3Rpb24gc3luY1ZlY3RvcihkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczIgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMi5tZW1BbGxvYywKICAgICAgICBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzMi5tZW1vcnk7CiAgICAgIHZhciB2ZWN0b3JBZGRyZXNzID0gZGF0YS52ZWN0b3JBZGRyZXNzLAogICAgICAgIGJ1ZmZlciA9IGRhdGEuYnVmZmVyOwogICAgICBpZiAobWVtQWxsb2MuaGFzKHZlY3RvckFkZHJlc3MpKSB7CiAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckZsb2F0MzIgPSBuZXcgRmxvYXQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldCh2ZWN0b3JBZGRyZXNzKSwKICAgICAgICAgIHdvcmtlck1lbUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NC53b3JrZXJNZW1BZGRyZXNzOwogICAgICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KGJ1ZmZlciwgd29ya2VyTWVtQWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIH0KICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgcHZNdm1BY3Rpb25NYXAgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KHt9LCBQdlhwdUFjdGlvbi5NQVRSSVhfVkVDVE9SX01VTFRJUExZLCBtYXRyaXhWZWN0b3JNdWx0aXBseSksIFB2WHB1QWN0aW9uLlNZTkNfVkVDVE9SLCBzeW5jVmVjdG9yKTsKCiAgLyogZXNsaW50IGNhbWVsY2FzZTogMCAqLwogIHZhciBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb247CiAgKGZ1bmN0aW9uIChQdlBpY29sbG1BdHRlbnRpb25BY3Rpb24pIHsKICAgIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbltQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bIkFUVEVOVElPTl9QUkVDT01QVVRFX0VOQ09ESU5HIl0gPSAyMDBdID0gIkFUVEVOVElPTl9QUkVDT01QVVRFX0VOQ09ESU5HIjsKICAgIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbltQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bIkFUVEVOVElPTl9FTkNPREUiXSA9IDIwMV0gPSAiQVRURU5USU9OX0VOQ09ERSI7CiAgICBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uWyJBVFRFTlRJT05fQVRURU5EIl0gPSAyMDJdID0gIkFUVEVOVElPTl9BVFRFTkQiOwogICAgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uW1B2UGljb2xsbUF0dGVudGlvbkFjdGlvblsiQVRURU5USU9OX1VQREFURV9LRVlTIl0gPSAyMDNdID0gIkFUVEVOVElPTl9VUERBVEVfS0VZUyI7CiAgICBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uWyJBVFRFTlRJT05fVVBEQVRFX1ZBTFVFUyJdID0gMjA0XSA9ICJBVFRFTlRJT05fVVBEQVRFX1ZBTFVFUyI7CiAgICBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb25bUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uWyJBVFRFTlRJT05fVFJBTlNQT1NFX1FVRVJZIl0gPSAyMDVdID0gIkFUVEVOVElPTl9UUkFOU1BPU0VfUVVFUlkiOwogIH0pKFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbiB8fCAoUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uID0ge30pKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CgogIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7IHZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07IGlmICghaXQpIHsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsgaWYgKGl0KSBvID0gaXQ7IHZhciBpID0gMDsgdmFyIEYgPSBmdW5jdGlvbiBGKCkge307IHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsgdGhyb3cgX2U7IH0sIGY6IEYgfTsgfSB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0gdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOyByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgeyBpdCA9IGl0LmNhbGwobyk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7IH0gfSB9OyB9CiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldOyByZXR1cm4gYXJyMjsgfQogIHZhciBQdlhwdSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBQdlhwdSgpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFB2WHB1KTsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyhQdlhwdSwgbnVsbCwgW3sKICAgICAga2V5OiAiYWRkWHB1IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFhwdShvYmpBZGRyZXNzLCBkYXRhKSB7CiAgICAgICAgUHZYcHUueHB1T2JqZWN0cy5zZXQob2JqQWRkcmVzcywgZGF0YSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0WHB1IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFhwdShvYmpBZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIFB2WHB1LnhwdU9iamVjdHMuZ2V0KG9iakFkZHJlc3MpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImhhc1hwdSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNYcHUob2JqQWRkcmVzcykgewogICAgICAgIHJldHVybiBQdlhwdS54cHVPYmplY3RzLmhhcyhvYmpBZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmVYcHUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlWHB1KG9iakFkZHJlc3MpIHsKICAgICAgICBpZiAoUHZYcHUueHB1T2JqZWN0cy5oYXMob2JqQWRkcmVzcykpIHsKICAgICAgICAgIHZhciBfUHZYcHUkeHB1T2JqZWN0cyRnZXQgPSBQdlhwdS54cHVPYmplY3RzLmdldChvYmpBZGRyZXNzKSwKICAgICAgICAgICAgZGV2aWNlTWVtID0gX1B2WHB1JHhwdU9iamVjdHMkZ2V0LmRldmljZU1lbTsKICAgICAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihkZXZpY2VNZW0pLAogICAgICAgICAgICBfc3RlcDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIG1lbUFkZHJlc3MgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICBQdlhwdS5tZW1vcnlPYmplY3RzWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgfQogICAgICAgICAgUHZYcHUueHB1T2JqZWN0c1siZGVsZXRlIl0ob2JqQWRkcmVzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImFkZE1lbW9yeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRNZW1vcnkobWVtQWRkcmVzcywgZGF0YSkgewogICAgICAgIFB2WHB1Lm1lbW9yeU9iamVjdHMuc2V0KG1lbUFkZHJlc3MsIGRhdGEpOwogICAgICAgIFB2WHB1LnhwdU9iamVjdHMuZ2V0KGRhdGEub2JqQWRkcmVzcykuZGV2aWNlTWVtLmFkZChtZW1BZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRNZW1vcnkiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWVtb3J5KG1lbUFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gUHZYcHUubWVtb3J5T2JqZWN0cy5nZXQobWVtQWRkcmVzcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiaGFzTWVtb3J5IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGhhc01lbW9yeShtZW1BZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIFB2WHB1Lm1lbW9yeU9iamVjdHMuaGFzKG1lbUFkZHJlc3MpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInJlbW92ZU1lbW9yeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVNZW1vcnkobWVtQWRkcmVzcykgewogICAgICAgIGlmIChQdlhwdS5oYXNNZW1vcnkobWVtQWRkcmVzcykpIHsKICAgICAgICAgIFB2WHB1LnhwdU9iamVjdHMuZ2V0KFB2WHB1LmdldE1lbW9yeShtZW1BZGRyZXNzKS5vYmpBZGRyZXNzKS5kZXZpY2VNZW1bImRlbGV0ZSJdKG1lbUFkZHJlc3MpOwogICAgICAgIH0KICAgICAgICBQdlhwdS5tZW1vcnlPYmplY3RzWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIFB2WHB1OwogIH0oKTsKICBfZGVmaW5lUHJvcGVydHkoUHZYcHUsICJ4cHVPYmplY3RzIiwgbmV3IE1hcCgpKTsKICBfZGVmaW5lUHJvcGVydHkoUHZYcHUsICJtZW1vcnlPYmplY3RzIiwgbmV3IE1hcCgpKTsKCiAgdmFyIGF0dGVudGlvblByZWNvbXB1dGVFbmNvZGluZyA9IGZ1bmN0aW9uIGF0dGVudGlvblByZWNvbXB1dGVFbmNvZGluZyhkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFscyA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFscy5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFscy5tZW1BbGxvYzsKICAgICAgdmFyIGVuY29kaW5nQWRkcmVzcyA9IGRhdGEuZW5jb2RpbmdBZGRyZXNzLAogICAgICAgIGRpbWVuc2lvbiA9IGRhdGEuZGltZW5zaW9uLAogICAgICAgIHN0ZXBzID0gZGF0YS5zdGVwcywKICAgICAgICB0aGV0YSA9IGRhdGEudGhldGE7CiAgICAgIHZhciBwdl9waWNvbGxtX2F0dGVudGlvbl9wcmVjb21wdXRlX2VuY29kaW5nID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl9wcmVjb21wdXRlX2VuY29kaW5nOwogICAgICB2YXIgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChlbmNvZGluZ0FkZHJlc3MpLAogICAgICAgIHdvcmtlckVuY29kaW5nQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fcHJlY29tcHV0ZV9lbmNvZGluZyh3b3JrZXJFbmNvZGluZ0FkZHJlc3MsIGRpbWVuc2lvbiwgc3RlcHMsIHRoZXRhKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgYXR0ZW50aW9uRW5jb2RlID0gZnVuY3Rpb24gYXR0ZW50aW9uRW5jb2RlKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzMiA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczIuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMyLm1lbUFsbG9jOwogICAgICB2YXIgeEFkZHJlc3MgPSBkYXRhLnhBZGRyZXNzLAogICAgICAgIG5ld0VuY29kaW5nQWRkcmVzcyA9IGRhdGEubmV3RW5jb2RpbmdBZGRyZXNzLAogICAgICAgIG4gPSBkYXRhLm4sCiAgICAgICAgbnVtSGVhZHMgPSBkYXRhLm51bUhlYWRzLAogICAgICAgIHJvcGVJbnRlcmxlYXZlZCA9IGRhdGEucm9wZUludGVybGVhdmVkLAogICAgICAgIGhlYWREaW1lbnNpb24gPSBkYXRhLmhlYWREaW1lbnNpb24sCiAgICAgICAgcm9wZURpbWVuc2lvbiA9IGRhdGEucm9wZURpbWVuc2lvbiwKICAgICAgICBwb3NpdGlvbiA9IGRhdGEucG9zaXRpb247CiAgICAgIHZhciBwdl9waWNvbGxtX2F0dGVudGlvbl9lbmNvZGUgPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZTsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldChuZXdFbmNvZGluZ0FkZHJlc3MpLAogICAgICAgIHdvcmtlck5ld0VuY29kaW5nQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZSh3b3JrZXJYQWRkcmVzcywgd29ya2VyTmV3RW5jb2RpbmdBZGRyZXNzLCBuLCBudW1IZWFkcywgcm9wZUludGVybGVhdmVkLCBoZWFkRGltZW5zaW9uLCByb3BlRGltZW5zaW9uLCBwb3NpdGlvbik7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGF0dGVudGlvbkF0dGVuZCA9IGZ1bmN0aW9uIGF0dGVudGlvbkF0dGVuZChkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczMgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMzLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMy5tZW1BbGxvYzsKICAgICAgdmFyIG51bUhlYWRzID0gZGF0YS5udW1IZWFkcywKICAgICAgICBudW1LdkhlYWRzID0gZGF0YS5udW1LdkhlYWRzLAogICAgICAgIHdpbmRvd0xlbmd0aCA9IGRhdGEud2luZG93TGVuZ3RoLAogICAgICAgIGhlYWREaW1lbnNpb24gPSBkYXRhLmhlYWREaW1lbnNpb24sCiAgICAgICAga2V5c0FkZHJlc3MgPSBkYXRhLmtleXNBZGRyZXNzLAogICAgICAgIGtleUludGVyY2VwdHNBZGRyZXNzID0gZGF0YS5rZXlJbnRlcmNlcHRzQWRkcmVzcywKICAgICAgICBrZXlTbG9wZXNBZGRyZXNzID0gZGF0YS5rZXlTbG9wZXNBZGRyZXNzLAogICAgICAgIHZhbHVlc0FkZHJlc3MgPSBkYXRhLnZhbHVlc0FkZHJlc3MsCiAgICAgICAgdmFsdWVJbnRlcmNlcHRzQWRkcmVzcyA9IGRhdGEudmFsdWVJbnRlcmNlcHRzQWRkcmVzcywKICAgICAgICB2YWx1ZVNsb3Blc0FkZHJlc3MgPSBkYXRhLnZhbHVlU2xvcGVzQWRkcmVzcywKICAgICAgICBwb3NpdGlvbiA9IGRhdGEucG9zaXRpb24sCiAgICAgICAgcXVlcnlBZGRyZXNzID0gZGF0YS5xdWVyeUFkZHJlc3MsCiAgICAgICAgbiA9IGRhdGEubiwKICAgICAgICBvdXRwdXRBZGRyZXNzID0gZGF0YS5vdXRwdXRBZGRyZXNzOwogICAgICB2YXIgcHZfcGljb2xsbV9hdHRlbnRpb25fYXR0ZW5kID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl9hdHRlbmQ7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldChrZXlzQWRkcmVzcyksCiAgICAgICAgd29ya2VyS2V5c0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDUgPSBtZW1BbGxvYy5nZXQoa2V5SW50ZXJjZXB0c0FkZHJlc3MpLAogICAgICAgIHdvcmtlcktleUludGVyY2VwdHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDUud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ2ID0gbWVtQWxsb2MuZ2V0KGtleVNsb3Blc0FkZHJlc3MpLAogICAgICAgIHdvcmtlcktleVNsb3Blc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Ni53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDcgPSBtZW1BbGxvYy5nZXQodmFsdWVzQWRkcmVzcyksCiAgICAgICAgd29ya2VyVmFsdWVzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ3Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0OCA9IG1lbUFsbG9jLmdldCh2YWx1ZUludGVyY2VwdHNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJWYWx1ZUludGVyY2VwdHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDgud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ5ID0gbWVtQWxsb2MuZ2V0KHZhbHVlU2xvcGVzQWRkcmVzcyksCiAgICAgICAgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDkud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxMCA9IG1lbUFsbG9jLmdldChxdWVyeUFkZHJlc3MpLAogICAgICAgIHdvcmtlclF1ZXJ5QWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDExID0gbWVtQWxsb2MuZ2V0KG91dHB1dEFkZHJlc3MpLAogICAgICAgIHdvcmtlck91dHB1dEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTEud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fYXR0ZW5kKG51bUhlYWRzLCBudW1LdkhlYWRzLCB3aW5kb3dMZW5ndGgsIGhlYWREaW1lbnNpb24sIHdvcmtlcktleXNBZGRyZXNzLCB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyS2V5U2xvcGVzQWRkcmVzcywgd29ya2VyVmFsdWVzQWRkcmVzcywgd29ya2VyVmFsdWVJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzLCBwb3NpdGlvbiwgd29ya2VyUXVlcnlBZGRyZXNzLCBuLCB3b3JrZXJPdXRwdXRBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgYXR0ZW50aW9uVXBkYXRlS2V5cyA9IGZ1bmN0aW9uIGF0dGVudGlvblVwZGF0ZUtleXMoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHM0ID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzNC5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczQubWVtQWxsb2M7CiAgICAgIHZhciBudW1LdkhlYWRzID0gZGF0YS5udW1LdkhlYWRzLAogICAgICAgIHdpbmRvd0xlbmd0aCA9IGRhdGEud2luZG93TGVuZ3RoLAogICAgICAgIGhlYWREaW1lbnNpb24gPSBkYXRhLmhlYWREaW1lbnNpb24sCiAgICAgICAga2V5c0FkZHJlc3MgPSBkYXRhLmtleXNBZGRyZXNzLAogICAgICAgIGtleUludGVyY2VwdHNBZGRyZXNzID0gZGF0YS5rZXlJbnRlcmNlcHRzQWRkcmVzcywKICAgICAgICBrZXlTbG9wZXNBZGRyZXNzID0gZGF0YS5rZXlTbG9wZXNBZGRyZXNzLAogICAgICAgIHBvc2l0aW9uID0gZGF0YS5wb3NpdGlvbiwKICAgICAgICBuID0gZGF0YS5uLAogICAgICAgIHRmQWRkcmVzcyA9IGRhdGEudGZBZGRyZXNzOwogICAgICB2YXIgcHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX2tleXMgPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX3VwZGF0ZV9rZXlzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDEyID0gbWVtQWxsb2MuZ2V0KGtleXNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJLZXlzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMi53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDEzID0gbWVtQWxsb2MuZ2V0KGtleUludGVyY2VwdHNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMy53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDE0ID0gbWVtQWxsb2MuZ2V0KGtleVNsb3Blc0FkZHJlc3MpLAogICAgICAgIHdvcmtlcktleVNsb3Blc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxNSA9IG1lbUFsbG9jLmdldCh0ZkFkZHJlc3MpLAogICAgICAgIHdvcmtlclRmQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxNS53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfa2V5cyhudW1LdkhlYWRzLCB3aW5kb3dMZW5ndGgsIGhlYWREaW1lbnNpb24sIHdvcmtlcktleXNBZGRyZXNzLCB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyS2V5U2xvcGVzQWRkcmVzcywgcG9zaXRpb24sIG4sIHdvcmtlclRmQWRkcmVzcyk7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGF0dGVudGlvblVwZGF0ZVZhbHVlcyA9IGZ1bmN0aW9uIGF0dGVudGlvblVwZGF0ZVZhbHVlcyhkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczUgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHM1LmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzNS5tZW1BbGxvYzsKICAgICAgdmFyIG51bUt2SGVhZHMgPSBkYXRhLm51bUt2SGVhZHMsCiAgICAgICAgd2luZG93TGVuZ3RoID0gZGF0YS53aW5kb3dMZW5ndGgsCiAgICAgICAgaGVhZERpbWVuc2lvbiA9IGRhdGEuaGVhZERpbWVuc2lvbiwKICAgICAgICB2YWx1ZXNBZGRyZXNzID0gZGF0YS52YWx1ZXNBZGRyZXNzLAogICAgICAgIHZhbHVlSW50ZXJjZXB0c0FkZHJlc3MgPSBkYXRhLnZhbHVlSW50ZXJjZXB0c0FkZHJlc3MsCiAgICAgICAgdmFsdWVTbG9wZXNBZGRyZXNzID0gZGF0YS52YWx1ZVNsb3Blc0FkZHJlc3MsCiAgICAgICAgcG9zaXRpb24gPSBkYXRhLnBvc2l0aW9uLAogICAgICAgIG4gPSBkYXRhLm4sCiAgICAgICAgdGZBZGRyZXNzID0gZGF0YS50ZkFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfdmFsdWVzID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfdmFsdWVzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDE2ID0gbWVtQWxsb2MuZ2V0KHZhbHVlc0FkZHJlc3MpLAogICAgICAgIHdvcmtlclZhbHVlc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTYud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxNyA9IG1lbUFsbG9jLmdldCh2YWx1ZUludGVyY2VwdHNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJWYWx1ZUludGVyY2VwdHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDE3Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MTggPSBtZW1BbGxvYy5nZXQodmFsdWVTbG9wZXNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJWYWx1ZVNsb3Blc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTgud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxOSA9IG1lbUFsbG9jLmdldCh0ZkFkZHJlc3MpLAogICAgICAgIHdvcmtlclRmQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxOS53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfdmFsdWVzKG51bUt2SGVhZHMsIHdpbmRvd0xlbmd0aCwgaGVhZERpbWVuc2lvbiwgd29ya2VyVmFsdWVzQWRkcmVzcywgd29ya2VyVmFsdWVJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzLCBwb3NpdGlvbiwgbiwgd29ya2VyVGZBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgYXR0ZW50aW9uVHJhbnNwb3NlUXVlcnkgPSBmdW5jdGlvbiBhdHRlbnRpb25UcmFuc3Bvc2VRdWVyeShkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczYgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHM2LmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzNi5tZW1BbGxvYzsKICAgICAgdmFyIG4gPSBkYXRhLm4sCiAgICAgICAgdGZBZGRyZXNzID0gZGF0YS50ZkFkZHJlc3MsCiAgICAgICAgaGZBZGRyZXNzID0gZGF0YS5oZkFkZHJlc3MsCiAgICAgICAgbnVtSGVhZHMgPSBkYXRhLm51bUhlYWRzLAogICAgICAgIGhlYWREaW1lbnNpb24gPSBkYXRhLmhlYWREaW1lbnNpb247CiAgICAgIHZhciBwdl9waWNvbGxtX2F0dGVudGlvbl90cmFuc3Bvc2VfcXVlcnkgPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX3RyYW5zcG9zZV9xdWVyeTsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyMCA9IG1lbUFsbG9jLmdldCh0ZkFkZHJlc3MpLAogICAgICAgIHdvcmtlclRmQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyMC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDIxID0gbWVtQWxsb2MuZ2V0KGhmQWRkcmVzcyksCiAgICAgICAgd29ya2VySGZBZGRyZXNzID0gX21lbUFsbG9jJGdldDIxLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX3RyYW5zcG9zZV9xdWVyeShuLCB3b3JrZXJUZkFkZHJlc3MsIHdvcmtlckhmQWRkcmVzcywgbnVtSGVhZHMsIGhlYWREaW1lbnNpb24pOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBwdlBpY29sbG1BdHRlbnRpb25BY3Rpb25NYXAgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uLkFUVEVOVElPTl9QUkVDT01QVVRFX0VOQ09ESU5HLCBhdHRlbnRpb25QcmVjb21wdXRlRW5jb2RpbmcpLCBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb24uQVRURU5USU9OX0VOQ09ERSwgYXR0ZW50aW9uRW5jb2RlKSwgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uLkFUVEVOVElPTl9BVFRFTkQsIGF0dGVudGlvbkF0dGVuZCksIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbi5BVFRFTlRJT05fVVBEQVRFX0tFWVMsIGF0dGVudGlvblVwZGF0ZUtleXMpLCBQdlBpY29sbG1BdHRlbnRpb25BY3Rpb24uQVRURU5USU9OX1VQREFURV9WQUxVRVMsIGF0dGVudGlvblVwZGF0ZVZhbHVlcyksIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbi5BVFRFTlRJT05fVFJBTlNQT1NFX1FVRVJZLCBhdHRlbnRpb25UcmFuc3Bvc2VRdWVyeSk7CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtRmVlZEZvcndhcmRBY3Rpb247CiAgKGZ1bmN0aW9uIChQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbikgewogICAgUHZQaWNvbGxtRmVlZEZvcndhcmRBY3Rpb25bUHZQaWNvbGxtRmVlZEZvcndhcmRBY3Rpb25bIkZFRURfRk9SV0FSRF9TSUxVIl0gPSAzMDBdID0gIkZFRURfRk9SV0FSRF9TSUxVIjsKICAgIFB2UGljb2xsbUZlZWRGb3J3YXJkQWN0aW9uW1B2UGljb2xsbUZlZWRGb3J3YXJkQWN0aW9uWyJGRUVEX0ZPUldBUkRfR0VMVSJdID0gMzAxXSA9ICJGRUVEX0ZPUldBUkRfR0VMVSI7CiAgICBQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbltQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvblsiRkVFRF9GT1JXQVJEX0FMTU9TVF9HRUxVIl0gPSAzMDJdID0gIkZFRURfRk9SV0FSRF9BTE1PU1RfR0VMVSI7CiAgICBQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbltQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvblsiRkVFRF9GT1JXQVJEX01VTFRJUExZX0JVRkZFUlMiXSA9IDMwM10gPSAiRkVFRF9GT1JXQVJEX01VTFRJUExZX0JVRkZFUlMiOwogIH0pKFB2UGljb2xsbUZlZWRGb3J3YXJkQWN0aW9uIHx8IChQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbiA9IHt9KSk7CgogIHZhciBmZWVkRm9yd2FyZFNpbHUgPSBmdW5jdGlvbiBmZWVkRm9yd2FyZFNpbHUoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMubWVtQWxsb2M7CiAgICAgIHZhciBuID0gZGF0YS5uLAogICAgICAgIHhBZGRyZXNzID0gZGF0YS54QWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX3NpbHUgPSBleHBvcnRzLnB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX3NpbHU7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9mZWVkX2ZvcndhcmRfc2lsdShuLCB3b3JrZXJYQWRkcmVzcyk7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGZlZWRGb3J3YXJkR2VsdSA9IGZ1bmN0aW9uIGZlZWRGb3J3YXJkR2VsdShkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczIgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMyLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMi5tZW1BbGxvYzsKICAgICAgdmFyIG4gPSBkYXRhLm4sCiAgICAgICAgeEFkZHJlc3MgPSBkYXRhLnhBZGRyZXNzOwogICAgICB2YXIgcHZfcGljb2xsbV9mZWVkX2ZvcndhcmRfZ2VsdSA9IGV4cG9ydHMucHZfcGljb2xsbV9mZWVkX2ZvcndhcmRfZ2VsdTsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX2dlbHUobiwgd29ya2VyWEFkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBmZWVkRm9yd2FyZEFsbW9zdEdlbHUgPSBmdW5jdGlvbiBmZWVkRm9yd2FyZEFsbW9zdEdlbHUoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMzID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzMy5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczMubWVtQWxsb2M7CiAgICAgIHZhciBuID0gZGF0YS5uLAogICAgICAgIHhBZGRyZXNzID0gZGF0YS54QWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX2FsbW9zdF9nZWx1ID0gZXhwb3J0cy5wdl9waWNvbGxtX2ZlZWRfZm9yd2FyZF9hbG1vc3RfZ2VsdTsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQzID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX2FsbW9zdF9nZWx1KG4sIHdvcmtlclhBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgZmVlZEZvcndhcmRNdWx0aXBseUJ1ZmZlcnMgPSBmdW5jdGlvbiBmZWVkRm9yd2FyZE11bHRpcGx5QnVmZmVycyhkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczQgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHM0LmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzNC5tZW1BbGxvYzsKICAgICAgdmFyIG4gPSBkYXRhLm4sCiAgICAgICAgeEFkZHJlc3MgPSBkYXRhLnhBZGRyZXNzLAogICAgICAgIHlBZGRyZXNzID0gZGF0YS55QWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX211bHRpcGx5X2J1ZmZlcnMgPSBleHBvcnRzLnB2X3BpY29sbG1fZmVlZF9mb3J3YXJkX211bHRpcGx5X2J1ZmZlcnM7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldCh4QWRkcmVzcyksCiAgICAgICAgd29ya2VyWEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDUgPSBtZW1BbGxvYy5nZXQoeUFkZHJlc3MpLAogICAgICAgIHdvcmtlcllBZGRyZXNzID0gX21lbUFsbG9jJGdldDUud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9mZWVkX2ZvcndhcmRfbXVsdGlwbHlfYnVmZmVycyhuLCB3b3JrZXJYQWRkcmVzcywgd29ya2VyWUFkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBwdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtRmVlZEZvcndhcmRBY3Rpb24uRkVFRF9GT1JXQVJEX1NJTFUsIGZlZWRGb3J3YXJkU2lsdSksIFB2UGljb2xsbUZlZWRGb3J3YXJkQWN0aW9uLkZFRURfRk9SV0FSRF9HRUxVLCBmZWVkRm9yd2FyZEdlbHUpLCBQdlBpY29sbG1GZWVkRm9yd2FyZEFjdGlvbi5GRUVEX0ZPUldBUkRfQUxNT1NUX0dFTFUsIGZlZWRGb3J3YXJkQWxtb3N0R2VsdSksIFB2UGljb2xsbUZlZWRGb3J3YXJkQWN0aW9uLkZFRURfRk9SV0FSRF9NVUxUSVBMWV9CVUZGRVJTLCBmZWVkRm9yd2FyZE11bHRpcGx5QnVmZmVycyk7CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtR2F0ZUFjdGlvbjsKICAoZnVuY3Rpb24gKFB2UGljb2xsbUdhdGVBY3Rpb24pIHsKICAgIFB2UGljb2xsbUdhdGVBY3Rpb25bUHZQaWNvbGxtR2F0ZUFjdGlvblsiR0FURV9GT1JXQVJEIl0gPSA0MDBdID0gIkdBVEVfRk9SV0FSRCI7CiAgfSkoUHZQaWNvbGxtR2F0ZUFjdGlvbiB8fCAoUHZQaWNvbGxtR2F0ZUFjdGlvbiA9IHt9KSk7CgogIHZhciBnYXRlRm9yd2FyZCA9IGZ1bmN0aW9uIGdhdGVGb3J3YXJkKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzLm1lbUFsbG9jOwogICAgICB2YXIgbiA9IGRhdGEubiwKICAgICAgICBrID0gZGF0YS5rLAogICAgICAgIG51bUV4cGVydHMgPSBkYXRhLm51bUV4cGVydHMsCiAgICAgICAgaW5kaWNlc0FkZHJlc3MgPSBkYXRhLmluZGljZXNBZGRyZXNzLAogICAgICAgIHdlaWdodHNBZGRyZXNzID0gZGF0YS53ZWlnaHRzQWRkcmVzcywKICAgICAgICB5QWRkcmVzcyA9IGRhdGEueUFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX2dhdGVfZm9yd2FyZCA9IGV4cG9ydHMucHZfcGljb2xsbV9nYXRlX2ZvcndhcmQ7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KGluZGljZXNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJJbmRpY2VzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KHdlaWdodHNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJXZWlnaHRzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldCh5QWRkcmVzcyksCiAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0My53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX2dhdGVfZm9yd2FyZChuLCBrLCBudW1FeHBlcnRzLCB3b3JrZXJJbmRpY2VzQWRkcmVzcywgd29ya2VyV2VpZ2h0c0FkZHJlc3MsIHdvcmtlcllBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgcHZQaWNvbGxtR2F0ZUFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtR2F0ZUFjdGlvbi5HQVRFX0ZPUldBUkQsIGdhdGVGb3J3YXJkKTsKCiAgLyogZXNsaW50IGNhbWVsY2FzZTogMCAqLwogIHZhciBQdlBpY29sbG1Nb2VUcmFuc2Zvcm1lckFjdGlvbjsKICAoZnVuY3Rpb24gKFB2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uKSB7CiAgICBQdlBpY29sbG1Nb2VUcmFuc2Zvcm1lckFjdGlvbltQdlBpY29sbG1Nb2VUcmFuc2Zvcm1lckFjdGlvblsiQUREX1RPX0JVRkZFUiJdID0gNTAwXSA9ICJBRERfVE9fQlVGRkVSIjsKICAgIFB2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uW1B2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uWyJNVUxUSVBMWV9XRUlHSFRfQU5EX0FERF9UT19CVUZGRVIiXSA9IDUwMV0gPSAiTVVMVElQTFlfV0VJR0hUX0FORF9BRERfVE9fQlVGRkVSIjsKICAgIFB2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uW1B2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uWyJBRERfQlVGRkVSUyJdID0gNTAyXSA9ICJBRERfQlVGRkVSUyI7CiAgfSkoUHZQaWNvbGxtTW9lVHJhbnNmb3JtZXJBY3Rpb24gfHwgKFB2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uID0ge30pKTsKCiAgdmFyIG1vZVRyYW5zZm9ybWVyQWRkVG9CdWZmZXIgPSBmdW5jdGlvbiBtb2VUcmFuc2Zvcm1lckFkZFRvQnVmZmVyKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzLm1lbUFsbG9jOwogICAgICB2YXIgbiA9IGRhdGEubiwKICAgICAgICB4QWRkcmVzcyA9IGRhdGEueEFkZHJlc3MsCiAgICAgICAgYnVmZmVyQWRkcmVzcyA9IGRhdGEuYnVmZmVyQWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fbW9lX3RyYW5zZm9ybWVyX2FkZF90b19idWZmZXIgPSBleHBvcnRzLnB2X3BpY29sbG1fbW9lX3RyYW5zZm9ybWVyX2FkZF90b19idWZmZXI7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KGJ1ZmZlckFkZHJlc3MpLAogICAgICAgIHdvcmtlckJ1ZmZlckFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Mi53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX21vZV90cmFuc2Zvcm1lcl9hZGRfdG9fYnVmZmVyKG4sIHdvcmtlclhBZGRyZXNzLCB3b3JrZXJCdWZmZXJBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgbW9lVHJhbnNmb3JtZXJNdWx0aXBseVdlaWdodEFuZEFkZFRvQnVmZmVyID0gZnVuY3Rpb24gbW9lVHJhbnNmb3JtZXJNdWx0aXBseVdlaWdodEFuZEFkZFRvQnVmZmVyKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzMiA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczIuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMyLm1lbUFsbG9jOwogICAgICB2YXIgbiA9IGRhdGEubiwKICAgICAgICB3ZWlnaHRzSW5kZXggPSBkYXRhLndlaWdodHNJbmRleCwKICAgICAgICB5SW5kZXggPSBkYXRhLnlJbmRleCwKICAgICAgICB3ZWlnaHRzQWRkcmVzcyA9IGRhdGEud2VpZ2h0c0FkZHJlc3MsCiAgICAgICAgeEFkZHJlc3MgPSBkYXRhLnhBZGRyZXNzLAogICAgICAgIHlBZGRyZXNzID0gZGF0YS55QWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fbW9lX3RyYW5zZm9ybWVyX211bHRpcGx5X3dlaWdodF9hbmRfYWRkX3RvX2J1ZmZlciA9IGV4cG9ydHMucHZfcGljb2xsbV9tb2VfdHJhbnNmb3JtZXJfbXVsdGlwbHlfd2VpZ2h0X2FuZF9hZGRfdG9fYnVmZmVyOwogICAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQod2VpZ2h0c0FkZHJlc3MpLAogICAgICAgIHdvcmtlcldlaWdodHNBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ0ID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ0Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NSA9IG1lbUFsbG9jLmdldCh5QWRkcmVzcyksCiAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NS53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX21vZV90cmFuc2Zvcm1lcl9tdWx0aXBseV93ZWlnaHRfYW5kX2FkZF90b19idWZmZXIobiwgd2VpZ2h0c0luZGV4LCB5SW5kZXgsIHdvcmtlcldlaWdodHNBZGRyZXNzLCB3b3JrZXJYQWRkcmVzcywgd29ya2VyWUFkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBtb2VUcmFuc2Zvcm1lckFkZEJ1ZmZlcnMgPSBmdW5jdGlvbiBtb2VUcmFuc2Zvcm1lckFkZEJ1ZmZlcnMoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMzID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzMy5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczMubWVtQWxsb2M7CiAgICAgIHZhciBuID0gZGF0YS5uLAogICAgICAgIGJ1ZmZlcjFBZGRyZXNzID0gZGF0YS5idWZmZXIxQWRkcmVzcywKICAgICAgICBidWZmZXIyQWRkcmVzcyA9IGRhdGEuYnVmZmVyMkFkZHJlc3MsCiAgICAgICAgeUFkZHJlc3MgPSBkYXRhLnlBZGRyZXNzOwogICAgICB2YXIgcHZfcGljb2xsbV9tb2VfdHJhbnNmb3JtZXJfYWRkX2J1ZmZlcnMgPSBleHBvcnRzLnB2X3BpY29sbG1fbW9lX3RyYW5zZm9ybWVyX2FkZF9idWZmZXJzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDYgPSBtZW1BbGxvYy5nZXQoYnVmZmVyMUFkZHJlc3MpLAogICAgICAgIHdvcmtlckJ1ZmZlcjFBZGRyZXNzID0gX21lbUFsbG9jJGdldDYud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ3ID0gbWVtQWxsb2MuZ2V0KGJ1ZmZlcjJBZGRyZXNzKSwKICAgICAgICB3b3JrZXJCdWZmZXIyQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ3Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0OCA9IG1lbUFsbG9jLmdldCh5QWRkcmVzcyksCiAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0OC53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX21vZV90cmFuc2Zvcm1lcl9hZGRfYnVmZmVycyhuLCB3b3JrZXJCdWZmZXIxQWRkcmVzcywgd29ya2VyQnVmZmVyMkFkZHJlc3MsIHdvcmtlcllBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgcHZQaWNvbGxtTW9lVHJhbnNmb3JtZXJBY3Rpb25NYXAgPSBfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtTW9lVHJhbnNmb3JtZXJBY3Rpb24uQUREX1RPX0JVRkZFUiwgbW9lVHJhbnNmb3JtZXJBZGRUb0J1ZmZlciksIFB2UGljb2xsbU1vZVRyYW5zZm9ybWVyQWN0aW9uLk1VTFRJUExZX1dFSUdIVF9BTkRfQUREX1RPX0JVRkZFUiwgbW9lVHJhbnNmb3JtZXJNdWx0aXBseVdlaWdodEFuZEFkZFRvQnVmZmVyKSwgUHZQaWNvbGxtTW9lVHJhbnNmb3JtZXJBY3Rpb24uQUREX0JVRkZFUlMsIG1vZVRyYW5zZm9ybWVyQWRkQnVmZmVycyk7CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtVHJhbnNmb3JtZXJBY3Rpb247CiAgKGZ1bmN0aW9uIChQdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvbikgewogICAgUHZQaWNvbGxtVHJhbnNmb3JtZXJBY3Rpb25bUHZQaWNvbGxtVHJhbnNmb3JtZXJBY3Rpb25bIkFERF9UT19CVUZGRVIiXSA9IDcwMF0gPSAiQUREX1RPX0JVRkZFUiI7CiAgICBQdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvbltQdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvblsiQUREX0JVRkZFUlMiXSA9IDcwMV0gPSAiQUREX0JVRkZFUlMiOwogIH0pKFB2UGljb2xsbVRyYW5zZm9ybWVyQWN0aW9uIHx8IChQdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvbiA9IHt9KSk7CgogIHZhciB0cmFuc2Zvcm1lckFkZFRvQnVmZmVyID0gZnVuY3Rpb24gdHJhbnNmb3JtZXJBZGRUb0J1ZmZlcihkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFscyA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFscy5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFscy5tZW1BbGxvYzsKICAgICAgdmFyIG4gPSBkYXRhLm4sCiAgICAgICAgeEFkZHJlc3MgPSBkYXRhLnhBZGRyZXNzLAogICAgICAgIGJ1ZmZlckFkZHJlc3MgPSBkYXRhLmJ1ZmZlckFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX3RyYW5zZm9ybWVyX2FkZF90b19idWZmZXIgPSBleHBvcnRzLnB2X3BpY29sbG1fdHJhbnNmb3JtZXJfYWRkX3RvX2J1ZmZlcjsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQgPSBtZW1BbGxvYy5nZXQoeEFkZHJlc3MpLAogICAgICAgIHdvcmtlclhBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQoYnVmZmVyQWRkcmVzcyksCiAgICAgICAgd29ya2VyQnVmZmVyQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHB2X3BpY29sbG1fdHJhbnNmb3JtZXJfYWRkX3RvX2J1ZmZlcihuLCB3b3JrZXJYQWRkcmVzcywgd29ya2VyQnVmZmVyQWRkcmVzcyk7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIHRyYW5zZm9ybWVyQWRkQnVmZmVycyA9IGZ1bmN0aW9uIHRyYW5zZm9ybWVyQWRkQnVmZmVycyhkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFsczIgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMyLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMi5tZW1BbGxvYzsKICAgICAgdmFyIG4gPSBkYXRhLm4sCiAgICAgICAgYnVmZmVyMUFkZHJlc3MgPSBkYXRhLmJ1ZmZlcjFBZGRyZXNzLAogICAgICAgIGJ1ZmZlcjJBZGRyZXNzID0gZGF0YS5idWZmZXIyQWRkcmVzcywKICAgICAgICB5QWRkcmVzcyA9IGRhdGEueUFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX3RyYW5zZm9ybWVyX2FkZF9idWZmZXJzID0gZXhwb3J0cy5wdl9waWNvbGxtX3RyYW5zZm9ybWVyX2FkZF9idWZmZXJzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQoYnVmZmVyMUFkZHJlc3MpLAogICAgICAgIHdvcmtlckJ1ZmZlcjFBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ0ID0gbWVtQWxsb2MuZ2V0KGJ1ZmZlcjJBZGRyZXNzKSwKICAgICAgICB3b3JrZXJCdWZmZXIyQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ0Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NSA9IG1lbUFsbG9jLmdldCh5QWRkcmVzcyksCiAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NS53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX3RyYW5zZm9ybWVyX2FkZF9idWZmZXJzKG4sIHdvcmtlckJ1ZmZlcjFBZGRyZXNzLCB3b3JrZXJCdWZmZXIyQWRkcmVzcywgd29ya2VyWUFkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBwdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2UGljb2xsbVRyYW5zZm9ybWVyQWN0aW9uLkFERF9UT19CVUZGRVIsIHRyYW5zZm9ybWVyQWRkVG9CdWZmZXIpLCBQdlBpY29sbG1UcmFuc2Zvcm1lckFjdGlvbi5BRERfQlVGRkVSUywgdHJhbnNmb3JtZXJBZGRCdWZmZXJzKTsKCiAgLyogZXNsaW50IGNhbWVsY2FzZTogMCAqLwogIHZhciBQdlBpY29sbG1Ob3JtQWN0aW9uOwogIChmdW5jdGlvbiAoUHZQaWNvbGxtTm9ybUFjdGlvbikgewogICAgUHZQaWNvbGxtTm9ybUFjdGlvbltQdlBpY29sbG1Ob3JtQWN0aW9uWyJOT1JNX0ZPUldBUkQiXSA9IDYwMF0gPSAiTk9STV9GT1JXQVJEIjsKICB9KShQdlBpY29sbG1Ob3JtQWN0aW9uIHx8IChQdlBpY29sbG1Ob3JtQWN0aW9uID0ge30pKTsKCiAgdmFyIG5vcm1Gb3J3YXJkID0gZnVuY3Rpb24gbm9ybUZvcndhcmQoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMgPSBkYXRhLmdsb2JhbHMsCiAgICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMubWVtQWxsb2M7CiAgICAgIHZhciBkaW1lbnNpb24gPSBkYXRhLmRpbWVuc2lvbiwKICAgICAgICBlcHMgPSBkYXRhLmVwcywKICAgICAgICB3ZWlnaHRBZGRyZXNzID0gZGF0YS53ZWlnaHRBZGRyZXNzLAogICAgICAgIG4gPSBkYXRhLm4sCiAgICAgICAgeE9mZnNldCA9IGRhdGEueE9mZnNldCwKICAgICAgICB4QWRkcmVzcyA9IGRhdGEueEFkZHJlc3MsCiAgICAgICAgeU9mZnNldCA9IGRhdGEueU9mZnNldCwKICAgICAgICB5QWRkcmVzcyA9IGRhdGEueUFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX25vcm1fZm9yd2FyZCA9IGV4cG9ydHMucHZfcGljb2xsbV9ub3JtX2ZvcndhcmQ7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KHdlaWdodEFkZHJlc3MpLAogICAgICAgIHdvcmtlcldlaWdodEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MiA9IG1lbUFsbG9jLmdldCh4QWRkcmVzcyksCiAgICAgICAgd29ya2VyWEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Mi53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQoeUFkZHJlc3MpLAogICAgICAgIHdvcmtlcllBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9ub3JtX2ZvcndhcmQoZGltZW5zaW9uLCBlcHMsIHdvcmtlcldlaWdodEFkZHJlc3MsIG4sIHdvcmtlclhBZGRyZXNzICsgeE9mZnNldCwgd29ya2VyWUFkZHJlc3MgKyB5T2Zmc2V0KTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgcHZQaWNvbGxtTm9ybUFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtTm9ybUFjdGlvbi5OT1JNX0ZPUldBUkQsIG5vcm1Gb3J3YXJkKTsKCiAgLyogZXNsaW50IGNhbWVsY2FzZTogMCAqLwogIHZhciBQdlBpY29sbG1Ob3JtTGF5ZXJBY3Rpb247CiAgKGZ1bmN0aW9uIChQdlBpY29sbG1Ob3JtTGF5ZXJBY3Rpb24pIHsKICAgIFB2UGljb2xsbU5vcm1MYXllckFjdGlvbltQdlBpY29sbG1Ob3JtTGF5ZXJBY3Rpb25bIk5PUk1fTEFZRVJfRk9SV0FSRCJdID0gODAwXSA9ICJOT1JNX0xBWUVSX0ZPUldBUkQiOwogIH0pKFB2UGljb2xsbU5vcm1MYXllckFjdGlvbiB8fCAoUHZQaWNvbGxtTm9ybUxheWVyQWN0aW9uID0ge30pKTsKCiAgdmFyIG5vcm1MYXllckZvcndhcmQgPSBmdW5jdGlvbiBub3JtTGF5ZXJGb3J3YXJkKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzLmV4cG9ydHMsCiAgICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzLm1lbUFsbG9jOwogICAgICB2YXIgZGltZW5zaW9uID0gZGF0YS5kaW1lbnNpb24sCiAgICAgICAgZXBzID0gZGF0YS5lcHMsCiAgICAgICAgd2VpZ2h0QWRkcmVzcyA9IGRhdGEud2VpZ2h0QWRkcmVzcywKICAgICAgICBiaWFzQWRkcmVzcyA9IGRhdGEuYmlhc0FkZHJlc3MsCiAgICAgICAgbiA9IGRhdGEubiwKICAgICAgICB4T2Zmc2V0ID0gZGF0YS54T2Zmc2V0LAogICAgICAgIHhBZGRyZXNzID0gZGF0YS54QWRkcmVzcywKICAgICAgICB5T2Zmc2V0ID0gZGF0YS55T2Zmc2V0LAogICAgICAgIHlBZGRyZXNzID0gZGF0YS55QWRkcmVzczsKICAgICAgdmFyIHB2X3BpY29sbG1fbm9ybV9sYXllcl9mb3J3YXJkID0gZXhwb3J0cy5wdl9waWNvbGxtX25vcm1fbGF5ZXJfZm9yd2FyZDsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQgPSBtZW1BbGxvYy5nZXQod2VpZ2h0QWRkcmVzcyksCiAgICAgICAgd29ya2VyV2VpZ2h0QWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KGJpYXNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJCaWFzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldCh4QWRkcmVzcyksCiAgICAgICAgd29ya2VyWEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0My53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDQgPSBtZW1BbGxvYy5nZXQoeUFkZHJlc3MpLAogICAgICAgIHdvcmtlcllBZGRyZXNzID0gX21lbUFsbG9jJGdldDQud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV9ub3JtX2xheWVyX2ZvcndhcmQoZGltZW5zaW9uLCBlcHMsIHdvcmtlcldlaWdodEFkZHJlc3MsIHdvcmtlckJpYXNBZGRyZXNzLCBuLCB3b3JrZXJYQWRkcmVzcyArIHhPZmZzZXQsIHdvcmtlcllBZGRyZXNzICsgeU9mZnNldCk7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIHB2UGljb2xsbU5vcm1MYXllckFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtTm9ybUxheWVyQWN0aW9uLk5PUk1fTEFZRVJfRk9SV0FSRCwgbm9ybUxheWVyRm9yd2FyZCk7CgogIC8qIGVzbGludCBjYW1lbGNhc2U6IDAgKi8KICB2YXIgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uOwogIChmdW5jdGlvbiAoUHZQaWNvbGxtV2VpZ2h0QWN0aW9uKSB7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JMT0NLUyJdID0gMTAwXSA9ICJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JMT0NLUyI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX1NJTkdMRSJdID0gMTAxXSA9ICJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX1NJTkdMRSI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX01VTFRJUExFIl0gPSAxMDJdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfTVVMVElQTEUiOwogICAgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uW1B2UGljb2xsbVdlaWdodEFjdGlvblsiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfQUREX0JJQVMiXSA9IDEwM10gPSAiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfQUREX0JJQVMiOwogICAgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uW1B2UGljb2xsbVdlaWdodEFjdGlvblsiV0VJR0hUX0ZMT0FUX0ZPUldBUkQiXSA9IDEwNF0gPSAiV0VJR0hUX0ZMT0FUX0ZPUldBUkQiOwogIH0pKFB2UGljb2xsbVdlaWdodEFjdGlvbiB8fCAoUHZQaWNvbGxtV2VpZ2h0QWN0aW9uID0ge30pKTsKCiAgdmFyIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc0Jsb2NrcyA9IGZ1bmN0aW9uIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc0Jsb2NrcyhkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgX2RhdGEkZ2xvYmFscyA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFscy5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFscy5tZW1BbGxvYywKICAgICAgICBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzLm1lbW9yeTsKICAgICAgdmFyIHNoYXBlID0gZGF0YS5zaGFwZSwKICAgICAgICBiaXREZXB0aHMgPSBkYXRhLmJpdERlcHRocywKICAgICAgICBiaXREZXB0aFN0YXJ0cyA9IGRhdGEuYml0RGVwdGhTdGFydHMsCiAgICAgICAgYmxvY2tzQWRkcmVzcyA9IGRhdGEuYmxvY2tzQWRkcmVzczsKICAgICAgdmFyIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2MsCiAgICAgICAgZnJlZSA9IGV4cG9ydHMuZnJlZSwKICAgICAgICBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X3ByZXByb2Nlc3NfYmxvY2tzID0gZXhwb3J0cy5wdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X3ByZXByb2Nlc3NfYmxvY2tzOwogICAgICBpZiAoIW1lbUFsbG9jLmhhcyhibG9ja3NBZGRyZXNzKSkgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgY29tbWFuZDogJ29rJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChibG9ja3NBZGRyZXNzKSwKICAgICAgICB3b3JrZXJCbG9ja3NBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgc2hhcGVBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogc2hhcGUubGVuZ3RoKTsKICAgICAgdmFyIGJpdERlcHRoc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aHMubGVuZ3RoKTsKICAgICAgdmFyIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRoU3RhcnRzLmxlbmd0aCk7CiAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoc2hhcGUsIHNoYXBlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhzLCBiaXREZXB0aHNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzU3RhcnRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfcHJlcHJvY2Vzc19ibG9ja3Moc2hhcGVBZGRyZXNzLCBiaXREZXB0aHMubGVuZ3RoLCBiaXREZXB0aHNBZGRyZXNzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIHdvcmtlckJsb2Nrc0FkZHJlc3MpOwogICAgICBmcmVlKHNoYXBlQWRkcmVzcyk7CiAgICAgIGZyZWUoYml0RGVwdGhzQWRkcmVzcyk7CiAgICAgIGZyZWUoYml0RGVwdGhzU3RhcnRBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkU2luZ2xlID0gZnVuY3Rpb24gd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkU2luZ2xlKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzMiA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczIuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMyLm1lbUFsbG9jLAogICAgICAgIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHMyLm1lbW9yeTsKICAgICAgdmFyIHNoYXBlID0gZGF0YS5zaGFwZSwKICAgICAgICBpbmRpY2VzQWRkcmVzcyA9IGRhdGEuaW5kaWNlc0FkZHJlc3MsCiAgICAgICAgYml0RGVwdGhTdGFydHMgPSBkYXRhLmJpdERlcHRoU3RhcnRzLAogICAgICAgIGJpdERlcHRocyA9IGRhdGEuYml0RGVwdGhzLAogICAgICAgIG1ldGFzQWRkcmVzcyA9IGRhdGEubWV0YXNBZGRyZXNzLAogICAgICAgIGJsb2Nrc0FkZHJlc3MgPSBkYXRhLmJsb2Nrc0FkZHJlc3MsCiAgICAgICAgeE9mZnNldCA9IGRhdGEueE9mZnNldCwKICAgICAgICB4QWRkcmVzcyA9IGRhdGEueEFkZHJlc3MsCiAgICAgICAgeUFkZHJlc3MgPSBkYXRhLnlBZGRyZXNzOwogICAgICB2YXIgYWxpZ25lZF9hbGxvYyA9IGV4cG9ydHMuYWxpZ25lZF9hbGxvYywKICAgICAgICBmcmVlID0gZXhwb3J0cy5mcmVlLAogICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGUgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGU7CiAgICAgIGlmICghbWVtQWxsb2MuaGFzKG1ldGFzQWRkcmVzcykgfHwgIW1lbUFsbG9jLmhhcyhibG9ja3NBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKHhBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKHlBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKGluZGljZXNBZGRyZXNzKSkgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgY29tbWFuZDogJ29rJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQoaW5kaWNlc0FkZHJlc3MpLAogICAgICAgIHdvcmtlckluZGljZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDIud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQzID0gbWVtQWxsb2MuZ2V0KG1ldGFzQWRkcmVzcyksCiAgICAgICAgd29ya2VyTWV0YXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ0ID0gbWVtQWxsb2MuZ2V0KGJsb2Nrc0FkZHJlc3MpLAogICAgICAgIHdvcmtlckJsb2Nrc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDUgPSBtZW1BbGxvYy5nZXQoeEFkZHJlc3MpLAogICAgICAgIHdvcmtlclhBZGRyZXNzID0gX21lbUFsbG9jJGdldDUud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ2ID0gbWVtQWxsb2MuZ2V0KHlBZGRyZXNzKSwKICAgICAgICB3b3JrZXJZQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ2Lndvcmtlck1lbUFkZHJlc3M7CiAgICAgIHZhciBzaGFwZUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBzaGFwZS5sZW5ndGgpOwogICAgICB2YXIgYml0RGVwdGhzU3RhcnRBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogYml0RGVwdGhTdGFydHMubGVuZ3RoKTsKICAgICAgdmFyIGJpdERlcHRoc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aHMubGVuZ3RoKTsKICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChzaGFwZSwgc2hhcGVBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzU3RhcnRBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIG1lbW9yeUJ1ZmZlckludDMyLnNldChiaXREZXB0aHMsIGJpdERlcHRoc0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX3NpbmdsZShzaGFwZUFkZHJlc3MsIHdvcmtlckluZGljZXNBZGRyZXNzLCBiaXREZXB0aHMubGVuZ3RoLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIGJpdERlcHRoc0FkZHJlc3MsIHdvcmtlck1ldGFzQWRkcmVzcywgd29ya2VyQmxvY2tzQWRkcmVzcywgd29ya2VyWEFkZHJlc3MgKyB4T2Zmc2V0LCB3b3JrZXJZQWRkcmVzcyk7CiAgICAgIGZyZWUoc2hhcGVBZGRyZXNzKTsKICAgICAgZnJlZShiaXREZXB0aHNTdGFydEFkZHJlc3MpOwogICAgICBmcmVlKGJpdERlcHRoc0FkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRNdWx0aXBsZSA9IGZ1bmN0aW9uIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZE11bHRpcGxlKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzMyA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczMuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMzLm1lbUFsbG9jLAogICAgICAgIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHMzLm1lbW9yeTsKICAgICAgdmFyIHNoYXBlID0gZGF0YS5zaGFwZSwKICAgICAgICBpbmRpY2VzQWRkcmVzcyA9IGRhdGEuaW5kaWNlc0FkZHJlc3MsCiAgICAgICAgYml0RGVwdGhTdGFydHMgPSBkYXRhLmJpdERlcHRoU3RhcnRzLAogICAgICAgIGJpdERlcHRocyA9IGRhdGEuYml0RGVwdGhzLAogICAgICAgIG1ldGFzQWRkcmVzcyA9IGRhdGEubWV0YXNBZGRyZXNzLAogICAgICAgIGJsb2Nrc0FkZHJlc3MgPSBkYXRhLmJsb2Nrc0FkZHJlc3MsCiAgICAgICAgbiA9IGRhdGEubiwKICAgICAgICB4T2Zmc2V0ID0gZGF0YS54T2Zmc2V0LAogICAgICAgIHhBZGRyZXNzID0gZGF0YS54QWRkcmVzcywKICAgICAgICB5QWRkcmVzcyA9IGRhdGEueUFkZHJlc3M7CiAgICAgIHZhciBhbGlnbmVkX2FsbG9jID0gZXhwb3J0cy5hbGlnbmVkX2FsbG9jLAogICAgICAgIGZyZWUgPSBleHBvcnRzLmZyZWUsCiAgICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX211bHRpcGxlID0gZXhwb3J0cy5wdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2ZvcndhcmRfbXVsdGlwbGU7CiAgICAgIGlmICghbWVtQWxsb2MuaGFzKG1ldGFzQWRkcmVzcykgfHwgIW1lbUFsbG9jLmhhcyhibG9ja3NBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKHhBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKHlBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKGluZGljZXNBZGRyZXNzKSkgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgY29tbWFuZDogJ29rJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgX21lbUFsbG9jJGdldDcgPSBtZW1BbGxvYy5nZXQoaW5kaWNlc0FkZHJlc3MpLAogICAgICAgIHdvcmtlckluZGljZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDcud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ4ID0gbWVtQWxsb2MuZ2V0KG1ldGFzQWRkcmVzcyksCiAgICAgICAgd29ya2VyTWV0YXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDgud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQ5ID0gbWVtQWxsb2MuZ2V0KGJsb2Nrc0FkZHJlc3MpLAogICAgICAgIHdvcmtlckJsb2Nrc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0OS53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDEwID0gbWVtQWxsb2MuZ2V0KHhBZGRyZXNzKSwKICAgICAgICB3b3JrZXJYQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMC53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDExID0gbWVtQWxsb2MuZ2V0KHlBZGRyZXNzKSwKICAgICAgICB3b3JrZXJZQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMS53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgc2hhcGVBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogc2hhcGUubGVuZ3RoKTsKICAgICAgdmFyIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRoU3RhcnRzLmxlbmd0aCk7CiAgICAgIHZhciBiaXREZXB0aHNBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogYml0RGVwdGhzLmxlbmd0aCk7CiAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoc2hhcGUsIHNoYXBlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhTdGFydHMsIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhzLCBiaXREZXB0aHNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9tdWx0aXBsZShzaGFwZUFkZHJlc3MsIHdvcmtlckluZGljZXNBZGRyZXNzLCBiaXREZXB0aHMubGVuZ3RoLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIGJpdERlcHRoc0FkZHJlc3MsIHdvcmtlck1ldGFzQWRkcmVzcywgd29ya2VyQmxvY2tzQWRkcmVzcywgbiwgd29ya2VyWEFkZHJlc3MgKyB4T2Zmc2V0LCB3b3JrZXJZQWRkcmVzcyk7CiAgICAgIGZyZWUoc2hhcGVBZGRyZXNzKTsKICAgICAgZnJlZShiaXREZXB0aHNTdGFydEFkZHJlc3MpOwogICAgICBmcmVlKGJpdERlcHRoc0FkZHJlc3MpOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciB3ZWlnaHRCbG9ja01peGVkMTZ4OEFkZEJpYXMgPSBmdW5jdGlvbiB3ZWlnaHRCbG9ja01peGVkMTZ4OEFkZEJpYXMoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHM0ID0gZGF0YS5nbG9iYWxzLAogICAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzNC5leHBvcnRzLAogICAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczQubWVtQWxsb2M7CiAgICAgIHZhciBuID0gZGF0YS5uLAogICAgICAgIGRpbWVuc2lvbiA9IGRhdGEuZGltZW5zaW9uLAogICAgICAgIHlBZGRyZXNzID0gZGF0YS55QWRkcmVzcywKICAgICAgICBiaWFzQWRkcmVzcyA9IGRhdGEuYmlhc0FkZHJlc3M7CiAgICAgIHZhciBmcmVlID0gZXhwb3J0cy5mcmVlLAogICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXM7CiAgICAgIGlmICghbWVtQWxsb2MuaGFzKHlBZGRyZXNzKSB8fCAhbWVtQWxsb2MuaGFzKGJpYXNBZGRyZXNzKSkgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgY29tbWFuZDogJ29rJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgX21lbUFsbG9jJGdldDEyID0gbWVtQWxsb2MuZ2V0KHlBZGRyZXNzKSwKICAgICAgICB3b3JrZXJZQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMi53b3JrZXJNZW1BZGRyZXNzOwogICAgICB2YXIgX21lbUFsbG9jJGdldDEzID0gbWVtQWxsb2MuZ2V0KGJpYXNBZGRyZXNzKSwKICAgICAgICB3b3JrZXJCaWFzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQxMy53b3JrZXJNZW1BZGRyZXNzOwogICAgICBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2FkZF9iaWFzKG4sIGRpbWVuc2lvbiwgd29ya2VyWUFkZHJlc3MsIHdvcmtlckJpYXNBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgd2VpZ2h0RmxvYXRGb3J3YXJkID0gZnVuY3Rpb24gd2VpZ2h0RmxvYXRGb3J3YXJkKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzNSA9IGRhdGEuZ2xvYmFscywKICAgICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczUuZXhwb3J0cywKICAgICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHM1Lm1lbUFsbG9jOwogICAgICB2YXIgbiA9IGRhdGEubiwKICAgICAgICBuYyA9IGRhdGEubmMsCiAgICAgICAgbnIgPSBkYXRhLm5yLAogICAgICAgIHdBZGRyZXNzID0gZGF0YS53QWRkcmVzcywKICAgICAgICB4T2Zmc2V0ID0gZGF0YS54T2Zmc2V0LAogICAgICAgIHhBZGRyZXNzID0gZGF0YS54QWRkcmVzcywKICAgICAgICB5QWRkcmVzcyA9IGRhdGEueUFkZHJlc3M7CiAgICAgIHZhciBwdl9waWNvbGxtX3dlaWdodF9mbG9hdF9mb3J3YXJkID0gZXhwb3J0cy5wdl9waWNvbGxtX3dlaWdodF9mbG9hdF9mb3J3YXJkOwogICAgICBpZiAoIW1lbUFsbG9jLmhhcyh3QWRkcmVzcykgfHwgIW1lbUFsbG9jLmhhcyh4QWRkcmVzcykgfHwgIW1lbUFsbG9jLmhhcyh5QWRkcmVzcykpIHsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxNCA9IG1lbUFsbG9jLmdldCh3QWRkcmVzcyksCiAgICAgICAgd29ya2VyV0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxNSA9IG1lbUFsbG9jLmdldCh4QWRkcmVzcyksCiAgICAgICAgd29ya2VyWEFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTUud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIF9tZW1BbGxvYyRnZXQxNiA9IG1lbUFsbG9jLmdldCh5QWRkcmVzcyksCiAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0MTYud29ya2VyTWVtQWRkcmVzczsKICAgICAgcHZfcGljb2xsbV93ZWlnaHRfZmxvYXRfZm9yd2FyZChuLCBuYywgbnIsIHdvcmtlcldBZGRyZXNzLCB3b3JrZXJYQWRkcmVzcyArIHhPZmZzZXQsIHdvcmtlcllBZGRyZXNzKTsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgcHZQaWNvbGxtV2VpZ2h0QWN0aW9uTWFwID0gX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQkxPQ0tTLCB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NCbG9ja3MpLCBQdlBpY29sbG1XZWlnaHRBY3Rpb24uV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfRk9SV0FSRF9TSU5HTEUsIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZFNpbmdsZSksIFB2UGljb2xsbVdlaWdodEFjdGlvbi5XRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9GT1JXQVJEX01VTFRJUExFLCB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRNdWx0aXBsZSksIFB2UGljb2xsbVdlaWdodEFjdGlvbi5XRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9BRERfQklBUywgd2VpZ2h0QmxvY2tNaXhlZDE2eDhBZGRCaWFzKSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9GTE9BVF9GT1JXQVJELCB3ZWlnaHRGbG9hdEZvcndhcmQpOwoKICBmdW5jdGlvbiBvd25LZXlzKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH0KICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9CiAgdmFyIGV4cG9ydHMkMTsKICB2YXIgbWVtb3J5OwogIHZhciBtZW1BbGxvYyA9IG5ldyBNYXAoKTsKICBmdW5jdGlvbiBhcnJheUJ1ZmZlclRvU3RyaW5nQXRJbmRleChhcnJheUJ1ZmZlciwgaW5kZXhTdGFydCkgewogICAgdmFyIGluZGV4RW5kID0gaW5kZXhTdGFydDsKICAgIHdoaWxlIChhcnJheUJ1ZmZlcltpbmRleEVuZF0gIT09IDApIHsKICAgICAgaW5kZXhFbmQrKzsKICAgIH0KICAgIHZhciB1dGY4ZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnKTsKICAgIHJldHVybiB1dGY4ZGVjb2Rlci5kZWNvZGUoYXJyYXlCdWZmZXIuc3ViYXJyYXkoaW5kZXhTdGFydCwgaW5kZXhFbmQpKTsKICB9CiAgdmFyIGdldFdhc20gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUkMS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUod2FzbSkgewogICAgICB2YXIgcHZDb25zb2xlTG9nV2FzbSwgcHZBc3NlcnRXYXNtLCBwdlRpbWVXYXNtLCBwdkZpbGVPcGVuV2FzbSwgcHZGaWxlQ2xvc2VXYXNtLCBwdkZpbGVSZWFkV2FzbSwgcHZGaWxlV3JpdGVXYXNtLCBwdkZpbGVTZWVrV2FzbSwgcHZGaWxlVGVsbFdhc20sIHB2RmlsZVJlbW92ZVdhc20sIGluc3RhbmNlLCBhbGlnbmVkX2FsbG9jLCBhbGlnbmVkQWxsb2M7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHB2Q29uc29sZUxvZ1dhc20gPSBmdW5jdGlvbiBwdkNvbnNvbGVMb2dXYXNtKGluZGV4KSB7CiAgICAgICAgICAgICAgaW5kZXggPSB1bnNpZ25lZEFkZHJlc3MoaW5kZXgpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIGluZGV4KSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2QXNzZXJ0V2FzbSA9IGZ1bmN0aW9uIHB2QXNzZXJ0V2FzbShleHByLCBsaW5lLCBmaWxlTmFtZUFkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlTmFtZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZU5hbWVBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICBpZiAoZXhwciA9PT0gMCkgewogICAgICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIGZpbGVOYW1lQWRkcmVzcyk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImFzc2VydGlvbiBmYWlsZWQgYXQgbGluZSAiLmNvbmNhdChsaW5lLCAiIGluIFwiIikuY29uY2F0KGZpbGVOYW1lLCAiXCIiKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdlRpbWVXYXNtID0gZnVuY3Rpb24gcHZUaW1lV2FzbSgpIHsKICAgICAgICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOwogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVPcGVuV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZU9wZW5XYXNtKGZpbGVBZGRyZXNzLCBwYXRoQWRkcmVzcywgbW9kZUFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgcGF0aEFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MocGF0aEFkZHJlc3MpOwogICAgICAgICAgICAgIG1vZGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKG1vZGVBZGRyZXNzKTsKICAgICAgICAgICAgICBzdGF0dXNBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKHN0YXR1c0FkZHJlc3MpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHZhciBwYXRoID0gYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIHBhdGhBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbW9kZSA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBtb2RlQWRkcmVzcyk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLm9wZW4ocGF0aCwgbW9kZSk7CiAgICAgICAgICAgICAgICBQdkZpbGVNZW0uc2V0UHRyKGZpbGVBZGRyZXNzLCBmaWxlKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDA7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVDbG9zZVdhc20gPSBmdW5jdGlvbiBwdkZpbGVDbG9zZVdhc20oZmlsZUFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgc3RhdHVzQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhzdGF0dXNBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIGZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDA7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVSZWFkV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVJlYWRXYXNtKGZpbGVBZGRyZXNzLCBjb250ZW50QWRkcmVzcywgc2l6ZSwgY291bnQsIG51bVJlYWRBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIGNvbnRlbnRBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGNvbnRlbnRBZGRyZXNzKTsKICAgICAgICAgICAgICBudW1SZWFkQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhudW1SZWFkQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGZpbGUucmVhZChzaXplLCBjb3VudCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJVaW50OC5zZXQoY29udGVudCwgY29udGVudEFkZHJlc3MpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbbnVtUmVhZEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IGNvbnRlbnQubGVuZ3RoIC8gc2l6ZTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltudW1SZWFkQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVXcml0ZVdhc20gPSBmdW5jdGlvbiBwdkZpbGVXcml0ZVdhc20oZmlsZUFkZHJlc3MsIGNvbnRlbnRBZGRyZXNzLCBzaXplLCBjb3VudCwgbnVtV3JpdGVBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIGNvbnRlbnRBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGNvbnRlbnRBZGRyZXNzKTsKICAgICAgICAgICAgICBudW1Xcml0ZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MobnVtV3JpdGVBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSAqIGNvdW50KTsKICAgICAgICAgICAgICAgIGNvbnRlbnQuc2V0KG1lbW9yeUJ1ZmZlclVpbnQ4LnNsaWNlKGNvbnRlbnRBZGRyZXNzLCBjb250ZW50QWRkcmVzcyArIHNpemUgKiBjb3VudCksIDApOwogICAgICAgICAgICAgICAgZmlsZS53cml0ZShjb250ZW50KTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW251bVdyaXRlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gY29udGVudC5sZW5ndGggLyBzaXplOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW251bVdyaXRlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2RmlsZVNlZWtXYXNtID0gZnVuY3Rpb24gcHZGaWxlU2Vla1dhc20oZmlsZUFkZHJlc3MsIG9mZnNldCwgd2hlbmNlLCBzdGF0dXNBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIHN0YXR1c0FkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3Moc3RhdHVzQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICBmaWxlLnNlZWsob2Zmc2V0LCB3aGVuY2UpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gMDsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2RmlsZVRlbGxXYXNtID0gZnVuY3Rpb24gcHZGaWxlVGVsbFdhc20oZmlsZUFkZHJlc3MsIG9mZnNldEFkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgb2Zmc2V0QWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhvZmZzZXRBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW29mZnNldEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IGZpbGUudGVsbCgpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW29mZnNldEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlUmVtb3ZlV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVJlbW92ZVdhc20ocGF0aEFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBwYXRoQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhwYXRoQWRkcmVzcyk7CiAgICAgICAgICAgICAgc3RhdHVzQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhzdGF0dXNBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgcGF0aCA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBwYXRoQWRkcmVzcyk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLm9wZW4ocGF0aCwgInciKTsKICAgICAgICAgICAgICAgIGZpbGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAwOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUod2FzbSwgewogICAgICAgICAgICAgIHdhc2lfc25hcHNob3RfcHJldmlldzE6IHdhc2lfc25hcHNob3RfcHJldmlldzFfZW11bGF0b3IsCiAgICAgICAgICAgICAgZW52OiB7CiAgICAgICAgICAgICAgICBtZW1vcnk6IG1lbW9yeSwKICAgICAgICAgICAgICAgIHB2X2NvbnNvbGVfbG9nX3dhc206IHB2Q29uc29sZUxvZ1dhc20sCiAgICAgICAgICAgICAgICBwdl9hc3NlcnRfd2FzbTogcHZBc3NlcnRXYXNtLAogICAgICAgICAgICAgICAgcHZfdGltZV93YXNtOiBwdlRpbWVXYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV9vcGVuX3dhc206IHB2RmlsZU9wZW5XYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV9jbG9zZV93YXNtOiBwdkZpbGVDbG9zZVdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3JlYWRfd2FzbTogcHZGaWxlUmVhZFdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3dyaXRlX3dhc206IHB2RmlsZVdyaXRlV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfc2Vla193YXNtOiBwdkZpbGVTZWVrV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfdGVsbF93YXNtOiBwdkZpbGVUZWxsV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfcmVtb3ZlX3dhc206IHB2RmlsZVJlbW92ZVdhc20KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgaW5zdGFuY2UgPSBfY29udGV4dC5zZW50Lmluc3RhbmNlOwogICAgICAgICAgICBhbGlnbmVkX2FsbG9jID0gaW5zdGFuY2UuZXhwb3J0cy5hbGlnbmVkX2FsbG9jOwogICAgICAgICAgICBhbGlnbmVkQWxsb2MgPSBmdW5jdGlvbiBhbGlnbmVkQWxsb2MoYWxpZ25tZW50LCBzaXplKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgICAgICAgdmFyIHBvaW50ZXIgPSBhbGlnbmVkX2FsbG9jKGFsaWdubWVudCwgc2l6ZSk7CiAgICAgICAgICAgICAgaWYgKHBvaW50ZXIgPCAwKSB7CiAgICAgICAgICAgICAgICBwb2ludGVyID0gcG9pbnRlciA+Pj4gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHBvaW50ZXI7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaW5zdGFuY2UuZXhwb3J0cyksIHt9LCB7CiAgICAgICAgICAgICAgYWxpZ25lZF9hbGxvYzogYWxpZ25lZEFsbG9jCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gZ2V0V2FzbShfeCkgewogICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7CiAgdmFyIGluaXQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkYXRhKSB7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgIG1lbW9yeSA9IG5ldyBXZWJBc3NlbWJseS5NZW1vcnkoewogICAgICAgICAgICAgIGluaXRpYWw6IDQwOTYsCiAgICAgICAgICAgICAgbWF4aW11bTogNjU1MzYKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIGdldFdhc20oZGF0YS53YXNtKTsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgZXhwb3J0cyQxID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDg7CiAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICAgICAgICBtZXNzYWdlOiBfY29udGV4dDIudDAubWVzc2FnZQogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDhdXSk7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gaW5pdChfeDIpIHsKICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKICB2YXIgYWxsb2NNZW0gPSBmdW5jdGlvbiBhbGxvY01lbShkYXRhKSB7CiAgICB0cnkgewogICAgICB2YXIgc2l6ZSA9IGRhdGEuc2l6ZSwKICAgICAgICBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzOwogICAgICB2YXIgX2V4cG9ydHMgPSBleHBvcnRzJDEsCiAgICAgICAgX2FsaWduZWRfYWxsb2MgPSBfZXhwb3J0cy5hbGlnbmVkX2FsbG9jOwogICAgICBpZiAoc2l6ZSA+IDApIHsKICAgICAgICB2YXIgd29ya2VyTWVtQWRkcmVzcyA9IF9hbGlnbmVkX2FsbG9jKFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHNpemUgKiBVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICBtZW1BbGxvYy5zZXQobWVtQWRkcmVzcywgewogICAgICAgICAgYWxsb2NTaXplOiBzaXplLAogICAgICAgICAgd29ya2VyTWVtQWRkcmVzczogd29ya2VyTWVtQWRkcmVzcwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGZyZWVNZW0gPSBmdW5jdGlvbiBmcmVlTWVtKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzOwogICAgICB2YXIgX2V4cG9ydHMyID0gZXhwb3J0cyQxLAogICAgICAgIGZyZWUgPSBfZXhwb3J0czIuZnJlZTsKICAgICAgaWYgKG1lbUFsbG9jLmhhcyhtZW1BZGRyZXNzKSkgewogICAgICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KG1lbUFkZHJlc3MpLAogICAgICAgICAgd29ya2VyTWVtQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQud29ya2VyTWVtQWRkcmVzczsKICAgICAgICBmcmVlKHdvcmtlck1lbUFkZHJlc3MpOwogICAgICAgIG1lbUFsbG9jWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgfQogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBjb3B5VG9YcHUgPSBmdW5jdGlvbiBjb3B5VG9YcHUoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIG1lbUFkZHJlc3MgPSBkYXRhLm1lbUFkZHJlc3MsCiAgICAgICAgb2Zmc2V0ID0gZGF0YS5vZmZzZXQsCiAgICAgICAgYnVmZmVyID0gZGF0YS5idWZmZXI7CiAgICAgIGlmIChtZW1BbGxvYy5oYXMobWVtQWRkcmVzcykpIHsKICAgICAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDIud29ya2VyTWVtQWRkcmVzczsKICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICBtZW1vcnlCdWZmZXJVaW50OC5zZXQoYnVmZmVyLCB3b3JrZXJNZW1BZGRyZXNzICsgb2Zmc2V0KTsKICAgICAgfQogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBjb3B5RnJvbVhwdSA9IGZ1bmN0aW9uIGNvcHlGcm9tWHB1KGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzLAogICAgICAgIG9mZnNldCA9IGRhdGEub2Zmc2V0LAogICAgICAgIHNpemUgPSBkYXRhLnNpemU7CiAgICAgIGlmIChtZW1BbGxvYy5oYXMobWVtQWRkcmVzcykpIHsKICAgICAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDMud29ya2VyTWVtQWRkcmVzczsKICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGNvbW1hbmQ6ICdvaycsCiAgICAgICAgICByZXN1bHQ6IG1lbW9yeUJ1ZmZlclVpbnQ4LnNsaWNlKHdvcmtlck1lbUFkZHJlc3MgKyBvZmZzZXQsIHdvcmtlck1lbUFkZHJlc3MgKyBvZmZzZXQgKyBzaXplKQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgY29tbWFuZDogJ29rJywKICAgICAgICAgIHJlc3VsdDogbmV3IFVpbnQ4QXJyYXkoMCkKICAgICAgICB9KTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBtZW1zZXQgPSBmdW5jdGlvbiBtZW1zZXQoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIG1lbUFkZHJlc3MgPSBkYXRhLm1lbUFkZHJlc3MsCiAgICAgICAgZmlsbEJ5dGUgPSBkYXRhLmZpbGxCeXRlLAogICAgICAgIHNpemUgPSBkYXRhLnNpemU7CiAgICAgIGlmIChtZW1BbGxvYy5oYXMobWVtQWRkcmVzcykpIHsKICAgICAgICB2YXIgX21lbUFsbG9jJGdldDQgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDQud29ya2VyTWVtQWRkcmVzczsKICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICBtZW1vcnlCdWZmZXJVaW50OC5maWxsKGZpbGxCeXRlLCB3b3JrZXJNZW1BZGRyZXNzLCB3b3JrZXJNZW1BZGRyZXNzICsgc2l6ZSk7CiAgICAgIH0KICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ29rJwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgY29tbWFuZDogJ2Vycm9yJywKICAgICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgdGltZXJTdGFydCA9IGZ1bmN0aW9uIHRpbWVyU3RhcnQoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdmFyIHdvcmtlckluZGV4ID0gZGF0YS53b3JrZXJJbmRleDsKICAgICAgdmFyIF9leHBvcnRzMyA9IGV4cG9ydHMkMSwKICAgICAgICBwdl9waWNvbGxtX3RpbWVyX3N0YXJ0X3dhc20gPSBfZXhwb3J0czMucHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtOwogICAgICBpZiAocHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtKSB7CiAgICAgICAgcHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtKHdvcmtlckluZGV4KTsKICAgICAgfQogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnb2snCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciB0aW1lclN0b3AgPSBmdW5jdGlvbiB0aW1lclN0b3AoKSB7CiAgICB0cnkgewogICAgICB2YXIgX2V4cG9ydHM0ID0gZXhwb3J0cyQxLAogICAgICAgIHB2X3BpY29sbG1fdGltZXJfc3RvcF93YXNtID0gX2V4cG9ydHM0LnB2X3BpY29sbG1fdGltZXJfc3RvcF93YXNtOwogICAgICBpZiAocHZfcGljb2xsbV90aW1lcl9zdG9wX3dhc20pIHsKICAgICAgICBwdl9waWNvbGxtX3RpbWVyX3N0b3Bfd2FzbSgpOwogICAgICB9CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdvaycKICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGNvbW1hbmQ6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIHhwdUFjdGlvbk1hcCA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2WHB1QWN0aW9uLklOSVQsIGluaXQpLCBQdlhwdUFjdGlvbi5BTExPQywgYWxsb2NNZW0pLCBQdlhwdUFjdGlvbi5GUkVFLCBmcmVlTWVtKSwgUHZYcHVBY3Rpb24uQ09QWV9UT19YUFUsIGNvcHlUb1hwdSksIFB2WHB1QWN0aW9uLkNPUFlfRlJPTV9YUFUsIGNvcHlGcm9tWHB1KSwgUHZYcHVBY3Rpb24uTUVNU0VULCBtZW1zZXQpLCBQdlhwdUFjdGlvbi5USU1FUl9TVEFSVCwgdGltZXJTdGFydCksIFB2WHB1QWN0aW9uLlRJTUVSX1NUT1AsIHRpbWVyU3RvcCksIHB2TXZtQWN0aW9uTWFwKSwgcHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uTWFwKSwgcHZQaWNvbGxtRmVlZEZvcndhcmRBY3Rpb25NYXApLCBwdlBpY29sbG1HYXRlQWN0aW9uTWFwKSwgcHZQaWNvbGxtTW9lVHJhbnNmb3JtZXJBY3Rpb25NYXApLCBwdlBpY29sbG1Ob3JtQWN0aW9uTWFwKSwgcHZQaWNvbGxtTm9ybUxheWVyQWN0aW9uTWFwKSwgcHZQaWNvbGxtVHJhbnNmb3JtZXJBY3Rpb25NYXApLCBwdlBpY29sbG1XZWlnaHRBY3Rpb25NYXApOwogIHNlbGYub25tZXNzYWdlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSQxLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoZXZlbnQpIHsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUkMS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGlmICghKGV2ZW50LmRhdGEuYWN0aW9uIGluIHhwdUFjdGlvbk1hcCkpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnQuZGF0YS5nbG9iYWxzID0gewogICAgICAgICAgICAgIGV4cG9ydHM6IGV4cG9ydHMkMSwKICAgICAgICAgICAgICBtZW1vcnk6IG1lbW9yeSwKICAgICAgICAgICAgICBtZW1BbGxvYzogbWVtQWxsb2MKICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICByZXR1cm4geHB1QWN0aW9uTWFwW2V2ZW50LmRhdGEuYWN0aW9uXShldmVudC5kYXRhKTsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA3OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgY29tbWFuZDogJ2ZhaWxlZCcsCiAgICAgICAgICAgICAgbWVzc2FnZTogIlVucmVjb2duaXplZCBjb21tYW5kOiAiLmNvbmNhdChldmVudC5kYXRhLmFjdGlvbikKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiAoX3gzKSB7CiAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7Cgp9KSgpOwoK",K=null,v=!1,function(I){return f=f||Y(w,K,v),new Worker(f,I)});function z(I,C){for(var A=0;A<C.length;A++){var e=C[A];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(I,g(e.key),e)}}function Q(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return M(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return M(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var A=0,e=function(){};return{s:e,n:function(){return A>=I.length?{done:!0}:{done:!1,value:I[A++]}},e:function(I){throw I},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,t=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return l=I.done,I},e:function(I){t=!0,c=I},f:function(){try{l||null==C.return||C.return()}finally{if(t)throw c}}}}function M(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,A=new Array(g);C<g;C++)A[C]=I[C];return A}!function(I){I[I.INIT=0]="INIT",I[I.ALLOC=1]="ALLOC",I[I.FREE=2]="FREE",I[I.COPY_TO_XPU=3]="COPY_TO_XPU",I[I.COPY_FROM_XPU=4]="COPY_FROM_XPU",I[I.MEMSET=5]="MEMSET",I[I.TIMER_START=6]="TIMER_START",I[I.TIMER_STOP=7]="TIMER_STOP",I[I.MATRIX_VECTOR_MULTIPLY=8]="MATRIX_VECTOR_MULTIPLY",I[I.SYNC_VECTOR=9]="SYNC_VECTOR"}(N||(N={}));var E=function(){function I(){!function(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}(this,I)}var g,C,A;return g=I,A=[{key:"addXpu",value:function(g,C){I.xpuObjects.set(g,C)}},{key:"getXpu",value:function(g){return I.xpuObjects.get(g)}},{key:"hasXpu",value:function(g){return I.xpuObjects.has(g)}},{key:"removeXpu",value:function(g){if(I.xpuObjects.has(g)){var C,A=Q(I.xpuObjects.get(g).deviceMem);try{for(A.s();!(C=A.n()).done;){var e=C.value;I.memoryObjects.delete(e)}}catch(I){A.e(I)}finally{A.f()}I.xpuObjects.delete(g)}}},{key:"addMemory",value:function(g,C){I.memoryObjects.set(g,C),I.xpuObjects.get(C.objAddress).deviceMem.add(g)}},{key:"getMemory",value:function(g){return I.memoryObjects.get(g)}},{key:"hasMemory",value:function(g){return I.memoryObjects.has(g)}},{key:"removeMemory",value:function(g){I.hasMemory(g)&&I.xpuObjects.get(I.getMemory(g).objAddress).deviceMem.delete(g),I.memoryObjects.delete(g)}}],(C=null)&&z(g.prototype,C),A&&z(g,A),Object.defineProperty(g,"prototype",{writable:!1}),I}();C(E,"xpuObjects",new Map),C(E,"memoryObjects",new Map);var x,L=function(I,g,C){return I.postMessage(g,C),new Promise((function(g,C){I.onmessage=function(I){switch(I.data.command){case"ok":g(I.data.result);break;case"failed":case"error":C(I.data.message);break;default:C("Unrecognized command: ".concat(I.data.command))}}}))};!function(I){I[I.ATTENTION_PRECOMPUTE_ENCODING=200]="ATTENTION_PRECOMPUTE_ENCODING",I[I.ATTENTION_ENCODE=201]="ATTENTION_ENCODE",I[I.ATTENTION_ATTEND=202]="ATTENTION_ATTEND",I[I.ATTENTION_UPDATE_KEYS=203]="ATTENTION_UPDATE_KEYS",I[I.ATTENTION_UPDATE_VALUES=204]="ATTENTION_UPDATE_VALUES",I[I.ATTENTION_TRANSPOSE_QUERY=205]="ATTENTION_TRANSPOSE_QUERY"}(x||(x={}));var T;C(C(C(C(C(C({},x.ATTENTION_PRECOMPUTE_ENCODING,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.encodingAddress,c=I.dimension,l=I.steps,t=I.theta;(0,C.pv_picollm_attention_precompute_encoding)(A.get(e).workerMemAddress,c,l,t),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),x.ATTENTION_ENCODE,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.xAddress,c=I.newEncodingAddress,l=I.n,t=I.numHeads,s=I.ropeInterleaved,Z=I.headDimension,d=I.ropeDimension,b=I.position;(0,C.pv_picollm_attention_encode)(A.get(e).workerMemAddress,A.get(c).workerMemAddress,l,t,s,Z,d,b),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),x.ATTENTION_ATTEND,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.numHeads,c=I.numKvHeads,l=I.windowLength,t=I.headDimension,s=I.keysAddress,Z=I.keyInterceptsAddress,d=I.keySlopesAddress,b=I.valuesAddress,i=I.valueInterceptsAddress,r=I.valueSlopesAddress,o=I.position,n=I.queryAddress,m=I.n,G=I.outputAddress;(0,C.pv_picollm_attention_attend)(e,c,l,t,A.get(s).workerMemAddress,A.get(Z).workerMemAddress,A.get(d).workerMemAddress,A.get(b).workerMemAddress,A.get(i).workerMemAddress,A.get(r).workerMemAddress,o,A.get(n).workerMemAddress,m,A.get(G).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),x.ATTENTION_UPDATE_KEYS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.numKvHeads,c=I.windowLength,l=I.headDimension,t=I.keysAddress,s=I.keyInterceptsAddress,Z=I.keySlopesAddress,d=I.position,b=I.n,i=I.tfAddress;(0,C.pv_picollm_attention_update_keys)(e,c,l,A.get(t).workerMemAddress,A.get(s).workerMemAddress,A.get(Z).workerMemAddress,d,b,A.get(i).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),x.ATTENTION_UPDATE_VALUES,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.numKvHeads,c=I.windowLength,l=I.headDimension,t=I.valuesAddress,s=I.valueInterceptsAddress,Z=I.valueSlopesAddress,d=I.position,b=I.n,i=I.tfAddress;(0,C.pv_picollm_attention_update_values)(e,c,l,A.get(t).workerMemAddress,A.get(s).workerMemAddress,A.get(Z).workerMemAddress,d,b,A.get(i).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),x.ATTENTION_TRANSPOSE_QUERY,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.tfAddress,l=I.hfAddress,t=I.numHeads,s=I.headDimension;(0,C.pv_picollm_attention_transpose_query)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress,t,s),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.FEED_FORWARD_SILU=300]="FEED_FORWARD_SILU",I[I.FEED_FORWARD_GELU=301]="FEED_FORWARD_GELU",I[I.FEED_FORWARD_ALMOST_GELU=302]="FEED_FORWARD_ALMOST_GELU",I[I.FEED_FORWARD_MULTIPLY_BUFFERS=303]="FEED_FORWARD_MULTIPLY_BUFFERS"}(T||(T={}));var D;C(C(C(C({},T.FEED_FORWARD_SILU,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress;(0,C.pv_picollm_feed_forward_silu)(e,A.get(c).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),T.FEED_FORWARD_GELU,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress;(0,C.pv_picollm_feed_forward_gelu)(e,A.get(c).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),T.FEED_FORWARD_ALMOST_GELU,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress;(0,C.pv_picollm_feed_forward_almost_gelu)(e,A.get(c).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),T.FEED_FORWARD_MULTIPLY_BUFFERS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress,l=I.yAddress;(0,C.pv_picollm_feed_forward_multiply_buffers)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.GATE_FORWARD=400]="GATE_FORWARD"}(D||(D={}));var P;C({},D.GATE_FORWARD,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.k,l=I.numExperts,t=I.indicesAddress,s=I.weightsAddress,Z=I.yAddress;(0,C.pv_picollm_gate_forward)(e,c,l,A.get(t).workerMemAddress,A.get(s).workerMemAddress,A.get(Z).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.ADD_TO_BUFFER=500]="ADD_TO_BUFFER",I[I.MULTIPLY_WEIGHT_AND_ADD_TO_BUFFER=501]="MULTIPLY_WEIGHT_AND_ADD_TO_BUFFER",I[I.ADD_BUFFERS=502]="ADD_BUFFERS"}(P||(P={}));var O;C(C(C({},P.ADD_TO_BUFFER,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress,l=I.bufferAddress;(0,C.pv_picollm_moe_transformer_add_to_buffer)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),P.MULTIPLY_WEIGHT_AND_ADD_TO_BUFFER,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.weightsIndex,l=I.yIndex,t=I.weightsAddress,s=I.xAddress,Z=I.yAddress;(0,C.pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer)(e,c,l,A.get(t).workerMemAddress,A.get(s).workerMemAddress,A.get(Z).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),P.ADD_BUFFERS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.buffer1Address,l=I.buffer2Address,t=I.yAddress;(0,C.pv_picollm_moe_transformer_add_buffers)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress,A.get(t).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.NORM_FORWARD=600]="NORM_FORWARD"}(O||(O={}));var _;C({},O.NORM_FORWARD,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.dimension,c=I.eps,l=I.weightAddress,t=I.n,s=I.xOffset,Z=I.xAddress,d=I.yOffset,b=I.yAddress;(0,C.pv_picollm_norm_forward)(e,c,A.get(l).workerMemAddress,t,A.get(Z).workerMemAddress+s,A.get(b).workerMemAddress+d),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.NORM_LAYER_FORWARD=800]="NORM_LAYER_FORWARD"}(_||(_={}));var j;C({},_.NORM_LAYER_FORWARD,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.dimension,c=I.eps,l=I.weightAddress,t=I.biasAddress,s=I.n,Z=I.xOffset,d=I.xAddress,b=I.yOffset,i=I.yAddress;(0,C.pv_picollm_norm_layer_forward)(e,c,A.get(l).workerMemAddress,A.get(t).workerMemAddress,s,A.get(d).workerMemAddress+Z,A.get(i).workerMemAddress+b),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.ADD_TO_BUFFER=700]="ADD_TO_BUFFER",I[I.ADD_BUFFERS=701]="ADD_BUFFERS"}(j||(j={}));var q;C(C({},j.ADD_TO_BUFFER,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.xAddress,l=I.bufferAddress;(0,C.pv_picollm_transformer_add_to_buffer)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),j.ADD_BUFFERS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.buffer1Address,l=I.buffer2Address,t=I.yAddress;(0,C.pv_picollm_transformer_add_buffers)(e,A.get(c).workerMemAddress,A.get(l).workerMemAddress,A.get(t).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),function(I){I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS=100]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE=101]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE=102]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE",I[I.WEIGHT_BLOCK_MIXED_16X8_ADD_BIAS=103]="WEIGHT_BLOCK_MIXED_16X8_ADD_BIAS",I[I.WEIGHT_FLOAT_FORWARD=104]="WEIGHT_FLOAT_FORWARD"}(q||(q={}));function $(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(I);g&&(A=A.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,A)}return C}function II(I){for(var g=1;g<arguments.length;g++){var A=null!=arguments[g]?arguments[g]:{};g%2?$(Object(A),!0).forEach((function(g){C(I,g,A[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(A)):$(Object(A)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(A,g))}))}return I}function gI(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return CI(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return CI(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var A=0,e=function(){};return{s:e,n:function(){return A>=I.length?{done:!0}:{done:!1,value:I[A++]}},e:function(I){throw I},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,t=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return l=I.done,I},e:function(I){t=!0,c=I},f:function(){try{l||null==C.return||C.return()}finally{if(t)throw c}}}}function CI(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,A=new Array(g);C<g;C++)A[C]=I[C];return A}C(C(C(C(C({},q.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=g.memory,c=I.shape,l=I.bitDepths,t=I.bitDepthStarts,s=I.blocksAddress,Z=C.aligned_alloc,d=C.free,b=C.pv_picollm_weight_block_mixed_16x8_preprocess_blocks;if(!A.has(s))return void self.postMessage({command:"ok"});var i=A.get(s).workerMemAddress,r=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*c.length),o=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*l.length),n=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*t.length),m=new Int32Array(e.buffer);m.set(c,r/Int32Array.BYTES_PER_ELEMENT),m.set(l,o/Int32Array.BYTES_PER_ELEMENT),m.set(t,n/Int32Array.BYTES_PER_ELEMENT),b(r,l.length,o,n,i),d(r),d(o),d(n),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),q.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=g.memory,c=I.shape,l=I.indicesAddress,t=I.bitDepthStarts,s=I.bitDepths,Z=I.metasAddress,d=I.blocksAddress,b=I.xOffset,i=I.xAddress,r=I.yAddress,o=C.aligned_alloc,n=C.free,m=C.pv_picollm_weight_block_mixed_16x8_forward_single;if(!(A.has(Z)&&A.has(d)&&A.has(i)&&A.has(r)&&A.has(l)))return void self.postMessage({command:"ok"});var G=A.get(l).workerMemAddress,a=A.get(Z).workerMemAddress,B=A.get(d).workerMemAddress,y=A.get(i).workerMemAddress,V=A.get(r).workerMemAddress,W=o(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*c.length),u=o(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*t.length),R=o(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*s.length),X=new Int32Array(e.buffer);X.set(c,W/Int32Array.BYTES_PER_ELEMENT),X.set(t,u/Int32Array.BYTES_PER_ELEMENT),X.set(s,R/Int32Array.BYTES_PER_ELEMENT),m(W,G,s.length,u,R,a,B,y+b,V),n(W),n(u),n(R),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),q.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=g.memory,c=I.shape,l=I.indicesAddress,t=I.bitDepthStarts,s=I.bitDepths,Z=I.metasAddress,d=I.blocksAddress,b=I.n,i=I.xOffset,r=I.xAddress,o=I.yAddress,n=C.aligned_alloc,m=C.free,G=C.pv_picollm_weight_block_mixed_16x8_forward_multiple;if(!(A.has(Z)&&A.has(d)&&A.has(r)&&A.has(o)&&A.has(l)))return void self.postMessage({command:"ok"});var a=A.get(l).workerMemAddress,B=A.get(Z).workerMemAddress,y=A.get(d).workerMemAddress,V=A.get(r).workerMemAddress,W=A.get(o).workerMemAddress,u=n(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*c.length),R=n(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*t.length),X=n(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*s.length),h=new Int32Array(e.buffer);h.set(c,u/Int32Array.BYTES_PER_ELEMENT),h.set(t,R/Int32Array.BYTES_PER_ELEMENT),h.set(s,X/Int32Array.BYTES_PER_ELEMENT),G(u,a,s.length,R,X,B,y,b,V+i,W),m(u),m(R),m(X),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),q.WEIGHT_BLOCK_MIXED_16X8_ADD_BIAS,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.dimension,l=I.yAddress,t=I.biasAddress,s=(C.free,C.pv_picollm_weight_block_mixed_16x8_add_bias);if(!A.has(l)||!A.has(t))return void self.postMessage({command:"ok"});s(e,c,A.get(l).workerMemAddress,A.get(t).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}})),q.WEIGHT_FLOAT_FORWARD,(function(I){try{var g=I.globals,C=g.exports,A=g.memAlloc,e=I.n,c=I.nc,l=I.nr,t=I.wAddress,s=I.xOffset,Z=I.xAddress,d=I.yAddress,b=C.pv_picollm_weight_float_forward;if(!A.has(t)||!A.has(Z)||!A.has(d))return void self.postMessage({command:"ok"});b(e,c,l,A.get(t).workerMemAddress,A.get(Z).workerMemAddress+s,A.get(d).workerMemAddress),self.postMessage({command:"ok"})}catch(I){self.postMessage({command:"error",message:I.message})}}));var AI=function(I,g){var C=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var g=e(b.mark((function g(A,e,c,l,t){var s,Z,d,i,r,o,m,G,a,B,y,V,W;return b.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return A=S(A),e=S(e),c=S(c),l=S(l),t=S(t),s=n.aligned_alloc,Z=R.getParser(navigator.userAgent),d=new Uint8Array(I.buffer),i=Z.getBrowserName(),g.next=11,s(Uint8Array.BYTES_PER_ELEMENT,(i.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 11:if(0!==(r=g.sent)){g.next=15;break}return C(t,-1),g.abrupt("return");case 15:for(C(A,r),o=0;o<i.length;o++)d[r+o]=i.charCodeAt(o);return d[r+i.length]=0,m=Z.getBrowserVersion(),g.next=21,s(Uint8Array.BYTES_PER_ELEMENT,(m.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 21:if(0!==(G=g.sent)){g.next=25;break}return C(t,-1),g.abrupt("return");case 25:for(C(e,G),a=0;a<m.length;a++)d[G+a]=m.charCodeAt(a);return d[G+m.length]=0,B=Z.getOSName(),g.next=31,s(Uint8Array.BYTES_PER_ELEMENT,(B.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 31:if(0!==(y=g.sent)){g.next=35;break}return C(t,-1),g.abrupt("return");case 35:for(C(c,y),V=0;V<B.length;V++)d[y+V]=B.charCodeAt(V);d[y+B.length]=0,W=window.navigator.hardwareConcurrency,C(l,W||1),C(t,0);case 41:case"end":return g.stop()}}),g)})));return function(I,C,A,e,c){return g.apply(this,arguments)}}(),c=function(){var I=e(b.mark((function I(A,e,c){var l,t,s,Z,d;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(A=S(A),c=S(c),g){I.next=5;break}return C(c,-1),I.abrupt("return");case 5:l=window.navigator.hardwareConcurrency,t=l&&l<e?l:e,s=[],Z=0;case 9:if(!(Z<t)){I.next=17;break}return d=new U,s.push(d),I.next=14,L(d,{action:N.INIT,wasm:g});case 14:Z++,I.next=9;break;case 17:E.addXpu(A,{deviceMem:new Set,numWorkers:t,workers:s}),C(c,0);case 19:case"end":return I.stop()}}),I)})));return function(g,C,A){return I.apply(this,arguments)}}(),l=function(){var I=e(b.mark((function I(g,A,e,c,l,t){var s,Z,d,i,r,o,n;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=S(g),A=S(A),t=S(t),s=E.getXpu(g)){I.next=7;break}return C(t,-1),I.abrupt("return");case 7:if(Z=0===c?s.numWorkers:c,(d=1===l)||e%Z==0){I.next=13;break}return C(t,-1),console.error("Failed to allocate memory: alloc size ".concat(e," must be divisible by batch ").concat(Z,".")),I.abrupt("return");case 13:i=Math.ceil(e/Z/s.numWorkers)*Z,r=e,o=[],n=0;case 17:if(!(n<s.numWorkers)){I.next=29;break}if(!d){I.next=22;break}o.push(L(s.workers[n],{action:N.ALLOC,size:e,memAddress:A})),I.next=26;break;case 22:if(o.push(L(s.workers[n],{action:N.ALLOC,size:Math.min(r,i),memAddress:A})),!((r-=i)<=0)){I.next=26;break}return I.abrupt("break",29);case 26:n++,I.next=17;break;case 29:return I.next=31,Promise.all(o);case 31:E.addMemory(A,{objAddress:g,isShared:d,allocSize:e,chunkSize:i}),C(t,0);case 33:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l){return I.apply(this,arguments)}}(),t=function(){var I=e(b.mark((function I(g){var C,A,e,c,l;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=S(g),!E.hasMemory(g)){I.next=9;break}for(C=E.getMemory(g),A=C.objAddress,e=E.getXpu(A),c=[],l=0;l<e.numWorkers;l++)c.push(L(e.workers[l],{action:N.FREE,memAddress:g}));return I.next=8,Promise.all(c);case 8:E.removeMemory(g);case 9:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),s=function(){var g=e(b.mark((function g(C,A,e,c){var l,t,s,Z,d,i,r,o,n,m,G,a,B;return b.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=S(C),A=S(A),l=E.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:t=l.objAddress,s=l.isShared,Z=l.chunkSize,d=E.getXpu(t),i=new Uint8Array(I.buffer).slice(A,A+c),r=[],o=c,n=0;case 11:if(!(n<d.numWorkers)){g.next=24;break}if(!s){g.next=16;break}r.push(L(d.workers[n],{action:N.COPY_TO_XPU,memAddress:C,offset:e,buffer:i})),g.next=21;break;case 16:if(m=n*Z,e<(n+1)*Z&&(a=Z-(G=e>m?e-m:0),B=c-o,r.push(L(d.workers[n],{action:N.COPY_TO_XPU,memAddress:C,offset:G,buffer:i.slice(B,B+a)})),o-=a),!(o<=0)){g.next=21;break}return g.abrupt("break",24);case 21:n++,g.next=11;break;case 24:return g.next=26,Promise.all(r);case 26:case"end":return g.stop()}}),g)})));return function(I,C,A,e){return g.apply(this,arguments)}}(),Z=function(){var g=e(b.mark((function g(C,A,e,c){var l,t,s,Z,d,i,r,o,n,m,G,a,B,y,V,W,u;return b.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=S(C),A=S(A),l=E.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:if(t=l.objAddress,s=l.allocSize,Z=l.isShared,d=l.chunkSize,i=E.getXpu(t),r=new Uint8Array(I.buffer),o=[],!Z){g.next=13;break}o.push(L(i.workers[0],{action:N.COPY_FROM_XPU,memAddress:C,offset:e,size:s})),g.next=24;break;case 13:n=s,m=0;case 15:if(!(m<i.numWorkers)){g.next=24;break}if(G=m*d,e<(m+1)*d&&(a=e>G?e-G:0,B=Math.min(n,d-a),o.push(L(i.workers[m],{action:N.COPY_FROM_XPU,memAddress:C,offset:a,size:B})),n-=B),0!==n){g.next=21;break}return g.abrupt("break",24);case 21:m++,g.next=15;break;case 24:return g.next=26,Promise.all(o);case 26:y=g.sent,V=0,W=0;case 29:if(!(W<y.length)){g.next=41;break}if(u=y[W],!(V+u.length>c)){g.next=36;break}return r.set(u.slice(0,c-V),A+V),g.abrupt("break",41);case 36:r.set(u,A+V),V+=u.length;case 38:W++,g.next=29;break;case 41:case"end":return g.stop()}}),g)})));return function(I,C,A,e){return g.apply(this,arguments)}}(),d=function(){var I=e(b.mark((function I(g,C,A){var e,c,l,t,s,Z,d,i,r;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=S(g),e=E.getMemory(g)){I.next=4;break}return I.abrupt("return");case 4:c=e.objAddress,l=e.allocSize,t=e.isShared,s=e.chunkSize,Z=E.getXpu(c),d=[],i=A,r=0;case 9:if(!(r<Z.numWorkers)){I.next=21;break}if(!t){I.next=14;break}d.push(L(Z.workers[r],{action:N.MEMSET,memAddress:g,fillByte:C,size:l})),I.next=18;break;case 14:if(d.push(L(Z.workers[r],{action:N.MEMSET,memAddress:g,fillByte:C,size:Math.min(i,s)})),!((i-=s)<=0)){I.next=18;break}return I.abrupt("break",21);case 18:r++,I.next=9;break;case 21:return I.next=23,Promise.all(d);case 23:case"end":return I.stop()}}),I)})));return function(g,C,A){return I.apply(this,arguments)}}(),i=function(){var I=e(b.mark((function I(g){var A;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:g=S(g),A=window.navigator.hardwareConcurrency,C(g,A||1);case 3:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),r=function(){var I=e(b.mark((function I(g){var C,A,e;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=S(g),C=E.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(A=[],e=0;e<C.numWorkers;e++)A.push(L(C.workers[e],{action:N.TIMER_START,workerIndex:e}));return I.next=8,Promise.all(A);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),o=function(){var I=e(b.mark((function I(g){var C,A,e;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=S(g),C=E.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(A=[],e=0;e<C.numWorkers;e++)A.push(L(C.workers[e],{action:N.TIMER_STOP}));return I.next=8,Promise.all(A);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),n=II(II(II(II(II(II(II(II(II({aligned_alloc:function(I,g){throw new Error("aligned_alloc was not passed in from parent module")},pv_xpu_web_worker_device_info_wasm:A,pv_xpu_web_worker_device_init_wasm:c,pv_xpu_web_worker_device_cleanup_wasm:function(I){I=S(I);var g=E.getXpu(I);if(g){var C,A=gI(g.workers);try{for(A.s();!(C=A.n()).done;){C.value.terminate()}}catch(I){A.e(I)}finally{A.f()}E.removeXpu(I)}},pv_xpu_web_worker_device_mem_alloc_wasm:l,pv_xpu_web_worker_device_mem_free_wasm:t,pv_xpu_web_worker_device_mem_copy_to_xpu_wasm:s,pv_xpu_web_worker_device_mem_copy_from_xpu_wasm:Z,pv_xpu_web_worker_device_mem_memset_wasm:d,pv_xpu_web_worker_get_max_workers_wasm:i,pv_xpu_web_worker_timer_start_wasm:r,pv_xpu_web_worker_timer_stop_wasm:o},function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s){var Z,d,i,r,o,n,m,G,a,B,y;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(Z=E.getXpu(C)){I.next=4;break}return g(s,-1),I.abrupt("return");case 4:if(d=E.getMemory(A)){I.next=8;break}return g(s,-1),I.abrupt("return");case 8:i=Z.numWorkers,r=d.chunkSize/(l/2),o=c,n=[],m=0;case 13:if(!(m<i)){I.next=21;break}if(n.push(L(Z.workers[m],{action:N.MATRIX_VECTOR_MULTIPLY,matrixAddress:A,vectorAddress:e,m:Math.min(o,r),n:l,resultAddress:t})),!((o-=r)<=0)){I.next=18;break}return I.abrupt("break",21);case 18:m++,I.next=13;break;case 21:return G=new Float32Array(l),I.next=24,Promise.all(n);case 24:for(a=I.sent,B=0;B<a.length;B++)a[B].length>0&&G.set(a[B],B*r);for(n=[],y=0;y<i;y++)n.push(L(Z.workers[y],{action:N.SYNC_VECTOR,vectorAddress:t,buffer:G}));return I.next=30,Promise.all(n);case 30:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t){return I.apply(this,arguments)}}();return{pv_matrix_vector_multiply_web_worker_wasm:C}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l,t){var s,Z,d;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),A=S(A),t=S(t),s=E.getXpu(C)){I.next=7;break}return g(t,-1),I.abrupt("return");case 7:for(Z=[],d=0;d<s.numWorkers;d++)Z.push(L(s.workers[d],{action:x.ATTENTION_PRECOMPUTE_ENCODING,encodingAddress:A,dimension:e,steps:c,theta:l}));return I.next=11,Promise.all(Z);case 11:g(t,0);case 12:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l){return I.apply(this,arguments)}}(),A=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i){var r,o,n;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),A=S(A),e=S(e),i=S(i),r=E.getXpu(C)){I.next=8;break}return g(i,-1),I.abrupt("return");case 8:for(o=[],n=0;n<r.numWorkers;n++)o.push(L(r.workers[n],{action:x.ATTENTION_ENCODE,xAddress:A,newEncodingAddress:e,n:c,numHeads:l,ropeInterleaved:t,headDimension:s,ropeDimension:Z,position:d}));return I.next=12,Promise.all(o);case 12:g(i,0);case 13:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d){return I.apply(this,arguments)}}(),c=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i,r,o,n,m,G,a){var B,y,V;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),t=S(t),s=S(s),Z=S(Z),d=S(d),i=S(i),r=S(r),n=S(n),G=S(G),a=S(a),B=E.getXpu(C)){I.next=14;break}return g(a,-1),I.abrupt("return");case 14:for(y=[],V=0;V<B.numWorkers;V++)y.push(L(B.workers[V],{action:x.ATTENTION_ATTEND,numHeads:A,numKvHeads:e,windowLength:c,headDimension:l,keysAddress:t,keyInterceptsAddress:s,keySlopesAddress:Z,valuesAddress:d,valueInterceptsAddress:i,valueSlopesAddress:r,position:o,queryAddress:n,n:m,outputAddress:G}));return I.next=18,Promise.all(y);case 18:g(a,0);case 19:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d,b,i,r,o,n,m){return I.apply(this,arguments)}}(),l=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i,r){var o,n,m;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),l=S(l),t=S(t),s=S(s),i=S(i),r=S(r),o=E.getXpu(C)){I.next=10;break}return g(r,-1),I.abrupt("return");case 10:for(n=[],m=0;m<o.numWorkers;m++)n.push(L(o.workers[m],{action:x.ATTENTION_UPDATE_KEYS,numKvHeads:A,windowLength:e,headDimension:c,keysAddress:l,keyInterceptsAddress:t,keySlopesAddress:s,position:Z,n:d,tfAddress:i}));return I.next=14,Promise.all(n);case 14:g(r,0);case 15:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d,b){return I.apply(this,arguments)}}(),t=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i,r){var o,n,m;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),l=S(l),t=S(t),s=S(s),i=S(i),r=S(r),o=E.getXpu(C)){I.next=10;break}return g(r,-1),I.abrupt("return");case 10:for(n=[],m=0;m<o.numWorkers;m++)n.push(L(o.workers[m],{action:x.ATTENTION_UPDATE_VALUES,numKvHeads:A,windowLength:e,headDimension:c,valuesAddress:l,valueInterceptsAddress:t,valueSlopesAddress:s,position:Z,n:d,tfAddress:i}));return I.next=14,Promise.all(n);case 14:g(r,0);case 15:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d,b){return I.apply(this,arguments)}}(),s=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s){var Z,d,i;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),s=S(s),Z=E.getXpu(C)){I.next=7;break}return I.abrupt("return");case 7:for(d=[],i=0;i<Z.numWorkers;i++)d.push(L(Z.workers[i],{action:x.ATTENTION_TRANSPOSE_QUERY,n:A,tfAddress:e,hfAddress:c,numHeads:l,headDimension:t}));return I.next=11,Promise.all(d);case 11:g(s,0);case 12:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t){return I.apply(this,arguments)}}();return{pv_picollm_attention_precompute_encoding_web_worker_wasm:C,pv_picollm_attention_encode_web_worker_wasm:A,pv_picollm_attention_attend_web_worker_wasm:c,pv_picollm_attention_update_keys_web_worker_wasm:l,pv_picollm_attention_update_values_web_worker_wasm:t,pv_picollm_attention_transpose_query_web_worker_wasm:s}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c){var l,t,s;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=E.getXpu(C)){I.next=7;break}return g(c,-1),I.abrupt("return");case 7:for(t=[],s=0;s<l.numWorkers;s++)t.push(L(l.workers[s],{action:T.FEED_FORWARD_SILU,n:A,xAddress:e}));return I.next=11,Promise.all(t);case 11:g(c,0);case 12:case"end":return I.stop()}}),I)})));return function(g,C,A,e){return I.apply(this,arguments)}}(),A=function(){var I=e(b.mark((function I(C,A,e,c){var l,t,s;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=E.getXpu(C)){I.next=7;break}return g(c,-1),I.abrupt("return");case 7:for(t=[],s=0;s<l.numWorkers;s++)t.push(L(l.workers[s],{action:T.FEED_FORWARD_GELU,n:A,xAddress:e}));return I.next=11,Promise.all(t);case 11:g(c,0);case 12:case"end":return I.stop()}}),I)})));return function(g,C,A,e){return I.apply(this,arguments)}}(),c=function(){var I=e(b.mark((function I(C,A,e,c){var l,t,s;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=E.getXpu(C)){I.next=6;break}return I.abrupt("return");case 6:for(t=[],s=0;s<l.numWorkers;s++)t.push(L(l.workers[s],{action:T.FEED_FORWARD_ALMOST_GELU,n:A,xAddress:e}));return I.next=10,Promise.all(t);case 10:g(c,0);case 11:case"end":return I.stop()}}),I)})));return function(g,C,A,e){return I.apply(this,arguments)}}(),l=function(){var I=e(b.mark((function I(C,A,e,c,l){var t,s,Z;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=S(l),t=E.getXpu(C)){I.next=8;break}return g(l,-1),I.abrupt("return");case 8:for(s=[],Z=0;Z<t.numWorkers;Z++)s.push(L(t.workers[Z],{action:T.FEED_FORWARD_MULTIPLY_BUFFERS,n:A,xAddress:e,yAddress:c}));return I.next=12,Promise.all(s);case 12:g(l,0);case 13:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c){return I.apply(this,arguments)}}();return{pv_picollm_feed_forward_silu_web_worker_wasm:C,pv_picollm_feed_forward_gelu_web_worker_wasm:A,pv_picollm_feed_forward_almost_gelu_web_worker_wasm:c,pv_picollm_feed_forward_multiply_buffers_web_worker_wasm:l}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z){var d,i,r;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),l=S(l),t=S(t),s=S(s),Z=S(Z),d=E.getXpu(C)){I.next=9;break}return g(Z,-1),I.abrupt("return");case 9:for(i=[],r=0;r<d.numWorkers;r++)i.push(L(d.workers[r],{action:D.GATE_FORWARD,n:A,k:e,numExperts:c,indicesAddress:l,weightsAddress:t,yAddress:s}));return I.next=13,Promise.all(i);case 13:g(Z,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s){return I.apply(this,arguments)}}();return{pv_picollm_gate_forward_web_worker_wasm:C}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l){var t,s,Z;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=S(l),t=E.getXpu(C)){I.next=8;break}return g(l,-1),I.abrupt("return");case 8:for(s=[],Z=0;Z<t.numWorkers;Z++)s.push(L(t.workers[Z],{action:P.ADD_TO_BUFFER,n:A,xAddress:e,bufferAddress:c}));return I.next=12,Promise.all(s);case 12:g(l,0);case 13:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c){return I.apply(this,arguments)}}(),A=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z){var d,i,r;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),l=S(l),t=S(t),s=S(s),Z=S(Z),d=E.getXpu(C)){I.next=9;break}return g(Z,-1),I.abrupt("return");case 9:for(i=[],r=0;r<d.numWorkers;r++)i.push(L(d.workers[r],{action:P.MULTIPLY_WEIGHT_AND_ADD_TO_BUFFER,n:A,weightsIndex:e,yIndex:c,weightsAddress:l,xAddress:t,yAddress:s}));return I.next=13,Promise.all(i);case 13:g(Z,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s){return I.apply(this,arguments)}}(),c=function(){var I=e(b.mark((function I(C,A,e,c,l,t){var s,Z,d;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=S(l),t=S(t),s=E.getXpu(C)){I.next=9;break}return g(t,-1),I.abrupt("return");case 9:for(Z=[],d=0;d<s.numWorkers;d++)Z.push(L(s.workers[d],{action:P.ADD_BUFFERS,n:A,buffer1Address:e,buffer2Address:c,yAddress:l}));return I.next=13,Promise.all(Z);case 13:g(t,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l){return I.apply(this,arguments)}}();return{pv_picollm_moe_transformer_add_to_buffer_web_worker_wasm:C,pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer_web_worker_wasm:A,pv_picollm_moe_transformer_add_buffers_web_worker_wasm:c}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i){var r,o,n;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),c=S(c),s=S(s),d=S(d),i=S(i),r=E.getXpu(C)){I.next=9;break}return g(i,-1),I.abrupt("return");case 9:for(o=[],n=0;n<r.numWorkers;n++)o.push(L(r.workers[n],{action:O.NORM_FORWARD,dimension:A,eps:e,weightAddress:c,n:l,xOffset:t,xAddress:s,yOffset:Z,yAddress:d}));return I.next=13,Promise.all(o);case 13:g(i,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d){return I.apply(this,arguments)}}();return{pv_picollm_norm_forward_web_worker_wasm:C}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d,i,r){var o,n,m;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),c=S(c),l=S(l),Z=S(Z),i=S(i),r=S(r),o=E.getXpu(C)){I.next=10;break}return g(r,-1),I.abrupt("return");case 10:for(n=[],m=0;m<o.numWorkers;m++)n.push(L(o.workers[m],{action:_.NORM_LAYER_FORWARD,dimension:A,eps:e,weightAddress:c,biasAddress:l,n:t,xOffset:s,xAddress:Z,yOffset:d,yAddress:i}));return I.next=14,Promise.all(n);case 14:g(r,0);case 15:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z,d,b){return I.apply(this,arguments)}}();return{pv_picollm_norm_layer_forward_web_worker_wasm:C}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=e(b.mark((function I(C,A,e,c,l){var t,s,Z;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=S(l),t=E.getXpu(C)){I.next=8;break}return g(l,-1),I.abrupt("return");case 8:for(s=[],Z=0;Z<t.numWorkers;Z++)s.push(L(t.workers[Z],{action:j.ADD_TO_BUFFER,n:A,xAddress:e,bufferAddress:c}));return I.next=12,Promise.all(s);case 12:g(l,0);case 13:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c){return I.apply(this,arguments)}}(),A=function(){var I=e(b.mark((function I(C,A,e,c,l,t){var s,Z,d;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),e=S(e),c=S(c),l=S(l),t=S(t),s=E.getXpu(C)){I.next=9;break}return g(t,-1),I.abrupt("return");case 9:for(Z=[],d=0;d<s.numWorkers;d++)Z.push(L(s.workers[d],{action:j.ADD_BUFFERS,n:A,buffer1Address:e,buffer2Address:c,yAddress:l}));return I.next=13,Promise.all(Z);case 13:g(t,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l){return I.apply(this,arguments)}}();return{pv_picollm_transformer_add_to_buffer_web_worker_wasm:C,pv_picollm_transformer_add_buffers_web_worker_wasm:A}}(I)),function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var C=e(b.mark((function C(A,e,c,l,t,s,Z,d){var i,r,o,n,m,G,a;return b.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:if(A=S(A),e=S(e),l=S(l),t=S(t),Z=S(Z),d=S(d),i=E.getXpu(A)){C.next=10;break}return g(d,-1),C.abrupt("return");case 10:for(r=new Int32Array(I.buffer),o=r.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),n=r.slice(l/Int32Array.BYTES_PER_ELEMENT,l/Int32Array.BYTES_PER_ELEMENT+c),m=r.slice(t/Int32Array.BYTES_PER_ELEMENT,t/Int32Array.BYTES_PER_ELEMENT+c),G=[],a=0;a<i.numWorkers;a++)G.push(L(i.workers[a],{action:q.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,shape:o,bitDepths:n,bitDepthStarts:m,numBlockBytes:s,blocksAddress:Z}));return C.next=18,Promise.all(G);case 18:g(d,0);case 19:case"end":return C.stop()}}),C)})));return function(I,g,A,e,c,l,t,s){return C.apply(this,arguments)}}(),A=function(){var C=e(b.mark((function C(A,e,c,l,t,s,Z,d,i,r,o,n,m,G){var a,B,y,V,W,u,R;return b.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:if(A=S(A),e=S(e),c=S(c),t=S(t),s=S(s),d=S(d),r=S(r),n=S(n),m=S(m),G=S(G),a=E.getXpu(A)){C.next=14;break}return g(G,-1),C.abrupt("return");case 14:for(B=new Int32Array(I.buffer),y=B.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),V=B.slice(t/Int32Array.BYTES_PER_ELEMENT,t/Int32Array.BYTES_PER_ELEMENT+l),W=B.slice(s/Int32Array.BYTES_PER_ELEMENT,s/Int32Array.BYTES_PER_ELEMENT+l),u=[],R=0;R<a.numWorkers;R++)u.push(L(a.workers[R],{action:q.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,shape:y,indicesAddress:c,bitDepthStarts:V,bitDepths:W,numMetas:Z,metasAddress:d,numBlockBytes:i,blocksAddress:r,xOffset:o,xAddress:n,yAddress:m}));return C.next=22,Promise.all(u);case 22:g(G,0);case 23:case"end":return C.stop()}}),C)})));return function(I,g,A,e,c,l,t,s,Z,d,b,i,r,o){return C.apply(this,arguments)}}(),c=function(){var C=e(b.mark((function C(A,e,c,l,t,s,Z,d,i,r,o,n,m,G,a){var B,y,V,W,u,R,X;return b.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:if(A=S(A),e=S(e),c=S(c),t=S(t),s=S(s),d=S(d),r=S(r),m=S(m),G=S(G),a=S(a),B=E.getXpu(A)){C.next=14;break}return g(a,-1),C.abrupt("return");case 14:for(y=new Int32Array(I.buffer),V=y.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),W=y.slice(t/Int32Array.BYTES_PER_ELEMENT,t/Int32Array.BYTES_PER_ELEMENT+l),u=y.slice(s/Int32Array.BYTES_PER_ELEMENT,s/Int32Array.BYTES_PER_ELEMENT+l),R=[],X=0;X<B.numWorkers;X++)R.push(L(B.workers[X],{action:q.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,shape:V,indicesAddress:c,bitDepthStarts:W,bitDepths:u,numMetas:Z,metasAddress:d,numBlockBytes:i,blocksAddress:r,n:o,xOffset:n,xAddress:m,yAddress:G}));return C.next=22,Promise.all(R);case 22:g(a,0);case 23:case"end":return C.stop()}}),C)})));return function(I,g,A,e,c,l,t,s,Z,d,b,i,r,o,n){return C.apply(this,arguments)}}(),l=function(){var I=e(b.mark((function I(C,A,e,c,l,t){var s,Z,d;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),c=S(c),l=S(l),t=S(t),s=E.getXpu(C)){I.next=8;break}return g(t,-1),I.abrupt("return");case 8:for(Z=[],d=0;d<s.numWorkers;d++)Z.push(L(s.workers[d],{action:q.WEIGHT_BLOCK_MIXED_16X8_ADD_BIAS,n:A,dimension:e,yAddress:c,biasAddress:l}));return I.next=12,Promise.all(Z);case 12:g(t,0);case 13:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l){return I.apply(this,arguments)}}(),t=function(){var I=e(b.mark((function I(C,A,e,c,l,t,s,Z,d){var i,r,o;return b.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=S(C),l=S(l),s=S(s),Z=S(Z),d=S(d),i=E.getXpu(C)){I.next=9;break}return g(d,-1),I.abrupt("return");case 9:for(r=[],o=0;o<i.numWorkers;o++)r.push(L(i.workers[o],{action:q.WEIGHT_FLOAT_FORWARD,n:A,nc:e,nr:c,wAddress:l,xOffset:t,xAddress:s,yAddress:Z}));return I.next=13,Promise.all(r);case 13:g(d,0);case 14:case"end":return I.stop()}}),I)})));return function(g,C,A,e,c,l,t,s,Z){return I.apply(this,arguments)}}();return{pv_picollm_weight_block_mixed_16x8_preprocess_blocks_web_worker_wasm:C,pv_picollm_weight_block_mixed_16x8_forward_single_web_worker_wasm:A,pv_picollm_weight_block_mixed_16x8_forward_multiple_web_worker_wasm:c,pv_picollm_weight_block_mixed_16x8_add_bias_web_worker_wasm:l,pv_picollm_weight_float_forward_web_worker_wasm:t}}(I));return n};export{AI as default};
