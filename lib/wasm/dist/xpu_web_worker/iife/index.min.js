var XpuWebWorker=function(){"use strict";function I(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}function g(g,C){if(g){if("string"==typeof g)return I(g,C);var e=Object.prototype.toString.call(g).slice(8,-1);return"Object"===e&&g.constructor&&(e=g.constructor.name),"Map"===e||"Set"===e?Array.from(g):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?I(g,C):void 0}}function C(I,C){return function(I){if(Array.isArray(I))return I}(I)||function(I,g){var C=null==I?null:"undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(null!=C){var e,A,t,r,c=[],i=!0,n=!1;try{if(t=(C=C.call(I)).next,0===g){if(Object(C)!==C)return;i=!1}else for(;!(i=(e=t.call(C)).done)&&(c.push(e.value),c.length!==g);i=!0);}catch(I){n=!0,A=I}finally{try{if(!i&&null!=C.return&&(r=C.return(),Object(r)!==r))return}finally{if(n)throw A}}return c}}(I,C)||g(I,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(I){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},e(I)}function A(I){var g=function(I,g){if("object"!=e(I)||!I)return I;var C=I[Symbol.toPrimitive];if(void 0!==C){var A=C.call(I,g||"default");if("object"!=e(A))return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(I)}(I,"string");return"symbol"==e(g)?g:String(g)}function t(I,g,C){return(g=A(g))in I?Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):I[g]=C,I}function r(I,g,C,e,A,t,r){try{var c=I[t](r),i=c.value}catch(I){return void C(I)}c.done?g(i):Promise.resolve(i).then(e,A)}function c(I){return function(){var g=this,C=arguments;return new Promise((function(e,A){var t=I.apply(g,C);function c(I){r(t,e,A,c,i,"next",I)}function i(I){r(t,e,A,c,i,"throw",I)}c(void 0)}))}}function i(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}var n={exports:{}},l={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(l);var o=l.exports;!function(I){var g=o.default;function C(){I.exports=C=function(){return A},I.exports.__esModule=!0,I.exports.default=I.exports;var e,A={},t=Object.prototype,r=t.hasOwnProperty,c=Object.defineProperty||function(I,g,C){I[g]=C.value},i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{s({},"")}catch(e){s=function(I,g,C){return I[g]=C}}function a(I,g,C,e){var A=g&&g.prototype instanceof y?g:y,t=Object.create(A.prototype),r=new f(e||[]);return c(t,"_invoke",{value:k(I,C,r)}),t}function d(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}A.wrap=a;var b="suspendedStart",Z="suspendedYield",m="executing",u="completed",B={};function y(){}function G(){}function V(){}var h={};s(h,n,(function(){return this}));var W=Object.getPrototypeOf,R=W&&W(W(F([])));R&&R!==t&&r.call(R,n)&&(h=R);var p=V.prototype=y.prototype=Object.create(h);function X(I){["next","throw","return"].forEach((function(g){s(I,g,(function(I){return this._invoke(g,I)}))}))}function H(I,C){function e(A,t,c,i){var n=d(I[A],I,t);if("throw"!==n.type){var l=n.arg,o=l.value;return o&&"object"==g(o)&&r.call(o,"__await")?C.resolve(o.__await).then((function(I){e("next",I,c,i)}),(function(I){e("throw",I,c,i)})):C.resolve(o).then((function(I){l.value=I,c(l)}),(function(I){return e("throw",I,c,i)}))}i(n.arg)}var A;c(this,"_invoke",{value:function(I,g){function t(){return new C((function(C,A){e(I,g,C,A)}))}return A=A?A.then(t,t):t()}})}function k(I,g,C){var A=b;return function(t,r){if(A===m)throw new Error("Generator is already running");if(A===u){if("throw"===t)throw r;return{value:e,done:!0}}for(C.method=t,C.arg=r;;){var c=C.delegate;if(c){var i=S(c,C);if(i){if(i===B)continue;return i}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(A===b)throw A=u,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);A=m;var n=d(I,g,C);if("normal"===n.type){if(A=C.done?u:Z,n.arg===B)continue;return{value:n.arg,done:C.done}}"throw"===n.type&&(A=u,C.method="throw",C.arg=n.arg)}}}function S(I,g){var C=g.method,A=I.iterator[C];if(A===e)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=e,S(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var t=d(A,I.iterator,g.arg);if("throw"===t.type)return g.method="throw",g.arg=t.arg,g.delegate=null,B;var r=t.arg;return r?r.done?(g[I.resultName]=r.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=e),g.delegate=null,B):r:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function J(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function w(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function f(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(J,this),this.reset(!0)}function F(I){if(I||""===I){var C=I[n];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var A=-1,t=function g(){for(;++A<I.length;)if(r.call(I,A))return g.value=I[A],g.done=!1,g;return g.value=e,g.done=!0,g};return t.next=t}}throw new TypeError(g(I)+" is not iterable")}return G.prototype=V,c(p,"constructor",{value:V,configurable:!0}),c(V,"constructor",{value:G,configurable:!0}),G.displayName=s(V,o,"GeneratorFunction"),A.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===G||"GeneratorFunction"===(g.displayName||g.name))},A.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,V):(I.__proto__=V,s(I,o,"GeneratorFunction")),I.prototype=Object.create(p),I},A.awrap=function(I){return{__await:I}},X(H.prototype),s(H.prototype,l,(function(){return this})),A.AsyncIterator=H,A.async=function(I,g,C,e,t){void 0===t&&(t=Promise);var r=new H(a(I,g,C,e),t);return A.isGeneratorFunction(g)?r:r.next().then((function(I){return I.done?I.value:r.next()}))},X(p),s(p,o,"Generator"),s(p,n,(function(){return this})),s(p,"toString",(function(){return"[object Generator]"})),A.keys=function(I){var g=Object(I),C=[];for(var e in g)C.push(e);return C.reverse(),function I(){for(;C.length;){var e=C.pop();if(e in g)return I.value=e,I.done=!1,I}return I.done=!0,I}},A.values=F,f.prototype={constructor:f,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!I)for(var g in this)"t"===g.charAt(0)&&r.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=e)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,A){return c.type="throw",c.arg=I,g.next=C,A&&(g.method="next",g.arg=e),!!A}for(var A=this.tryEntries.length-1;A>=0;--A){var t=this.tryEntries[A],c=t.completion;if("root"===t.tryLoc)return C("end");if(t.tryLoc<=this.prev){var i=r.call(t,"catchLoc"),n=r.call(t,"finallyLoc");if(i&&n){if(this.prev<t.catchLoc)return C(t.catchLoc,!0);if(this.prev<t.finallyLoc)return C(t.finallyLoc)}else if(i){if(this.prev<t.catchLoc)return C(t.catchLoc,!0)}else{if(!n)throw new Error("try statement without catch or finally");if(this.prev<t.finallyLoc)return C(t.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var e=this.tryEntries[C];if(e.tryLoc<=this.prev&&r.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var A=e;break}}A&&("break"===I||"continue"===I)&&A.tryLoc<=g&&g<=A.finallyLoc&&(A=null);var t=A?A.completion:{};return t.type=I,t.arg=g,A?(this.method="next",this.next=A.finallyLoc,B):this.complete(t)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),w(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var e=C.completion;if("throw"===e.type){var A=e.arg;w(C)}return A}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:F(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=e),B}},A}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(n);var s=(0,n.exports)(),a=s;try{regeneratorRuntime=s}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}var d=i(a);const b={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Z={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},m={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},u={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},B={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class y{static getFirstMatch(I,g){const C=g.match(I);return C&&C.length>0&&C[1]||""}static getSecondMatch(I,g){const C=g.match(I);return C&&C.length>1&&C[2]||""}static matchAndReturnConst(I,g,C){if(I.test(g))return C}static getWindowsVersionName(I){switch(I){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),10===g[0])switch(g[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(I){const g=I.split(".").splice(0,2).map((I=>parseInt(I,10)||0));if(g.push(0),!(1===g[0]&&g[1]<5))return 1===g[0]&&g[1]<6?"Cupcake":1===g[0]&&g[1]>=6?"Donut":2===g[0]&&g[1]<2?"Eclair":2===g[0]&&2===g[1]?"Froyo":2===g[0]&&g[1]>2?"Gingerbread":3===g[0]?"Honeycomb":4===g[0]&&g[1]<1?"Ice Cream Sandwich":4===g[0]&&g[1]<4?"Jelly Bean":4===g[0]&&g[1]>=4?"KitKat":5===g[0]?"Lollipop":6===g[0]?"Marshmallow":7===g[0]?"Nougat":8===g[0]?"Oreo":9===g[0]?"Pie":void 0}static getVersionPrecision(I){return I.split(".").length}static compareVersions(I,g,C=!1){const e=y.getVersionPrecision(I),A=y.getVersionPrecision(g);let t=Math.max(e,A),r=0;const c=y.map([I,g],(I=>{const g=t-y.getVersionPrecision(I),C=I+new Array(g+1).join(".0");return y.map(C.split("."),(I=>new Array(20-I.length).join("0")+I)).reverse()}));for(C&&(r=t-Math.min(e,A)),t-=1;t>=r;){if(c[0][t]>c[1][t])return 1;if(c[0][t]===c[1][t]){if(t===r)return 0;t-=1}else if(c[0][t]<c[1][t])return-1}}static map(I,g){const C=[];let e;if(Array.prototype.map)return Array.prototype.map.call(I,g);for(e=0;e<I.length;e+=1)C.push(g(I[e]));return C}static find(I,g){let C,e;if(Array.prototype.find)return Array.prototype.find.call(I,g);for(C=0,e=I.length;C<e;C+=1){const e=I[C];if(g(e,C))return e}}static assign(I,...g){const C=I;let e,A;if(Object.assign)return Object.assign(I,...g);for(e=0,A=g.length;e<A;e+=1){const I=g[e];if("object"==typeof I&&null!==I){Object.keys(I).forEach((g=>{C[g]=I[g]}))}}return I}static getBrowserAlias(I){return b[I]}static getBrowserTypeByAlias(I){return Z[I]||""}}const G=/version\/(\d+(\.?_?\d+)+)/i,V=[{test:[/googlebot/i],describe(I){const g={name:"Googlebot"},C=y.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/opera/i],describe(I){const g={name:"Opera"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opr\/|opios/i],describe(I){const g={name:"Opera"},C=y.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/SamsungBrowser/i],describe(I){const g={name:"Samsung Internet for Android"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Whale/i],describe(I){const g={name:"NAVER Whale Browser"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MZBrowser/i],describe(I){const g={name:"MZ Browser"},C=y.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/focus/i],describe(I){const g={name:"Focus"},C=y.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/swing/i],describe(I){const g={name:"Swing"},C=y.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/coast/i],describe(I){const g={name:"Opera Coast"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(I){const g={name:"Opera Touch"},C=y.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/yabrowser/i],describe(I){const g={name:"Yandex Browser"},C=y.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/ucbrowser/i],describe(I){const g={name:"UC Browser"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/Maxthon|mxios/i],describe(I){const g={name:"Maxthon"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/epiphany/i],describe(I){const g={name:"Epiphany"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/puffin/i],describe(I){const g={name:"Puffin"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sleipnir/i],describe(I){const g={name:"Sleipnir"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/k-meleon/i],describe(I){const g={name:"K-Meleon"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/micromessenger/i],describe(I){const g={name:"WeChat"},C=y.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/qqbrowser/i],describe(I){const g={name:/qqbrowserlite/i.test(I)?"QQ Browser Lite":"QQ Browser"},C=y.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/msie|trident/i],describe(I){const g={name:"Internet Explorer"},C=y.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/\sedg\//i],describe(I){const g={name:"Microsoft Edge"},C=y.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/edg([ea]|ios)/i],describe(I){const g={name:"Microsoft Edge"},C=y.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/vivaldi/i],describe(I){const g={name:"Vivaldi"},C=y.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/seamonkey/i],describe(I){const g={name:"SeaMonkey"},C=y.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/sailfish/i],describe(I){const g={name:"Sailfish"},C=y.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,I);return C&&(g.version=C),g}},{test:[/silk/i],describe(I){const g={name:"Amazon Silk"},C=y.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/phantom/i],describe(I){const g={name:"PhantomJS"},C=y.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/slimerjs/i],describe(I){const g={name:"SlimerJS"},C=y.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g={name:"BlackBerry"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(web|hpw)[o0]s/i],describe(I){const g={name:"WebOS Browser"},C=y.getFirstMatch(G,I)||y.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/bada/i],describe(I){const g={name:"Bada"},C=y.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/tizen/i],describe(I){const g={name:"Tizen"},C=y.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/qupzilla/i],describe(I){const g={name:"QupZilla"},C=y.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/firefox|iceweasel|fxios/i],describe(I){const g={name:"Firefox"},C=y.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/electron/i],describe(I){const g={name:"Electron"},C=y.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/MiuiBrowser/i],describe(I){const g={name:"Miui"},C=y.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/chromium/i],describe(I){const g={name:"Chromium"},C=y.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,I)||y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/chrome|crios|crmo/i],describe(I){const g={name:"Chrome"},C=y.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/GSA/i],describe(I){const g={name:"Google Search"},C=y.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g={name:"Android Browser"},C=y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/playstation 4/i],describe(I){const g={name:"PlayStation 4"},C=y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/safari|applewebkit/i],describe(I){const g={name:"Safari"},C=y.getFirstMatch(G,I);return C&&(g.version=C),g}},{test:[/.*/i],describe(I){const g=-1!==I.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:y.getFirstMatch(g,I),version:y.getSecondMatch(g,I)}}}];var h=[{test:[/Roku\/DVP/],describe(I){const g=y.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,I);return{name:u.Roku,version:g}}},{test:[/windows phone/i],describe(I){const g=y.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,I);return{name:u.WindowsPhone,version:g}}},{test:[/windows /i],describe(I){const g=y.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,I),C=y.getWindowsVersionName(g);return{name:u.Windows,version:g,versionName:C}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(I){const g={name:u.iOS},C=y.getSecondMatch(/(Version\/)(\d[\d.]+)/,I);return C&&(g.version=C),g}},{test:[/macintosh/i],describe(I){const g=y.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,I).replace(/[_\s]/g,"."),C=y.getMacOSVersionName(g),e={name:u.MacOS,version:g};return C&&(e.versionName=C),e}},{test:[/(ipod|iphone|ipad)/i],describe(I){const g=y.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,I).replace(/[_\s]/g,".");return{name:u.iOS,version:g}}},{test(I){const g=!I.test(/like android/i),C=I.test(/android/i);return g&&C},describe(I){const g=y.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,I),C=y.getAndroidVersionName(g),e={name:u.Android,version:g};return C&&(e.versionName=C),e}},{test:[/(web|hpw)[o0]s/i],describe(I){const g=y.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,I),C={name:u.WebOS};return g&&g.length&&(C.version=g),C}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(I){const g=y.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,I)||y.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,I)||y.getFirstMatch(/\bbb(\d+)/i,I);return{name:u.BlackBerry,version:g}}},{test:[/bada/i],describe(I){const g=y.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,I);return{name:u.Bada,version:g}}},{test:[/tizen/i],describe(I){const g=y.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,I);return{name:u.Tizen,version:g}}},{test:[/linux/i],describe:()=>({name:u.Linux})},{test:[/CrOS/],describe:()=>({name:u.ChromeOS})},{test:[/PlayStation 4/],describe(I){const g=y.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,I);return{name:u.PlayStation4,version:g}}}],W=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(I){const g=y.getFirstMatch(/(can-l01)/i,I)&&"Nova",C={type:m.mobile,vendor:"Huawei"};return g&&(C.model=g),C}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:m.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:m.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:m.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:m.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:m.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:m.tablet})},{test(I){const g=I.test(/ipod|iphone/i),C=I.test(/like (ipod|iphone)/i);return g&&!C},describe(I){const g=y.getFirstMatch(/(ipod|iphone)/i,I);return{type:m.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:m.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:m.mobile})},{test:I=>"blackberry"===I.getBrowserName(!0),describe:()=>({type:m.mobile,vendor:"BlackBerry"})},{test:I=>"bada"===I.getBrowserName(!0),describe:()=>({type:m.mobile})},{test:I=>"windows phone"===I.getBrowserName(),describe:()=>({type:m.mobile,vendor:"Microsoft"})},{test(I){const g=Number(String(I.getOSVersion()).split(".")[0]);return"android"===I.getOSName(!0)&&g>=3},describe:()=>({type:m.tablet})},{test:I=>"android"===I.getOSName(!0),describe:()=>({type:m.mobile})},{test:I=>"macos"===I.getOSName(!0),describe:()=>({type:m.desktop,vendor:"Apple"})},{test:I=>"windows"===I.getOSName(!0),describe:()=>({type:m.desktop})},{test:I=>"linux"===I.getOSName(!0),describe:()=>({type:m.desktop})},{test:I=>"playstation 4"===I.getOSName(!0),describe:()=>({type:m.tv})},{test:I=>"roku"===I.getOSName(!0),describe:()=>({type:m.tv})}],R=[{test:I=>"microsoft edge"===I.getBrowserName(!0),describe(I){if(/\sedg\//i.test(I))return{name:B.Blink};const g=y.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,I);return{name:B.EdgeHTML,version:g}}},{test:[/trident/i],describe(I){const g={name:B.Trident},C=y.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:I=>I.test(/presto/i),describe(I){const g={name:B.Presto},C=y.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test(I){const g=I.test(/gecko/i),C=I.test(/like gecko/i);return g&&!C},describe(I){const g={name:B.Gecko},C=y.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:B.Blink})},{test:[/(apple)?webkit/i],describe(I){const g={name:B.WebKit},C=y.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,I);return C&&(g.version=C),g}}];class p{constructor(I,g=!1){if(null==I||""===I)throw new Error("UserAgent parameter can't be empty");this._ua=I,this.parsedResult={},!0!==g&&this.parse()}getUA(){return this._ua}test(I){return I.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const I=y.find(V,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.browser=I.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(I){return I?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const I=y.find(h,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.os=I.describe(this.getUA())),this.parsedResult.os}getOSName(I){const{name:g}=this.getOS();return I?String(g).toLowerCase()||"":g||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(I=!1){const{type:g}=this.getPlatform();return I?String(g).toLowerCase()||"":g||""}parsePlatform(){this.parsedResult.platform={};const I=y.find(W,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.platform=I.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(I){return I?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const I=y.find(R,(I=>{if("function"==typeof I.test)return I.test(this);if(I.test instanceof Array)return I.test.some((I=>this.test(I)));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.engine=I.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return y.assign({},this.parsedResult)}satisfies(I){const g={};let C=0;const e={};let A=0;if(Object.keys(I).forEach((t=>{const r=I[t];"string"==typeof r?(e[t]=r,A+=1):"object"==typeof r&&(g[t]=r,C+=1)})),C>0){const I=Object.keys(g),C=y.find(I,(I=>this.isOS(I)));if(C){const I=this.satisfies(g[C]);if(void 0!==I)return I}const e=y.find(I,(I=>this.isPlatform(I)));if(e){const I=this.satisfies(g[e]);if(void 0!==I)return I}}if(A>0){const I=Object.keys(e),g=y.find(I,(I=>this.isBrowser(I,!0)));if(void 0!==g)return this.compareVersion(e[g])}}isBrowser(I,g=!1){const C=this.getBrowserName().toLowerCase();let e=I.toLowerCase();const A=y.getBrowserTypeByAlias(e);return g&&A&&(e=A.toLowerCase()),e===C}compareVersion(I){let g=[0],C=I,e=!1;const A=this.getBrowserVersion();if("string"==typeof A)return">"===I[0]||"<"===I[0]?(C=I.substr(1),"="===I[1]?(e=!0,C=I.substr(2)):g=[],">"===I[0]?g.push(1):g.push(-1)):"="===I[0]?C=I.substr(1):"~"===I[0]&&(e=!0,C=I.substr(1)),g.indexOf(y.compareVersions(A,C,e))>-1}isOS(I){return this.getOSName(!0)===String(I).toLowerCase()}isPlatform(I){return this.getPlatformType(!0)===String(I).toLowerCase()}isEngine(I){return this.getEngineName(!0)===String(I).toLowerCase()}is(I,g=!1){return this.isBrowser(I,g)||this.isOS(I)||this.isPlatform(I)}some(I=[]){return I.some((I=>this.is(I)))}}
/*!
   * Bowser - a browser detector
   * https://github.com/lancedikson/bowser
   * MIT License | (c) Dustin Diaz 2012-2015
   * MIT License | (c) Denis Demchenko 2015-2019
   */class X{static getParser(I,g=!1){if("string"!=typeof I)throw new Error("UserAgent should be a string");return new p(I,g)}static parse(I){return new p(I).getResult()}static get BROWSER_MAP(){return Z}static get ENGINE_MAP(){return B}static get OS_MAP(){return u}static get PLATFORMS_MAP(){return m}}var H={exports:{}},k={exports:{}};!function(I){function g(C){return I.exports=g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.__esModule=!0,I.exports.default=I.exports,g(C)}I.exports=g,I.exports.__esModule=!0,I.exports.default=I.exports}(k);var S=k.exports;!function(I){var g=S.default;function C(){I.exports=C=function(){return A},I.exports.__esModule=!0,I.exports.default=I.exports;var e,A={},t=Object.prototype,r=t.hasOwnProperty,c=Object.defineProperty||function(I,g,C){I[g]=C.value},i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{s({},"")}catch(e){s=function(I,g,C){return I[g]=C}}function a(I,g,C,e){var A=g&&g.prototype instanceof y?g:y,t=Object.create(A.prototype),r=new f(e||[]);return c(t,"_invoke",{value:k(I,C,r)}),t}function d(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(I){return{type:"throw",arg:I}}}A.wrap=a;var b="suspendedStart",Z="suspendedYield",m="executing",u="completed",B={};function y(){}function G(){}function V(){}var h={};s(h,n,(function(){return this}));var W=Object.getPrototypeOf,R=W&&W(W(F([])));R&&R!==t&&r.call(R,n)&&(h=R);var p=V.prototype=y.prototype=Object.create(h);function X(I){["next","throw","return"].forEach((function(g){s(I,g,(function(I){return this._invoke(g,I)}))}))}function H(I,C){function e(A,t,c,i){var n=d(I[A],I,t);if("throw"!==n.type){var l=n.arg,o=l.value;return o&&"object"==g(o)&&r.call(o,"__await")?C.resolve(o.__await).then((function(I){e("next",I,c,i)}),(function(I){e("throw",I,c,i)})):C.resolve(o).then((function(I){l.value=I,c(l)}),(function(I){return e("throw",I,c,i)}))}i(n.arg)}var A;c(this,"_invoke",{value:function(I,g){function t(){return new C((function(C,A){e(I,g,C,A)}))}return A=A?A.then(t,t):t()}})}function k(I,g,C){var A=b;return function(t,r){if(A===m)throw new Error("Generator is already running");if(A===u){if("throw"===t)throw r;return{value:e,done:!0}}for(C.method=t,C.arg=r;;){var c=C.delegate;if(c){var i=S(c,C);if(i){if(i===B)continue;return i}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(A===b)throw A=u,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);A=m;var n=d(I,g,C);if("normal"===n.type){if(A=C.done?u:Z,n.arg===B)continue;return{value:n.arg,done:C.done}}"throw"===n.type&&(A=u,C.method="throw",C.arg=n.arg)}}}function S(I,g){var C=g.method,A=I.iterator[C];if(A===e)return g.delegate=null,"throw"===C&&I.iterator.return&&(g.method="return",g.arg=e,S(I,g),"throw"===g.method)||"return"!==C&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+C+"' method")),B;var t=d(A,I.iterator,g.arg);if("throw"===t.type)return g.method="throw",g.arg=t.arg,g.delegate=null,B;var r=t.arg;return r?r.done?(g[I.resultName]=r.value,g.next=I.nextLoc,"return"!==g.method&&(g.method="next",g.arg=e),g.delegate=null,B):r:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,B)}function J(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function w(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function f(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(J,this),this.reset(!0)}function F(I){if(I||""===I){var C=I[n];if(C)return C.call(I);if("function"==typeof I.next)return I;if(!isNaN(I.length)){var A=-1,t=function g(){for(;++A<I.length;)if(r.call(I,A))return g.value=I[A],g.done=!1,g;return g.value=e,g.done=!0,g};return t.next=t}}throw new TypeError(g(I)+" is not iterable")}return G.prototype=V,c(p,"constructor",{value:V,configurable:!0}),c(V,"constructor",{value:G,configurable:!0}),G.displayName=s(V,o,"GeneratorFunction"),A.isGeneratorFunction=function(I){var g="function"==typeof I&&I.constructor;return!!g&&(g===G||"GeneratorFunction"===(g.displayName||g.name))},A.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,V):(I.__proto__=V,s(I,o,"GeneratorFunction")),I.prototype=Object.create(p),I},A.awrap=function(I){return{__await:I}},X(H.prototype),s(H.prototype,l,(function(){return this})),A.AsyncIterator=H,A.async=function(I,g,C,e,t){void 0===t&&(t=Promise);var r=new H(a(I,g,C,e),t);return A.isGeneratorFunction(g)?r:r.next().then((function(I){return I.done?I.value:r.next()}))},X(p),s(p,o,"Generator"),s(p,n,(function(){return this})),s(p,"toString",(function(){return"[object Generator]"})),A.keys=function(I){var g=Object(I),C=[];for(var e in g)C.push(e);return C.reverse(),function I(){for(;C.length;){var e=C.pop();if(e in g)return I.value=e,I.done=!1,I}return I.done=!0,I}},A.values=F,f.prototype={constructor:f,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!I)for(var g in this)"t"===g.charAt(0)&&r.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=e)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var g=this;function C(C,A){return c.type="throw",c.arg=I,g.next=C,A&&(g.method="next",g.arg=e),!!A}for(var A=this.tryEntries.length-1;A>=0;--A){var t=this.tryEntries[A],c=t.completion;if("root"===t.tryLoc)return C("end");if(t.tryLoc<=this.prev){var i=r.call(t,"catchLoc"),n=r.call(t,"finallyLoc");if(i&&n){if(this.prev<t.catchLoc)return C(t.catchLoc,!0);if(this.prev<t.finallyLoc)return C(t.finallyLoc)}else if(i){if(this.prev<t.catchLoc)return C(t.catchLoc,!0)}else{if(!n)throw new Error("try statement without catch or finally");if(this.prev<t.finallyLoc)return C(t.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var e=this.tryEntries[C];if(e.tryLoc<=this.prev&&r.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var A=e;break}}A&&("break"===I||"continue"===I)&&A.tryLoc<=g&&g<=A.finallyLoc&&(A=null);var t=A?A.completion:{};return t.type=I,t.arg=g,A?(this.method="next",this.next=A.finallyLoc,B):this.complete(t)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),B},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),w(C),B}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var e=C.completion;if("throw"===e.type){var A=e.arg;w(C)}return A}}throw new Error("illegal catch attempt")},delegateYield:function(I,g,C){return this.delegate={iterator:F(I),resultName:g,nextLoc:C},"next"===this.method&&(this.arg=e),B}},A}I.exports=C,I.exports.__esModule=!0,I.exports.default=I.exports}(H);var J=(0,H.exports)();try{regeneratorRuntime=J}catch(I){"object"==typeof globalThis?globalThis.regeneratorRuntime=J:Function("r","regeneratorRuntime = r")(J)}function w(I){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},w(I)}function f(I){var g=function(I,g){if("object"!==w(I)||null===I)return I;var C=I[Symbol.toPrimitive];if(void 0!==C){var e=C.call(I,g||"default");if("object"!==w(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(I)}(I,"string");return"symbol"===w(g)?g:String(g)}function F(I,g){for(var C=0;C<g.length;C++){var e=g[C];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(I,f(e.key),e)}}function Y(I){return I<0?I>>>0:I}function v(I,g){for(var C=g;0!==I[C];)C++;return new TextDecoder("utf-8").decode(I.subarray(g,C))}function K(I,g,C){var e=void 0===g?null:g,A=function(I,g){var C=atob(I);if(g){for(var e=new Uint8Array(C.length),A=0,t=C.length;A<t;++A)e[A]=C.charCodeAt(A);return String.fromCharCode.apply(null,new Uint16Array(e.buffer))}return C}(I,void 0!==C&&C),t=A.indexOf("\n",10)+1,r=A.substring(t)+(e?"//# sourceMappingURL="+e:""),c=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(c)}(function(){function I(){!function(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}(this,I),this._path=""}var g,C,e;return g=I,e=[{key:"getPtr",value:function(g){if(I._filePtrs.has(g))return I._filePtrs.get(g);throw new Error("File instance not found.")}},{key:"setPtr",value:function(g,C){I._filePtrs.set(g,C)}},{key:"removePtr",value:function(g){I._filePtrs.delete(g)}}],(C=[{key:"meta",get:function(){if(void 0!==this._meta)return Object.assign({version:0},this._meta)}},{key:"pageSize",get:function(){}}])&&F(g.prototype,C),e&&F(g,e),Object.defineProperty(g,"prototype",{writable:!1}),I}())._filePtrs=new Map;var N,E,U,M,L,T=(N="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gX3R5cGVvZiQzKG8pIHsKICAgICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7CgogICAgcmV0dXJuIF90eXBlb2YkMyA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvOwogICAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgICB9LCBfdHlwZW9mJDMobyk7CiAgfQoKICBmdW5jdGlvbiB0b1ByaW1pdGl2ZSh0LCByKSB7CiAgICBpZiAoIm9iamVjdCIgIT0gX3R5cGVvZiQzKHQpIHx8ICF0KSByZXR1cm4gdDsKICAgIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdOwogICAgaWYgKHZvaWQgMCAhPT0gZSkgewogICAgICB2YXIgaSA9IGUuY2FsbCh0LCByIHx8ICJkZWZhdWx0Iik7CiAgICAgIGlmICgib2JqZWN0IiAhPSBfdHlwZW9mJDMoaSkpIHJldHVybiBpOwogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOwogICAgfQogICAgcmV0dXJuICgic3RyaW5nIiA9PT0gciA/IFN0cmluZyA6IE51bWJlcikodCk7CiAgfQoKICBmdW5jdGlvbiB0b1Byb3BlcnR5S2V5KHQpIHsKICAgIHZhciBpID0gdG9QcmltaXRpdmUodCwgInN0cmluZyIpOwogICAgcmV0dXJuICJzeW1ib2wiID09IF90eXBlb2YkMyhpKSA/IGkgOiBTdHJpbmcoaSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgICBrZXkgPSB0b1Byb3BlcnR5S2V5KGtleSk7CiAgICBpZiAoa2V5IGluIG9iaikgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CgogIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgIHRyeSB7CiAgICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHJlamVjdChlcnJvcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CiAgICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgICB9CiAgICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgICAgfSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMSAoeCkgewogIAlyZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdkZWZhdWx0JykgPyB4WydkZWZhdWx0J10gOiB4OwogIH0KCiAgdmFyIHJlZ2VuZXJhdG9yUnVudGltZSQyID0ge2V4cG9ydHM6IHt9fTsKCiAgdmFyIF90eXBlb2YkMiA9IHtleHBvcnRzOiB7fX07CgogIF90eXBlb2YkMi5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKICAJICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwoKICAJICByZXR1cm4gKG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiB0eXBlb2YgbzsKICAJICB9IDogZnVuY3Rpb24gKG8pIHsKICAJICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgCSAgfSwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cyksIF90eXBlb2Yobyk7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChfdHlwZW9mJDIpKTsKCiAgdmFyIF90eXBlb2ZFeHBvcnRzJDEgPSBfdHlwZW9mJDIuZXhwb3J0czsKCiAgcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJdmFyIF90eXBlb2YgPSBfdHlwZW9mRXhwb3J0cyQxWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMikpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyQxID0gcmVnZW5lcmF0b3JSdW50aW1lJDIuZXhwb3J0czsKCiAgLy8gVE9ETyhCYWJlbCA4KTogUmVtb3ZlIHRoaXMgZmlsZS4KCiAgdmFyIHJ1bnRpbWUkMSA9IHJlZ2VuZXJhdG9yUnVudGltZUV4cG9ydHMkMSgpOwogIHZhciByZWdlbmVyYXRvciQxID0gcnVudGltZSQxOwoKICAvLyBDb3BpZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL3BhY2thZ2VzL3J1bnRpbWUvcnVudGltZS5qcyNMNzM2PQogIHRyeSB7CiAgICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lJDE7CiAgICB9IGVsc2UgewogICAgICBGdW5jdGlvbigiciIsICJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikocnVudGltZSQxKTsKICAgIH0KICB9CgogIHZhciBfcmVnZW5lcmF0b3JSdW50aW1lJDEgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMkMShyZWdlbmVyYXRvciQxKTsKCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMgKHgpIHsKICAJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKICB9CgogIHZhciByZWdlbmVyYXRvclJ1bnRpbWUkMSA9IHtleHBvcnRzOiB7fX07CgogIHZhciBfdHlwZW9mJDEgPSB7ZXhwb3J0czoge319OwoKICBfdHlwZW9mJDEuZXhwb3J0czsKCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAJZnVuY3Rpb24gX3R5cGVvZihvKSB7CiAgCSAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKCiAgCSAgcmV0dXJuIChtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gdHlwZW9mIG87CiAgCSAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgCSAgICByZXR1cm4gbyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMpLCBfdHlwZW9mKG8pOwogIAl9CiAgCW1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiwgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWUsIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0czsgCiAgfSAoX3R5cGVvZiQxKSk7CgogIHZhciBfdHlwZW9mRXhwb3J0cyA9IF90eXBlb2YkMS5leHBvcnRzOwoKICByZWdlbmVyYXRvclJ1bnRpbWUkMS5leHBvcnRzOwoKICAoZnVuY3Rpb24gKG1vZHVsZSkgewogIAl2YXIgX3R5cGVvZiA9IF90eXBlb2ZFeHBvcnRzWyJkZWZhdWx0Il07CiAgCWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CiAgCSAgbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKICAJICAgIHJldHVybiBlOwogIAkgIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHM7CiAgCSAgdmFyIHQsCiAgCSAgICBlID0ge30sCiAgCSAgICByID0gT2JqZWN0LnByb3RvdHlwZSwKICAJICAgIG4gPSByLmhhc093blByb3BlcnR5LAogIAkgICAgbyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAodCwgZSwgcikgewogIAkgICAgICB0W2VdID0gci52YWx1ZTsKICAJICAgIH0sCiAgCSAgICBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sCiAgCSAgICBhID0gaS5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsCiAgCSAgICBjID0gaS5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLAogIAkgICAgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOwogIAkgIGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CiAgCSAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKICAJICAgICAgdmFsdWU6IHIsCiAgCSAgICAgIGVudW1lcmFibGU6ICEwLAogIAkgICAgICBjb25maWd1cmFibGU6ICEwLAogIAkgICAgICB3cml0YWJsZTogITAKICAJICAgIH0pLCB0W2VdOwogIAkgIH0KICAJICB0cnkgewogIAkgICAgZGVmaW5lKHt9LCAiIik7CiAgCSAgfSBjYXRjaCAodCkgewogIAkgICAgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKICAJICAgICAgcmV0dXJuIHRbZV0gPSByOwogIAkgICAgfTsKICAJICB9CiAgCSAgZnVuY3Rpb24gd3JhcCh0LCBlLCByLCBuKSB7CiAgCSAgICB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLAogIAkgICAgICBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksCiAgCSAgICAgIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsKICAJICAgIHJldHVybiBvKGEsICJfaW52b2tlIiwgewogIAkgICAgICB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKQogIAkgICAgfSksIGE7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsKICAJICAgIHRyeSB7CiAgCSAgICAgIHJldHVybiB7CiAgCSAgICAgICAgdHlwZTogIm5vcm1hbCIsCiAgCSAgICAgICAgYXJnOiB0LmNhbGwoZSwgcikKICAJICAgICAgfTsKICAJICAgIH0gY2F0Y2ggKHQpIHsKICAJICAgICAgcmV0dXJuIHsKICAJICAgICAgICB0eXBlOiAidGhyb3ciLAogIAkgICAgICAgIGFyZzogdAogIAkgICAgICB9OwogIAkgICAgfQogIAkgIH0KICAJICBlLndyYXAgPSB3cmFwOwogIAkgIHZhciBoID0gInN1c3BlbmRlZFN0YXJ0IiwKICAJICAgIGwgPSAic3VzcGVuZGVkWWllbGQiLAogIAkgICAgZiA9ICJleGVjdXRpbmciLAogIAkgICAgcyA9ICJjb21wbGV0ZWQiLAogIAkgICAgeSA9IHt9OwogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9CiAgCSAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIAkgIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICAJICB2YXIgcCA9IHt9OwogIAkgIGRlZmluZShwLCBhLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gdGhpczsKICAJICB9KTsKICAJICB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICAJICAgIHYgPSBkICYmIGQoZCh2YWx1ZXMoW10pKSk7CiAgCSAgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwogIAkgIHZhciBnID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUocCk7CiAgCSAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHQpIHsKICAJICAgIFsibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgCSAgICAgIGRlZmluZSh0LCBlLCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CiAgCSAgICAgIH0pOwogIAkgICAgfSk7CiAgCSAgfQogIAkgIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewogIAkgICAgZnVuY3Rpb24gaW52b2tlKHIsIG8sIGksIGEpIHsKICAJICAgICAgdmFyIGMgPSB0cnlDYXRjaCh0W3JdLCB0LCBvKTsKICAJICAgICAgaWYgKCJ0aHJvdyIgIT09IGMudHlwZSkgewogIAkgICAgICAgIHZhciB1ID0gYy5hcmcsCiAgCSAgICAgICAgICBoID0gdS52YWx1ZTsKICAJICAgICAgICByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7CiAgCSAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAJICAgICAgICAgIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgCSAgICAgICAgICB1LnZhbHVlID0gdCwgaSh1KTsKICAJICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogIAkgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsKICAJICAgICAgICB9KTsKICAJICAgICAgfQogIAkgICAgICBhKGMuYXJnKTsKICAJICAgIH0KICAJICAgIHZhciByOwogIAkgICAgbyh0aGlzLCAiX2ludm9rZSIsIHsKICAJICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsKICAJICAgICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKICAJICAgICAgICAgIHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgewogIAkgICAgICAgICAgICBpbnZva2UodCwgbiwgZSwgcik7CiAgCSAgICAgICAgICB9KTsKICAJICAgICAgICB9CiAgCSAgICAgICAgcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwogIAkgICAgICB9CiAgCSAgICB9KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CiAgCSAgICB2YXIgbyA9IGg7CiAgCSAgICByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsKICAJICAgICAgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogIAkgICAgICBpZiAobyA9PT0gcykgewogIAkgICAgICAgIGlmICgidGhyb3ciID09PSBpKSB0aHJvdyBhOwogIAkgICAgICAgIHJldHVybiB7CiAgCSAgICAgICAgICB2YWx1ZTogdCwKICAJICAgICAgICAgIGRvbmU6ICEwCiAgCSAgICAgICAgfTsKICAJICAgICAgfQogIAkgICAgICBmb3IgKG4ubWV0aG9kID0gaSwgbi5hcmcgPSBhOzspIHsKICAJICAgICAgICB2YXIgYyA9IG4uZGVsZWdhdGU7CiAgCSAgICAgICAgaWYgKGMpIHsKICAJICAgICAgICAgIHZhciB1ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShjLCBuKTsKICAJICAgICAgICAgIGlmICh1KSB7CiAgCSAgICAgICAgICAgIGlmICh1ID09PSB5KSBjb250aW51ZTsKICAJICAgICAgICAgICAgcmV0dXJuIHU7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICAgIGlmICgibmV4dCIgPT09IG4ubWV0aG9kKSBuLnNlbnQgPSBuLl9zZW50ID0gbi5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gbi5tZXRob2QpIHsKICAJICAgICAgICAgIGlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CiAgCSAgICAgICAgICBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsKICAJICAgICAgICB9IGVsc2UgInJldHVybiIgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCJyZXR1cm4iLCBuLmFyZyk7CiAgCSAgICAgICAgbyA9IGY7CiAgCSAgICAgICAgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsKICAJICAgICAgICBpZiAoIm5vcm1hbCIgPT09IHAudHlwZSkgewogIAkgICAgICAgICAgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOwogIAkgICAgICAgICAgcmV0dXJuIHsKICAJICAgICAgICAgICAgdmFsdWU6IHAuYXJnLAogIAkgICAgICAgICAgICBkb25lOiBuLmRvbmUKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgfQogIAkgICAgICAgICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7CiAgCSAgICAgIH0KICAJICAgIH07CiAgCSAgfQogIAkgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgcikgewogIAkgICAgdmFyIG4gPSByLm1ldGhvZCwKICAJICAgICAgbyA9IGUuaXRlcmF0b3Jbbl07CiAgCSAgICBpZiAobyA9PT0gdCkgcmV0dXJuIHIuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBuICYmIGUuaXRlcmF0b3JbInJldHVybiJdICYmIChyLm1ldGhvZCA9ICJyZXR1cm4iLCByLmFyZyA9IHQsIG1heWJlSW52b2tlRGVsZWdhdGUoZSwgciksICJ0aHJvdyIgPT09IHIubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbiAmJiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBuICsgIicgbWV0aG9kIikpLCB5OwogIAkgICAgdmFyIGkgPSB0cnlDYXRjaChvLCBlLml0ZXJhdG9yLCByLmFyZyk7CiAgCSAgICBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsKICAJICAgIHZhciBhID0gaS5hcmc7CiAgCSAgICByZXR1cm4gYSA/IGEuZG9uZSA/IChyW2UucmVzdWx0TmFtZV0gPSBhLnZhbHVlLCByLm5leHQgPSBlLm5leHRMb2MsICJyZXR1cm4iICE9PSByLm1ldGhvZCAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksIHIuZGVsZWdhdGUgPSBudWxsLCB5KSA6IGEgOiAoci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIHIuZGVsZWdhdGUgPSBudWxsLCB5KTsKICAJICB9CiAgCSAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gewogIAkgICAgICB0cnlMb2M6IHRbMF0KICAJICAgIH07CiAgCSAgICAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOwogIAkgIH0KICAJICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKICAJICAgIHZhciBlID0gdC5jb21wbGV0aW9uIHx8IHt9OwogIAkgICAgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsKICAJICB9CiAgCSAgZnVuY3Rpb24gQ29udGV4dCh0KSB7CiAgCSAgICB0aGlzLnRyeUVudHJpZXMgPSBbewogIAkgICAgICB0cnlMb2M6ICJyb290IgogIAkgICAgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsKICAJICB9CiAgCSAgZnVuY3Rpb24gdmFsdWVzKGUpIHsKICAJICAgIGlmIChlIHx8ICIiID09PSBlKSB7CiAgCSAgICAgIHZhciByID0gZVthXTsKICAJICAgICAgaWYgKHIpIHJldHVybiByLmNhbGwoZSk7CiAgCSAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlLm5leHQpIHJldHVybiBlOwogIAkgICAgICBpZiAoIWlzTmFOKGUubGVuZ3RoKSkgewogIAkgICAgICAgIHZhciBvID0gLTEsCiAgCSAgICAgICAgICBpID0gZnVuY3Rpb24gbmV4dCgpIHsKICAJICAgICAgICAgICAgZm9yICg7ICsrbyA8IGUubGVuZ3RoOykgaWYgKG4uY2FsbChlLCBvKSkgcmV0dXJuIG5leHQudmFsdWUgPSBlW29dLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgICAgICAgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKICAJICAgICAgICAgIH07CiAgCSAgICAgICAgcmV0dXJuIGkubmV4dCA9IGk7CiAgCSAgICAgIH0KICAJICAgIH0KICAJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoX3R5cGVvZihlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgCSAgfQogIAkgIHJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAiY29uc3RydWN0b3IiLCB7CiAgCSAgICB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgCSAgICBjb25maWd1cmFibGU6ICEwCiAgCSAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsKICAJICAgIHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwKICAJICAgIGNvbmZpZ3VyYWJsZTogITAKICAJICB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgewogIAkgICAgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ICYmIHQuY29uc3RydWN0b3I7CiAgCSAgICByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKICAJICB9LCBlLm1hcmsgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OwogIAkgIH0sIGUuYXdyYXAgPSBmdW5jdGlvbiAodCkgewogIAkgICAgcmV0dXJuIHsKICAJICAgICAgX19hd2FpdDogdAogIAkgICAgfTsKICAJICB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsKICAJICAgIHJldHVybiB0aGlzOwogIAkgIH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsKICAJICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOwogIAkgICAgdmFyIGEgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKHQsIHIsIG4sIG8pLCBpKTsKICAJICAgIHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgewogIAkgICAgICByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOwogIAkgICAgfSk7CiAgCSAgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgewogIAkgICAgcmV0dXJuIHRoaXM7CiAgCSAgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7CiAgCSAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgCSAgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7CiAgCSAgICB2YXIgZSA9IE9iamVjdCh0KSwKICAJICAgICAgciA9IFtdOwogIAkgICAgZm9yICh2YXIgbiBpbiBlKSByLnB1c2gobik7CiAgCSAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7CiAgCSAgICAgIGZvciAoOyByLmxlbmd0aDspIHsKICAJICAgICAgICB2YXIgdCA9IHIucG9wKCk7CiAgCSAgICAgICAgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKICAJICAgICAgfQogIAkgICAgICByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CiAgCSAgICB9OwogIAkgIH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAJICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LAogIAkgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKICAJICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CiAgCSAgICB9LAogIAkgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAJICAgICAgdGhpcy5kb25lID0gITA7CiAgCSAgICAgIHZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gdGhpcy5ydmFsOwogIAkgICAgfSwKICAJICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CiAgCSAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IGU7CiAgCSAgICAgIHZhciByID0gdGhpczsKICAJICAgICAgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsKICAJICAgICAgICByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOwogIAkgICAgICB9CiAgCSAgICAgIGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAJICAgICAgICB2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwKICAJICAgICAgICAgIGEgPSBpLmNvbXBsZXRpb247CiAgCSAgICAgICAgaWYgKCJyb290IiA9PT0gaS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpOwogIAkgICAgICAgIGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAJICAgICAgICAgIHZhciBjID0gbi5jYWxsKGksICJjYXRjaExvYyIpLAogIAkgICAgICAgICAgICB1ID0gbi5jYWxsKGksICJmaW5hbGx5TG9jIik7CiAgCSAgICAgICAgICBpZiAoYyAmJiB1KSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwogIAkgICAgICAgICAgfSBlbHNlIGlmIChjKSB7CiAgCSAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKICAJICAgICAgICAgIH0gZWxzZSB7CiAgCSAgICAgICAgICAgIGlmICghdSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogIAkgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CiAgCSAgICAgICAgICB9CiAgCSAgICAgICAgfQogIAkgICAgICB9CiAgCSAgICB9LAogIAkgICAgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodCwgZSkgewogIAkgICAgICBmb3IgKHZhciByID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IHIgPj0gMDsgLS1yKSB7CiAgCSAgICAgICAgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CiAgCSAgICAgICAgaWYgKG8udHJ5TG9jIDw9IHRoaXMucHJldiAmJiBuLmNhbGwobywgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHsKICAJICAgICAgICAgIHZhciBpID0gbzsKICAJICAgICAgICAgIGJyZWFrOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKICAJICAgICAgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CiAgCSAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwogIAkgICAgfSwKICAJICAgIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CiAgCSAgICAgIGlmICgidGhyb3ciID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwogIAkgICAgICByZXR1cm4gImJyZWFrIiA9PT0gdC50eXBlIHx8ICJjb250aW51ZSIgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogInJldHVybiIgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwogIAkgICAgfSwKICAJICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKICAJICAgICAgZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewogIAkgICAgICAgIHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOwogIAkgICAgICAgIGlmIChyLmZpbmFsbHlMb2MgPT09IHQpIHJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbiwgci5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkociksIHk7CiAgCSAgICAgIH0KICAJICAgIH0sCiAgCSAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godCkgewogIAkgICAgICBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7CiAgCSAgICAgICAgdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CiAgCSAgICAgICAgaWYgKHIudHJ5TG9jID09PSB0KSB7CiAgCSAgICAgICAgICB2YXIgbiA9IHIuY29tcGxldGlvbjsKICAJICAgICAgICAgIGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsKICAJICAgICAgICAgICAgdmFyIG8gPSBuLmFyZzsKICAJICAgICAgICAgICAgcmVzZXRUcnlFbnRyeShyKTsKICAJICAgICAgICAgIH0KICAJICAgICAgICAgIHJldHVybiBvOwogIAkgICAgICAgIH0KICAJICAgICAgfQogIAkgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogIAkgICAgfSwKICAJICAgIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgewogIAkgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsKICAJICAgICAgICBpdGVyYXRvcjogdmFsdWVzKGUpLAogIAkgICAgICAgIHJlc3VsdE5hbWU6IHIsCiAgCSAgICAgICAgbmV4dExvYzogbgogIAkgICAgICB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OwogIAkgICAgfQogIAkgIH0sIGU7CiAgCX0KICAJbW9kdWxlLmV4cG9ydHMgPSBfcmVnZW5lcmF0b3JSdW50aW1lLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzOyAKICB9IChyZWdlbmVyYXRvclJ1bnRpbWUkMSkpOwoKICB2YXIgcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cyA9IHJlZ2VuZXJhdG9yUnVudGltZSQxLmV4cG9ydHM7CgogIC8vIFRPRE8oQmFiZWwgOCk6IFJlbW92ZSB0aGlzIGZpbGUuCgogIHZhciBydW50aW1lID0gcmVnZW5lcmF0b3JSdW50aW1lRXhwb3J0cygpOwogIHZhciByZWdlbmVyYXRvciA9IHJ1bnRpbWU7CgogIC8vIENvcGllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vcGFja2FnZXMvcnVudGltZS9ydW50aW1lLmpzI0w3MzY9CiAgdHJ5IHsKICAgIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWU7CiAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIpIHsKICAgICAgZ2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lOwogICAgfSBlbHNlIHsKICAgICAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUpOwogICAgfQogIH0KCiAgdmFyIF9yZWdlbmVyYXRvclJ1bnRpbWUgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMocmVnZW5lcmF0b3IpOwoKICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQ0KICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuDQoNCiAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZDQogIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwNCiAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SDQogIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1INCiAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8NCg0KICBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0NCiAgICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgICB9KTsNCiAgfQoKICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICAgIG8uX19wcm90b19fID0gcDsKICAgICAgcmV0dXJuIG87CiAgICB9OwogICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewogICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICAgIH0KICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfQogICAgfSk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7CiAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgfSk7CiAgICBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsKICB9CgogIGZ1bmN0aW9uIF90eXBlb2YobykgewogICAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKCiAgICByZXR1cm4gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvOwogICAgfSA6IGZ1bmN0aW9uIChvKSB7CiAgICAgIHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87CiAgICB9LCBfdHlwZW9mKG8pOwogIH0KCiAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgICBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgICB9CiAgICByZXR1cm4gc2VsZjsKICB9CgogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICAgIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgcmV0dXJuIGNhbGw7CiAgICB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOwogICAgfQogICAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7CiAgfQoKICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayQxKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHsKICAgIGlmIChfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsKICAgIHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsKICAgIGlmIChwcmltICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpOwogICAgICBpZiAoX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTsKICAgIH0KICAgIHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsKICB9CgogIGZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgewogICAgdmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTsKICAgIHJldHVybiBfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7CiAgfQoKICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyQxKHRhcmdldCwgcHJvcHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MkMShDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyQxKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzJDEoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CgogIC8qDQogICAgQ29weXJpZ2h0IDIwMjItMjAyMyBQaWNvdm9pY2UgSW5jLg0KCiAgICBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIGxpY2Vuc2UuIEEgY29weSBvZiB0aGUgbGljZW5zZSBpcyBsb2NhdGVkIGluIHRoZSAiTElDRU5TRSINCiAgICBmaWxlIGFjY29tcGFueWluZyB0aGlzIHNvdXJjZS4NCgogICAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbg0KICAgIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQ0KICAgIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogICovCiAgLyoqDQogICAqIEJhc2VQdkZpbGUgQ2xhc3MNCiAgICogVGhpcyBjbGFzcyBtb2NrcyB0aGUgZmlsZSBzeXN0ZW0gdXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UuDQogICAqLwogIHZhciBQdkZpbGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUHZGaWxlKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2skMSh0aGlzLCBQdkZpbGUpOwogICAgICB0aGlzLl9wYXRoID0gJyc7CiAgICB9CiAgICAvKioNCiAgICAgKiBHZXR0ZXIgZm9yIGZpbGUncyBtZXRhIGluZm9ybWF0aW9uLg0KICAgICAqLwogICAgX2NyZWF0ZUNsYXNzJDEoUHZGaWxlLCBbewogICAgICBrZXk6ICJtZXRhIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgaWYgKHRoaXMuX21ldGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgdmVyc2lvbjogMAogICAgICAgIH0sIHRoaXMuX21ldGEpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInBhZ2VTaXplIiwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgICAvKioNCiAgICAgICAqIEdldCB0aGUgZmlsZSBwb2ludGVyIGZyb20gdGhlIF9maWxlUHRycyBtYXAuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBwb2ludGVyIHRvIEJhc2VQdkZpbGUgaW5zdGFuY2UgdG8gZ2V0IGZyb20gdGhlIG1hcC4NCiAgICAgICAqIEByZXR1cm5zIEJhc2VQdkZpbGUgcmV0dXJucyB0aGUgY3VycmVudCBmaWxlIGluc3RhbmNlIHJlbGF0ZWQgdG8gcHRyLg0KICAgICAgICovCiAgICB9XSwgW3sKICAgICAga2V5OiAiZ2V0UHRyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFB0cihwdHIpIHsKICAgICAgICBpZiAoUHZGaWxlLl9maWxlUHRycy5oYXMocHRyKSkgewogICAgICAgICAgcmV0dXJuIFB2RmlsZS5fZmlsZVB0cnMuZ2V0KHB0cik7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSBpbnN0YW5jZSBub3QgZm91bmQuJyk7CiAgICAgIH0KICAgICAgLyoqDQogICAgICAgKiBTYXZlcyB0aGUgQmFzZVB2RmlsZSBpbnN0YW5jZSB0byB0aGUgbWFwIHdpdGggYW4gYXNzb2NpYXRlZCBwdHIuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBmaWxlIHBvaW50ZXIgdG8gc2F2ZSBhcyB0aGUga2V5Lg0KICAgICAgICogQHBhcmFtIGluc3RhbmNlIFRoZSBCYXNlUHZGaWxlIGluc3RhbmNlIHRvIHNhdmUgYXMgdGhlIHZhbHVlLg0KICAgICAgICovCiAgICB9LCB7CiAgICAgIGtleTogInNldFB0ciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQdHIocHRyLCBpbnN0YW5jZSkgewogICAgICAgIFB2RmlsZS5fZmlsZVB0cnMuc2V0KHB0ciwgaW5zdGFuY2UpOwogICAgICB9CiAgICAgIC8qKg0KICAgICAgICogUmVtb3ZlcyB0aGUgcHRyIGZyb20gdGhlIF9maWxlUHRycyBtYXAuDQogICAgICAgKiBAcGFyYW0gcHRyIFRoZSBmaWxlIHBvaW50ZXIgdG8gcmVtb3ZlLg0KICAgICAgICovCiAgICB9LCB7CiAgICAgIGtleTogInJlbW92ZVB0ciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVQdHIocHRyKSB7CiAgICAgICAgUHZGaWxlLl9maWxlUHRyc1siZGVsZXRlIl0ocHRyKTsKICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIFB2RmlsZTsKICB9KCk7CiAgUHZGaWxlLl9maWxlUHRycyA9IG5ldyBNYXAoKTsKCiAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0KICBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQogIC8qKg0KICAgKiBQdkZpbGVNZW0gQ2xhc3MNCiAgICogVGhpcyBjbGFzcyBtb2NrcyB0aGUgZmlsZSBzeXN0ZW0gdXNpbmcgaW4tbWVtb3J5IHN0b3JhZ2UuDQogICAqLwogIHZhciBQdkZpbGVNZW0gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QdkZpbGUpIHsKICAgIF9pbmhlcml0cyhQdkZpbGVNZW0sIF9QdkZpbGUpOwogICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihQdkZpbGVNZW0pOwogICAgZnVuY3Rpb24gUHZGaWxlTWVtKHBhdGgsIG1ldGEsIGRiLCBtb2RlKSB7CiAgICAgIHZhciBfdGhpczsKICAgICAgX2NsYXNzQ2FsbENoZWNrJDEodGhpcywgUHZGaWxlTWVtKTsKICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKICAgICAgX3RoaXMuX3BvcyA9IDA7CiAgICAgIF90aGlzLl9wYXRoID0gcGF0aDsKICAgICAgX3RoaXMuX21ldGEgPSBtZXRhOwogICAgICBfdGhpcy5fbW9kZSA9IG1vZGU7CiAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyQxKFB2RmlsZU1lbSwgW3sKICAgICAga2V5OiAiY2xvc2UiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInJlYWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZChzaXplLCBjb3VudCkgewogICAgICAgIGlmICghdGhpcy5leGlzdHMoKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCInIi5jb25jYXQodGhpcy5fcGF0aCwgIicgZG9lc24ndCBleGlzdC4iKSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pc0VPRikgewogICAgICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcigiRU9GIik7CiAgICAgICAgICBlcnIubmFtZSA9ICJFbmRPZkZpbGUiOwogICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIH0KICAgICAgICB2YXIgdG9Db3B5ID0gTWF0aC5taW4oc2l6ZSAqIGNvdW50LCB0aGlzLl9maWxlLmxlbmd0aCAtIHRoaXMuX3Bvcyk7CiAgICAgICAgdmFyIHRvdGFsRWxlbXMgPSB0b0NvcHkgLSB0b0NvcHkgJSBzaXplOwogICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSh0b3RhbEVsZW1zKTsKICAgICAgICBidWZmZXIuc2V0KHRoaXMuX2ZpbGUuc2xpY2UodGhpcy5fcG9zLCB0aGlzLl9wb3MgKyB0b3RhbEVsZW1zKSwgMCk7CiAgICAgICAgdGhpcy5fcG9zICs9IHRvdGFsRWxlbXM7CiAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJ3cml0ZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB3cml0ZShjb250ZW50KSB7CiAgICAgICAgdmFyIG5ld0ZpbGUgPSBuZXcgVWludDhBcnJheSh0aGlzLl9wb3MgKyBjb250ZW50Lmxlbmd0aCk7CiAgICAgICAgaWYgKHRoaXMuX2ZpbGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3RmlsZS5zZXQodGhpcy5fZmlsZS5zbGljZSgwLCB0aGlzLl9wb3MpKTsKICAgICAgICAgIG5ld0ZpbGUuc2V0KGNvbnRlbnQsIHRoaXMuX3Bvcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld0ZpbGUuc2V0KGNvbnRlbnQpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9maWxlID0gbmV3RmlsZTsKICAgICAgICB0aGlzLl9wb3MgKz0gY29udGVudC5sZW5ndGg7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic2VlayIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWVrKG9mZnNldCwgd2hlbmNlKSB7CiAgICAgICAgaWYgKCF0aGlzLmV4aXN0cygpICYmIHRoaXMuX21vZGUgPT09ICJyZWFkb25seSIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiJyIuY29uY2F0KHRoaXMuX3BhdGgsICInIGRvZXNuJ3QgZXhpc3QuIikpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuZXhpc3RzKCkpIHsKICAgICAgICAgIC8vIFRoaXMgaXMgdmFsaWQgaW4gSVNPIEMgYnV0IG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBjdXJyZW50IGltcGxlbWVudGF0aW9uCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiciLmNvbmNhdCh0aGlzLl9wYXRoLCAiJyBkb2Vzbid0IGV4aXN0LiIpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9mZnNldCA8IDApIHsKICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoIkVPRiIpOwogICAgICAgICAgZXJyLm5hbWUgPSAiRW5kT2ZGaWxlIjsKICAgICAgICAgIHRocm93IGVycjsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld09mZnNldDsKICAgICAgICBpZiAod2hlbmNlID09PSAwKSB7CiAgICAgICAgICBuZXdPZmZzZXQgPSBNYXRoLm1pbihvZmZzZXQsIHRoaXMuX2ZpbGUubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKHdoZW5jZSA9PT0gMSkgewogICAgICAgICAgbmV3T2Zmc2V0ID0gTWF0aC5taW4odGhpcy5fcG9zICsgb2Zmc2V0LCB0aGlzLl9maWxlLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmICh3aGVuY2UgPT09IDIpIHsKICAgICAgICAgIG5ld09mZnNldCA9IE1hdGgubWluKHRoaXMuX2ZpbGUubGVuZ3RoICsgb2Zmc2V0LCB0aGlzLl9maWxlLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBvcGVyYXRpb246ICIuY29uY2F0KHdoZW5jZSwgIi4iKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3BvcyA9IG5ld09mZnNldDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJ0ZWxsIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRlbGwoKSB7CiAgICAgICAgaWYgKCF0aGlzLmV4aXN0cygpKSB7CiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9wb3M7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZSgpIHsKICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFTk9FTlQiKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBQdkZpbGVNZW0uX21lbUZpbGVzWyJkZWxldGUiXSh0aGlzLl9wYXRoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BvcyA9IDA7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZXhpc3RzIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGV4aXN0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmlsZSAhPT0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9pc0VPRiIsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wb3MgPj0gdGhpcy5fZmlsZS5sZW5ndGg7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2ZpbGUiLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gUHZGaWxlTWVtLl9tZW1GaWxlcy5nZXQodGhpcy5fcGF0aCk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGNvbnRlbnQpIHsKICAgICAgICBQdkZpbGVNZW0uX21lbUZpbGVzLnNldCh0aGlzLl9wYXRoLCBjb250ZW50KTsKICAgICAgfQogICAgfV0sIFt7CiAgICAgIGtleTogIm9wZW4iLAogICAgICB2YWx1ZTogZnVuY3Rpb24gb3BlbihwYXRoLCBtb2RlKSB7CiAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uX21lbUZpbGVzLmdldChwYXRoKTsKICAgICAgICB2YXIgZGJNb2RlID0gbW9kZS5pbmNsdWRlcygncicpID8gInJlYWRvbmx5IiA6ICJyZWFkd3JpdGUiOwogICAgICAgIGlmIChmaWxlID09PSB1bmRlZmluZWQgJiYgZGJNb2RlID09PSAicmVhZG9ubHkiKSB7CiAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IoIiciLmNvbmNhdChwYXRoLCAiJyBkb2Vzbid0IGV4aXN0LiIpKTsKICAgICAgICAgIGVycm9yLm5hbWUgPSAiRmlsZU5vdEV4aXN0cyI7CiAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9CiAgICAgICAgdmFyIGZpbGVNZW0gPSBuZXcgUHZGaWxlTWVtKHBhdGgsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYk1vZGUpOwogICAgICAgIGlmIChtb2RlLmluY2x1ZGVzKCdhJykpIHsKICAgICAgICAgIGZpbGVNZW0uc2VlaygwLCAyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpbGVNZW07CiAgICAgIH0KICAgIH1dKTsKICAgIHJldHVybiBQdkZpbGVNZW07CiAgfShQdkZpbGUpOwogIFB2RmlsZU1lbS5fbWVtRmlsZXMgPSBuZXcgTWFwKCk7CiAgLyoqDQogICAqIENhc3QgYSBzaWduZWQgYWRkcmVzcyB0byB1bnNpZ25lZCBhZGRyZXNzLg0KICAgKg0KICAgKiBAcGFyYW0gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byBjYXN0IHRvIHVuc2lnbmVkIGFkZHJlc3MuDQogICAqLwogIGZ1bmN0aW9uIHVuc2lnbmVkQWRkcmVzcyhhZGRyZXNzKSB7CiAgICBpZiAoYWRkcmVzcyA8IDApIHsKICAgICAgcmV0dXJuIGFkZHJlc3MgPj4+IDA7CiAgICB9CiAgICByZXR1cm4gYWRkcmVzczsKICB9CgogIHZhciBQdlhwdUFjdGlvbjsKICAoZnVuY3Rpb24gKFB2WHB1QWN0aW9uKSB7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiSU5JVCJdID0gMF0gPSAiSU5JVCI7CiAgICBQdlhwdUFjdGlvbltQdlhwdUFjdGlvblsiQUxMT0MiXSA9IDFdID0gIkFMTE9DIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJGUkVFIl0gPSAyXSA9ICJGUkVFIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJDT1BZX1RPX1hQVSJdID0gM10gPSAiQ09QWV9UT19YUFUiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIkNPUFlfRlJPTV9YUFUiXSA9IDRdID0gIkNPUFlfRlJPTV9YUFUiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIk1FTVNFVCJdID0gNV0gPSAiTUVNU0VUIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJUSU1FUl9TVEFSVCJdID0gNl0gPSAiVElNRVJfU1RBUlQiOwogICAgUHZYcHVBY3Rpb25bUHZYcHVBY3Rpb25bIlRJTUVSX1NUT1AiXSA9IDddID0gIlRJTUVSX1NUT1AiOwogICAgLy8gb3RoZXIgeHB1IGFjdGlvbnMKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJNQVRSSVhfVkVDVE9SX01VTFRJUExZIl0gPSA4XSA9ICJNQVRSSVhfVkVDVE9SX01VTFRJUExZIjsKICAgIFB2WHB1QWN0aW9uW1B2WHB1QWN0aW9uWyJTWU5DX1ZFQ1RPUiJdID0gOV0gPSAiU1lOQ19WRUNUT1IiOwogIH0pKFB2WHB1QWN0aW9uIHx8IChQdlhwdUFjdGlvbiA9IHt9KSk7CgogIGNvbnN0IHdhc2lfc25hcHNob3RfcHJldmlldzFfZW11bGF0b3IgPSB7CiAgICBhcmdzX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGFyZ3Nfc2l6ZXNfZ2V0OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZW52aXJvbl9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBlbnZpcm9uX3NpemVzX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGNsb2NrX3Jlc19nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBjbG9ja190aW1lX2dldDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2FkdmlzZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2FsbG9jYXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfY2xvc2U6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9kYXRhc3luYzogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2Zkc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9mZHN0YXRfc2V0X2ZsYWdzOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfZmRzdGF0X3NldF9yaWdodHM6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9maWxlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9maWxlc3RhdF9zZXRfc2l6ZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX2ZpbGVzdGF0X3NldF90aW1lczogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3ByZWFkOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcHJlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9wcmVzdGF0X2Rpcl9uYW1lOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcHdyaXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfcmVhZDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3JlYWRkaXI6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9yZW51bWJlcjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3NlZWs6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBmZF9zeW5jOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgZmRfdGVsbDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIGZkX3dyaXRlOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9jcmVhdGVfZGlyZWN0b3J5OiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogICAgcGF0aF9maWxlc3RhdF9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX2ZpbGVzdGF0X3NldF90aW1lczogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfbGluazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfb3BlbjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfcmVhZGxpbms6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX3JlbW92ZV9kaXJlY3Rvcnk6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwYXRoX3JlbmFtZTogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfc3ltbGluazogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHBhdGhfdW5saW5rX2ZpbGU6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBwb2xsX29uZW9mZjogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHByb2NfZXhpdDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHByb2NfcmFpc2U6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzY2hlZF95aWVsZDogKGlucHV0KSA9PiB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHJhbmRvbV9nZXQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3JlY3Y6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3NlbmQ6IChpbnB1dCkgPT4gewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBzb2NrX3NodXRkb3duOiAoaW5wdXQpID0+IHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAogIH07CgogIHZhciBtYXRyaXhWZWN0b3JNdWx0aXBseSA9IGZ1bmN0aW9uIG1hdHJpeFZlY3Rvck11bHRpcGx5KGRhdGEpIHsKICAgIHZhciBfZGF0YSRnbG9iYWxzID0gZGF0YS5nbG9iYWxzLAogICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFscy5leHBvcnRzLAogICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMubWVtQWxsb2MsCiAgICAgIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHMubWVtb3J5OwogICAgdmFyIG1hdHJpeEFkZHJlc3MgPSBkYXRhLm1hdHJpeEFkZHJlc3MsCiAgICAgIHZlY3RvckFkZHJlc3MgPSBkYXRhLnZlY3RvckFkZHJlc3MsCiAgICAgIG0gPSBkYXRhLm0sCiAgICAgIG4gPSBkYXRhLm4sCiAgICAgIHJlc3VsdEFkZHJlc3MgPSBkYXRhLnJlc3VsdEFkZHJlc3M7CiAgICB2YXIgcHZfbWF0cml4X3ZlY3Rvcl9tdWx0aXBseSA9IGV4cG9ydHMucHZfbWF0cml4X3ZlY3Rvcl9tdWx0aXBseTsKICAgIGlmICghbWVtQWxsb2MuaGFzKG1hdHJpeEFkZHJlc3MpIHx8ICFtZW1BbGxvYy5oYXModmVjdG9yQWRkcmVzcykgfHwgIW1lbUFsbG9jLmhhcyhyZXN1bHRBZGRyZXNzKSkgewogICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgwKTsKICAgIH0KICAgIHZhciBtZW1vcnlCdWZmZXJGbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgIHZhciBfbWVtQWxsb2MkZ2V0ID0gbWVtQWxsb2MuZ2V0KG1hdHJpeEFkZHJlc3MpLAogICAgICB3b3JrZXJNYXRyaXhBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KHZlY3RvckFkZHJlc3MpLAogICAgICB3b3JrZXJWZWN0b3JBZGRyZXNzID0gX21lbUFsbG9jJGdldDIud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldChyZXN1bHRBZGRyZXNzKSwKICAgICAgd29ya2VyUmVzdWx0QWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICBwdl9tYXRyaXhfdmVjdG9yX211bHRpcGx5KHdvcmtlck1hdHJpeEFkZHJlc3MsIHdvcmtlclZlY3RvckFkZHJlc3MsIG0sIG4sIHdvcmtlclJlc3VsdEFkZHJlc3MpOwogICAgcmV0dXJuIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2xpY2Uod29ya2VyUmVzdWx0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgd29ya2VyUmVzdWx0QWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCArIG0pOwogIH07CiAgdmFyIHN5bmNWZWN0b3IgPSBmdW5jdGlvbiBzeW5jVmVjdG9yKGRhdGEpIHsKICAgIHZhciBfZGF0YSRnbG9iYWxzMiA9IGRhdGEuZ2xvYmFscywKICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMi5tZW1BbGxvYywKICAgICAgbWVtb3J5ID0gX2RhdGEkZ2xvYmFsczIubWVtb3J5OwogICAgdmFyIHZlY3RvckFkZHJlc3MgPSBkYXRhLnZlY3RvckFkZHJlc3MsCiAgICAgIGJ1ZmZlciA9IGRhdGEuYnVmZmVyOwogICAgaWYgKG1lbUFsbG9jLmhhcyh2ZWN0b3JBZGRyZXNzKSkgewogICAgICB2YXIgbWVtb3J5QnVmZmVyRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldCh2ZWN0b3JBZGRyZXNzKSwKICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDQud29ya2VyTWVtQWRkcmVzczsKICAgICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQoYnVmZmVyLCB3b3JrZXJNZW1BZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIH0KICB9OwogIHZhciBwdk12bUFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2WHB1QWN0aW9uLk1BVFJJWF9WRUNUT1JfTVVMVElQTFksIG1hdHJpeFZlY3Rvck11bHRpcGx5KSwgUHZYcHVBY3Rpb24uU1lOQ19WRUNUT1IsIHN5bmNWZWN0b3IpOwoKICAvKiBlc2xpbnQgY2FtZWxjYXNlOiAwICovCiAgdmFyIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbjsKICAoZnVuY3Rpb24gKFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbikgewogICAgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uW1B2UGljb2xsbUF0dGVudGlvbkFjdGlvblsiQVRURU5USU9OX1BSRUNPTVBVVEVfRU5DT0RJTkciXSA9IDIwMF0gPSAiQVRURU5USU9OX1BSRUNPTVBVVEVfRU5DT0RJTkciOwogICAgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uW1B2UGljb2xsbUF0dGVudGlvbkFjdGlvblsiQVRURU5USU9OX0FUVEVORF9DT01CSU5FRCJdID0gMjAxXSA9ICJBVFRFTlRJT05fQVRURU5EX0NPTUJJTkVEIjsKICB9KShQdlBpY29sbG1BdHRlbnRpb25BY3Rpb24gfHwgKFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbiA9IHt9KSk7CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHRvUHJvcGVydHlLZXkoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7CiAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgfSk7CiAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdOyBpZiAoIWl0KSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHZhciBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7IHRocm93IF9lOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9IHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsgaXQgPSBpdC5jYWxsKG8pOyB9LCBuOiBmdW5jdGlvbiBuKCkgeyB2YXIgc3RlcCA9IGl0Lm5leHQoKTsgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsgcmV0dXJuIHN0ZXA7IH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7IGRpZEVyciA9IHRydWU7IGVyciA9IF9lMjsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTsgfSBmaW5hbGx5IHsgaWYgKGRpZEVycikgdGhyb3cgZXJyOyB9IH0gfTsgfQogIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOyB9CiAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTsgcmV0dXJuIGFycjI7IH0KICB2YXIgUHZYcHUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUHZYcHUoKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQdlhwdSk7CiAgICB9CiAgICBfY3JlYXRlQ2xhc3MoUHZYcHUsIG51bGwsIFt7CiAgICAgIGtleTogImFkZFhwdSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRYcHUob2JqQWRkcmVzcywgZGF0YSkgewogICAgICAgIFB2WHB1LnhwdU9iamVjdHMuc2V0KG9iakFkZHJlc3MsIGRhdGEpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFhwdSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRYcHUob2JqQWRkcmVzcykgewogICAgICAgIHJldHVybiBQdlhwdS54cHVPYmplY3RzLmdldChvYmpBZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJoYXNYcHUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzWHB1KG9iakFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gUHZYcHUueHB1T2JqZWN0cy5oYXMob2JqQWRkcmVzcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlWHB1IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVhwdShvYmpBZGRyZXNzKSB7CiAgICAgICAgaWYgKFB2WHB1LnhwdU9iamVjdHMuaGFzKG9iakFkZHJlc3MpKSB7CiAgICAgICAgICB2YXIgX1B2WHB1JHhwdU9iamVjdHMkZ2V0ID0gUHZYcHUueHB1T2JqZWN0cy5nZXQob2JqQWRkcmVzcyksCiAgICAgICAgICAgIGRldmljZU1lbSA9IF9QdlhwdSR4cHVPYmplY3RzJGdldC5kZXZpY2VNZW07CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZGV2aWNlTWVtKSwKICAgICAgICAgICAgX3N0ZXA7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciBtZW1BZGRyZXNzID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgUHZYcHUubWVtb3J5T2JqZWN0c1siZGVsZXRlIl0obWVtQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgIH0KICAgICAgICAgIFB2WHB1LnhwdU9iamVjdHNbImRlbGV0ZSJdKG9iakFkZHJlc3MpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJhZGRNZW1vcnkiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTWVtb3J5KG1lbUFkZHJlc3MsIGRhdGEpIHsKICAgICAgICBQdlhwdS5tZW1vcnlPYmplY3RzLnNldChtZW1BZGRyZXNzLCBkYXRhKTsKICAgICAgICBQdlhwdS54cHVPYmplY3RzLmdldChkYXRhLm9iakFkZHJlc3MpLmRldmljZU1lbS5hZGQobWVtQWRkcmVzcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0TWVtb3J5IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE1lbW9yeShtZW1BZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIFB2WHB1Lm1lbW9yeU9iamVjdHMuZ2V0KG1lbUFkZHJlc3MpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImhhc01lbW9yeSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNNZW1vcnkobWVtQWRkcmVzcykgewogICAgICAgIHJldHVybiBQdlhwdS5tZW1vcnlPYmplY3RzLmhhcyhtZW1BZGRyZXNzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmVNZW1vcnkiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTWVtb3J5KG1lbUFkZHJlc3MpIHsKICAgICAgICBpZiAoUHZYcHUuaGFzTWVtb3J5KG1lbUFkZHJlc3MpKSB7CiAgICAgICAgICBQdlhwdS54cHVPYmplY3RzLmdldChQdlhwdS5nZXRNZW1vcnkobWVtQWRkcmVzcykub2JqQWRkcmVzcykuZGV2aWNlTWVtWyJkZWxldGUiXShtZW1BZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgUHZYcHUubWVtb3J5T2JqZWN0c1siZGVsZXRlIl0obWVtQWRkcmVzcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0VW5pcXVlUG9pbnRlciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVbmlxdWVQb2ludGVyKCkgewogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICB2YXIgcHRyID0gTWF0aC5jZWlsKChwZXJmb3JtYW5jZS5ub3coKSArIE1hdGgucmFuZG9tKCkpICogMTBlMik7CiAgICAgICAgICBpZiAoIXRoaXMudW5pcXVlUG9pbnRlcnMuaGFzKHB0cikpIHsKICAgICAgICAgICAgdGhpcy51bmlxdWVQb2ludGVycy5hZGQocHRyKTsKICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlVW5pcXVlUG9pbnRlciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVVbmlxdWVQb2ludGVyKHB0cikgewogICAgICAgIGlmICh0aGlzLnVuaXF1ZVBvaW50ZXJzLmhhcyhwdHIpKSB7CiAgICAgICAgICB0aGlzLnVuaXF1ZVBvaW50ZXJzWyJkZWxldGUiXShwdHIpOwogICAgICAgIH0KICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIFB2WHB1OwogIH0oKTsKICBfZGVmaW5lUHJvcGVydHkoUHZYcHUsICJ4cHVPYmplY3RzIiwgbmV3IE1hcCgpKTsKICBfZGVmaW5lUHJvcGVydHkoUHZYcHUsICJtZW1vcnlPYmplY3RzIiwgbmV3IE1hcCgpKTsKICBfZGVmaW5lUHJvcGVydHkoUHZYcHUsICJ1bmlxdWVQb2ludGVycyIsIG5ldyBTZXQoKSk7CgogIHZhciBhdHRlbnRpb25QcmVjb21wdXRlRW5jb2RpbmcgPSBmdW5jdGlvbiBhdHRlbnRpb25QcmVjb21wdXRlRW5jb2RpbmcoZGF0YSkgewogICAgdmFyIF9kYXRhJGdsb2JhbHMgPSBkYXRhLmdsb2JhbHMsCiAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzLmV4cG9ydHMsCiAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFscy5tZW1BbGxvYzsKICAgIHZhciBlbmNvZGluZ0FkZHJlc3MgPSBkYXRhLmVuY29kaW5nQWRkcmVzcywKICAgICAgZGltZW5zaW9uID0gZGF0YS5kaW1lbnNpb24sCiAgICAgIHN0ZXBzID0gZGF0YS5zdGVwcywKICAgICAgdGhldGEgPSBkYXRhLnRoZXRhOwogICAgdmFyIHB2X3BpY29sbG1fYXR0ZW50aW9uX3ByZWNvbXB1dGVfZW5jb2Rpbmdfd2FzbSA9IGV4cG9ydHMucHZfcGljb2xsbV9hdHRlbnRpb25fcHJlY29tcHV0ZV9lbmNvZGluZ193YXNtOwogICAgdmFyIF9tZW1BbGxvYyRnZXQgPSBtZW1BbGxvYy5nZXQoZW5jb2RpbmdBZGRyZXNzKSwKICAgICAgd29ya2VyRW5jb2RpbmdBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fcHJlY29tcHV0ZV9lbmNvZGluZ193YXNtKHdvcmtlckVuY29kaW5nQWRkcmVzcywgZGltZW5zaW9uLCBzdGVwcywgdGhldGEpOwogIH07CiAgdmFyIGF0dGVudGlvbkF0dGVuZENvbWJpbmVkID0gZnVuY3Rpb24gYXR0ZW50aW9uQXR0ZW5kQ29tYmluZWQoZGF0YSkgewogICAgdmFyIF9kYXRhJGdsb2JhbHMyID0gZGF0YS5nbG9iYWxzLAogICAgICBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczIuZXhwb3J0cywKICAgICAgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzMi5tZW1BbGxvYywKICAgICAgbWVtb3J5ID0gX2RhdGEkZ2xvYmFsczIubWVtb3J5OwogICAgdmFyIG51bUhlYWRzID0gZGF0YS5udW1IZWFkcywKICAgICAgbnVtS3ZIZWFkcyA9IGRhdGEubnVtS3ZIZWFkcywKICAgICAgd2luZG93TGVuZ3RoID0gZGF0YS53aW5kb3dMZW5ndGgsCiAgICAgIGhlYWREaW1lbnNpb24gPSBkYXRhLmhlYWREaW1lbnNpb24sCiAgICAgIHJvcGVEaW1lbnNpb24gPSBkYXRhLnJvcGVEaW1lbnNpb24sCiAgICAgIHJvcGVJbnRlcmxlYXZlZCA9IGRhdGEucm9wZUludGVybGVhdmVkLAogICAgICBuZXdFbmNvZGluZ0FkZHJlc3MgPSBkYXRhLm5ld0VuY29kaW5nQWRkcmVzcywKICAgICAgcUJ1ZmZlciA9IGRhdGEucUJ1ZmZlciwKICAgICAga0J1ZmZlciA9IGRhdGEua0J1ZmZlciwKICAgICAgdkJ1ZmZlciA9IGRhdGEudkJ1ZmZlciwKICAgICAga2V5c0FkZHJlc3MgPSBkYXRhLmtleXNBZGRyZXNzLAogICAgICBrZXlJbnRlcmNlcHRzQWRkcmVzcyA9IGRhdGEua2V5SW50ZXJjZXB0c0FkZHJlc3MsCiAgICAgIGtleVNsb3Blc0FkZHJlc3MgPSBkYXRhLmtleVNsb3Blc0FkZHJlc3MsCiAgICAgIHZhbHVlc0FkZHJlc3MgPSBkYXRhLnZhbHVlc0FkZHJlc3MsCiAgICAgIHZhbHVlSW50ZXJjZXB0c0FkZHJlc3MgPSBkYXRhLnZhbHVlSW50ZXJjZXB0c0FkZHJlc3MsCiAgICAgIHZhbHVlU2xvcGVzQWRkcmVzcyA9IGRhdGEudmFsdWVTbG9wZXNBZGRyZXNzLAogICAgICBwb3NpdGlvbiA9IGRhdGEucG9zaXRpb24sCiAgICAgIHF1ZXJ5QWRkcmVzcyA9IGRhdGEucXVlcnlBZGRyZXNzLAogICAgICBuID0gZGF0YS5uOwogICAgdmFyIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2MsCiAgICAgIGZyZWUgPSBleHBvcnRzLmZyZWUsCiAgICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX2VuY29kZV93YXNtID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl9lbmNvZGVfd2FzbSwKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX2tleXNfd2FzbSA9IGV4cG9ydHMucHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX2tleXNfd2FzbSwKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX3ZhbHVlc193YXNtID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfdmFsdWVzX3dhc20sCiAgICAgIHB2X3BpY29sbG1fYXR0ZW50aW9uX3RyYW5zcG9zZV9xdWVyeV93YXNtID0gZXhwb3J0cy5wdl9waWNvbGxtX2F0dGVudGlvbl90cmFuc3Bvc2VfcXVlcnlfd2FzbSwKICAgICAgcHZfcGljb2xsbV9hdHRlbnRpb25fYXR0ZW5kX3dhc20gPSBleHBvcnRzLnB2X3BpY29sbG1fYXR0ZW50aW9uX2F0dGVuZF93YXNtOwogICAgdmFyIF9tZW1BbGxvYyRnZXQyID0gbWVtQWxsb2MuZ2V0KG5ld0VuY29kaW5nQWRkcmVzcyksCiAgICAgIHdvcmtlckVuY29kaW5nQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQyLndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDMgPSBtZW1BbGxvYy5nZXQoa2V5c0FkZHJlc3MpLAogICAgICB3b3JrZXJLZXlzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDQgPSBtZW1BbGxvYy5nZXQoa2V5SW50ZXJjZXB0c0FkZHJlc3MpLAogICAgICB3b3JrZXJLZXlJbnRlcmNlcHRzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ0Lndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDUgPSBtZW1BbGxvYy5nZXQoa2V5U2xvcGVzQWRkcmVzcyksCiAgICAgIHdvcmtlcktleVNsb3Blc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0NS53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIF9tZW1BbGxvYyRnZXQ2ID0gbWVtQWxsb2MuZ2V0KHZhbHVlc0FkZHJlc3MpLAogICAgICB3b3JrZXJWYWx1ZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDYud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0NyA9IG1lbUFsbG9jLmdldCh2YWx1ZUludGVyY2VwdHNBZGRyZXNzKSwKICAgICAgd29ya2VyVmFsdWVJbnRlcmNlcHRzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ3Lndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgX21lbUFsbG9jJGdldDggPSBtZW1BbGxvYy5nZXQodmFsdWVTbG9wZXNBZGRyZXNzKSwKICAgICAgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDgud29ya2VyTWVtQWRkcmVzczsKICAgIHZhciBfbWVtQWxsb2MkZ2V0OSA9IG1lbUFsbG9jLmdldChxdWVyeUFkZHJlc3MpLAogICAgICB3b3JrZXJRdWVyeUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0OS53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIHdvcmtlclFBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHFCdWZmZXIubGVuZ3RoICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIHZhciB3b3JrZXJLQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBrQnVmZmVyLmxlbmd0aCAqIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICB2YXIgd29ya2VyVkFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgdkJ1ZmZlci5sZW5ndGggKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgdmFyIGxlbmd0aCA9IG51bUhlYWRzICogaGVhZERpbWVuc2lvbiAqIG47CiAgICB2YXIgd29ya2VyT3V0cHV0QWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBsZW5ndGggKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgdmFyIG1lbW9yeUJ1ZmZlckZsb2F0MzIgPSBuZXcgRmxvYXQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQocUJ1ZmZlciwgd29ya2VyUUFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQoa0J1ZmZlciwgd29ya2VyS0FkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQodkJ1ZmZlciwgd29ya2VyVkFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5maWxsKDAsIHdvcmtlck91dHB1dEFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIHdvcmtlck91dHB1dEFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKyBsZW5ndGgpOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fZW5jb2RlX3dhc20od29ya2VyUUFkZHJlc3MsIHdvcmtlckVuY29kaW5nQWRkcmVzcywgbiwgbnVtSGVhZHMsIHJvcGVJbnRlcmxlYXZlZCwgaGVhZERpbWVuc2lvbiwgcm9wZURpbWVuc2lvbiwgcG9zaXRpb24pOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdHJhbnNwb3NlX3F1ZXJ5X3dhc20obiwgd29ya2VyUUFkZHJlc3MsIHdvcmtlclF1ZXJ5QWRkcmVzcywgbnVtSGVhZHMsIGhlYWREaW1lbnNpb24pOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fZW5jb2RlX3dhc20od29ya2VyS0FkZHJlc3MsIHdvcmtlckVuY29kaW5nQWRkcmVzcywgbiwgbnVtS3ZIZWFkcywgcm9wZUludGVybGVhdmVkLCBoZWFkRGltZW5zaW9uLCByb3BlRGltZW5zaW9uLCBwb3NpdGlvbik7CiAgICBwdl9waWNvbGxtX2F0dGVudGlvbl91cGRhdGVfa2V5c193YXNtKG51bUt2SGVhZHMsIHdpbmRvd0xlbmd0aCwgaGVhZERpbWVuc2lvbiwgd29ya2VyS2V5c0FkZHJlc3MsIHdvcmtlcktleUludGVyY2VwdHNBZGRyZXNzLCB3b3JrZXJLZXlTbG9wZXNBZGRyZXNzLCBwb3NpdGlvbiwgbiwgd29ya2VyS0FkZHJlc3MpOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fdXBkYXRlX3ZhbHVlc193YXNtKG51bUt2SGVhZHMsIHdpbmRvd0xlbmd0aCwgaGVhZERpbWVuc2lvbiwgd29ya2VyVmFsdWVzQWRkcmVzcywgd29ya2VyVmFsdWVJbnRlcmNlcHRzQWRkcmVzcywgd29ya2VyVmFsdWVTbG9wZXNBZGRyZXNzLCBwb3NpdGlvbiwgbiwgd29ya2VyVkFkZHJlc3MpOwogICAgcHZfcGljb2xsbV9hdHRlbnRpb25fYXR0ZW5kX3dhc20obnVtSGVhZHMsIG51bUt2SGVhZHMsIHdpbmRvd0xlbmd0aCwgaGVhZERpbWVuc2lvbiwgd29ya2VyS2V5c0FkZHJlc3MsIHdvcmtlcktleUludGVyY2VwdHNBZGRyZXNzLCB3b3JrZXJLZXlTbG9wZXNBZGRyZXNzLCB3b3JrZXJWYWx1ZXNBZGRyZXNzLCB3b3JrZXJWYWx1ZUludGVyY2VwdHNBZGRyZXNzLCB3b3JrZXJWYWx1ZVNsb3Blc0FkZHJlc3MsIHBvc2l0aW9uLCB3b3JrZXJRdWVyeUFkZHJlc3MsIG4sIHdvcmtlck91dHB1dEFkZHJlc3MpOwogICAgbWVtb3J5QnVmZmVyRmxvYXQzMiA9IG5ldyBGbG9hdDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICB2YXIgcmVzID0gbWVtb3J5QnVmZmVyRmxvYXQzMi5zbGljZSh3b3JrZXJPdXRwdXRBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCB3b3JrZXJPdXRwdXRBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICsgbGVuZ3RoKTsKICAgIGZyZWUod29ya2VyUUFkZHJlc3MpOwogICAgZnJlZSh3b3JrZXJLQWRkcmVzcyk7CiAgICBmcmVlKHdvcmtlclZBZGRyZXNzKTsKICAgIGZyZWUod29ya2VyT3V0cHV0QWRkcmVzcyk7CiAgICByZXR1cm4gcmVzOwogIH07CiAgdmFyIHB2UGljb2xsbUF0dGVudGlvbkFjdGlvbk1hcCA9IF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2UGljb2xsbUF0dGVudGlvbkFjdGlvbi5BVFRFTlRJT05fUFJFQ09NUFVURV9FTkNPRElORywgYXR0ZW50aW9uUHJlY29tcHV0ZUVuY29kaW5nKSwgUHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uLkFUVEVOVElPTl9BVFRFTkRfQ09NQklORUQsIGF0dGVudGlvbkF0dGVuZENvbWJpbmVkKTsKCiAgLyogZXNsaW50IGNhbWVsY2FzZTogMCAqLwogIHZhciBQdlBpY29sbG1XZWlnaHRBY3Rpb247CiAgKGZ1bmN0aW9uIChQdlBpY29sbG1XZWlnaHRBY3Rpb24pIHsKICAgIFB2UGljb2xsbVdlaWdodEFjdGlvbltQdlBpY29sbG1XZWlnaHRBY3Rpb25bIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQkxPQ0tTIl0gPSAxMDBdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQkxPQ0tTIjsKICAgIFB2UGljb2xsbVdlaWdodEFjdGlvbltQdlBpY29sbG1XZWlnaHRBY3Rpb25bIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfTUVUQVMiXSA9IDEwMV0gPSAiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfUFJFUFJPQ0VTU19NRVRBUyI7CiAgICBQdlBpY29sbG1XZWlnaHRBY3Rpb25bUHZQaWNvbGxtV2VpZ2h0QWN0aW9uWyJXRUlHSFRfQkxPQ0tfTUlYRURfMTZYOF9QUkVQUk9DRVNTX0JJQVMiXSA9IDEwMl0gPSAiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfUFJFUFJPQ0VTU19CSUFTIjsKICAgIFB2UGljb2xsbVdlaWdodEFjdGlvbltQdlBpY29sbG1XZWlnaHRBY3Rpb25bIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfU0lOR0xFIl0gPSAxMDNdID0gIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfU0lOR0xFIjsKICAgIFB2UGljb2xsbVdlaWdodEFjdGlvbltQdlBpY29sbG1XZWlnaHRBY3Rpb25bIldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfTVVMVElQTEUiXSA9IDEwNF0gPSAiV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfRk9SV0FSRF9NVUxUSVBMRSI7CiAgfSkoUHZQaWNvbGxtV2VpZ2h0QWN0aW9uIHx8IChQdlBpY29sbG1XZWlnaHRBY3Rpb24gPSB7fSkpOwoKICB2YXIgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmxvY2tzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlKGRhdGEpIHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHMsIGV4cG9ydHMsIG1lbUFsbG9jLCBtZW1vcnksIHNoYXBlLCBiaXREZXB0aHMsIGJpdERlcHRoU3RhcnRzLCBudW1CbG9ja0J5dGVzLCBibG9ja3NBZGRyZXNzLCBibG9jaywgYWxpZ25lZF9hbGxvYywgZnJlZSwgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9wcmVwcm9jZXNzX2Jsb2Nrcywgd29ya2VyQmxvY2tzQWRkcmVzcywgc2hhcGVBZGRyZXNzLCBiaXREZXB0aHNBZGRyZXNzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIG1lbW9yeUJ1ZmZlclVpbnQ4LCBtZW1vcnlCdWZmZXJJbnQzMjsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUkMS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2RhdGEkZ2xvYmFscyA9IGRhdGEuZ2xvYmFscywgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMuZXhwb3J0cywgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzLm1lbUFsbG9jLCBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzLm1lbW9yeTsKICAgICAgICAgICAgc2hhcGUgPSBkYXRhLnNoYXBlLCBiaXREZXB0aHMgPSBkYXRhLmJpdERlcHRocywgYml0RGVwdGhTdGFydHMgPSBkYXRhLmJpdERlcHRoU3RhcnRzLCBudW1CbG9ja0J5dGVzID0gZGF0YS5udW1CbG9ja0J5dGVzLCBibG9ja3NBZGRyZXNzID0gZGF0YS5ibG9ja3NBZGRyZXNzLCBibG9jayA9IGRhdGEuYmxvY2s7CiAgICAgICAgICAgIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2MsIGZyZWUgPSBleHBvcnRzLmZyZWUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfcHJlcHJvY2Vzc19ibG9ja3MgPSBleHBvcnRzLnB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfcHJlcHJvY2Vzc19ibG9ja3M7CiAgICAgICAgICAgIHdvcmtlckJsb2Nrc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIG51bUJsb2NrQnl0ZXMgKiBVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgaWYgKHdvcmtlckJsb2Nrc0FkZHJlc3MpIHsKICAgICAgICAgICAgICBtZW1BbGxvYy5zZXQoYmxvY2tzQWRkcmVzcywgewogICAgICAgICAgICAgICAgYWxsb2NTaXplOiBudW1CbG9ja0J5dGVzLAogICAgICAgICAgICAgICAgd29ya2VyTWVtQWRkcmVzczogd29ya2VyQmxvY2tzQWRkcmVzcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNoYXBlQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIHNoYXBlLmxlbmd0aCk7CiAgICAgICAgICAgICAgYml0RGVwdGhzQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRocy5sZW5ndGgpOwogICAgICAgICAgICAgIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRoU3RhcnRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlclVpbnQ4LnNldChibG9jaywgd29ya2VyQmxvY2tzQWRkcmVzcyk7CiAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KHNoYXBlLCBzaGFwZUFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhzLCBiaXREZXB0aHNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRoU3RhcnRzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgICBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X3ByZXByb2Nlc3NfYmxvY2tzKHNoYXBlQWRkcmVzcywgYml0RGVwdGhzLmxlbmd0aCwgYml0RGVwdGhzQWRkcmVzcywgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCB3b3JrZXJCbG9ja3NBZGRyZXNzKTsKICAgICAgICAgICAgICBmcmVlKHNoYXBlQWRkcmVzcyk7CiAgICAgICAgICAgICAgZnJlZShiaXREZXB0aHNBZGRyZXNzKTsKICAgICAgICAgICAgICBmcmVlKGJpdERlcHRoc1N0YXJ0QWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NCbG9ja3MoX3gpIHsKICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpOwogIHZhciB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NNZXRhcyA9IGZ1bmN0aW9uIHdlaWdodEJsb2NrTWl4ZWQxNng4UHJlcHJvY2Vzc01ldGFzKGRhdGEpIHsKICAgIHZhciBfZGF0YSRnbG9iYWxzMiA9IGRhdGEuZ2xvYmFscywKICAgICAgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHMyLmV4cG9ydHMsCiAgICAgIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczIubWVtQWxsb2MsCiAgICAgIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHMyLm1lbW9yeTsKICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzLAogICAgICBtZXRhcyA9IGRhdGEubWV0YXM7CiAgICB2YXIgYWxpZ25lZF9hbGxvYyA9IGV4cG9ydHMuYWxpZ25lZF9hbGxvYzsKICAgIHZhciB3b3JrZXJNZXRhc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKFVpbnQxNkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBtZXRhcy5sZW5ndGggKiBVaW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICBpZiAod29ya2VyTWV0YXNBZGRyZXNzKSB7CiAgICAgIG1lbUFsbG9jLnNldChtZW1BZGRyZXNzLCB7CiAgICAgICAgYWxsb2NTaXplOiBtZXRhcy5sZW5ndGggKiBVaW50MTZBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwKICAgICAgICB3b3JrZXJNZW1BZGRyZXNzOiB3b3JrZXJNZXRhc0FkZHJlc3MKICAgICAgfSk7CiAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50MTYgPSBuZXcgVWludDE2QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgIG1lbW9yeUJ1ZmZlclVpbnQxNi5zZXQobWV0YXMsIHdvcmtlck1ldGFzQWRkcmVzcyAvIFVpbnQxNkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIH0KICB9OwogIHZhciB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NCaWFzID0gZnVuY3Rpb24gd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzQmlhcyhkYXRhKSB7CiAgICB2YXIgX2RhdGEkZ2xvYmFsczMgPSBkYXRhLmdsb2JhbHMsCiAgICAgIGV4cG9ydHMgPSBfZGF0YSRnbG9iYWxzMy5leHBvcnRzLAogICAgICBtZW1BbGxvYyA9IF9kYXRhJGdsb2JhbHMzLm1lbUFsbG9jLAogICAgICBtZW1vcnkgPSBfZGF0YSRnbG9iYWxzMy5tZW1vcnk7CiAgICB2YXIgbWVtQWRkcmVzcyA9IGRhdGEubWVtQWRkcmVzcywKICAgICAgYmlhcyA9IGRhdGEuYmlhczsKICAgIHZhciBhbGlnbmVkX2FsbG9jID0gZXhwb3J0cy5hbGlnbmVkX2FsbG9jOwogICAgdmFyIHdvcmtlckJpYXNBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIGJpYXMubGVuZ3RoICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgIGlmICh3b3JrZXJCaWFzQWRkcmVzcykgewogICAgICBtZW1BbGxvYy5zZXQobWVtQWRkcmVzcywgewogICAgICAgIGFsbG9jU2l6ZTogYmlhcy5sZW5ndGggKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCiAgICAgICAgd29ya2VyTWVtQWRkcmVzczogd29ya2VyQmlhc0FkZHJlc3MKICAgICAgfSk7CiAgICAgIHZhciBtZW1vcnlCdWZmZXJGbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgbWVtb3J5QnVmZmVyRmxvYXQzMi5zZXQoYmlhcywgd29ya2VyQmlhc0FkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgfQogIH07CiAgdmFyIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZFNpbmdsZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUkMS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGRhdGEpIHsKICAgICAgdmFyIF9kYXRhJGdsb2JhbHM0LCBleHBvcnRzLCBtZW1BbGxvYywgbWVtb3J5LCBzaGFwZSwgaW5kaWNlc0FkZHJlc3MsIGJpdERlcHRoU3RhcnRzLCBiaXREZXB0aHMsIG1ldGFzQWRkcmVzcywgYmxvY2tzQWRkcmVzcywgeE9mZnNldCwgeEJ1ZmZlciwgYmlhc0FkZHJlc3MsIGFsaWduZWRfYWxsb2MsIGZyZWUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9zaW5nbGUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMsIF9tZW1BbGxvYyRnZXQsIHdvcmtlckluZGljZXNBZGRyZXNzLCBfbWVtQWxsb2MkZ2V0Miwgd29ya2VyTWV0YXNBZGRyZXNzLCBfbWVtQWxsb2MkZ2V0Mywgd29ya2VyQmxvY2tzQWRkcmVzcywgc2hhcGVBZGRyZXNzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIGJpdERlcHRoc0FkZHJlc3MsIHdvcmtlclhBZGRyZXNzLCB3b3JrZXJZQWRkcmVzcywgbWVtb3J5QnVmZmVyRmxvYXQzMiwgbWVtb3J5QnVmZmVySW50MzIsIF9tZW1BbGxvYyRnZXQ0LCB3b3JrZXJCaWFzQWRkcmVzcywgYWxsb2NTaXplLCBkaW1lbnNpb24sIHJlczsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUkMS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9kYXRhJGdsb2JhbHM0ID0gZGF0YS5nbG9iYWxzLCBleHBvcnRzID0gX2RhdGEkZ2xvYmFsczQuZXhwb3J0cywgbWVtQWxsb2MgPSBfZGF0YSRnbG9iYWxzNC5tZW1BbGxvYywgbWVtb3J5ID0gX2RhdGEkZ2xvYmFsczQubWVtb3J5OwogICAgICAgICAgICBzaGFwZSA9IGRhdGEuc2hhcGUsIGluZGljZXNBZGRyZXNzID0gZGF0YS5pbmRpY2VzQWRkcmVzcywgYml0RGVwdGhTdGFydHMgPSBkYXRhLmJpdERlcHRoU3RhcnRzLCBiaXREZXB0aHMgPSBkYXRhLmJpdERlcHRocywgbWV0YXNBZGRyZXNzID0gZGF0YS5tZXRhc0FkZHJlc3MsIGJsb2Nrc0FkZHJlc3MgPSBkYXRhLmJsb2Nrc0FkZHJlc3MsIHhPZmZzZXQgPSBkYXRhLnhPZmZzZXQsIHhCdWZmZXIgPSBkYXRhLnhCdWZmZXIsIGJpYXNBZGRyZXNzID0gZGF0YS5iaWFzQWRkcmVzczsKICAgICAgICAgICAgYWxpZ25lZF9hbGxvYyA9IGV4cG9ydHMuYWxpZ25lZF9hbGxvYywgZnJlZSA9IGV4cG9ydHMuZnJlZSwgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX3NpbmdsZSA9IGV4cG9ydHMucHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX3NpbmdsZSwgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhcyA9IGV4cG9ydHMucHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChpbmRpY2VzQWRkcmVzcyksIHdvcmtlckluZGljZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgICAgICAgICBfbWVtQWxsb2MkZ2V0MiA9IG1lbUFsbG9jLmdldChtZXRhc0FkZHJlc3MpLCB3b3JrZXJNZXRhc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Mi53b3JrZXJNZW1BZGRyZXNzOwogICAgICAgICAgICBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldChibG9ja3NBZGRyZXNzKSwgd29ya2VyQmxvY2tzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICAgICAgICAgIHNoYXBlQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIHNoYXBlLmxlbmd0aCk7CiAgICAgICAgICAgIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIGJpdERlcHRoU3RhcnRzLmxlbmd0aCk7CiAgICAgICAgICAgIGJpdERlcHRoc0FkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aHMubGVuZ3RoKTsKICAgICAgICAgICAgd29ya2VyWEFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKDI1NiwgRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogeEJ1ZmZlci5sZW5ndGgpOwogICAgICAgICAgICB3b3JrZXJZQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoMjU2LCBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBzaGFwZVswXSk7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIgPSBuZXcgRmxvYXQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoc2hhcGUsIHNoYXBlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhTdGFydHMsIGJpdERlcHRoc1N0YXJ0QWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMi5zZXQoYml0RGVwdGhzLCBiaXREZXB0aHNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckZsb2F0MzIuc2V0KHhCdWZmZXIsIHdvcmtlclhBZGRyZXNzIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX3NpbmdsZShzaGFwZUFkZHJlc3MsIHdvcmtlckluZGljZXNBZGRyZXNzLCBiaXREZXB0aHMubGVuZ3RoLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIGJpdERlcHRoc0FkZHJlc3MsIHdvcmtlck1ldGFzQWRkcmVzcywgd29ya2VyQmxvY2tzQWRkcmVzcywgd29ya2VyWEFkZHJlc3MgKyB4T2Zmc2V0LCB3b3JrZXJZQWRkcmVzcyk7CiAgICAgICAgICAgIGlmIChtZW1BbGxvYy5oYXMoYmlhc0FkZHJlc3MpKSB7CiAgICAgICAgICAgICAgX21lbUFsbG9jJGdldDQgPSBtZW1BbGxvYy5nZXQoYmlhc0FkZHJlc3MpLCB3b3JrZXJCaWFzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ0Lndvcmtlck1lbUFkZHJlc3MsIGFsbG9jU2l6ZSA9IF9tZW1BbGxvYyRnZXQ0LmFsbG9jU2l6ZTsKICAgICAgICAgICAgICBkaW1lbnNpb24gPSBhbGxvY1NpemUgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7CiAgICAgICAgICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhcygxLCBkaW1lbnNpb24sIHdvcmtlcllBZGRyZXNzLCB3b3JrZXJCaWFzQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKS5zbGljZSh3b3JrZXJZQWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgd29ya2VyWUFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKyBzaGFwZVswXSk7CiAgICAgICAgICAgIGZyZWUoc2hhcGVBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZShiaXREZXB0aHNTdGFydEFkZHJlc3MpOwogICAgICAgICAgICBmcmVlKGJpdERlcHRoc0FkZHJlc3MpOwogICAgICAgICAgICBmcmVlKHdvcmtlclhBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZSh3b3JrZXJZQWRkcmVzcyk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCByZXMpOwogICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIpOwogICAgfSkpOwogICAgcmV0dXJuIGZ1bmN0aW9uIHdlaWdodEJsb2NrTWl4ZWQxNng4Rm9yd2FyZFNpbmdsZShfeDIpIHsKICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKICB2YXIgd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkTXVsdGlwbGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhkYXRhKSB7CiAgICAgIHZhciBfZGF0YSRnbG9iYWxzNSwgZXhwb3J0cywgbWVtQWxsb2MsIG1lbW9yeSwgc2hhcGUsIGluZGljZXNBZGRyZXNzLCBiaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzLCBtZXRhc0FkZHJlc3MsIGJsb2Nrc0FkZHJlc3MsIG4sIHhPZmZzZXQsIHhCdWZmZXIsIGJpYXNBZGRyZXNzLCBhbGlnbmVkX2FsbG9jLCBmcmVlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2ZvcndhcmRfbXVsdGlwbGUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfYWRkX2JpYXMsIF9tZW1BbGxvYyRnZXQ1LCB3b3JrZXJJbmRpY2VzQWRkcmVzcywgX21lbUFsbG9jJGdldDYsIHdvcmtlck1ldGFzQWRkcmVzcywgX21lbUFsbG9jJGdldDcsIHdvcmtlckJsb2Nrc0FkZHJlc3MsIHNoYXBlQWRkcmVzcywgYml0RGVwdGhzU3RhcnRBZGRyZXNzLCBiaXREZXB0aHNBZGRyZXNzLCB3b3JrZXJYQWRkcmVzcywgd29ya2VyWUFkZHJlc3MsIG1lbW9yeUJ1ZmZlckZsb2F0MzIsIG1lbW9yeUJ1ZmZlckludDMyLCBfbWVtQWxsb2MkZ2V0OCwgd29ya2VyQmlhc0FkZHJlc3MsIGFsbG9jU2l6ZSwgZGltZW5zaW9uLCByZXM7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfZGF0YSRnbG9iYWxzNSA9IGRhdGEuZ2xvYmFscywgZXhwb3J0cyA9IF9kYXRhJGdsb2JhbHM1LmV4cG9ydHMsIG1lbUFsbG9jID0gX2RhdGEkZ2xvYmFsczUubWVtQWxsb2MsIG1lbW9yeSA9IF9kYXRhJGdsb2JhbHM1Lm1lbW9yeTsKICAgICAgICAgICAgc2hhcGUgPSBkYXRhLnNoYXBlLCBpbmRpY2VzQWRkcmVzcyA9IGRhdGEuaW5kaWNlc0FkZHJlc3MsIGJpdERlcHRoU3RhcnRzID0gZGF0YS5iaXREZXB0aFN0YXJ0cywgYml0RGVwdGhzID0gZGF0YS5iaXREZXB0aHMsIG1ldGFzQWRkcmVzcyA9IGRhdGEubWV0YXNBZGRyZXNzLCBibG9ja3NBZGRyZXNzID0gZGF0YS5ibG9ja3NBZGRyZXNzLCBuID0gZGF0YS5uLCB4T2Zmc2V0ID0gZGF0YS54T2Zmc2V0LCB4QnVmZmVyID0gZGF0YS54QnVmZmVyLCBiaWFzQWRkcmVzcyA9IGRhdGEuYmlhc0FkZHJlc3M7CiAgICAgICAgICAgIGFsaWduZWRfYWxsb2MgPSBleHBvcnRzLmFsaWduZWRfYWxsb2MsIGZyZWUgPSBleHBvcnRzLmZyZWUsIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9tdWx0aXBsZSA9IGV4cG9ydHMucHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9mb3J3YXJkX211bHRpcGxlLCBwdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2FkZF9iaWFzID0gZXhwb3J0cy5wdl9waWNvbGxtX3dlaWdodF9ibG9ja19taXhlZF8xNng4X2FkZF9iaWFzOwogICAgICAgICAgICBfbWVtQWxsb2MkZ2V0NSA9IG1lbUFsbG9jLmdldChpbmRpY2VzQWRkcmVzcyksIHdvcmtlckluZGljZXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDUud29ya2VyTWVtQWRkcmVzczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldDYgPSBtZW1BbGxvYy5nZXQobWV0YXNBZGRyZXNzKSwgd29ya2VyTWV0YXNBZGRyZXNzID0gX21lbUFsbG9jJGdldDYud29ya2VyTWVtQWRkcmVzczsKICAgICAgICAgICAgX21lbUFsbG9jJGdldDcgPSBtZW1BbGxvYy5nZXQoYmxvY2tzQWRkcmVzcyksIHdvcmtlckJsb2Nrc0FkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Ny53b3JrZXJNZW1BZGRyZXNzOwogICAgICAgICAgICBzaGFwZUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBzaGFwZS5sZW5ndGgpOwogICAgICAgICAgICBiaXREZXB0aHNTdGFydEFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiBiaXREZXB0aFN0YXJ0cy5sZW5ndGgpOwogICAgICAgICAgICBiaXREZXB0aHNBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULCBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogYml0RGVwdGhzLmxlbmd0aCk7CiAgICAgICAgICAgIHdvcmtlclhBZGRyZXNzID0gYWxpZ25lZF9hbGxvYyhGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQsIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIHhCdWZmZXIubGVuZ3RoKTsKICAgICAgICAgICAgd29ya2VyWUFkZHJlc3MgPSBhbGlnbmVkX2FsbG9jKEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogKHNoYXBlWzBdICogbikpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJGbG9hdDMyID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KHNoYXBlLCBzaGFwZUFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRoU3RhcnRzLCBiaXREZXB0aHNTdGFydEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTsKICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzIuc2V0KGJpdERlcHRocywgYml0RGVwdGhzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICAgICAgICBtZW1vcnlCdWZmZXJGbG9hdDMyLnNldCh4QnVmZmVyLCB3b3JrZXJYQWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICAgICAgICAgIHB2X3BpY29sbG1fd2VpZ2h0X2Jsb2NrX21peGVkXzE2eDhfZm9yd2FyZF9tdWx0aXBsZShzaGFwZUFkZHJlc3MsIHdvcmtlckluZGljZXNBZGRyZXNzLCBiaXREZXB0aHMubGVuZ3RoLCBiaXREZXB0aHNTdGFydEFkZHJlc3MsIGJpdERlcHRoc0FkZHJlc3MsIHdvcmtlck1ldGFzQWRkcmVzcywgd29ya2VyQmxvY2tzQWRkcmVzcywgbiwgd29ya2VyWEFkZHJlc3MgKyB4T2Zmc2V0LCB3b3JrZXJZQWRkcmVzcyk7CiAgICAgICAgICAgIGlmIChtZW1BbGxvYy5oYXMoYmlhc0FkZHJlc3MpKSB7CiAgICAgICAgICAgICAgX21lbUFsbG9jJGdldDggPSBtZW1BbGxvYy5nZXQoYmlhc0FkZHJlc3MpLCB3b3JrZXJCaWFzQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQ4Lndvcmtlck1lbUFkZHJlc3MsIGFsbG9jU2l6ZSA9IF9tZW1BbGxvYyRnZXQ4LmFsbG9jU2l6ZTsKICAgICAgICAgICAgICBkaW1lbnNpb24gPSBhbGxvY1NpemUgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7CiAgICAgICAgICAgICAgcHZfcGljb2xsbV93ZWlnaHRfYmxvY2tfbWl4ZWRfMTZ4OF9hZGRfYmlhcyhuLCBkaW1lbnNpb24sIHdvcmtlcllBZGRyZXNzLCB3b3JrZXJCaWFzQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzID0gbmV3IEZsb2F0MzJBcnJheShtZW1vcnkuYnVmZmVyKS5zbGljZSh3b3JrZXJZQWRkcmVzcyAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgd29ya2VyWUFkZHJlc3MgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKyBzaGFwZVswXSAqIG4pOwogICAgICAgICAgICBmcmVlKHNoYXBlQWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUoYml0RGVwdGhzU3RhcnRBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZShiaXREZXB0aHNBZGRyZXNzKTsKICAgICAgICAgICAgZnJlZSh3b3JrZXJYQWRkcmVzcyk7CiAgICAgICAgICAgIGZyZWUod29ya2VyWUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgcmVzKTsKICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRNdWx0aXBsZShfeDMpIHsKICAgICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKICB2YXIgcHZQaWNvbGxtV2VpZ2h0QWN0aW9uTWFwID0gX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eSh7fSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X1BSRVBST0NFU1NfQkxPQ0tTLCB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NCbG9ja3MpLCBQdlBpY29sbG1XZWlnaHRBY3Rpb24uV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfUFJFUFJPQ0VTU19NRVRBUywgd2VpZ2h0QmxvY2tNaXhlZDE2eDhQcmVwcm9jZXNzTWV0YXMpLCBQdlBpY29sbG1XZWlnaHRBY3Rpb24uV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfUFJFUFJPQ0VTU19CSUFTLCB3ZWlnaHRCbG9ja01peGVkMTZ4OFByZXByb2Nlc3NCaWFzKSwgUHZQaWNvbGxtV2VpZ2h0QWN0aW9uLldFSUdIVF9CTE9DS19NSVhFRF8xNlg4X0ZPUldBUkRfU0lOR0xFLCB3ZWlnaHRCbG9ja01peGVkMTZ4OEZvcndhcmRTaW5nbGUpLCBQdlBpY29sbG1XZWlnaHRBY3Rpb24uV0VJR0hUX0JMT0NLX01JWEVEXzE2WDhfRk9SV0FSRF9NVUxUSVBMRSwgd2VpZ2h0QmxvY2tNaXhlZDE2eDhGb3J3YXJkTXVsdGlwbGUpOwoKICBmdW5jdGlvbiBvd25LZXlzKGUsIHIpIHsgdmFyIHQgPSBPYmplY3Qua2V5cyhlKTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIG8gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyByICYmIChvID0gby5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSwgcikuZW51bWVyYWJsZTsgfSkpLCB0LnB1c2guYXBwbHkodCwgbyk7IH0gcmV0dXJuIHQ7IH0KICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9CiAgdmFyIGV4cG9ydHMkMTsKICB2YXIgbWVtb3J5OwogIHZhciBtZW1BbGxvYyA9IG5ldyBNYXAoKTsKICBmdW5jdGlvbiBhcnJheUJ1ZmZlclRvU3RyaW5nQXRJbmRleChhcnJheUJ1ZmZlciwgaW5kZXhTdGFydCkgewogICAgdmFyIGluZGV4RW5kID0gaW5kZXhTdGFydDsKICAgIHdoaWxlIChhcnJheUJ1ZmZlcltpbmRleEVuZF0gIT09IDApIHsKICAgICAgaW5kZXhFbmQrKzsKICAgIH0KICAgIHZhciB1dGY4ZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnKTsKICAgIHJldHVybiB1dGY4ZGVjb2Rlci5kZWNvZGUoYXJyYXlCdWZmZXIuc3ViYXJyYXkoaW5kZXhTdGFydCwgaW5kZXhFbmQpKTsKICB9CiAgdmFyIGdldFdhc20gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUkMS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUod2FzbSkgewogICAgICB2YXIgcHZDb25zb2xlTG9nV2FzbSwgcHZBc3NlcnRXYXNtLCBwdlRpbWVXYXNtLCBwdkZpbGVPcGVuV2FzbSwgcHZGaWxlQ2xvc2VXYXNtLCBwdkZpbGVSZWFkV2FzbSwgcHZGaWxlV3JpdGVXYXNtLCBwdkZpbGVTZWVrV2FzbSwgcHZGaWxlVGVsbFdhc20sIHB2RmlsZVJlbW92ZVdhc20sIGluc3RhbmNlLCBhbGlnbmVkX2FsbG9jLCBhbGlnbmVkQWxsb2M7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHB2Q29uc29sZUxvZ1dhc20gPSBmdW5jdGlvbiBwdkNvbnNvbGVMb2dXYXNtKGluZGV4KSB7CiAgICAgICAgICAgICAgaW5kZXggPSB1bnNpZ25lZEFkZHJlc3MoaW5kZXgpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIGluZGV4KSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2QXNzZXJ0V2FzbSA9IGZ1bmN0aW9uIHB2QXNzZXJ0V2FzbShleHByLCBsaW5lLCBmaWxlTmFtZUFkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlTmFtZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZU5hbWVBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICBpZiAoZXhwciA9PT0gMCkgewogICAgICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIGZpbGVOYW1lQWRkcmVzcyk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImFzc2VydGlvbiBmYWlsZWQgYXQgbGluZSAiLmNvbmNhdChsaW5lLCAiIGluIFwiIikuY29uY2F0KGZpbGVOYW1lLCAiXCIiKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdlRpbWVXYXNtID0gZnVuY3Rpb24gcHZUaW1lV2FzbSgpIHsKICAgICAgICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOwogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVPcGVuV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZU9wZW5XYXNtKGZpbGVBZGRyZXNzLCBwYXRoQWRkcmVzcywgbW9kZUFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgcGF0aEFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MocGF0aEFkZHJlc3MpOwogICAgICAgICAgICAgIG1vZGVBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKG1vZGVBZGRyZXNzKTsKICAgICAgICAgICAgICBzdGF0dXNBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKHN0YXR1c0FkZHJlc3MpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJVaW50OCA9IG5ldyBVaW50OEFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHZhciBtZW1vcnlCdWZmZXJJbnQzMiA9IG5ldyBJbnQzMkFycmF5KG1lbW9yeS5idWZmZXIpOwogICAgICAgICAgICAgIHZhciBwYXRoID0gYXJyYXlCdWZmZXJUb1N0cmluZ0F0SW5kZXgobWVtb3J5QnVmZmVyVWludDgsIHBhdGhBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbW9kZSA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBtb2RlQWRkcmVzcyk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLm9wZW4ocGF0aCwgbW9kZSk7CiAgICAgICAgICAgICAgICBQdkZpbGVNZW0uc2V0UHRyKGZpbGVBZGRyZXNzLCBmaWxlKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDA7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVDbG9zZVdhc20gPSBmdW5jdGlvbiBwdkZpbGVDbG9zZVdhc20oZmlsZUFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgc3RhdHVzQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhzdGF0dXNBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIGZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IDA7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVSZWFkV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVJlYWRXYXNtKGZpbGVBZGRyZXNzLCBjb250ZW50QWRkcmVzcywgc2l6ZSwgY291bnQsIG51bVJlYWRBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIGNvbnRlbnRBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGNvbnRlbnRBZGRyZXNzKTsKICAgICAgICAgICAgICBudW1SZWFkQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhudW1SZWFkQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9IGZpbGUucmVhZChzaXplLCBjb3VudCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJVaW50OC5zZXQoY29udGVudCwgY29udGVudEFkZHJlc3MpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbbnVtUmVhZEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IGNvbnRlbnQubGVuZ3RoIC8gc2l6ZTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltudW1SZWFkQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBwdkZpbGVXcml0ZVdhc20gPSBmdW5jdGlvbiBwdkZpbGVXcml0ZVdhc20oZmlsZUFkZHJlc3MsIGNvbnRlbnRBZGRyZXNzLCBzaXplLCBjb3VudCwgbnVtV3JpdGVBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIGNvbnRlbnRBZGRyZXNzID0gdW5zaWduZWRBZGRyZXNzKGNvbnRlbnRBZGRyZXNzKTsKICAgICAgICAgICAgICBudW1Xcml0ZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MobnVtV3JpdGVBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSAqIGNvdW50KTsKICAgICAgICAgICAgICAgIGNvbnRlbnQuc2V0KG1lbW9yeUJ1ZmZlclVpbnQ4LnNsaWNlKGNvbnRlbnRBZGRyZXNzLCBjb250ZW50QWRkcmVzcyArIHNpemUgKiBjb3VudCksIDApOwogICAgICAgICAgICAgICAgZmlsZS53cml0ZShjb250ZW50KTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW251bVdyaXRlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gY29udGVudC5sZW5ndGggLyBzaXplOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW251bVdyaXRlQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2RmlsZVNlZWtXYXNtID0gZnVuY3Rpb24gcHZGaWxlU2Vla1dhc20oZmlsZUFkZHJlc3MsIG9mZnNldCwgd2hlbmNlLCBzdGF0dXNBZGRyZXNzKSB7CiAgICAgICAgICAgICAgZmlsZUFkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3MoZmlsZUFkZHJlc3MpOwogICAgICAgICAgICAgIHN0YXR1c0FkZHJlc3MgPSB1bnNpZ25lZEFkZHJlc3Moc3RhdHVzQWRkcmVzcyk7CiAgICAgICAgICAgICAgdmFyIG1lbW9yeUJ1ZmZlckludDMyID0gbmV3IEludDMyQXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLmdldFB0cihmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgICBmaWxlLnNlZWsob2Zmc2V0LCB3aGVuY2UpOwogICAgICAgICAgICAgICAgbWVtb3J5QnVmZmVySW50MzJbc3RhdHVzQWRkcmVzcyAvIEludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlRdID0gMDsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHB2RmlsZVRlbGxXYXNtID0gZnVuY3Rpb24gcHZGaWxlVGVsbFdhc20oZmlsZUFkZHJlc3MsIG9mZnNldEFkZHJlc3MpIHsKICAgICAgICAgICAgICBmaWxlQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhmaWxlQWRkcmVzcyk7CiAgICAgICAgICAgICAgb2Zmc2V0QWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhvZmZzZXRBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBQdkZpbGVNZW0uZ2V0UHRyKGZpbGVBZGRyZXNzKTsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW29mZnNldEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IGZpbGUudGVsbCgpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW29mZnNldEFkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHZGaWxlUmVtb3ZlV2FzbSA9IGZ1bmN0aW9uIHB2RmlsZVJlbW92ZVdhc20ocGF0aEFkZHJlc3MsIHN0YXR1c0FkZHJlc3MpIHsKICAgICAgICAgICAgICBwYXRoQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhwYXRoQWRkcmVzcyk7CiAgICAgICAgICAgICAgc3RhdHVzQWRkcmVzcyA9IHVuc2lnbmVkQWRkcmVzcyhzdGF0dXNBZGRyZXNzKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgbWVtb3J5QnVmZmVySW50MzIgPSBuZXcgSW50MzJBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgICAgICAgICAgICB2YXIgcGF0aCA9IGFycmF5QnVmZmVyVG9TdHJpbmdBdEluZGV4KG1lbW9yeUJ1ZmZlclVpbnQ4LCBwYXRoQWRkcmVzcyk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gUHZGaWxlTWVtLm9wZW4ocGF0aCwgInciKTsKICAgICAgICAgICAgICAgIGZpbGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBtZW1vcnlCdWZmZXJJbnQzMltzdGF0dXNBZGRyZXNzIC8gSW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVF0gPSAwOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeUJ1ZmZlckludDMyW3N0YXR1c0FkZHJlc3MgLyBJbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXSA9IC0xOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICByZXR1cm4gV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUod2FzbSwgewogICAgICAgICAgICAgIHdhc2lfc25hcHNob3RfcHJldmlldzE6IHdhc2lfc25hcHNob3RfcHJldmlldzFfZW11bGF0b3IsCiAgICAgICAgICAgICAgZW52OiB7CiAgICAgICAgICAgICAgICBtZW1vcnk6IG1lbW9yeSwKICAgICAgICAgICAgICAgIHB2X2NvbnNvbGVfbG9nX3dhc206IHB2Q29uc29sZUxvZ1dhc20sCiAgICAgICAgICAgICAgICBwdl9hc3NlcnRfd2FzbTogcHZBc3NlcnRXYXNtLAogICAgICAgICAgICAgICAgcHZfdGltZV93YXNtOiBwdlRpbWVXYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV9vcGVuX3dhc206IHB2RmlsZU9wZW5XYXNtLAogICAgICAgICAgICAgICAgcHZfZmlsZV9jbG9zZV93YXNtOiBwdkZpbGVDbG9zZVdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3JlYWRfd2FzbTogcHZGaWxlUmVhZFdhc20sCiAgICAgICAgICAgICAgICBwdl9maWxlX3dyaXRlX3dhc206IHB2RmlsZVdyaXRlV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfc2Vla193YXNtOiBwdkZpbGVTZWVrV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfdGVsbF93YXNtOiBwdkZpbGVUZWxsV2FzbSwKICAgICAgICAgICAgICAgIHB2X2ZpbGVfcmVtb3ZlX3dhc206IHB2RmlsZVJlbW92ZVdhc20KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgaW5zdGFuY2UgPSBfY29udGV4dC5zZW50Lmluc3RhbmNlOwogICAgICAgICAgICBhbGlnbmVkX2FsbG9jID0gaW5zdGFuY2UuZXhwb3J0cy5hbGlnbmVkX2FsbG9jOwogICAgICAgICAgICBhbGlnbmVkQWxsb2MgPSBmdW5jdGlvbiBhbGlnbmVkQWxsb2MoYWxpZ25tZW50LCBzaXplKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgICAgICAgdmFyIHBvaW50ZXIgPSBhbGlnbmVkX2FsbG9jKGFsaWdubWVudCwgc2l6ZSk7CiAgICAgICAgICAgICAgaWYgKHBvaW50ZXIgPCAwKSB7CiAgICAgICAgICAgICAgICBwb2ludGVyID0gcG9pbnRlciA+Pj4gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHBvaW50ZXI7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaW5zdGFuY2UuZXhwb3J0cyksIHt9LCB7CiAgICAgICAgICAgICAgYWxpZ25lZF9hbGxvYzogYWxpZ25lZEFsbG9jCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gZ2V0V2FzbShfeCkgewogICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7CiAgdmFyIGluaXQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lJDEubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkYXRhKSB7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBtZW1vcnkgPSBuZXcgV2ViQXNzZW1ibHkuTWVtb3J5KHsKICAgICAgICAgICAgICBpbml0aWFsOiAxMjgKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGdldFdhc20oZGF0YS53YXNtKTsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgZXhwb3J0cyQxID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiBpbml0KF94MikgewogICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpOwogIHZhciBhbGxvY01lbSA9IGZ1bmN0aW9uIGFsbG9jTWVtKGRhdGEpIHsKICAgIHZhciBzaXplID0gZGF0YS5zaXplLAogICAgICBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzOwogICAgdmFyIF9leHBvcnRzID0gZXhwb3J0cyQxLAogICAgICBhbGlnbmVkX2FsbG9jID0gX2V4cG9ydHMuYWxpZ25lZF9hbGxvYzsKICAgIGlmIChzaXplID4gMCkgewogICAgICB2YXIgd29ya2VyTWVtQWRkcmVzcyA9IGFsaWduZWRfYWxsb2MoVWludDhBcnJheS5CWVRFU19QRVJfRUxFTUVOVCwgc2l6ZSAqIFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgICBtZW1BbGxvYy5zZXQobWVtQWRkcmVzcywgewogICAgICAgIGFsbG9jU2l6ZTogc2l6ZSwKICAgICAgICB3b3JrZXJNZW1BZGRyZXNzOiB3b3JrZXJNZW1BZGRyZXNzCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGZyZWVNZW0gPSBmdW5jdGlvbiBmcmVlTWVtKGRhdGEpIHsKICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzOwogICAgdmFyIF9leHBvcnRzMiA9IGV4cG9ydHMkMSwKICAgICAgZnJlZSA9IF9leHBvcnRzMi5mcmVlOwogICAgaWYgKG1lbUFsbG9jLmhhcyhtZW1BZGRyZXNzKSkgewogICAgICB2YXIgX21lbUFsbG9jJGdldCA9IG1lbUFsbG9jLmdldChtZW1BZGRyZXNzKSwKICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldC53b3JrZXJNZW1BZGRyZXNzOwogICAgICBmcmVlKHdvcmtlck1lbUFkZHJlc3MpOwogICAgICBtZW1BbGxvY1siZGVsZXRlIl0obWVtQWRkcmVzcyk7CiAgICB9CiAgfTsKICB2YXIgY29weVRvWHB1ID0gZnVuY3Rpb24gY29weVRvWHB1KGRhdGEpIHsKICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzLAogICAgICBvZmZzZXQgPSBkYXRhLm9mZnNldCwKICAgICAgYnVmZmVyID0gZGF0YS5idWZmZXI7CiAgICB2YXIgX21lbUFsbG9jJGdldDIgPSBtZW1BbGxvYy5nZXQobWVtQWRkcmVzcyksCiAgICAgIHdvcmtlck1lbUFkZHJlc3MgPSBfbWVtQWxsb2MkZ2V0Mi53b3JrZXJNZW1BZGRyZXNzOwogICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICBtZW1vcnlCdWZmZXJVaW50OC5zZXQoYnVmZmVyLCB3b3JrZXJNZW1BZGRyZXNzICsgb2Zmc2V0KTsKICB9OwogIHZhciBjb3B5RnJvbVhwdSA9IGZ1bmN0aW9uIGNvcHlGcm9tWHB1KGRhdGEpIHsKICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzLAogICAgICBvZmZzZXQgPSBkYXRhLm9mZnNldCwKICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTsKICAgIHZhciBfbWVtQWxsb2MkZ2V0MyA9IG1lbUFsbG9jLmdldChtZW1BZGRyZXNzKSwKICAgICAgd29ya2VyTWVtQWRkcmVzcyA9IF9tZW1BbGxvYyRnZXQzLndvcmtlck1lbUFkZHJlc3M7CiAgICB2YXIgbWVtb3J5QnVmZmVyVWludDggPSBuZXcgVWludDhBcnJheShtZW1vcnkuYnVmZmVyKTsKICAgIHJldHVybiBtZW1vcnlCdWZmZXJVaW50OC5zbGljZSh3b3JrZXJNZW1BZGRyZXNzICsgb2Zmc2V0LCB3b3JrZXJNZW1BZGRyZXNzICsgb2Zmc2V0ICsgc2l6ZSk7CiAgfTsKICB2YXIgbWVtc2V0ID0gZnVuY3Rpb24gbWVtc2V0KGRhdGEpIHsKICAgIHZhciBtZW1BZGRyZXNzID0gZGF0YS5tZW1BZGRyZXNzLAogICAgICBmaWxsQnl0ZSA9IGRhdGEuZmlsbEJ5dGUsCiAgICAgIHNpemUgPSBkYXRhLnNpemU7CiAgICBpZiAobWVtQWxsb2MuaGFzKG1lbUFkZHJlc3MpKSB7CiAgICAgIHZhciBfbWVtQWxsb2MkZ2V0NCA9IG1lbUFsbG9jLmdldChtZW1BZGRyZXNzKSwKICAgICAgICB3b3JrZXJNZW1BZGRyZXNzID0gX21lbUFsbG9jJGdldDQud29ya2VyTWVtQWRkcmVzczsKICAgICAgdmFyIG1lbW9yeUJ1ZmZlclVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobWVtb3J5LmJ1ZmZlcik7CiAgICAgIG1lbW9yeUJ1ZmZlclVpbnQ4LmZpbGwoZmlsbEJ5dGUsIHdvcmtlck1lbUFkZHJlc3MsIHdvcmtlck1lbUFkZHJlc3MgKyBzaXplKTsKICAgIH0KICB9OwogIHZhciB0aW1lclN0YXJ0ID0gZnVuY3Rpb24gdGltZXJTdGFydChkYXRhKSB7CiAgICB2YXIgd29ya2VySW5kZXggPSBkYXRhLndvcmtlckluZGV4OwogICAgdmFyIF9leHBvcnRzMyA9IGV4cG9ydHMkMSwKICAgICAgcHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtID0gX2V4cG9ydHMzLnB2X3BpY29sbG1fdGltZXJfc3RhcnRfd2FzbTsKICAgIGlmIChwdl9waWNvbGxtX3RpbWVyX3N0YXJ0X3dhc20pIHsKICAgICAgcHZfcGljb2xsbV90aW1lcl9zdGFydF93YXNtKHdvcmtlckluZGV4KTsKICAgIH0KICB9OwogIHZhciB0aW1lclN0b3AgPSBmdW5jdGlvbiB0aW1lclN0b3AoKSB7CiAgICB2YXIgX2V4cG9ydHM0ID0gZXhwb3J0cyQxLAogICAgICBwdl9waWNvbGxtX3RpbWVyX3N0b3Bfd2FzbSA9IF9leHBvcnRzNC5wdl9waWNvbGxtX3RpbWVyX3N0b3Bfd2FzbTsKICAgIGlmIChwdl9waWNvbGxtX3RpbWVyX3N0b3Bfd2FzbSkgewogICAgICBwdl9waWNvbGxtX3RpbWVyX3N0b3Bfd2FzbSgpOwogICAgfQogIH07CiAgdmFyIHhwdUFjdGlvbk1hcCA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoX2RlZmluZVByb3BlcnR5KF9kZWZpbmVQcm9wZXJ0eShfZGVmaW5lUHJvcGVydHkoe30sIFB2WHB1QWN0aW9uLklOSVQsIGluaXQpLCBQdlhwdUFjdGlvbi5BTExPQywgYWxsb2NNZW0pLCBQdlhwdUFjdGlvbi5GUkVFLCBmcmVlTWVtKSwgUHZYcHVBY3Rpb24uQ09QWV9UT19YUFUsIGNvcHlUb1hwdSksIFB2WHB1QWN0aW9uLkNPUFlfRlJPTV9YUFUsIGNvcHlGcm9tWHB1KSwgUHZYcHVBY3Rpb24uTUVNU0VULCBtZW1zZXQpLCBQdlhwdUFjdGlvbi5USU1FUl9TVEFSVCwgdGltZXJTdGFydCksIFB2WHB1QWN0aW9uLlRJTUVSX1NUT1AsIHRpbWVyU3RvcCksIHB2TXZtQWN0aW9uTWFwKSwgcHZQaWNvbGxtQXR0ZW50aW9uQWN0aW9uTWFwKSwgcHZQaWNvbGxtV2VpZ2h0QWN0aW9uTWFwKTsKICBzZWxmLm9ubWVzc2FnZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUkMS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGV2ZW50KSB7CiAgICAgIHZhciByZXM7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lJDEud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBpZiAoIShldmVudC5kYXRhLmFjdGlvbiBpbiB4cHVBY3Rpb25NYXApKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudC5kYXRhLmdsb2JhbHMgPSB7CiAgICAgICAgICAgICAgZXhwb3J0czogZXhwb3J0cyQxLAogICAgICAgICAgICAgIG1lbW9yeTogbWVtb3J5LAogICAgICAgICAgICAgIG1lbUFsbG9jOiBtZW1BbGxvYwogICAgICAgICAgICB9OwogICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDI7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIHhwdUFjdGlvbk1hcFtldmVudC5kYXRhLmFjdGlvbl0oZXZlbnQuZGF0YSk7CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBjb21tYW5kOiAnb2snLAogICAgICAgICAgICAgICAgd29ya0lkOiBldmVudC5kYXRhLndvcmtJZCwKICAgICAgICAgICAgICAgIHJlc3VsdDogcmVzCiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgICAgICAgfSwgW3Jlcy5idWZmZXJdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGNvbW1hbmQ6ICdvaycsCiAgICAgICAgICAgICAgICB3b3JrSWQ6IGV2ZW50LmRhdGEud29ya0lkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gOTsKICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzWyJjYXRjaCJdKDIpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBjb21tYW5kOiAnZXJyb3InLAogICAgICAgICAgICAgIHdvcmtJZDogZXZlbnQuZGF0YS53b3JrSWQsCiAgICAgICAgICAgICAgbWVzc2FnZTogX2NvbnRleHQzLnQwLm1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE1OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIGNvbW1hbmQ6ICdmYWlsZWQnLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICJVbnJlY29nbml6ZWQgY29tbWFuZDogIi5jb25jYXQoZXZlbnQuZGF0YS5hY3Rpb24pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTMsIG51bGwsIFtbMiwgOV1dKTsKICAgIH0pKTsKICAgIHJldHVybiBmdW5jdGlvbiAoX3gzKSB7CiAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7Cgp9KSgpOwoK",E=null,U=!1,function(I){return M=M||K(N,E,U),new Worker(M,I)});function Q(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}function z(I,g){for(var C=0;C<g.length;C++){var e=g[C];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(I,A(e.key),e)}}function x(I,g,C){return g&&z(I.prototype,g),C&&z(I,C),Object.defineProperty(I,"prototype",{writable:!1}),I}function _(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return P(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return P(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function P(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}!function(I){I[I.INIT=0]="INIT",I[I.ALLOC=1]="ALLOC",I[I.FREE=2]="FREE",I[I.COPY_TO_XPU=3]="COPY_TO_XPU",I[I.COPY_FROM_XPU=4]="COPY_FROM_XPU",I[I.MEMSET=5]="MEMSET",I[I.TIMER_START=6]="TIMER_START",I[I.TIMER_STOP=7]="TIMER_STOP",I[I.MATRIX_VECTOR_MULTIPLY=8]="MATRIX_VECTOR_MULTIPLY",I[I.SYNC_VECTOR=9]="SYNC_VECTOR"}(L||(L={}));var O=function(){function I(){Q(this,I)}return x(I,null,[{key:"addXpu",value:function(g,C){I.xpuObjects.set(g,C)}},{key:"getXpu",value:function(g){return I.xpuObjects.get(g)}},{key:"hasXpu",value:function(g){return I.xpuObjects.has(g)}},{key:"removeXpu",value:function(g){if(I.xpuObjects.has(g)){var C,e=_(I.xpuObjects.get(g).deviceMem);try{for(e.s();!(C=e.n()).done;){var A=C.value;I.memoryObjects.delete(A)}}catch(I){e.e(I)}finally{e.f()}I.xpuObjects.delete(g)}}},{key:"addMemory",value:function(g,C){I.memoryObjects.set(g,C),I.xpuObjects.get(C.objAddress).deviceMem.add(g)}},{key:"getMemory",value:function(g){return I.memoryObjects.get(g)}},{key:"hasMemory",value:function(g){return I.memoryObjects.has(g)}},{key:"removeMemory",value:function(g){I.hasMemory(g)&&I.xpuObjects.get(I.getMemory(g).objAddress).deviceMem.delete(g),I.memoryObjects.delete(g)}},{key:"getUniquePointer",value:function(){for(;;){var I=Math.ceil(1e3*(performance.now()+Math.random()));if(!this.uniquePointers.has(I))return this.uniquePointers.add(I),I}}},{key:"removeUniquePointer",value:function(I){this.uniquePointers.has(I)&&this.uniquePointers.delete(I)}}]),I}();function j(C){return function(g){if(Array.isArray(g))return I(g)}(C)||function(I){if("undefined"!=typeof Symbol&&null!=I[Symbol.iterator]||null!=I["@@iterator"])return Array.from(I)}(C)||g(C)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return q(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return q(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function q(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}t(O,"xpuObjects",new Map),t(O,"memoryObjects",new Map),t(O,"uniquePointers",new Set);var $=new Map;function II(I){return $.has(I)||$.set(I,function(){for(var I="BCDEF".split(""),g="#",C=0;C<6;C++)g+=I[Math.floor(Math.random()*I.length)];return g}()),$.get(I)}var gI=function(){function I(){Q(this,I),t(this,"_names",new Map),t(this,"_paths",void 0),t(this,"_stack",void 0),t(this,"_enabled",void 0),t(this,"_memory",null),this._paths=new Map,this._stack=[],this._enabled=!1}var g;return x(I,[{key:"addName",value:function(I,g){this._names.set(I,g)}},{key:"getName",value:function(I){return this._names.get(I)}},{key:"enabled",get:function(){return this._enabled},set:function(I){this._enabled=I}},{key:"memory",get:function(){return this._memory},set:function(I){this._memory=I}},{key:"graphify",value:function(I,g,C,e){var A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=I.name,r=this;function i(){return i=c(d.mark((function c(){var i,n,l,o,s,a,b,Z=arguments;return d.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:for(i=Z.length,n=new Array(i),l=0;l<i;l++)n[l]=Z[l];if(r.memory&&void 0!==A&&(new Int32Array(r.memory.buffer)[n[n.length-1]/Int32Array.BYTES_PER_ELEMENT]=A),r.enabled){c.next=6;break}return c.next=5,I.apply(I,n);case 5:return c.abrupt("return");case 6:o=g.map((function(I){return n[I]})),s=C>=0?n[C]:C,a=e?n[e]:void 0,(b=new CI(t,I,n)).inputsAddr=o,b.output=s,b.subName=r.getName(a),"pvXpuDeviceMemFree"===t||"pvXpuGraphifiedFree"===t?r.addFreeNode(b,o[0]):r.addNode(b,o);case 14:case"end":return c.stop()}}),c)}))),i.apply(this,arguments)}return function(){return i.apply(this,arguments)}}},{key:"addNode",value:function(I,g){this._stack.push(I),this._paths.has(I)||this._paths.set(I,new Set);var C,e=D(g);try{for(e.s();!(C=e.n()).done;)for(var A=C.value,t=this._stack.length-2;t>=0;t--){var r=this._stack[t];if(r.output===A){this._paths.get(r).add(I),I.inputs.add(r);break}}}catch(I){e.e(I)}finally{e.f()}}},{key:"addFreeNode",value:function(I,g){this._stack.push(I),this._paths.has(I)||this._paths.set(I,new Set);for(var C=this._stack.length-2;C>=0;C--){var e=this._stack[C];if(e.inputsAddr.includes(g)){this._paths.get(e).add(I),I.inputs.add(e);break}}}},{key:"executeHelper",value:function(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(I.numVisited++,I.level=Math.max(g,I.level),!(I.numVisited<I.inputs.size||I.visited)){I.visited=!0,I.runOnce();var C,e=D(this._paths.get(I));try{for(e.s();!(C=e.n()).done;){var A=C.value;this.executeHelper(A,I.level+1)}}catch(I){e.e(I)}finally{e.f()}}}},{key:"execute",value:(g=c(d.mark((function I(){var g,C,e,A,t,r,c,i,n,l,o=this;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:for(CI.tick=performance.now(),g=this._stack.filter((function(I){return 0===I.inputs.size})),C=[];g.length>0;)C.push(g.splice(0,8));e=0,A=C;case 5:if(!(e<A.length)){I.next=15;break}t=A[e],r=[],c=D(t);try{for(c.s();!(i=c.n()).done;)n=i.value,this.executeHelper(n),r.push(n.executionPromise)}catch(I){c.e(I)}finally{c.f()}return I.next=12,Promise.all(r);case 12:e++,I.next=5;break;case 15:return l=new Promise((function(I){Promise.all(o._stack.map((function(I){return I.executionPromise}))).then((function(){I()}))})),I.next=18,l;case 18:this.clear();case 19:case"end":return I.stop()}}),I,this)}))),function(){return g.apply(this,arguments)})},{key:"generateViz",value:function(){var I,g="",e="",A=D(this._paths);try{for(A.s();!(I=A.n()).done;){var t=C(I.value,2),r=t[0],c=t[1];g+="  ".concat(r.id," [label=<[").concat(r.id,"] ").concat(r.name).concat(r.subName?" ("+r.subName+")":"",'<BR /><FONT POINT-SIZE="10">wait: ').concat(r.timeWait.toFixed(4),", execute: ").concat(r.timeExecute.toFixed(4),'</FONT>>, style=filled, fillcolor="').concat(II(r.level),'"]\n');var i,n=D(c);try{for(n.s();!(i=n.n()).done;){var l=i.value;e+="  ".concat(r.id," -> ").concat(l.id,"\n")}}catch(I){n.e(I)}finally{n.f()}}}catch(I){A.e(I)}finally{A.f()}var o="digraph {\n".concat(g,"\n").concat(e,"}");console.log(o)}},{key:"clear",value:function(){this._paths.clear(),this._stack=[],CI.reset()}}]),I}(),CI=function(){function I(g,C,e){Q(this,I),t(this,"id",void 0),t(this,"name",void 0),t(this,"subName",void 0),t(this,"visited",void 0),t(this,"numVisited",void 0),t(this,"executionPromise",void 0),t(this,"inputs",void 0),t(this,"inputsAddr",void 0),t(this,"output",void 0),t(this,"timeWait",0),t(this,"timeExecute",0),t(this,"level",0),t(this,"_fn",void 0),t(this,"_args",void 0),this.id=I.nodeId++,this.name=g,this.visited=!1,this.numVisited=0,this.inputs=new Set,this.inputsAddr=[],this.output=-1,this._fn=C,this._args=e}var g;return x(I,[{key:"runOnce",value:function(){var g=this;if(void 0===this.executionPromise){var C=j(this.inputs).map((function(I){return I.executionPromise}));this.executionPromise=Promise.all(C).then(c(d.mark((function C(){var e,A,t;return d.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:return e=performance.now(),g.timeWait=(e-I.tick)/1e3,A=performance.now(),C.next=5,g._fn.apply(null,g._args);case 5:return t=C.sent,e=performance.now(),g.timeExecute=(e-A)/1e3,C.abrupt("return",t);case 9:case"end":return C.stop()}}),C)}))))}}},{key:"runFn",value:(g=c(d.mark((function I(){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this._fn.apply(null,this._args);case 2:case"end":return I.stop()}}),I,this)}))),function(){return g.apply(this,arguments)})}],[{key:"reset",value:function(){I.nodeId=0}}]),I}();function eI(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(I);g&&(e=e.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,e)}return C}function AI(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?eI(Object(C),!0).forEach((function(g){t(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):eI(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}t(CI,"nodeId",0),t(CI,"executeWasmFn",void 0),t(CI,"tick",0);var tI,rI=function(){function I(g){var C=this;Q(this,I),t(this,"worker",void 0),t(this,"listeners",{}),this.worker=g,this.worker.onmessage=function(I){switch(I.data.command){case"ok":I.data.workId in C.listeners&&(C.listeners[I.data.workId](I.data.result),C.removeListener(I.data.workId));break;case"failed":case"error":throw C.removeListener(I.data.workId),new Error(I.data.message);default:throw C.removeListener(I.data.workId),new Error("Unrecognized command: ".concat(I.data.command))}}}return x(I,[{key:"postMessage",value:function(I,g){this.worker.postMessage(I,g)}},{key:"terminate",value:function(){this.worker.terminate()}},{key:"addListener",value:function(I,g){this.listeners[I]=g}},{key:"removeListener",value:function(I){delete this.listeners[I]}}]),I}(),cI=function(I,g,C){var e=Math.ceil(1e10*(performance.now()+Math.random())),A=function(I,g){return new Promise((function(C){g.addListener(I,(function(I){C(I)}))}))}(e,I);return I.postMessage(AI(AI({},g),{},{workId:e}),C),A};!function(I){I[I.ATTENTION_PRECOMPUTE_ENCODING=200]="ATTENTION_PRECOMPUTE_ENCODING",I[I.ATTENTION_ATTEND_COMBINED=201]="ATTENTION_ATTEND_COMBINED"}(tI||(tI={}));var iI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,C,A,t,r,c){var i;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),C=Y(C),c=Y(c),i=O.getXpu(g)){I.next=7;break}return e(c,-1),I.abrupt("return");case 7:return I.next=9,cI(i.workers[0],{action:tI.ATTENTION_PRECOMPUTE_ENCODING,encodingAddress:C,dimension:A,steps:t,theta:r});case 9:e(c,0);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}(),t=function(){var g=c(d.mark((function g(C,A,t,r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G,V,h,W,R){var p,X,H,k,S,J,w;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),l=Y(l),o=Y(o),s=Y(s),a=Y(a),b=Y(b),Z=Y(Z),m=Y(m),u=Y(u),B=Y(B),y=Y(y),V=Y(V),W=Y(W),R=Y(R),p=O.getXpu(C)){g.next=18;break}return e(R,-1),g.abrupt("return");case 18:return X=new Float32Array(I.buffer),H=h*A*c,k=X.slice(o/Float32Array.BYTES_PER_ELEMENT,o/Float32Array.BYTES_PER_ELEMENT+H),S=X.slice(s/Float32Array.BYTES_PER_ELEMENT,s/Float32Array.BYTES_PER_ELEMENT+H),J=X.slice(a/Float32Array.BYTES_PER_ELEMENT,a/Float32Array.BYTES_PER_ELEMENT+H),g.next=25,cI(p.workers[0],{action:tI.ATTENTION_ATTEND_COMBINED,numHeads:A,numKvHeads:t,windowLength:r,headDimension:c,ropeDimension:i,ropeInterleaved:n,newEncodingAddress:l,qBuffer:k,kBuffer:S,vBuffer:J,keysAddress:b,keyInterceptsAddress:Z,keySlopesAddress:m,valuesAddress:u,valueInterceptsAddress:B,valueSlopesAddress:y,position:G,queryAddress:V,n:h},[k.buffer,S.buffer,J.buffer]);case 25:w=g.sent,(X=new Float32Array(I.buffer)).set(w,W/Float32Array.BYTES_PER_ELEMENT);case 28:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,n,l,o,s,a,d,b,Z,m,u,B,y,G,V){return g.apply(this,arguments)}}();return{pv_picollm_attention_precompute_encoding_web_worker_wasm:A,pv_picollm_attention_attend_combined_web_worker_wasm:g.graphify(t,[7,8,9,10,11,14,18,20],20)}};t(t({},tI.ATTENTION_PRECOMPUTE_ENCODING,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=I.encodingAddress,t=I.dimension,r=I.steps,c=I.theta;(0,C.pv_picollm_attention_precompute_encoding_wasm)(e.get(A).workerMemAddress,t,r,c)})),tI.ATTENTION_ATTEND_COMBINED,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.numHeads,r=I.numKvHeads,c=I.windowLength,i=I.headDimension,n=I.ropeDimension,l=I.ropeInterleaved,o=I.newEncodingAddress,s=I.qBuffer,a=I.kBuffer,d=I.vBuffer,b=I.keysAddress,Z=I.keyInterceptsAddress,m=I.keySlopesAddress,u=I.valuesAddress,B=I.valueInterceptsAddress,y=I.valueSlopesAddress,G=I.position,V=I.queryAddress,h=I.n,W=C.aligned_alloc,R=C.free,p=C.pv_picollm_attention_encode_wasm,X=C.pv_picollm_attention_update_keys_wasm,H=C.pv_picollm_attention_update_values_wasm,k=C.pv_picollm_attention_transpose_query_wasm,S=C.pv_picollm_attention_attend_wasm,J=e.get(o).workerMemAddress,w=e.get(b).workerMemAddress,f=e.get(Z).workerMemAddress,F=e.get(m).workerMemAddress,Y=e.get(u).workerMemAddress,v=e.get(B).workerMemAddress,K=e.get(y).workerMemAddress,N=e.get(V).workerMemAddress,E=W(Float32Array.BYTES_PER_ELEMENT,s.length*Float32Array.BYTES_PER_ELEMENT),U=W(Float32Array.BYTES_PER_ELEMENT,a.length*Float32Array.BYTES_PER_ELEMENT),M=W(Float32Array.BYTES_PER_ELEMENT,d.length*Float32Array.BYTES_PER_ELEMENT),L=t*i*h,T=W(Float32Array.BYTES_PER_ELEMENT,L*Float32Array.BYTES_PER_ELEMENT),Q=new Float32Array(A.buffer);Q.set(s,E/Float32Array.BYTES_PER_ELEMENT),Q.set(a,U/Float32Array.BYTES_PER_ELEMENT),Q.set(d,M/Float32Array.BYTES_PER_ELEMENT),Q.fill(0,T/Float32Array.BYTES_PER_ELEMENT,T/Float32Array.BYTES_PER_ELEMENT+L),p(E,J,h,t,l,i,n,G),k(h,E,N,t,i),p(U,J,h,r,l,i,n,G),X(r,c,i,w,f,F,G,h,U),H(r,c,i,Y,v,K,G,h,M),S(t,r,c,i,w,f,F,Y,v,K,G,N,h,T);var z=(Q=new Float32Array(A.buffer)).slice(T/Float32Array.BYTES_PER_ELEMENT,T/Float32Array.BYTES_PER_ELEMENT+L);return R(E),R(U),R(M),R(T),z}));var nI,lI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),O.getXpu(g)){I.next=7;break}return e(r,-1),I.abrupt("return");case 7:return I.next=9,C.pv_picollm_feed_forward_silu_wasm(A,t);case 9:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),t=function(){var I=c(d.mark((function I(g,A,t,r){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),O.getXpu(g)){I.next=7;break}return e(r,-1),I.abrupt("return");case 7:return I.next=9,C.pv_picollm_feed_forward_gelu_wasm(A,t);case 9:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),r=function(){var I=c(d.mark((function I(g,e,A,t){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),A=Y(A),O.getXpu(g)){I.next=6;break}return I.abrupt("return");case 6:return I.next=8,C.pv_picollm_feed_forward_almost_gelu_wasm(e,A);case 8:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),i=function(){var I=c(d.mark((function I(g,A,t,r,c){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),c=Y(c),O.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_feed_forward_multiply_buffers_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}();return{pv_picollm_feed_forward_silu_web_worker_wasm:g.graphify(A,[2],2),pv_picollm_feed_forward_gelu_web_worker_wasm:g.graphify(t,[2],2),pv_picollm_feed_forward_almost_gelu_web_worker_wasm:g.graphify(r,[2],2),pv_picollm_feed_forward_multiply_buffers_web_worker_wasm:g.graphify(i,[2,3],3)}},oI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r,c,i,n,l){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),c=Y(c),i=Y(i),n=Y(n),l=Y(l),O.getXpu(g)){I.next=9;break}return e(l,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_gate_forward_wasm(A,t,r,c,i,n);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i){return I.apply(this,arguments)}}();return{pv_picollm_gate_forward_web_worker_wasm:g.graphify(A,[],6)}},sI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r,c){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),c=Y(c),O.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_moe_transformer_add_to_buffer_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}(),t=function(){var I=c(d.mark((function I(g,A,t,r,c,i,n,l){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),c=Y(c),i=Y(i),n=Y(n),l=Y(l),O.getXpu(g)){I.next=9;break}return e(l,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer_wasm(A,t,r,c,i,n);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i){return I.apply(this,arguments)}}(),r=function(){var I=c(d.mark((function I(g,A,t,r,c,i){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),c=Y(c),i=Y(i),O.getXpu(g)){I.next=9;break}return e(i,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_moe_transformer_add_buffers_wasm(A,t,r,c);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}();return{pv_picollm_moe_transformer_add_to_buffer_web_worker_wasm:g.graphify(A,[2],3),pv_picollm_moe_transformer_multiply_weight_and_add_to_buffer_web_worker_wasm:g.graphify(t,[5],6),pv_picollm_moe_transformer_add_buffers_web_worker_wasm:g.graphify(r,[2,3],4)}},aI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r,c,i,n,l,o,s){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),r=Y(r),n=Y(n),o=Y(o),s=Y(s),O.getXpu(g)){I.next=9;break}return e(s,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_norm_forward_wasm(A,t,r,c,n+i,o+l);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,n,l){return I.apply(this,arguments)}}();return{pv_picollm_norm_forward_web_worker_wasm:g.graphify(A,[6],8)}},dI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r,c,i,n,l,o,s,a){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),r=Y(r),c=Y(c),l=Y(l),s=Y(s),a=Y(a),O.getXpu(g)){I.next=10;break}return e(a,-1),I.abrupt("return");case 10:return I.next=12,C.pv_picollm_norm_layer_forward_wasm(A,t,r,c,i,l+n,s+o);case 12:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,n,l,o){return I.apply(this,arguments)}}();return{pv_picollm_norm_layer_forward_web_worker_wasm:g.graphify(A,[7,9],9)}},bI=function(I,g,C){var e=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},A=function(){var I=c(d.mark((function I(g,A,t,r,c){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),c=Y(c),O.getXpu(g)){I.next=8;break}return e(c,-1),I.abrupt("return");case 8:return I.next=10,C.pv_picollm_transformer_add_to_buffer_wasm(A,t,r);case 10:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t){return I.apply(this,arguments)}}(),t=function(){var I=c(d.mark((function I(g,A,t,r,c,i){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),t=Y(t),r=Y(r),c=Y(c),i=Y(i),O.getXpu(g)){I.next=9;break}return e(i,-1),I.abrupt("return");case 9:return I.next=11,C.pv_picollm_transformer_add_buffers_wasm(A,t,r,c);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}();return{pv_picollm_transformer_add_to_buffer_web_worker_wasm:g.graphify(A,[2,3],3),pv_picollm_transformer_add_buffers_web_worker_wasm:g.graphify(t,[2,3],4)}};function ZI(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return mI(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return mI(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function mI(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}function uI(I){return I|=I>>1,I|=I>>2,I|=I>>4,I|=I>>8,I|=I>>16,(I|=I>>32)-(I>>1)}function BI(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;void 0===g&&(g=I,I=0);for(var e=[],A=I;C>0?A<g:A>g;A+=C)e.push(A);return e}!function(I){I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS=100]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS",I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS=101]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS",I[I.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS=102]="WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE=103]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE",I[I.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE=104]="WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE"}(nI||(nI={}));var yI=function(I,g,e){var A=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},t=function(){var e=c(d.mark((function e(t,r,c,i,n,l,o,s,a,b,Z){var m,u,B,y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,K,N,E,U,M,L,T,Q,z,x,_,P,D;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Y(t),r=Y(r),c=Y(c),n=Y(n),l=Y(l),a=Y(a),b=Y(b),Z=Y(Z),m=O.getXpu(t)){e.next=12;break}return A(Z,-1),e.abrupt("return");case 12:for(u=new Uint8Array(I.buffer),B=v(u,r),g.addName(a,B),y=new Int32Array(I.buffer),G=y.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+2),V=y.slice(n/Int32Array.BYTES_PER_ELEMENT,n/Int32Array.BYTES_PER_ELEMENT+i),h=y.slice(l/Int32Array.BYTES_PER_ELEMENT,l/Int32Array.BYTES_PER_ELEMENT+i),W=new Uint8Array(I.buffer).slice(a,a+s),R=[],p=0,X=0;X<i;X++)H=X===i-1?G[1]/8:h[X+1],k=(H-h[X])*V[X]*G[0],R.push([p,k]),p+=k;S=[],m.numWorkers<4?(J=uI(m.numWorkers),S=BI(m.numWorkers-J,m.numWorkers)):(w=uI((m.numWorkers-1)*(2/3)),f=uI((m.numWorkers-1)*(1/3)),F=m.numWorkers-1-w-f,S=B.includes("ff")||s>1024e4?BI(1,1+w):BI(1+w,1+w+f),F>0&&B.includes("att.v")&&(F>=f?S=BI(1+w+f,1+w+2*f):f===F+1&&(S=[0].concat(j(BI(1+w+f,w+2*f)))))),K=Math.ceil(s/o/S.length)*o,N=s/K,G[0]/=N,E=[],U=s,M=0;case 31:if(!(M<S.length)){e.next=43;break}L=new Uint8Array(K),T=0,Q=ZI(R);try{for(Q.s();!(z=Q.n()).done;)x=C(z.value,2),_=x[0],P=x[1],D=M*(P/N),L.set(W.slice(_+D,_+D+P/N),T),T+=P/N}catch(I){Q.e(I)}finally{Q.f()}if(U-=T,E.push(cI(m.workers[S[M]],{action:nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,shape:G,bitDepths:V,bitDepthStarts:h,numBlockBytes:K,blocksAddress:b,block:L},[L.buffer])),!(U<=0)){e.next=40;break}return e.abrupt("break",43);case 40:M++,e.next=31;break;case 43:return e.next=45,Promise.all(E);case 45:A(Z,0),O.addMemory(b,{objAddress:t,memFlag:0,allocSize:s,chunkSize:K,workerSet:S});case 47:case"end":return e.stop()}}),e)})));return function(I,g,C,A,t,r,c,i,n,l,o){return e.apply(this,arguments)}}(),r=function(){var g=c(d.mark((function g(e,t,r,c,i,n,l,o,s,a){var b,Z,m,u,B,y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,v,K,N,E;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(e=Y(e),t=Y(t),c=Y(c),i=Y(i),o=Y(o),s=Y(s),a=Y(a),b=O.getXpu(e)){g.next=11;break}return A(a,-1),g.abrupt("return");case 11:if(Z=O.getMemory(i)){g.next=15;break}return A(a,-1),g.abrupt("return");case 15:for(m=new Int32Array(I.buffer),u=m.slice(t/Int32Array.BYTES_PER_ELEMENT,t/Int32Array.BYTES_PER_ELEMENT+2),B=m.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),y=new Uint16Array(I.buffer).slice(o/Uint16Array.BYTES_PER_ELEMENT,o/Uint16Array.BYTES_PER_ELEMENT+l),G=[],V=0,h=0;h<r;h++)W=h===r-1?u[1]/8:B[h+1],R=2*(W-B[h])*(u[0]/16),G.push([V,R]),V+=R;p=Math.ceil(l/n/Z.workerSet.length)*n,X=l/p,H=[],k=l,S=0;case 27:if(!(S<Z.workerSet.length)){g.next=39;break}J=new Uint16Array(p),w=0,f=ZI(G);try{for(f.s();!(F=f.n()).done;)v=C(F.value,2),K=v[0],N=v[1],E=S*(N/X),J.set(y.slice(K+E,K+E+N/X),w),w+=N/X}catch(I){f.e(I)}finally{f.f()}if(k-=w,H.push(cI(b.workers[Z.workerSet[S]],{action:nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS,memAddress:s,metas:J},[J.buffer])),!(k<=0)){g.next=36;break}return g.abrupt("break",39);case 36:S++,g.next=27;break;case 39:return g.next=41,Promise.all(H);case 41:A(a,0),O.addMemory(s,{objAddress:e,memFlag:0,allocSize:l*Uint16Array.BYTES_PER_ELEMENT,chunkSize:p,workerSet:Z.workerSet});case 43:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,n,l){return g.apply(this,arguments)}}(),i=function(){var g=c(d.mark((function g(C,e,t,r,c,i,n){var l,o,s,a,b,Z,m,u,B,y,G;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),e=Y(e),t=Y(t),c=Y(c),i=Y(i),n=Y(n),l=O.getXpu(C)){g.next=10;break}return A(n,-1),g.abrupt("return");case 10:if(o=O.getMemory(t)){g.next=14;break}return A(n,-1),g.abrupt("return");case 14:s=new Int32Array(I.buffer),a=s.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),b=a[0],Z=new Float32Array(I.buffer).slice(c/Float32Array.BYTES_PER_ELEMENT,c/Float32Array.BYTES_PER_ELEMENT+b),m=Math.ceil(b/r/o.workerSet.length)*r,u=[],B=b,y=0;case 22:if(!(y<o.workerSet.length)){g.next=31;break}if(G=Z.slice(y*m,(y+1)*m),u.push(cI(l.workers[o.workerSet[y]],{action:nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS,memAddress:i,bias:G},[G.buffer])),!((B-=m)<=0)){g.next=28;break}return g.abrupt("break",31);case 28:y++,g.next=22;break;case 31:return g.next=33,Promise.all(u);case 33:A(n,0),O.addMemory(i,{objAddress:C,memFlag:0,allocSize:b*Float32Array.BYTES_PER_ELEMENT,chunkSize:m,workerSet:o.workerSet});case 35:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c){return g.apply(this,arguments)}}(),n=function(){var g=c(d.mark((function g(C,e,t,r,c,i,n,l,o,s,a,b,Z,m,u){var B,y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,v;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),e=Y(e),t=Y(t),c=Y(c),i=Y(i),l=Y(l),s=Y(s),b=Y(b),Z=Y(Z),m=Y(m),u=Y(u),B=O.getXpu(C)){g.next=15;break}return A(u,-1),g.abrupt("return");case 15:if(y=O.getMemory(s)){g.next=19;break}return A(u,-1),g.abrupt("return");case 19:if(O.getMemory(l)){g.next=23;break}return A(u,-1),g.abrupt("return");case 23:if(G=O.getMemory(b)){g.next=27;break}return A(u,-1),g.abrupt("return");case 27:if(O.getMemory(Z)){g.next=31;break}return A(u,-1),g.abrupt("return");case 31:for(V=new Float32Array(I.buffer),h=new Int32Array(I.buffer),W=h.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),R=h.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),p=h.slice(i/Int32Array.BYTES_PER_ELEMENT,i/Int32Array.BYTES_PER_ELEMENT+r),X=V.slice(b/Float32Array.BYTES_PER_ELEMENT,(b+G.allocSize)/Float32Array.BYTES_PER_ELEMENT),H=y.chunkSize,k=o/H,W[0]/=k,S=[],J=0;J<y.workerSet.length;J++)S.push(cI(B.workers[y.workerSet[J]],{action:nI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,shape:W,indicesAddress:t,bitDepthStarts:R,bitDepths:p,numMetas:n,metasAddress:l,numBlockBytes:H,blocksAddress:s,xOffset:a,xAddress:b,xBuffer:X,biasAddress:m}));return g.next=44,Promise.all(S);case 44:for(w=g.sent,f=new Float32Array(W[0]*k),F=0;F<w.length;F++)v=new Float32Array(w[F].buffer),f.set(v,F*v.length);V.set(f,Z/Float32Array.BYTES_PER_ELEMENT);case 48:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,n,l,o,s,a,d,b){return g.apply(this,arguments)}}(),l=function(){var g=c(d.mark((function g(C,e,t,r,c,i,n,l,o,s,a,b,Z,m,u,B){var y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,v,K,N,E,U;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),e=Y(e),t=Y(t),c=Y(c),i=Y(i),l=Y(l),s=Y(s),Z=Y(Z),m=Y(m),u=Y(u),B=Y(B),y=O.getXpu(C)){g.next=15;break}return A(B,-1),g.abrupt("return");case 15:if(G=O.getMemory(s)){g.next=19;break}return A(B,-1),g.abrupt("return");case 19:if(O.getMemory(l)){g.next=23;break}return A(B,-1),g.abrupt("return");case 23:if(O.getMemory(m)){g.next=27;break}return A(B,-1),g.abrupt("return");case 27:if(V=O.getMemory(Z)){g.next=31;break}return A(B,-1),g.abrupt("return");case 31:for(h=new Float32Array(I.buffer),W=new Int32Array(I.buffer),R=W.slice(e/Int32Array.BYTES_PER_ELEMENT,e/Int32Array.BYTES_PER_ELEMENT+2),p=W.slice(c/Int32Array.BYTES_PER_ELEMENT,c/Int32Array.BYTES_PER_ELEMENT+r),X=W.slice(i/Int32Array.BYTES_PER_ELEMENT,i/Int32Array.BYTES_PER_ELEMENT+r),H=h.slice(Z/Float32Array.BYTES_PER_ELEMENT,(Z+V.allocSize)/Float32Array.BYTES_PER_ELEMENT),k=G.chunkSize,S=o/k,R[0]/=S,J=[],w=0;w<G.workerSet.length;w++)J.push(cI(y.workers[G.workerSet[w]],{action:nI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,shape:R,indicesAddress:t,bitDepthStarts:p,bitDepths:X,numMetas:n,metasAddress:l,numBlockBytes:k,blocksAddress:s,n:a,xOffset:b,xAddress:Z,xBuffer:H,biasAddress:u}));return g.next=44,Promise.all(J);case 44:for(f=g.sent,F=new Float32Array(R[0]*S*a),v=0,K=0;K<f.length;K++){for(N=new Float32Array(f[K].buffer),E=0,U=0;U<a;U++)F.set(N.slice(E,E+R[0]),E*S+v),E+=R[0];v+=R[0]}h.set(F,m/Float32Array.BYTES_PER_ELEMENT);case 49:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t,r,c,i,n,l,o,s,a,d,b,Z){return g.apply(this,arguments)}}(),o=function(){var I=c(d.mark((function I(g,C,t,r,c,i,n,l,o){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),c=Y(c),n=Y(n),l=Y(l),o=Y(o),O.getXpu(g)){I.next=9;break}return A(o,-1),I.abrupt("return");case 9:return I.next=11,e.pv_picollm_weight_float_forward_wasm(C,t,r,c,n+i,l);case 11:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c,i,n){return I.apply(this,arguments)}}();return{pv_picollm_weight_block_mixed_16x8_preprocess_blocks_web_worker_wasm:t,pv_picollm_weight_block_mixed_16x8_preprocess_metas_web_worker_wasm:r,pv_picollm_weight_block_mixed_16x8_preprocess_bias_web_worker_wasm:i,pv_picollm_weight_block_mixed_16x8_forward_single_web_worker_wasm:g.graphify(n,[11,12],12,9),pv_picollm_weight_block_mixed_16x8_forward_multiple_web_worker_wasm:g.graphify(l,[12,13],13,9),pv_picollm_weight_float_forward_web_worker_wasm:g.graphify(o,[6,7],7)}},GI=function(){var I=c(d.mark((function I(g){var C,e,A,t,r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.bitDepths,i=g.bitDepthStarts,n=g.numBlockBytes,l=g.blocksAddress,o=g.block,s=e.aligned_alloc,a=e.free,b=e.pv_picollm_weight_block_mixed_16x8_preprocess_blocks,(Z=s(Uint8Array.BYTES_PER_ELEMENT,n*Uint8Array.BYTES_PER_ELEMENT))&&(A.set(l,{allocSize:n,workerMemAddress:Z}),m=s(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),u=s(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*c.length),B=s(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),y=new Uint8Array(t.buffer),G=new Int32Array(t.buffer),y.set(o,Z),G.set(r,m/Int32Array.BYTES_PER_ELEMENT),G.set(c,u/Int32Array.BYTES_PER_ELEMENT),G.set(i,B/Int32Array.BYTES_PER_ELEMENT),b(m,c.length,u,B,Z),a(m),a(u),a(B));case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),VI=function(){var I=c(d.mark((function I(g){var C,e,A,t,r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,Y,v,K;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.indicesAddress,i=g.bitDepthStarts,n=g.bitDepths,l=g.metasAddress,o=g.blocksAddress,s=g.xOffset,a=g.xBuffer,b=g.biasAddress,Z=e.aligned_alloc,m=e.free,u=e.pv_picollm_weight_block_mixed_16x8_forward_single,B=e.pv_picollm_weight_block_mixed_16x8_add_bias,y=A.get(c),G=y.workerMemAddress,V=A.get(l),h=V.workerMemAddress,W=A.get(o),R=W.workerMemAddress,p=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),X=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),H=Z(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*n.length),k=Z(256,Float32Array.BYTES_PER_ELEMENT*a.length),S=Z(256,Float32Array.BYTES_PER_ELEMENT*r[0]),J=new Float32Array(t.buffer),(w=new Int32Array(t.buffer)).set(r,p/Int32Array.BYTES_PER_ELEMENT),w.set(i,X/Int32Array.BYTES_PER_ELEMENT),w.set(n,H/Int32Array.BYTES_PER_ELEMENT),J.set(a,k/Float32Array.BYTES_PER_ELEMENT),u(p,G,n.length,X,H,h,R,k+s,S),A.has(b)&&(f=A.get(b),F=f.workerMemAddress,Y=f.allocSize,v=Y/Float32Array.BYTES_PER_ELEMENT,B(1,v,S,F)),K=new Float32Array(t.buffer).slice(S/Float32Array.BYTES_PER_ELEMENT,S/Float32Array.BYTES_PER_ELEMENT+r[0]),m(p),m(X),m(H),m(k),m(S),I.abrupt("return",K);case 26:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),hI=function(){var I=c(d.mark((function I(g){var C,e,A,t,r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G,V,h,W,R,p,X,H,k,S,J,w,f,F,Y,v,K,N;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=g.globals,e=C.exports,A=C.memAlloc,t=C.memory,r=g.shape,c=g.indicesAddress,i=g.bitDepthStarts,n=g.bitDepths,l=g.metasAddress,o=g.blocksAddress,s=g.n,a=g.xOffset,b=g.xBuffer,Z=g.biasAddress,m=e.aligned_alloc,u=e.free,B=e.pv_picollm_weight_block_mixed_16x8_forward_multiple,y=e.pv_picollm_weight_block_mixed_16x8_add_bias,G=A.get(c),V=G.workerMemAddress,h=A.get(l),W=h.workerMemAddress,R=A.get(o),p=R.workerMemAddress,X=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*r.length),H=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*i.length),k=m(Int32Array.BYTES_PER_ELEMENT,Int32Array.BYTES_PER_ELEMENT*n.length),S=m(Float32Array.BYTES_PER_ELEMENT,Float32Array.BYTES_PER_ELEMENT*b.length),J=m(Float32Array.BYTES_PER_ELEMENT,Float32Array.BYTES_PER_ELEMENT*(r[0]*s)),w=new Float32Array(t.buffer),(f=new Int32Array(t.buffer)).set(r,X/Int32Array.BYTES_PER_ELEMENT),f.set(i,H/Int32Array.BYTES_PER_ELEMENT),f.set(n,k/Int32Array.BYTES_PER_ELEMENT),w.set(b,S/Float32Array.BYTES_PER_ELEMENT),B(X,V,n.length,H,k,W,p,s,S+a,J),A.has(Z)&&(F=A.get(Z),Y=F.workerMemAddress,v=F.allocSize,K=v/Float32Array.BYTES_PER_ELEMENT,y(s,K,J,Y)),N=new Float32Array(t.buffer).slice(J/Float32Array.BYTES_PER_ELEMENT,J/Float32Array.BYTES_PER_ELEMENT+r[0]*s),u(X),u(H),u(k),u(S),u(J),I.abrupt("return",N);case 26:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}();function WI(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(I);g&&(e=e.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,e)}return C}function RI(I,g){var C="undefined"!=typeof Symbol&&I[Symbol.iterator]||I["@@iterator"];if(!C){if(Array.isArray(I)||(C=function(I,g){if(!I)return;if("string"==typeof I)return pI(I,g);var C=Object.prototype.toString.call(I).slice(8,-1);"Object"===C&&I.constructor&&(C=I.constructor.name);if("Map"===C||"Set"===C)return Array.from(I);if("Arguments"===C||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return pI(I,g)}(I))||g&&I&&"number"==typeof I.length){C&&(I=C);var e=0,A=function(){};return{s:A,n:function(){return e>=I.length?{done:!0}:{done:!1,value:I[e++]}},e:function(I){throw I},f:A}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,r=!0,c=!1;return{s:function(){C=C.call(I)},n:function(){var I=C.next();return r=I.done,I},e:function(I){c=!0,t=I},f:function(){try{r||null==C.return||C.return()}finally{if(c)throw t}}}}function pI(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,e=new Array(g);C<g;C++)e[C]=I[C];return e}t(t(t(t(t({},nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BLOCKS,GI),nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_METAS,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.memAddress,r=I.metas,c=(0,C.aligned_alloc)(Uint16Array.BYTES_PER_ELEMENT,r.length*Uint16Array.BYTES_PER_ELEMENT);c&&(e.set(t,{allocSize:r.length*Uint16Array.BYTES_PER_ELEMENT,workerMemAddress:c}),new Uint16Array(A.buffer).set(r,c/Uint16Array.BYTES_PER_ELEMENT))})),nI.WEIGHT_BLOCK_MIXED_16X8_PREPROCESS_BIAS,(function(I){var g=I.globals,C=g.exports,e=g.memAlloc,A=g.memory,t=I.memAddress,r=I.bias,c=(0,C.aligned_alloc)(Float32Array.BYTES_PER_ELEMENT,r.length*Float32Array.BYTES_PER_ELEMENT);c&&(e.set(t,{allocSize:r.length*Float32Array.BYTES_PER_ELEMENT,workerMemAddress:c}),new Float32Array(A.buffer).set(r,c/Float32Array.BYTES_PER_ELEMENT))})),nI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_SINGLE,VI),nI.WEIGHT_BLOCK_MIXED_16X8_FORWARD_MULTIPLE,hI);return function(I,g){var e=new gI;e.memory=I;for(var A=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},r=function(){var g=c(d.mark((function g(C,e,t,r,c){var i,n,l,o,s,a,b,Z,m,u,B,y,G;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return C=Y(C),e=Y(e),t=Y(t),r=Y(r),c=Y(c),i=W.aligned_alloc,n=X.getParser(navigator.userAgent),l=new Uint8Array(I.buffer),o=n.getBrowserName(),g.next=11,i(Uint8Array.BYTES_PER_ELEMENT,(o.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 11:if(0!==(s=g.sent)){g.next=15;break}return A(c,-1),g.abrupt("return");case 15:for(A(C,s),a=0;a<o.length;a++)l[s+a]=o.charCodeAt(a);return l[s+o.length]=0,b=n.getBrowserVersion(),g.next=21,i(Uint8Array.BYTES_PER_ELEMENT,(b.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 21:if(0!==(Z=g.sent)){g.next=25;break}return A(c,-1),g.abrupt("return");case 25:for(A(e,Z),m=0;m<b.length;m++)l[Z+m]=b.charCodeAt(m);return l[Z+b.length]=0,u=n.getOSName(),g.next=31,i(Uint8Array.BYTES_PER_ELEMENT,(u.length+1)*Uint8Array.BYTES_PER_ELEMENT);case 31:if(0!==(B=g.sent)){g.next=35;break}return A(c,-1),g.abrupt("return");case 35:for(A(t,B),y=0;y<u.length;y++)l[B+y]=u.charCodeAt(y);l[B+u.length]=0,G=self.navigator.hardwareConcurrency,A(r,G||1),A(c,0);case 41:case"end":return g.stop()}}),g)})));return function(I,C,e,A,t){return g.apply(this,arguments)}}(),i=function(){var I=c(d.mark((function I(C,t,r){var c,i,n,l,o;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(C=Y(C),r=Y(r),g){I.next=5;break}return A(r,-1),I.abrupt("return");case 5:0===t&&(t=8),c=self.navigator.hardwareConcurrency,i=c&&c<t?c:t,n=[],l=0;case 10:if(!(l<i)){I.next=18;break}return o=new rI(new T),n.push(o),I.next=15,cI(o,{action:L.INIT,wasm:g});case 15:l++,I.next=10;break;case 18:if(!W.pv_picollm_feed_forward_almost_gelu_init_lookup_table){I.next=21;break}return I.next=21,W.pv_picollm_feed_forward_almost_gelu_init_lookup_table();case 21:O.addXpu(C,{deviceMem:new Set,numWorkers:i,workers:n,graph:e}),A(r,0);case 23:case"end":return I.stop()}}),I)})));return function(g,C,e){return I.apply(this,arguments)}}(),n=function(){var I=c(d.mark((function I(g,C,t,r,c,i){var n,l,o,s,a,b,Z,m,u;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),C=Y(C),i=Y(i),n=O.getXpu(g)){I.next=7;break}return A(i,-1),I.abrupt("return");case 7:if(l=n.workers,o=n.numWorkers,s=t,!Boolean(4&c)){I.next=40;break}if(a=[],!Boolean(8&c)){I.next=17;break}a.push(cI(l[0],{action:L.ALLOC,size:t,memAddress:C})),I.next=38;break;case 17:if(b=Boolean(2&c),Z=0===r?o:r,b||t%Z==0){I.next=23;break}return A(i,-1),console.error("Failed to allocate memory: alloc size ".concat(t," must be divisible by batch ").concat(Z,".")),I.abrupt("return");case 23:s=Math.ceil(t/Z/n.numWorkers)*Z,m=t,u=0;case 26:if(!(u<n.numWorkers)){I.next=38;break}if(!b){I.next=31;break}a.push(cI(l[u],{action:L.ALLOC,size:t,memAddress:C})),I.next=35;break;case 31:if(a.push(cI(l[u],{action:L.ALLOC,size:Math.min(m,s),memAddress:C})),!((m-=s)<=0)){I.next=35;break}return I.abrupt("break",38);case 35:u++,I.next=26;break;case 38:return I.next=40,Promise.all(a);case 40:O.addMemory(C,{objAddress:g,memFlag:c,allocSize:t,chunkSize:s}),e.enabled||A(i,0);case 42:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r){return I.apply(this,arguments)}}(),l=function(){var I=c(d.mark((function I(g){var C,e,A,t,r,c;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),!O.hasMemory(g)){I.next=16;break}if(C=O.getMemory(g),e=C.objAddress,A=C.memFlag,t=O.getXpu(e),Boolean(4&A)){I.next=10;break}return I.next=8,W.free(g);case 8:I.next=14;break;case 10:for(r=[],c=0;c<t.numWorkers;c++)r.push(cI(t.workers[c],{action:L.FREE,memAddress:g}));return I.next=14,Promise.all(r);case 14:O.removeMemory(g),O.removeUniquePointer(g);case 16:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),o=function(){var g=c(d.mark((function g(C,e,A,t){var r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),e=Y(e),r=O.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:if(c=r.objAddress,i=r.memFlag,n=r.chunkSize,l=O.getXpu(c),Boolean(4&i)){g.next=13;break}(o=new Uint8Array(I.buffer)).set(o.slice(e,e+t),C+A),g.next=38;break;case 13:if(s=[],a=new Uint8Array(I.buffer).slice(e,e+t),!Boolean(8&i)){g.next=20;break}s.push(cI(l.workers[0],{action:L.COPY_TO_XPU,memAddress:C,offset:A,buffer:a})),g.next=36;break;case 20:b=Boolean(2&i),Z=t,m=0;case 23:if(!(m<l.numWorkers)){g.next=36;break}if(!b){g.next=28;break}s.push(cI(l.workers[m],{action:L.COPY_TO_XPU,memAddress:C,offset:A,buffer:a})),g.next=33;break;case 28:if(u=m*n,A<(m+1)*n&&(y=n-(B=A>u?A-u:0),G=t-Z,s.push(cI(l.workers[m],{action:L.COPY_TO_XPU,memAddress:C,offset:B,buffer:a.slice(G,G+y)})),Z-=y),!(Z<=0)){g.next=33;break}return g.abrupt("break",36);case 33:m++,g.next=23;break;case 36:return g.next=38,Promise.all(s);case 38:case"end":return g.stop()}}),g)})));return function(I,C,e,A){return g.apply(this,arguments)}}(),s=function(){var g=c(d.mark((function g(C,e,A,t){var r,c,i,n,l,o,s,a,b,Z,m,u,B,y,G,V,h,W,R,p;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),e=Y(e),r=O.getMemory(C)){g.next=5;break}return g.abrupt("return");case 5:if(c=r.objAddress,i=r.allocSize,n=r.memFlag,l=r.chunkSize,o=O.getXpu(c),Boolean(4&n)){g.next=13;break}(s=new Uint8Array(I.buffer)).set(s.slice(C+A,C+A+t),e),g.next=49;break;case 13:if(a=[],b=Boolean(2&n),Z=Boolean(8&n),!b&&!Z){g.next=20;break}a.push(cI(o.workers[0],{action:L.COPY_FROM_XPU,memAddress:C,offset:A,size:i})),g.next=31;break;case 20:m=i,u=0;case 22:if(!(u<o.numWorkers)){g.next=31;break}if(B=u*l,A<(u+1)*l&&(y=A>B?A-B:0,G=Math.min(m,l-y),a.push(cI(o.workers[u],{action:L.COPY_FROM_XPU,memAddress:C,offset:y,size:G})),m-=G),0!==m){g.next=28;break}return g.abrupt("break",31);case 28:u++,g.next=22;break;case 31:return g.next=33,Promise.all(a);case 33:V=g.sent,h=new Uint8Array(I.buffer),W=0,R=0;case 37:if(!(R<V.length)){g.next=49;break}if(p=V[R],!(W+p.length>t)){g.next=44;break}return h.set(p.slice(0,t-W),e+W),g.abrupt("break",49);case 44:h.set(p,e+W),W+=p.length;case 46:R++,g.next=37;break;case 49:case"end":return g.stop()}}),g)})));return function(I,C,e,A){return g.apply(this,arguments)}}(),a=function(){var g=c(d.mark((function g(C,e,A){var t,r,c,i,n,l,o,s,a,b;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(C=Y(C),t=O.getMemory(C)){g.next=4;break}return g.abrupt("return");case 4:if(r=t.objAddress,c=t.allocSize,i=t.memFlag,n=t.chunkSize,l=O.getXpu(r),Boolean(4&i)){g.next=12;break}new Uint8Array(I.buffer).fill(e,C,C+A),g.next=35;break;case 12:if(o=[],!Boolean(8&i)){g.next=18;break}o.push(cI(l.workers[0],{action:L.MEMSET,memAddress:C,fillByte:e,size:c})),g.next=33;break;case 18:s=Boolean(2&i),a=A,b=0;case 21:if(!(b<l.numWorkers)){g.next=33;break}if(!s){g.next=26;break}o.push(cI(l.workers[b],{action:L.MEMSET,memAddress:C,fillByte:e,size:c})),g.next=30;break;case 26:if(o.push(cI(l.workers[b],{action:L.MEMSET,memAddress:C,fillByte:e,size:Math.min(a,n)})),!((a-=n)<=0)){g.next=30;break}return g.abrupt("break",33);case 30:b++,g.next=21;break;case 33:return g.next=35,Promise.all(o);case 35:case"end":return g.stop()}}),g)})));return function(I,C,e){return g.apply(this,arguments)}}(),b=function(){var I=c(d.mark((function I(g){var C;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:g=Y(g),C=self.navigator.hardwareConcurrency,A(g,C||1);case 3:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),Z=function(){var I=c(d.mark((function I(g){var C,e,A;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),C=O.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(e=[],A=0;A<C.numWorkers;A++)e.push(cI(C.workers[A],{action:L.TIMER_START,workerIndex:A}));return I.next=8,Promise.all(e);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),m=function(){var I=c(d.mark((function I(g){var C,e,A;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),C=O.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:for(e=[],A=0;A<C.numWorkers;A++)e.push(cI(C.workers[A],{action:L.TIMER_STOP}));return I.next=8,Promise.all(e);case 8:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),u=function(){var I=c(d.mark((function I(g){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),O.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:e.enabled=!0;case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),B=function(){var I=c(d.mark((function I(g){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),O.getXpu(g)){I.next=4;break}return I.abrupt("return");case 4:e.enabled=!1;case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),y=function(){var I=c(d.mark((function I(g,C){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(g=Y(g),O.getXpu(g)){I.next=5;break}return A(C,-1),I.abrupt("return");case 5:return I.prev=5,I.next=8,e.execute();case 8:A(C,0),I.next=14;break;case 11:I.prev=11,I.t0=I.catch(5),A(C,-1);case 14:case"end":return I.stop()}}),I,null,[[5,11]])})));return function(g,C){return I.apply(this,arguments)}}(),G=function(){var g=c(d.mark((function g(C,e,A){var t;return d.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return A=Y(A),g.prev=1,g.next=4,W.aligned_alloc(C,e);case 4:t=g.sent,new Int32Array(I.buffer)[A/Int32Array.BYTES_PER_ELEMENT]=t,g.next=13;break;case 9:g.prev=9,g.t0=g.catch(1),new Int32Array(I.buffer)[A/Int32Array.BYTES_PER_ELEMENT]=0;case 13:case"end":return g.stop()}}),g,null,[[1,9]])})));return function(I,C,e){return g.apply(this,arguments)}}(),V=function(){var I=c(d.mark((function I(g){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,W.free(g);case 2:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),h=function(){var I=c(d.mark((function I(g,C,e,A){return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,W.pv_picollm_table_forward(g,C,e,A);case 2:case"end":return I.stop()}}),I)})));return function(g,C,e,A){return I.apply(this,arguments)}}(),W=function(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?WI(Object(C),!0).forEach((function(g){t(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):WI(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}({aligned_alloc:function(I,g){throw new Error("aligned_alloc was not passed in from parent module")},free:function(I){throw new Error("free was not passed in from parent module")},pv_picollm_table_forward:function(I,g,C,e){throw new Error("pv_picollm_table_forward was not passed in from parent module")},pv_picollm_feed_forward_almost_gelu_init_lookup_table:void 0,pv_xpu_graphified_alloc_wasm:e.graphify(G,[2],2,void 0,1),pv_xpu_graphified_free_wasm:e.graphify(V,[0],0,void 0,1),pv_xpu_web_worker_device_info_wasm:r,pv_xpu_web_worker_device_init_wasm:i,pv_xpu_web_worker_device_cleanup_wasm:function(I){I=Y(I);var g=O.getXpu(I);if(g){var C,e=RI(g.workers);try{for(e.s();!(C=e.n()).done;){C.value.terminate()}}catch(I){e.e(I)}finally{e.f()}O.removeXpu(I)}},pv_xpu_web_worker_device_get_unique_pointer_wasm:function(){return O.getUniquePointer()},pv_xpu_web_worker_device_mem_alloc_wasm:e.graphify(n,[1],1),pv_xpu_web_worker_device_mem_free_wasm:e.graphify(l,[0],0,void 0,void 0),pv_xpu_web_worker_device_mem_copy_to_xpu_wasm:e.graphify(o,[0,1],0,void 0,void 0),pv_xpu_web_worker_device_mem_copy_from_xpu_wasm:e.graphify(s,[0,1],-1,void 0,void 0),pv_xpu_web_worker_device_mem_memset_wasm:e.graphify(a,[0],0,void 0,void 0),pv_xpu_web_worker_get_max_workers_wasm:b,pv_xpu_web_worker_timer_start_wasm:Z,pv_xpu_web_worker_timer_stop_wasm:m,pv_xpu_web_worker_start_graph_wasm:u,pv_xpu_web_worker_stop_graph_wasm:B,pv_xpu_web_worker_execute_graph_wasm:y,pv_xpu_web_worker_picollm_table_forward_wasm:e.graphify(h,[2,3],3,void 0,void 0)},function(I){var g=function(g,C){new Int32Array(I.buffer)[g/Int32Array.BYTES_PER_ELEMENT]=C},C=function(){var I=c(d.mark((function I(C,e,A,t,r,c,i){var n,l,o,s,a,b,Z,m,u,B,y;return d.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(n=O.getXpu(C)){I.next=4;break}return g(i,-1),I.abrupt("return");case 4:if(l=O.getMemory(e)){I.next=8;break}return g(i,-1),I.abrupt("return");case 8:o=n.numWorkers,s=l.chunkSize/(r/2),a=t,b=[],Z=0;case 13:if(!(Z<o)){I.next=21;break}if(b.push(cI(n.workers[Z],{action:L.MATRIX_VECTOR_MULTIPLY,matrixAddress:e,vectorAddress:A,m:Math.min(a,s),n:r,resultAddress:c})),!((a-=s)<=0)){I.next=18;break}return I.abrupt("break",21);case 18:Z++,I.next=13;break;case 21:return m=new Float32Array(r),I.next=24,Promise.all(b);case 24:for(u=I.sent,B=0;B<u.length;B++)u[B].length>0&&m.set(u[B],B*s);for(b=[],y=0;y<o;y++)b.push(cI(n.workers[y],{action:L.SYNC_VECTOR,vectorAddress:c,buffer:m}));return I.next=30,Promise.all(b);case 30:case"end":return I.stop()}}),I)})));return function(g,C,e,A,t,r,c){return I.apply(this,arguments)}}();return{pv_matrix_vector_multiply_web_worker_wasm:C}}(I)),R=0,p=[iI,lI,oI,sI,aI,dI,bI,yI];R<p.length;R++)for(var H=p[R],k=0,S=Object.entries(H(I,e,W));k<S.length;k++){var J=C(S[k],2),w=J[0],f=J[1];W[w]=f}return W}}();
