<!DOCTYPE html>
<html lang="en">
<head>
  <script src="node_modules/@picovoice/picollm-web/dist/iife/index.js"></script>
  <script type="application/javascript">

    let accessKey = null;
    let modelFile = null;
    let modelUrl = null;
    let picoLLM = null;
    let prompt = "";

    let llmResponse = "";

    window.onload = () => {
      const accessKeyInput = document.getElementById("accessKey")
      const uploadFileInput = document.getElementById("uploadFile");
      const fetchUrlInput = document.getElementById("fetchUrl");
      const promptInput = document.getElementById("prompt");

      accessKeyInput.addEventListener("input", (event) => {
        accessKey = event.target.value.trim();
      });

      uploadFileInput.addEventListener("change", (event) => {
        modelFile = event.target.files[0];
      });

      fetchUrlInput.addEventListener("input", (event) => {
        modelUrl = event.target.value.trim();
      });

      promptInput.addEventListener("input", (event) => {
        prompt = event.target.value.trim();
      });
    };

    function writeMessage(message) {
      console.log(message);
      document.getElementById("status").innerHTML = message;
    }

    async function startPicoLLM() {
      writeMessage("picoLLM is loading. Please wait...");
      try {
        let model = {
          modelFile: modelFile ? modelFile : modelUrl,
          cacheFileOverwrite: true
        }

        picoLLM = await PicollmWeb.PicoLLM.create(accessKey, model);
        writeMessage("picoLLM ready!");
      } catch (err) {
        writeMessage(err);
      }
    }

    async function generate() {

      llmResponse = "";
      const streamCallback = (token) => {
        llmResponse += token;
        writeMessage(llmResponse)
      }

      const result = await picoLLM.generate(prompt, {
        completionTokenLimit: 30,
        streamCallback
      });
      writeMessage(result.completion);
    }
  </script>
</head>
<body>
<h1>picoLLM Web Demo</h1>
<hr/>
<label for="accessKey">
  AccessKey obtained from
  <a href="https://console.picovoice.ai/">Picovoice Console</a>:
</label>
<input type="text" id="accessKey" name="accessKey"/>
<br><br>
<label for="uploadFile">Upload model file: </label>
<input id="uploadFile" name="uploadFile" type="file">
<h3>OR</h3>
<label for="fetchUrl">Download model from URL: </label>
<input id="fetchUrl" name="fetchURL" type="text" />
<br><br>
<input type="button" value="Init picoLLM" onclick="startPicoLLM()"/>
<hr/>
<br>
<label for="prompt">Prompt: </label>
<textarea id="prompt" name="prompt"></textarea>
<input type="button" value="Generate" onclick="generate()"/>
<br>
<hr/>
<div id="status" style="white-space: pre;"></div>
<br>
<div id="result"></div>
</body>
</html>
